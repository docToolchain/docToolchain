<!doctype html>
<html lang="de">
<head>
  
  <!-- 010_manual/single-page.html -->
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="jbake" name="generator">
  <meta content="INDEX, FOLLOW" name="ROBOTS">

  <title>docToolchain Manual</title>
  <meta content="docToolchain" property="og:title">
  <meta content="build your dev docs the easy way..." property="og:description">
  <meta content="website" property="og:type">
  <meta content="docToolchain" property="og:site_name">
  <meta content="docToolchain" itemprop="name">
  <meta content="build your dev docs the easy way..." itemprop="description">
  <meta content="summary" name="twitter:card">
  <meta content="docToolchain" name="twitter:title">
  <meta content="build your dev docs the easy way..." name="twitter:description">

  <link as="style" href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css"
        rel="preload">
  <link href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css" integrity=""
        rel="stylesheet">
  <link href="../css/asciidoctor.css" rel="stylesheet">
  <link href="../css/prettify.css" rel="stylesheet">

    <!-- favicon generated with https://www.favicon-generator.org/ -->
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="../android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  <script crossorigin="anonymous" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
          src="../js/jquery-3.5.1.min.js"></script>
  <style>
      div.bg-light {
          background-color: rgba(127, 180, 224, 0.3) !important;
      }
      //for blog posts

  span.blogtag {
      border-radius: 10px;
      background-color: #30638E;
      color: white;
      padding: 5px 10px;
  }
  span.blogblogtag a {
      color: white;
      padding: 0
  }
  span.blogtag span {
      margin-left: 10px;
      border-radius: 10px;
      background-color: white;
      color: #30638E;
  }
  div.td-toc {
    height: calc(100vh - 5rem) !important;
  }
  div#toctitle {
    display: none
  }
  #td-section-nav {
    max-height: calc(100vh - 4rem);
    font-size: smaller;
    line-hight: 1.1;
  }
  .td-page-meta {
      font-size: smaller;
      line-hight: 1.1;
  }
  #td-section-nav ul.td-sidebar-nav__section  {
    padding-left:0px;
  }
  .match {
      font-size: smaller;
  }
      .admonitionblock td.icon .fa:before {
          font-size: xxx-large;
      }
  </style>

   <style>
    div.openblock.primary div.content, div.openblock.secondary div.content {
        border: 1px solid #7a2518;
        padding: 5px;
    }
    div.openblock.primary div.content div.content, div.openblock.secondary div.content div.content {
        border: 0px solid #7a2518;
        padding: 0;
    }

    .hidden {
        display: none;
    }

    .switch {
        border-width: 1px 1px 0 1px;
        border-style: solid;
        border-color: #7a2518;
        display: inline-block;
    }

    .switch--item {
        padding: 2px 10px;
        background-color: #ffffff;
        color: #7a2518;
        display: inline-block;
        cursor: pointer;
    }

    .switch--item:not(:first-child) {
        border-width: 0 0 0 1px;
        border-style: solid;
        border-color: #7a2518;
    }

    .switch--item.selected {
        background-color: #7a2519;
        color: #ffffff;
    }
    </style>


</head>

<body onload="prettyPrint()" class="td-section">
<header>
	
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <a class="navbar-brand" href="../index.html">
        <span class="navbar-logo"></span><span
            class="font-weight-bold">docToolchain</span>
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
        <ul class="navbar-nav mt-2 mt-lg-0">
    <li class="nav-item mr-4 mb-2 mb-lg-0"><!--img src="../images/status.png" alt="status" width="16" height="16" onerror="this.style.display='none'"--></li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../10_about/10_about-the-project.html"><span>About</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link active" href="../010_manual/20_install.html"><span>User Docs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../015_tasks/03_tasks.html"><span>Tasks</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../020_tutorial/010_Install.html"><span>Tutorial</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../025_development/010_setup_dev_env.html"><span>For Devs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../030_news/index.html"><span>News</span></a>
            </li>

        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block" >
        <form action="../search.html">
        <input aria-label="Search this siteâ€¦" autocomplete="off" class="form-control td-search-input"
               placeholder="ï€‚ Search this siteâ€¦" type="search" name="q">
        </form>
    </div>
</nav>

</header>
<div class="container-fluid td-outer">
	<div class="td-main">
		<div class="row flex-xl-nowrap">
			<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
				<div class="td-sidebar__inner" id="td-sidebar-menu" >
					
        <form class="td-sidebar__search d-flex align-items-center d-lg-none" action="../search.html">

            <input aria-label="Search this siteâ€¦" name="q" autocomplete="off" class="form-control td-search-input"
                   placeholder="ï€‚ Search this siteâ€¦" type="search">


            <button aria-controls="td-docs-nav" aria-expanded="false"
                    aria-label="Toggle section navigation" class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" data-target="#td-section-nav"
                    data-toggle="collapse" type="button">
            </button>
        </form>

        <nav class="collapse td-sidebar-nav" id="td-section-nav" >

            <ul class="td-sidebar-nav__section pr-md-3">
                <ul>
                    <li class="collapse show" id="docs">
                        <ul class="td-sidebar-nav__section pr-md-3">
                <div id="toc" class="toc">
<div id="toctitle">toc-title</div>
<ul class="sectlevel2">
<li><a href="#_autobuildsite">1. autobuildSite</a>
<ul class="sectlevel3">
<li><a href="#_about_this_task">1.1. About This Task</a></li>
<li><a href="#_source">1.2. Source</a></li>
<li><a href="#_generatehtml">1.3. generateHTML</a></li>
<li><a href="#_fixencoding">1.4. fixEncoding</a></li>
<li><a href="#_prependfilename">1.5. prependFilename</a></li>
<li><a href="#_collectincludes">1.6. collectIncludes</a></li>
<li><a href="#_generatepdf">1.7. generatePDF</a></li>
<li><a href="#task_generatesite">1.8. generateSite</a></li>
<li><a href="#_generatedocbook">1.9. generateDocbook</a></li>
<li><a href="#_generatedeck">1.10. generateDeck</a></li>
<li><a href="#_publishtoconfluence">1.11. publishToConfluence</a></li>
<li><a href="#_converttodocx">1.12. convertToDocx</a></li>
<li><a href="#_createreferencedoc">1.13. createReferenceDoc</a></li>
<li><a href="#_converttoepub">1.14. convertToEpub</a></li>
<li><a href="#_exportea">1.15. exportEA</a></li>
<li><a href="#_exportvisio">1.16. exportVisio</a></li>
<li><a href="#_exportdrawio">1.17. exportDrawIo</a></li>
<li><a href="#_exportchangelog">1.18. exportChangeLog</a></li>
<li><a href="#_exportcontributors">1.19. exportContributors</a></li>
<li><a href="#_exportjiraissues">1.20. exportJiraIssues</a></li>
<li><a href="#_exportjirasprintchangelogissues">1.21. exportJiraSprintChangelogIssues</a></li>
<li><a href="#_exportppt">1.22. exportPPT</a></li>
<li><a href="#_exportexcel">1.23. exportExcel</a></li>
</ul>
</li>
<li><a href="#_about_this_task_18">2. About This Task</a>
<ul class="sectlevel3">
<li><a href="#_source_21">2.1. Source</a></li>
<li><a href="#_exportopenapi">2.2. exportOpenAPI</a></li>
<li><a href="#_htmlsanitycheck">2.3. htmlSanityCheck</a></li>
<li><a href="#_dependencyupdates">2.4. dependencyUpdates</a></li>
</ul>
</li>
</ul>
</div>

                        </ul>
                    </li>
                </ul>
        </nav>

				</div>
			</div>
			<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
				<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
					
        <a href="https://github.com/doctoolchain/doctoolchain/edit/ng/src/docs/010_manual/single-page.adoc"
           target="_blank"><i class="fa fa-edit fa-fw"></i> Improve this doc</a>
        <!--a href="https://github.com/google/docsy-example/new/master/content/en/docs/_index.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A"
           target="_blank"><i class="fa fa-edit fa-fw"></i> Create child page</a-->
        <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc" target="_blank"><i
                class="fab fa-github fa-fw"></i> Create an issue</a>
        <!--a href="https://github.com/google/docsy/issues/new" target="_blank"><i
                class="fas fa-tasks fa-fw"></i> Create project issue</a-->
        <!--a href="https://example.docsy.dev/docs/_print/" id="print"><i class="fa fa-print fa-fw"></i> Print
        entire section</a-->
        

				</div>
			</div>
			<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
				    <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
        <ol class="breadcrumb spb-1">
            <!--li aria-current="page" class="breadcrumb-item active">
                <a href="https://example.docsy.dev/docs/">Documentation</a>
            </li-->

        </ol>
    </nav>


    <div class="td-content">
        <p>
            
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<h2 id="_doctoolchain_manual" class="discrete">docToolchain Manual</h2>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<script>
document.location.href = '../10_about/20_what-is-doctoolchain.html';
</script>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::020_install.adoc[leveloffset=+1]</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::025_features.adoc[leveloffset=+1]</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div class="sect2">
<h3 id="_autobuildsite">1. autobuildSite</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c8d80df8d69ee21f98fc9a9bfa527897?d=identicon" alt="Julian Elve" width="32" height="32" title="Julian Elve"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect3">
<h4 id="_about_this_task">1.1. About This Task</h4>
<div class="paragraph">
<p>This script starts an endless loop which checks for changes to your docs source then re-runs the <code>generateSite</code>-task whenever it detects changes.
The output will be logged to <code>build/generateSite.log</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_source">1.2. Source</h4>
<div class="listingblock">
<div class="title">bin/autobuildSite.bash</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">#!/bin/bash
DIR_TO_WATCH='src/'
#COMMAND='rm -r build || true &amp;&amp; mkdir -p build/microsite/output/images/ &amp;&amp; ./dtcw generateSite 2&gt;&amp;1 | tee build/generateSite.log'
COMMAND='mkdir -p build/microsite/output/images/ &amp;&amp; ./dtcw generateSite 2&gt;&amp;1 | tee build/generateSite.log'

#execute first time
cp src/docs/images/ready.png build/microsite/output/images/status.png
#eval $COMMAND

#wait for changes and execute
while true ; do
  watch --no-title --chgexit "ls -lR ${DIR_TO_WATCH} | sha1sum"
  cp src/docs/images/building.png build/microsite/output/images/status.png
  eval "$COMMAND"
  cp src/docs/images/ready.png build/microsite/output/images/status.png
  sleep 6
done</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
<div class="sect3">
<h4 id="_generatehtml">1.3. generateHTML</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/396a442cdf8e71070a810ed30f8d2285?d=identicon" alt="Jan Hendriks" width="32" height="32" title="Jan Hendriks"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/73252f762a6ec69bb59a23c8ff861c4a?d=identicon" alt="David M. Carr" width="32" height="32" title="David M. Carr"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateHTML.png" alt="generateHTML">
</div>
</div>
<div class="paragraph">
<p>This is the standard AsciiDoctor generator which is supported out of the box.</p>
</div>
<div class="paragraph">
<p>The result is written to <code>build/html5</code>.
The HTML files need the images folder to be in the same directory to display correctly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you would like to have a single-file HTML as result, you can configure AsciiDoctor to store the images inline as <code>data-uri</code>.<br>
Just set <code>:data-uri:</code> in the config of your AsciiDoc file.<br>
But be warned - such a file can become very big easily and some browsers might get into trouble rendering them.<br>
<a href="https://rdmueller.github.io/single-file-html/" class="bare">https://rdmueller.github.io/single-file-html/</a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_text_based_diagrams">Text based Diagrams</h5>
<div class="paragraph">
<p>For docToolchain, it is configured to use the <a href="https://asciidoctor.org/docs/asciidoctor-diagram/">asciidoctor-diagram</a> plugin which is used to create PlantUML diagrams.</p>
</div>
<div class="paragraph">
<p>The plugin also supports a bunch of other text based diagrams, but <a href="http://plantuml.com/">PlantUML</a> is the most used.</p>
</div>
<div class="paragraph">
<p>To use it, just specify your PlantUML code like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.example diagram
[plantuml, "{plantUMLDir}demoPlantUML", png] # <b class="conum">(1)</b>
----
class BlockProcessor
class DiagramBlock
class DitaaBlock
class PlantUmlBlock

BlockProcessor &lt;|-- DiagramBlock
DiagramBlock &lt;|-- DitaaBlock
DiagramBlock &lt;|-- PlantUmlBlock
----</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The element of this list specifies the diagram tool <code>plantuml</code> to be used.<br>
The second element is the name of the image to be created and the third specifies the image type.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>{plantUMLDir}</code> ensures that PlantUML also works for the <a href="03_task_generatePDF.html"><code>generatePDF</code></a> task.
Without it, <a href="03_task_generateHTML.html"><code>generateHTML</code></a> works fine, but the PDF will not contain the generated images.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Make sure to specify a unique image name for each diagram, otherwise they will overwrite each other.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example renders as</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUML.png" alt="{plantUMLDir}demoPlantUML" width="269" height="282">
</div>
<div class="title">Figure 1. example diagram</div>
</div>
<div class="paragraph">
<p>If you want to control the size of the generated diagram in the output, you can configure the "width" attribute (in pixels) or "scale" attribute (floating point ratio) passed to <a href="https://asciidoctor.org/docs/asciidoctor-diagram/">asciidoctor-diagram</a>.
For example, if you take the example diagram above and change the declaration to one of the below versions</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[plantuml, target="{plantUMLDir}demoPlantUMLWidth", format=png, width=250]
# rest of the diagram definition

[plantuml, target="{plantUMLDir}demoPlantUMLScale", format=png, scale=0.75]
# rest of the diagram definition</pre>
</div>
</div>
<div class="paragraph">
<p>it will render like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUMLWidth.png" alt="{plantUMLDir}demoPlantUMLWidth" width="250" height="282">
</div>
<div class="title">Figure 2. example diagram (with specified width)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUMLScale.png" alt="{plantUMLDir}demoPlantUMLScale" width="201" height="211">
</div>
<div class="title">Figure 3. example diagram (with specified scale)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
PlantUML needs Graphviz dot installed to work.
If you can&#8217;t install it, you can use the Java based version of the dot library.
Just add <code>!pragma graphviz_dot smetana</code> as the first line of your diagram definition.
This is still an experimental feature, but already works quite well!<br>
<a href="https://rdmueller.github.io/plantuml-without-graphviz/" class="bare">https://rdmueller.github.io/plantuml-without-graphviz/</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Blog-Posts: <a href="https://rdmueller.github.io/plantuml-gradle/">PlantUML with Gradle</a>, <a href="https://rdmueller.github.io/plantUML-and-pdf/">plantUML with Asciidoctor-pdf</a>, <a href="https://rdmueller.github.io/plantUML-revisited/">plantUML revisited</a>, <a href="https://rdmueller.github.io/plantuml-without-graphviz/">How to use PlantUML without Graphviz</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_source_2">Source</h5>
<div class="listingblock">
<div class="title">AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateHTML (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use html5 as asciidoc backend') {
        attributes (
            'plantUMLDir'         : file("${docDir}/${config.outputPath}/html5").toURI().relativize(new File("${docDir}/${config.outputPath}/html5/plantUML/").toURI()).getPath(),
        )

    // specify output folder explicitly to avoid cleaning targetDir from other generated content
    outputDir = file(targetDir + '/html5/')
    separateOutputDirs(false)

    def sourceFilesHTML = sourceFiles.findAll {
                                'html' in it.formats
                            }
//    onlyIf {
//        sourceFilesHTML
//    }

    sources {
        sourceFilesHTML.each {
            include it.file
            logger.info it.file
        }
    }
    resources {
        config.imageDirs.each { imageDir -&gt;
            from(new File(file(srcDir),imageDir))
            logger.info ('imageDir: '+imageDir)
            into './images'
        }
        config.resourceDirs.each { resource -&gt;
            from(new File(file(srcDir),resource.source))
            logger.info ('resource: '+resource.source)
            into resource.target
        }
    }
    backends = ['html5']
doFirst {
    if (sourceFilesHTML.size()==0) {
        throw new Exception ("""

&gt;&gt; No source files defined for type HTML.
&gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
""")
    }

}
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::../015_tasks/03_copy_themes.adoc[leveloffset=+2]</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_fixencoding">1.4. fixEncoding</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_2">About This Task</h5>
<div class="paragraph">
<p>Whenever Asciidoctor has to process a file that is not UTF-8 encoded, Ruby tries to read it, then throws an error similar to this one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>asciidoctor: FAILED: /home/demo/test.adoc: Failed to load AsciiDoc document - invalid byte sequence in UTF-8</pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, finding the incorrectly encoded file is difficult if a lot of <code>includes::</code> are used, and Asciidoctor will only show the name of the main document. This is not Asciidoctor&#8217;s fault. The fault lies with the Ruby interpreter that sits underneath.</p>
</div>
<div class="paragraph">
<p>The fixEncoding task crawls through all <code>*.ad</code> and <code>*.adoc</code> files and checks their encoding.
If it comes across a file which is not UTF-8 encoded, it will rewrite it with the UTF-8 encoding.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_3">Source</h5>
<div class="listingblock">
<div class="title">scripts/fixEncoding.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.util.*
import static groovy.io.FileType.*

task fixEncoding(
        description: 'finds and converts non UTF-8 adoc files to UTF-8',
        group: 'docToolchain helper',
) {
    doLast {
        File sourceFolder = new File("${docDir}/${inputPath}")
        println("sourceFolder: " + sourceFolder.canonicalPath)
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^.*(ad|adoc|asciidoc)$') {
                CharsetToolkit toolkit = new CharsetToolkit(file);
                // guess the encoding
                def guessedCharset = toolkit.getCharset().toString().toUpperCase();
                if (guessedCharset!='UTF-8') {
                    def text = file.text
                    file.write(text, "utf-8")
                    println("  converted ${file.name} from '${guessedCharset}' to 'UFT-8'")
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_prependfilename">1.5. prependFilename</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_3">About This Task</h5>
<div class="paragraph">
<p>When Asciidoctor renders a file, the file context only knows the name of the top-level AsciiDoc file. But an include file doesn&#8217;t know that it is being included.
It simply gets the name of the master file and has no chance to get its own name as an attribute.
This task crawls through all AsciiDoc files and prepends the name of the current file like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>:filename: 015_tasks/03_task_prependFilename.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>This way, each file gets its own filename.
This enables features like the inclusion of file contributors (see exportContributors-task).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This task skips all files named <code>config.*</code>, <code>_config.*</code>, <code>feedback.*</code> and <code>_feedback.*</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_source_4">Source</h5>
<div class="listingblock">
<div class="title">scripts/prependFilename.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.io.FileType.*

task prependFilename(
        description: 'crawls through all AsciiDoc files and prepends the name of the current file',
        group: 'docToolchain helper',
) {
    doLast {
        File sourceFolder = new File("${docDir}/${inputPath}")
        println("sourceFolder: " + sourceFolder.canonicalPath)
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^.*(ad|adoc|asciidoc)$') {
                if (file.name.split('[.]')[0] in ["feedback", "_feedback", "config", "_config"]) {
                    println "skipped "+file.name
                } else {
                    def text = file.getText('utf-8')
                    def name = file.canonicalPath - sourceFolder.canonicalPath
                    name = name.replace("\\", "/").replaceAll("^/", "")
                    if (text.contains(":filename:")) {
                        text = text.replaceAll(":filename:.*", ":filename: $name")
                        println "updated "+name
                    } else {
                        text = ":filename: $name\n" + text
                        println "added   "+name
                    }
                    file.write(text,'utf-8')
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_collectincludes">1.6. collectIncludes</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c8d80df8d69ee21f98fc9a9bfa527897?d=identicon" alt="Julian Elve" width="32" height="32" title="Julian Elve"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Mueller" width="32" height="32" title="Ralf D. Mueller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_4">About This Task</h5>
<div class="paragraph">
<p>This task crawls through your entire project looking for AsciiDoc files with a specific name pattern, then creates a single AsciiDoc file which includes only those files.</p>
</div>
<div class="paragraph">
<p>When you create modular documentation, most includes are static.
For example, the arc42-template has 12 chapters and a master template that includes those 12 chapters.</p>
</div>
<div class="paragraph">
<p>Normally when you work with dynamic modules like ADRs (Architecture Decision Records) you create those files on the fly.
Maybe not within your <code>/src/docs</code> folder, but alongside the code file for which you wrote the ADR.
In order to include these files in your documentation, you have to add the file with its whole relative path to one of your AsciiDoc files.</p>
</div>
<div class="paragraph">
<p>This task will handle it for you!</p>
</div>
<div class="paragraph">
<p>Just stick to this file-naming pattern <code>^[A-Z]{3,}[-_].*</code> (begin with at least three uppercase letters and a dash/underscore) and this task will collect the file and write it to your build folder.
You only have to include this generated file from within your documentation.
If you provide templates for the documents, those templates are skipped if the name matches the pattern <code>^.\*[-\_][tT]emplate[-\_].*</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example">Example</h5>
<div class="paragraph">
<p>You have a file called:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/src/java/yourCompany/domain/books/ADR-1-whyWeUseTheAISINInsteadOFISBN.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>The task will collect this file and write another file called:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/build/docs/_includes/ADR_includes.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which will look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>include::../../../src/java/yourCompany/domain/books/ADR-1-whyWeUseTheAISINInsteadOFISBN.adoc[]</pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, you&#8217;ll reap the most benefits if the task has several ADR files to collect.
ðŸ˜Ž</p>
</div>
<div class="paragraph">
<p>You can then include these files in your main documentation by using a single include:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>include::{targetDir}/docs/_includes/ADR_includes.adoc[]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_5">Source</h5>
<div class="listingblock">
<div class="title">scripts/collectIncludes.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.io.FileType.*
import java.security.MessageDigest

task collectIncludes(
        description: 'collect all ADRs as includes in one file',
        group: 'docToolchain'
) {
    doFirst {
        new File(targetDir, '_includes').mkdirs()
    }
    doLast {
        //let's search the whole project for files, not only the docs folder
        //could be a problem with node projects :-)

        //running as subproject? set scandir to main project
        if (project.name!=rootProject.name &amp;&amp; scanDir=='.') {
            scanDir = project(':').projectDir.path
        }
        if (docDir.startsWith('.')) {
            docDir = file(new File(projectDir, docDir).canonicalPath)
        }
        logger.info "docToolchain&gt; docDir: ${docDir}"
        logger.info "docToolchain&gt; scanDir: ${scanDir}"
        if (scanDir.startsWith('.')) {
            scanDir = file(new File(docDir, scanDir).canonicalPath)
        } else {
            scanDir = file(new File(scanDir, "").canonicalPath)
        }
        logger.info "docToolchain&gt; scanDir: ${scanDir}"

        logger.info "docToolchain&gt; includeRoot: ${includeRoot}"

        if (includeRoot.startsWith('.')) {
            includeRoot = file(new File(docDir, includeRoot).canonicalPath)
        }
        logger.info "docToolchain&gt; includeRoot: ${includeRoot}"

        File sourceFolder = scanDir
        println "sourceFolder: " + sourceFolder.canonicalPath
        def collections = [:]
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^[A-Z]{3,}[-_].*[.](ad|adoc|asciidoc)$') {
                def type = file.name.replaceAll('^([A-Z]{3,})[-_].*$','\$1')
                if (!collections[type]) {
                    collections[type] = []
                }
                logger.info "file: " + file.canonicalPath
                def fileName = (file.canonicalPath - scanDir.canonicalPath)[1..-1]
                if (file.name ==~ '^.*[Tt]emplate.*$') {
                    logger.info "ignore template file: " + fileName
                } else {
                    if (file.name ==~ '^.*[A-Z]{3,}_includes.adoc$') {
                        logger.info "ignore generated _includes files: " + fileName
                    } else {
                        if ( fileName.startsWith('docToolchain') || fileName.replace("\\", "/").matches('^.*/docToolchain/.*$')) {
                            //ignore docToolchain as submodule
                        } else {
                            logger.info "include corrected file: " + fileName
                            collections[type] &lt;&lt; fileName
                        }
                    }
                }
            }
        }
        println "targetFolder: " + (targetDir - docDir)
        logger.info "targetDir - includeRoot: " + (targetDir - includeRoot)
        def pathDiff = '../' * ((targetDir - docDir)
                                    .replaceAll('^/','')
                                    .replaceAll('/$','')
                                    .replaceAll("[^/]",'').size()+1)

        logger.info "pathDiff: " + pathDiff
        collections.each { type, fileNames -&gt;
            if (fileNames) {
                def outFile = new File(targetDir+'/_includes', type + '_includes.adoc')
                logger.info outFile.canonicalPath-sourceFolder.canonicalPath
                outFile.write("// this is autogenerated\n")
                fileNames.sort().each { fileName -&gt;
                    outFile.append ("include::../"+pathDiff+fileName.replace("\\", "/")+"[]\n\n")
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_generatepdf">1.7. generatePDF</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generatePDF.png" alt="generatePDF">
</div>
</div>
<div class="paragraph">
<p>This task makes use of the <a href="https://asciidoctor.org/docs/convert-asciidoc-to-pdf/">asciidoctor-pdf</a> plugin to render your documents as a pretty PDF file.</p>
</div>
<div class="paragraph">
<p>The file will be written to <code>build/pdf</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The used plugin is still in alpha status, but the results are already quite good.
If you want to use another way to create a PDF, use <a href="https://phantomjs.org/">PhantomJS</a> for instance and script it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The PDF is generated directly from your AsciiDoc sources without the need of an intermediate format or other tools.
The result looks more like a nicely rendered book than a print-to-pdf HTML page.</p>
</div>
<div class="paragraph">
<p>It is very likely that you need to "theme" you PDF - change colors, fonts, page header, and footer.
This can be done by creating a <code>custom-theme.yml</code> file.
As a starting point, copy the file <code>src/docs/pdfTheme/custom-theme.yml</code> from docToolchain to your project and reference it from your main <code>.adoc`file via setting the `:pdf-stylesdir:</code>.
For instance, insert</p>
</div>
<div class="literalblock">
<div class="content">
<pre>:pdf-stylesdir: ../pdfTheme</pre>
</div>
</div>
<div class="paragraph">
<p>at the top of your document to reference the <code>custom-theme.yml</code> from the <code>/pdfTheme</code> folder.</p>
</div>
<div class="paragraph">
<p>Documentation on how to modify a theme can be found in the <a href="https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc">asciidoctor-pdf theming guide</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Blog-Post: <a href="https://rdmueller.github.io/pdf-output/">Beyond HTML</a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_source_6">Source</h5>
<div class="listingblock">
<div class="title">AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generatePDF (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use pdf as asciidoc backend') {

    attributes (
        'plantUMLDir'         : file("${docDir}/${config.outputPath}/pdf/images/plantUML/").path,
    )

    attributes (
        'data-uri': 'true',
        'plantUMLDir'         : file("${docDir}/${config.outputPath}/images/").path,
        'imagesoutdir'        : file("${docDir}/${config.outputPath}/images/").path
    )

    def sourceFilesPDF = sourceFiles.findAll {
        'pdf' in it.formats
    }
//    onlyIf {
//        sourceFilesPDF
//    }

    sources {
        sourceFilesPDF.each {
            include it.file
            logger.info it.file
        }
    }

    backends = ['pdf']
    /**
    //check if a remote pdfTheme is defined
    def pdfTheme = System.getenv('DTC_PDFTHEME')
    def themeFolder = pdfTheme.md5()
    if (pdfTheme) {
        //check if it is already installed
        //TODO: finish this...
    }
    **/
    doFirst {
            if (sourceFilesPDF.size()==0) {
                throw new Exception ("""

    &gt;&gt; No source files defined for type PDF.
    &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
    """)
            }

    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="task_generatesite">1.8. generateSite</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>4 minutes to read</pre>
</div>
</div>
<div class="paragraph">
<p>When you have <em>one</em> document, the output of <code>generateHTML</code> might fit your needs.
When your documentation grows, and you have <em>several</em> documents, you need a microsite which bundles all the information.</p>
</div>
<div class="paragraph">
<p>The <code>generateSite</code> task uses <a href="https://jbake.org">jBake</a> to create a static site with a Landingpage, Blog and Search.</p>
</div>
<div class="sect4">
<h5 id="_pages">Pages</h5>
<div class="paragraph">
<p>The microsite is page oriented instead of document oriented.
It is likely that you already organized your documents by chapter.
Use these chapters as pages to create a great user experience.</p>
</div>
<div class="paragraph">
<p>The arc42-template sources are a good example.</p>
</div>
<div class="paragraph">
<p>In order to include a page in the microsite, add a meta-data header to it.</p>
</div>
<div class="listingblock">
<div class="title">page meta-data</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:jbake-menu: arc42
:jbake-title: Solution Strategy
:jbake-order: 4
:jbake-type: page_toc
:jbake-status: published
:filename: 015_tasks/03_task_generateSite.adoc

:toc:

[[section-solution-strategy]]
=== Solution Strategy</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">jbake-menu</dt>
<dd>
<p>the top-level menu for this page.
Defaults to the top-level folder name of the adoc file within the <code>docDir</code>.</p>
</dd>
<dt class="hdlist1">jbake-title</dt>
<dd>
<p>the title to be displayed in the drop-down top-level menu.
Defaults to the first headline of the file.</p>
</dd>
<dt class="hdlist1">jbake-order</dt>
<dd>
<p>give the drop-down entries a sort order.
Defaults to a prefixed number of the file like <code><strong>04</strong>_filename.adoc</code> or to the prefixed number of the second level folder name.</p>
</dd>
<dt class="hdlist1">jbake-type</dt>
<dd>
<p>the page type.
This controls which template is used to render the page.
You will mostly use <code>page</code> for a full-width page or <code>page_toc</code> for a page with a table of contents (toc) rendered on the left.
Defaults to <code>page_toc</code>.</p>
</dd>
<dt class="hdlist1">jbake-status</dt>
<dd>
<p><code>draft</code> or <code>published</code>.
Only <code>published</code> pages will be rendered.
Defaults to <code>published</code> for files with a <code>jbake-order</code> and <code>draft</code> for files without order or files prefixed with <code>_</code>.</p>
</dd>
<dt class="hdlist1">filename</dt>
<dd>
<p>needed for edit and feedback-links (coming soon).
Defaults to the filename :-)</p>
</dd>
<dt class="hdlist1">ifndef</dt>
<dd>
<p>this fixes the imagesdir according to the nesting level of your docs folder
Defaults to the main <code>docDir/images</code></p>
</dd>
<dt class="hdlist1">toc</dt>
<dd>
<p>for <code>:jbake-type: page_toc</code>, you need this line to generate the toc.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Start your pages with a <code>==</code> level headline. You can fix the level offset when you include the page in a larger document with <code>include::chapter.adoc[leveloffset=+1]</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_templates_and_style">Templates and Style</h5>
<div class="paragraph">
<p>The jBake templates and CSS etc. is hidden away from you for convenience.
The basic template use <a href="http://getbootstrap.com/">twitter Bootstrap 5</a> as CSS framework.</p>
</div>
<div class="paragraph">
<p>Use the <a href="03_task_copy_themes.html"><code>copyThemes</code></a> task to copy all hidden jBake resources to your project.
You can then remove the ones you don&#8217;t need and change those you want to change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>copyThemes</code> overwrites existing files, but your code is under version control, isn&#8217;t it?
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_landing_page">Landing Page</h5>
<div class="paragraph">
<p>Put a <code>index.gsp</code> page as landing page in <code>src/site/templates</code>.
This landing page is plain HTML5 styled with twitter bootstrap.
Header and footer is added by docToolchain.
An example can be found through <a href="03_task_copy_themes.html"><code>copyThemes</code></a> or <a href="https://github.com/docToolchain/docToolchain/blob/ng/src/site/templates/index.gsp">on github</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_blog">Blog</h5>
<div class="paragraph">
<p>The microsite also contains a simple but powerful blog.
Use it to inform your team about changes and architecture decision records (ADRs).</p>
</div>
<div class="paragraph">
<p>To create a new blog post, create a new file in <code>src/docs/blog/&lt;year&gt;/&lt;post-name&gt;.adoc</code> with the following template:</p>
</div>
<div class="listingblock">
<div class="title">blog post template</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:jbake-title: &lt;title-of your post&gt;
:jbake-date: &lt;date formatted as 2021-02-28&gt;
:jbake-type: post
:jbake-tags: &lt;blog, asciidoc&gt;
:jbake-status: published

:imagesdir: ../../images

== {jbake-title}
{jbake-author}
{jbake-date}

&lt;insert your text here&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_search">Search</h5>
<div class="paragraph">
<p>The microsite does not bring its own local search.
Instead, it only has a search input-field which can be used to link to another search engine.</p>
</div>
</div>
<div class="sect4">
<h5 id="_cicd">CI/CD</h5>
<div class="paragraph">
<p>When run in an automated build, you should set the environment variable <code>DTC_HEADLESS</code> to <code>true</code> or <code>1</code> to ensure that docToolchain will not ask to install the configured theme.
It will simply assume that you do want to install it.</p>
</div>
<div class="paragraph">
<p>To avoid the download of the theme with every build, you can copy the themes folder from <code>$HOME/.doctoolchain/themes</code> to the corresponding folder in your build container.</p>
</div>
</div>
<div class="sect4">
<h5 id="_see_also">See also</h5>
<div class="paragraph">
<p><a href="03_task_previewSite.html"><code>previewSite</code></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_source_7">Source</h5>
<div class="listingblock">
<div class="title">scripts/generateSite.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.util.*
import static groovy.io.FileType.*

buildscript {
    repositories {
        maven {
            url mavenRepository
        }
    }
    dependencies {
        classpath 'org.asciidoctor:asciidoctorj-diagram:2.0.2'
    }
}
dependencies {
    jbake 'org.asciidoctor:asciidoctorj-diagram:2.0.2'
    jbake 'io.pebbletemplates:pebble:3.1.2'
}

apply plugin: 'org.jbake.site'
apply plugin: 'org.gretty'

def color = { color, text -&gt;
    def colors = [black: 30, red: 31, green: 32, yellow: 33, blue: 34, magenta: 35, cyan: 36, white: 37]
    return new String((char) 27) + "[${colors[color]}m${text}" + new String((char) 27) + "[0m"
}

jbake {
    version = '2.7.0-rc.2'
    srcDirName = "${targetDir}/microsite/tmp/site"
    destDirName = "${targetDir}/microsite/output"
    configuration['asciidoctor.option.requires'] = "asciidoctor-diagram"
    config.microsite.each { key, value -&gt;
        configuration['site.'+key-'config.microsite.'] = value
        //println 'site.'+key-'config.microsite.' +" = "+ value
    }

    configuration['asciidoctor.attributes'] = [
        "sourceDir=${targetDir}",
        'source-highlighter=prettify@',
        //'imagesDir=../images@',
        "imagesoutDir=${targetDir}/microsite/output/images@",
        "imagesDir=${config.microsite.contextPath}/images@",
        "targetDir=${targetDir}",
        "docDir=${docDir}",
        "projectRootDir=${new File(docDir).canonicalPath}@",
    ]

}
bakePreview {
    port = '8046'
}
gretty {
    httpPort = "${config.microsite.previewPort?:8042}" as Integer
    contextPath = "${config.microsite.contextPath}"
    extraResourceBases = ["${targetDir}/microsite/output"]
}


task generateSite(
    group: 'docToolchain',
    description: 'generate a microsite using jBake.') {
    doLast {
        new File("${targetDir}/microsite/tmp").mkdirs()
        println "created"
        println new File("${targetDir}/microsite/tmp/").canonicalPath
        //copy internal theme
        println "copy internal theme ${new File(projectDir, 'src/site').canonicalPath}"
        copy {
            from('src/site')
            into("${targetDir}/microsite/tmp/site")
        }
        //check if a remote pdfTheme is defined
        def siteTheme = System.getenv('DTC_SITETHEME')?:""
        def themeFolder = new File(projectDir, "../themes/" + siteTheme.md5())
        try {
            if (siteTheme) {
                println "use siteTheme $siteTheme"
                //check if it is already installed
                if (!themeFolder.exists()) {
                    if (System.getenv('DTC_HEADLESS')) {
                        ant.yesno = "y"
                    } else {
                        println "${color 'green', """\nTheme '$siteTheme' is not installed yet. """}"
                        def input = ant.input(message: """
${color 'green', 'do you want me to download and install it to '}
${color 'green', '   ' + themeFolder.canonicalPath}
${color 'green', 'for you?'}\n""",
                            validargs: 'y,n', addproperty: 'yesno')
                    }
                    if (ant.yesno == "y") {
                        themeFolder.mkdirs()
                        download {
                            src siteTheme
                            dest new File(themeFolder, 'siteTheme.zip')
                        }
                        copy {
                            from zipTree(new File(themeFolder, 'siteTheme.zip'))
                            into themeFolder
                        }
                        delete {
                            delete new File(themeFolder, 'siteTheme.zip')
                        }

                    } else {
                        println "${color 'green', """\nI will continue without the theme for now... """}"
                        siteTheme = ""
                    }

                }
                 //copy external theme
                if (siteTheme) {
                    copy {
                        from(themeFolder) {}
                        into("${targetDir}/microsite/tmp/")
                    }
                    //check if the config has to be updated
                    // check if config still contains /** microsite **/
                    def configFile = new File(docDir, mainConfigFile)
                    def configFileText = configFile.text
                    if (configFileText.contains("/** start:microsite **/")) {
                        def configFragment = new File(targetDir,'/microsite/tmp/site/configFragment.groovy')
                        if (configFragment.exists()) {
                            println "${color 'green', """
    It seems that this theme is used for the first time in this project.
    Let's configure it!
    If you are unsure, change these settings later in your config file
    $configFile.canonicalPath
    """}"
                            def comment = ""
                            def conf = ""
                            def example = ""
                            def i = 0
                            configFragment.eachLine { line -&gt;
                                if (line.trim()) {
                                    if (line.startsWith("//")) {
                                        conf += "    " + line + "\n"
                                        def tmp = line[2..-1].trim()
                                        comment += color('green', tmp) + "\n"
                                        if (tmp.toLowerCase().startsWith("example")) {
                                            example = tmp.replaceAll("[^ ]* ", "")
                                        }
                                    } else {
                                        //only prompt if there is something to prompt
                                        if (line.contains("##")) {
                                            def property = line.replaceAll("[ =].*", "")
                                            if (!example) {
                                                example = config.microsite[property]
                                            }
                                            comment = color('blue', "$property") + "\n" + comment
                                            if (example) {
                                                ant.input(message: comment,
                                                    addproperty: 'res' + i, defaultvalue: example)
                                            } else {
                                                ant.input(message: comment,
                                                    addproperty: 'res' + i)
                                            }
                                            (comment, example) = ["", ""]
                                            line = line.replaceAll("##.+##", ant['res' + i])
                                            conf += "    " + line + "\n"
                                            i++
                                        } else {
                                            conf += "    " + line + "\n"
                                        }
                                    }
                                } else {
                                    conf += "\n"
                                }
                            }
                            configFile.write(configFileText.replaceAll("(?sm)/[*][*] start:microsite [*][*]/.*/[*][*] end:microsite [*][*]/", "%%marker%%").replace("%%marker%%", conf))
                            println color('green', "config written\ntry\n ./dtcw generateSite previewSite\nto see your microsite!")
                        }
                        //copy the dummy docs (blog, landing page) to the project repository
                        copy {
                            from(new File(themeFolder, 'site/doc')) {}
                            into(new File(docDir, inputPath))
                        }
                    }
                }
            }
        } catch (Exception e) {
            println color('red', e.message)
            if (e.message.startsWith("Not Found")) {
                themeFolder.deleteDir()
                throw new GradleException("Couldn't find theme. Did you specify the right URL?\n"+e.message)
            } else {
                throw new GradleException(e.message)
            }
        }
        //copy project theme
        if (config.microsite.siteFolder) {
            def projectTheme = new File(new File(docDir, inputPath), config.microsite.siteFolder)
            println "copy project theme ${projectTheme.canonicalPath}"
            copy {
                from(projectTheme) {}
                into("${targetDir}/microsite/tmp/site")
            }
        }
        //copy docs
        copy {
            from(new File(docDir, inputPath)) {}
            into("${targetDir}/microsite/tmp/site/doc")
        }

        //fix MetaData-Header
        File sourceFolder = new File(targetDir, '/microsite/tmp/site/doc')
        logger.info("sourceFolder: " + sourceFolder.canonicalPath)
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^.*(ad|adoc|asciidoc)$') {
                if (file.name.startsWith("_")) {
                    //ignore
                } else {
                    def origText = file.text
                    //parse jbake attributes
                    def text = ""
                    def jbake = [
                        status: "published",
                        order: -1,
                        type: 'page_toc'
                    ]
                    def parseAttribs = true
                    def beforeToc = ""
                    origText.eachLine { line -&gt;
                        if (parseAttribs &amp;&amp; line.startsWith(":jbake")) {
                            line = (line - ":jbake-").split(": +", 2)
                            jbake[line[0]] = line[1]
                        } else {
                            if (line.startsWith("[")) {
                                // stop parsing jBake-attribs when a [source] - block starts which might contain those attribs as example
                                parseAttribs = false
                            }
                            text += line+"\n"
                            //there are some attributes which have to be set before the toc
                            if (line.startsWith(":toc") ) {
                                beforeToc += line+"\n"
                            }
                        }
                    }
                    def name = file.canonicalPath - (sourceFolder.canonicalPath+File.separator)
                    if (File.separator=='\\') {
                        name = name.split("\\\\")
                    } else {
                        name = name.split("/")
                    }
                    if (name.size()&gt;1) {
                        if (!jbake.menu) {
                            jbake.menu = name[0]
                            if (jbake.menu ==~ /[0-9]+[-_].*/) {
                                jbake.menu = jbake.menu.split("[-_]", 2)[1]
                            }
                        }
                        def docname = name[-1]
                        if (docname ==~ /[0-9]+[-_].*/) {
                            jbake.order = docname.split("[-_]",2)[0]
                            docname     = docname.split("[-_]",2)[1]
                        }
                        if (name.size() &gt; 2) {
                            if ((jbake.order as Integer)==0) {
                                // let's take the order from the second level dir or file and not the file
                                def secondLevel = name[1]
                                if (secondLevel ==~ /[0-9]+[-_].*/) {
                                    jbake.order = secondLevel.split("[-_]",2)[0]
                                }
                            } else {
                                if ((jbake.order as Integer) &gt; 0) {
                                    //
                                } else {
                                    jbake.status = "draft"
                                }
                            }
                        }
                        if (jbake.order==-1 &amp;&amp; docname.startsWith('index')) {
                            jbake.order = 0
                            jbake.status = "published"
                        }
                        // news blog
                        if (jbake.order==-1 &amp;&amp; jbake.type=='post') {
                            jbake.order = 0
                            try {
                                jbake.order = Date.parse("yyyy-MM-dd", jbake.date).time / 100000
                            } catch ( Exception e) {
                                System.out.println "unparsable date ${jbake.date} in $name"
                            }
                            jbake.status = "published"
                        }
                        def leveloffset = 0
                        text.eachLine { line -&gt;
                            if (!jbake.title &amp;&amp; line ==~ "^=+ .*") {
                                jbake.title = (line =~ "^=+ (.*)")[0][1]
                                def level = (line =~ "^(=+) .*")[0][1]
                                if (level=="=") {
                                    leveloffset = 1
                                }
                            }
                        }
                        if (!jbake.title) {
                            jbake.title = docname
                        }
                        if (leveloffset==1) {
                            //leveloffset needed
                            // we always start with "==" not with "="
                            text = text.replaceAll("(?ms)^(=+) ", '$1= ')
                        }
                        def header = ''
                        jbake.each { key, value -&gt;
                            if (key=='order') {
                                header += ":jbake-${key}: ${value as Integer}\n"
                            } else {
                                header += ":jbake-${key}: ${value}\n"
                            }
                        }
                        file.write(header + "\n$beforeToc\n\n:toc: left\n\n++++\n&lt;!-- endtoc --&gt;\n++++\n" + text, "utf-8")
                    }
                }
            }
        }

        /**
         println "="*80
         println (new File("${targetDir}/microsite/tmp/site/doc").canonicalPath)
         new File("${targetDir}/microsite/tmp/site/doc").eachFileRecurse { file -&gt;
         if (file.name.endsWith('.adoc')) {
         System.out.println "&gt;&gt; "+file.name
         }
         }
         **/
    }
}
task previewSite(
    group: 'docToolchain',
    dependsOn: [],
    description: 'start a little webserver to preview your Microsite',
) {
        if (new File("${targetDir}/microsite/output").exists()) {
            finalizedBy 'jettyRun'
        }
    doLast {
        if (new File("${targetDir}/microsite/output").exists()) {
            // everything is fine
        } else {
            throw new GradleException("""&gt;
&gt; Microsite not built yet, please run './dtcw generateSite' first
&gt;""")
        }
    }
}
task copyImages(type: Copy) {
    config.imageDirs.each { imageDir -&gt;
        from(new File (new File(docDir, inputPath),imageDir)) {}
        logger.info ('imageDir: '+imageDir)
        into("${targetDir}/microsite/output/images")
    }
    config.resourceDirs.each { resource -&gt;
        from(new File(file(srcDir),resource.source))
        logger.info ('resource: '+resource.source)
        into("${targetDir}/microsite/output/" + resource.target)
    }
}

bake.dependsOn copyImages
generateSite.finalizedBy bake</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_generatedocbook">1.9. generateDocbook</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateDocBook.png" alt="generateDocBook">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_5">About This Task</h5>
<div class="paragraph">
<p>A helper task, generateDocbook generates the intermediate format for <a href="03_task_convertToDocx.html"><code>convertToDocx</code></a>&lt;&lt;&gt;&gt; and <a href="03_task_convertToEpub.html"><code>convertToEpub</code></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_8">Source</h5>
<div class="listingblock">
<div class="title">AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateDocbook (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use docbook as asciidoc backend') {

    def sourceFilesDOCBOOK = sourceFiles.findAll {
        'docbook' in it.formats
    }
//    onlyIf {
//        sourceFilesDOCBOOK
//    }

    sources {
        sourceFilesDOCBOOK.each {
            include it.file
            logger.info it.file
        }
    }

    backends = ['docbook']
    doFirst {
        if (sourceFilesDOCBOOK.size()==0) {
            throw new Exception ("""

    &gt;&gt; No source files defined for type docbook.
    &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
    """)
        }

    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_generatedeck">1.10. generateDeck</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_2">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateDeck.png" alt="generateDeck">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_6">About This Task</h5>
<div class="paragraph">
<p>This task makes use of the <a href="https://github.com/asciidoctor/asciidoctor-reveal.js/">asciidoctor-reveal.js</a> backend to render your documents into a HTML-based presentation.
It creates a PowerPoint presentation, then enriches it by adding reveal.js slide definitions in AsciiDoc to the speaker notes.
For best results, use this task with the <a href="03_task_exportPPT.html"><code>exportPPT</code></a> task.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_9">Source</h5>
<div class="listingblock">
<div class="title">AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateDeck (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use revealJs as asciidoc backend to create a presentation') {

    attributes (
            'idprefix': 'slide-',
            'idseparator': '-',
            'docinfo1': '',
            'revealjs_theme': 'black',
            'revealjs_progress': 'true',
            'revealjs_touch': 'true',
            'revealjs_hideAddressBar': 'true',
            'revealjs_transition': 'linear',
            'revealjs_history': 'true',
            'revealjs_slideNumber': 'true'
    )
    options template_dirs : [new File(new File (projectDir,'/resources/asciidoctor-reveal.js'),'templates').absolutePath ]

    def sourceFilesREVEAL = sourceFiles.findAll {
        'revealjs' in it.formats
    }
//    onlyIf {
//        sourceFilesREVEAL
//    }

    sources {
        sourceFilesREVEAL.each {
            include it.file
            logger.info it.file
        }
    }

    outputDir = file(targetDir+'/decks/')

    resources {
        from('resources') {
            include 'reveal.js/**'
        }
        from(sourceDir) {
            include 'images/**'
        }
        into("")
        logger.info "${docDir}/${config.outputPath}/images"
    }
    doFirst {
        if (sourceFilesREVEAL.size()==0) {
            throw new Exception ("""
    &gt;&gt; No source files defined for type 'revealjs'.
    &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
    """)
        }

    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_publishtoconfluence">1.11. publishToConfluence</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/26543494012e9d554d707ae10121bcf3?d=identicon" alt="Denny Israel" width="32" height="32" title="Denny Israel"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/518a75fcbe5adea38aa4bec267d7572b?d=identicon" alt="Nikolay Orozov" width="32" height="32" title="Nikolay Orozov"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6dd2fe167fd7d2a84322787e3428d14e?d=identicon" alt="Joseph Staub" width="32" height="32" title="Joseph Staub"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/7107bc30257a84fd371a188bda07309f?d=identicon" alt="oliver drewes" width="32" height="32" title="oliver drewes"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/415bf2233be007b088ca81b749f02071?d=identicon" alt="Nils Mahlstaedt" width="32" height="32" title="Nils Mahlstaedt"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/be47969496f94a5a89159d70cd82bda0?d=identicon" alt="sabatmonk" width="32" height="32" title="sabatmonk"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/4280fc350b2b3cb323d151be608be3f8?d=identicon" alt="Alexander Herrmann" width="32" height="32" title="Alexander Herrmann"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/aacd09e76c0affa36f76f8ef337a1536?d=identicon" alt="Luis Muniz" width="32" height="32" title="Luis Muniz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c5a117679f7101b5de26dd25a2a8e98?d=identicon" alt="Dierk HÃ¶ppner" width="32" height="32" title="Dierk HÃ¶ppner"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e7d9e6618a36e94b35d43cbd2925aee0?d=identicon" alt="bit-jkraushaar" width="32" height="32" title="bit-jkraushaar"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/d2017e2cab333d23e2c7285cb62fdc43?d=identicon" alt="Constantin" width="32" height="32" title="Constantin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c384e5d2b684c60fc8f062d75dae3f7?d=identicon" alt="Alfon" width="32" height="32" title="Alfon"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2dc2929d0609d6338d2794446156f312?d=identicon" alt="Thomas Grabietz" width="32" height="32" title="Thomas Grabietz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/73252f762a6ec69bb59a23c8ff861c4a?d=identicon" alt="David M. Carr" width="32" height="32" title="David M. Carr"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>6 minutes to read</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/publishToConfluence.png" alt="publishToConfluence">
</div>
</div>
<div class="paragraph">
<p>This target takes the generated HTML file, splits it by headline and pushes it to Confluence.
This enables you to use the docs-as-code approach while getting feedback from non-techies through Confluence comments.
And it fulfills the "requirement" of "&#8230;&#8203; but all documentation is in Confluence".</p>
</div>
<div class="paragraph">
<p>Special features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[source]</code>-blocks are converted to code-macro blocks in confluence.</p>
</li>
<li>
<p>only pages and images which have changed between task runs are really published and hence only for those changes notifications are sent to watchers. This is quite important - otherwise watchers are easily annoyed by too many notifications.</p>
</li>
<li>
<p><code>:keywords:</code> Keywords are attached as labels to every generated Confluence page. The rules for page labels should be kept in mind. See <a href="https://confluence.atlassian.com/doc/add-remove-and-search-for-labels-136419.html" class="bare">https://confluence.atlassian.com/doc/add-remove-and-search-for-labels-136419.html</a>. Several keywords are allowed. They must be separated by comma, e.g. <code>:keywords: label_1, label-2, label3, &#8230;&#8203;</code>. Labels (keywords) must not contain a space character! Use '_' or '-'.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
code-macro-blocks in confluence render an error if the language attribute contains an unknown language.
See <a href="https://confluence.atlassian.com/doc/code-block-macro-139390.html" class="bare">https://confluence.atlassian.com/doc/code-block-macro-139390.html</a> for a list of valid language and how to add further languages.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_configuration">Configuration</h5>
<div class="paragraph">
<p>We tried to make the configuration self-explaining, but there are always some note to add.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ancestorId</dt>
<dd>
<p>this is the page ID of the parent page to which you want your docs to be published.
Go to this page, click on edit and the needed ID will show up in the URL.
Specify the ID as string within the config file.</p>
</dd>
<dt class="hdlist1">api</dt>
<dd>
<p>for cloud instances, <code>[context]</code> is <code>wiki</code></p>
</dd>
<dt class="hdlist1">preambleTitle</dt>
<dd>
<p>the title of the page containing the preamble (everything the first second level heading). Default is 'arc42'</p>
</dd>
<dt class="hdlist1">disableToC</dt>
<dd>
<p>This boolean configuration define if the Table of Content (ToC) is disabled from the page once uploaded in confluence. (it is false by default, so the ToC is active)</p>
</dd>
<dt class="hdlist1">pagePrefix/pageSuffix</dt>
<dd>
<p>Confluence can&#8217;t handle two pages with the same name.
Moreover, the script matches pages regardless of the case. It will thus refuse to replace a page whose title only differs in case with an existing page.
So you should create a new confluence space for each piece of larger documentation.
If you are restricted and can&#8217;t create new spaces, you can use this <code>pagePrefix</code>/<code>pageSuffix</code> to define a prefix/suffix for this doc so that it doesn&#8217;t conflict with other page names.</p>
</dd>
<dt class="hdlist1">credentials</dt>
<dd>
<p>Use username and password or even better username and api-token.
You can create new API-tokens in <a href="https://confluence.atlassian.com/cloud/api-tokens-938839638.html">your profile</a>.
To avoid having your password or api-token versioned through git, you can store it outside of this configuration as environment variable or in another file - the key here is that the config file is a groovy script.
e.g. you can do things like <code>credentials = "user:${new File("/home/me/apitoken").text}".bytes.encodeBase64().toString()</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To simplify the injection of credentials from external sources there is a fallback. Should you leave the credentials field empty,
the variables <code>confluenceUser</code> and <code>confluencePass</code> from the build environment will be used for authentication. You can set these through any means
allowed by gradle like the <code>gradle.properties</code> file in the project or your home directory, environment variables or command-line flags.
For all ways to set these variables, have a look at the <a href="https://docs.gradle.org/current/userguide/build_environment.html">gradle manual</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">apikey</dt>
<dd>
<p>In cases where you have to use full user authorization because of internal confluence permission handling, you need to add the API-token in addition to the credentials.
The API-token cannot be added to the credentials as it is used for user and password exchange.
Therefore the API-token can be added as parameter apikey, which makes the addition of the token as a separate header field with key: <code>keyId</code> and value of <code>apikey</code>.
Example including storing of the real value outside this configuration: <code>apikey = "${new File("/home/me/apitoken").text}"</code>.</p>
</dd>
<dt class="hdlist1">extraPageContent</dt>
<dd>
<p>If you need to prefix your pages with a warning that this is generated content - this is the right place.</p>
</dd>
<dt class="hdlist1">enableAttachments</dt>
<dd>
<p>If value is set to <strong>true</strong>, your links to local file references will be uploaded as attachments. The current implementation only supports a single folder. This foldername will be used as a prefix to validate if your file should be uploaded or not.
In case you enable this feature, and use a folder which starts with "attachment*", an adaption of this prefix is required.</p>
</dd>
<dt class="hdlist1">jiraServerId</dt>
<dd>
<p>the jira server id your confluence instance is connected to. If value is set, all anchors pointing to a jira ticket will be replaced by the confluence jira macro.
To function properly jiraRoot has to be configured (see <a href="03_task_exportJiraIssues.html"><code>exportJiraIssues</code></a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>All files to attach will require to be linked inside the document.</p>
</div>
<div class="paragraph">
<p><code>link:attachment/myfolder/myfile.json[My API definition]</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">attachmentPrefix</dt>
<dd>
<p>The expected foldername of your output dir. <strong>Default</strong>: <code>attachment</code></p>
</dd>
<dt class="hdlist1">proxy</dt>
<dd>
<p>If you need to provide a proxy to access Confluence, you may set a map with keys <code>host</code> (e.g. <code>'my.proxy.com'</code>), <code>port</code> (e.g. <code>'1234'</code>) and <code>schema</code> (e.g. <code>'http'</code>) of your proxy.</p>
</dd>
<dt class="hdlist1">useOpenapiMacro</dt>
<dd>
<p>If this option is present and equal to "confluence-open-api" then any source block marked with class openapi will be wrapped in Elitesoft Swagger Editor macro:  (see <a href="https://marketplace.atlassian.com/apps/1218914/open-api-swagger-editor-for-confluence">Elitesoft Swagger Editor</a>)<br>
For backward compatibility: If this option is present and equal to <code>true</code>, then again the Elitesoft Swagger Editor macro will be used.<br>
If this option is present and equal to "open-api" then any source block marked with class openapi will be wrapped in Open API Documentation for Confluence macro:  (see <a href="https://marketplace.atlassian.com/apps/1215176/open-api-documentation-for-confluence">Open API Documentation for Confluence</a>). A download source (yaml) button is shown by default.<br>
This is how you&#8217;d include your openapi YAML file:<br></p>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">[source.openapi,yaml]
----
include::myopeanapi.yaml[]
----</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//Configureation for publishToConfluence

confluence = [:]

// 'input' is an array of files to upload to Confluence with the ability
//          to configure a different parent page for each file.
//
// Attributes
// - 'file': absolute or relative path to the asciidoc generated html file to be exported
// - 'url': absolute URL to an asciidoc generated html file to be exported
// - 'ancestorName' (optional): the name of the parent page in Confluence as string;
//                             this attribute has priority over ancestorId, but if page with given name doesn't exist,
//                             ancestorId will be used as a fallback
// - 'ancestorId' (optional): the id of the parent page in Confluence as string; leave this empty
//                            if a new parent shall be created in the space
// - 'preambleTitle' (optional): the title of the page containing the preamble (everything
//                            before the first second level heading). Default is 'arc42'
//
// The following four keys can also be used in the global section below
// - 'spaceKey' (optional): page specific variable for the key of the confluence space to write to
// - 'createSubpages' (optional): page specific variable to determine whether ".sect2" sections shall be split from the current page into subpages
// - 'pagePrefix' (optional): page specific variable, the pagePrefix will be a prefix for the page title and it's sub-pages
//                            use this if you only have access to one confluence space but need to store several
//                            pages with the same title - a different pagePrefix will make them unique
// - 'pageSuffix' (optional): same usage as prefix but appended to the title and it's subpages
// only 'file' or 'url' is allowed. If both are given, 'url' is ignored
confluence.with {
    input = [
            [ file: "build/docs/html5/arc42-template-de.html" ],
    ]

    // endpoint of the confluenceAPI (REST) to be used
    // verfiy that you got the correct endpoint by browsing to 
    // https://[yourServer]/[context]/rest/api/user/current
    // you should get a valid json which describes your current user
    // a working example is https://arc42-template.atlassian.net/wiki/rest/api/user/current
    api = 'https://[yourServer]/[context]/rest/api/'

//    Additionally, spaceKey, createSubpages, pagePrefix and pageSuffix can be globally defined here. The assignment in the input array has precedence

    // the key of the confluence space to write to
    spaceKey = 'asciidoc'

    // the title of the page containing the preamble (everything the first second level heading). Default is 'arc42'
    preambleTitle = ''

    // variable to determine whether ".sect2" sections shall be split from the current page into subpages
    createSubpages = false

    // the pagePrefix will be a prefix for each page title
    // use this if you only have access to one confluence space but need to store several
    // pages with the same title - a different pagePrefix will make them unique
    pagePrefix = ''

    pageSuffix = ''

    /*
    WARNING: It is strongly recommended to store credentials securely instead of commiting plain text values to your git repository!!!

    Tool expects credentials that belong to an account which has the right permissions to to create and edit confluence pages in the given space.
    Credentials can be used in a form of:
     - passed parameters when calling script (-PconfluenceUser=myUsername -PconfluencePass=myPassword) which can be fetched as a secrets on CI/CD or
     - gradle variables set through gradle properties (uses the 'confluenceUser' and 'confluencePass' keys)
    Often, same credentials are used for Jira &amp; Confluence, in which case it is recommended to pass CLI parameters for both entities as
    -Pusername=myUser -Ppassword=myPassword
    */

    //optional API-token to be added in case the credentials are needed for user and password exchange.
    //apikey = "[API-token]"

    // HTML Content that will be included with every page published
    // directly after the TOC. If left empty no additional content will be
    // added
    // extraPageContent = '&lt;ac:structured-macro ac:name="warning"&gt;&lt;ac:parameter ac:name="title" /&gt;&lt;ac:rich-text-body&gt;This is a generated page, do not edit!&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;
    extraPageContent = ''

    // enable or disable attachment uploads for local file references
    enableAttachments = false

    // default attachmentPrefix = attachment - All files to attach will require to be linked inside the document.
    // attachmentPrefix = "attachment"


    // Optional proxy configuration, only used to access Confluence
    // schema supports http and https
    // proxy = [host: 'my.proxy.com', port: 1234, schema: 'http']

    // Optional: specify which Confluence OpenAPI Macro should be used to render OpenAPI definitions
    // possible values: ["confluence-open-api", "open-api", true]. true is the same as "confluence-open-api" for backward compatibility
    // useOpenapiMacro = "confluence-open-api"
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_css_styling">CSS Styling</h5>
<div class="paragraph">
<p>Some AsciiDoctor features depend on particular CSS style definitions.
Unless these styles are defined, some formatting that is present in the HTML version will not be represented when published to Confluence.</p>
</div>
<div class="olist arabic">
<div class="title">To configure Confluence to include additional style definitions:</div>
<ol class="arabic">
<li>
<p>Log in to Confluence as a space admin</p>
</li>
<li>
<p>Go to the desired space</p>
</li>
<li>
<p>Select "Space tools", "Look and Feel", "Stylesheet"</p>
</li>
<li>
<p>Click "Edit", enter the desired style definitions, and click "Save"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The default style definitions can be found in the AsciiDoc project as <a href="https://raw.githubusercontent.com/asciidoctor/asciidoctor/master/data/stylesheets/asciidoctor-default.css">asciidoctor-default.css</a>.
Note that you likely do <strong>NOT</strong> want to include the whole thing, as some of the definitions are likely to disrupt Confluence&#8217;s layout.</p>
</div>
<div class="paragraph">
<p>The following style definitions are believed to be Confluence-compatible, and enable use of the built-in roles (<code>big</code>/<code>small</code>, <code>underline</code>/<code>overline</code>/<code>line-through</code>, <code><em>COLOR</em></code>/<code><em>COLOR</em>-background</code> for the <a href="https://en.wikipedia.org/wiki/Web_colors#HTML_color_names">sixteen HTML color names</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="css">.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_10">Source</h5>
<div class="listingblock">
<div class="title">publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task publishToConfluence(
        description: 'publishes the HTML rendered output to confluence',
        group: 'docToolchain'
) {
    doLast {
        logger.info("docToolchain&gt; docDir: "+docDir)

        binding.setProperty('config',config)
        binding.setProperty('docDir',docDir)
        evaluate(new File(projectDir, 'scripts/asciidoc2confluence.groovy'))
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">scripts/asciidoc2confluence.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">/**
 * Created by Ralf D. Mueller and Alexander Heusingfeld
 * https://github.com/rdmueller/asciidoc2confluence
 *
 * this script expects an HTML document created with AsciiDoctor
 * in the following style (default AsciiDoctor output)
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     &lt;div class="sectionbody"&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *     &lt;/div&gt;
 * &lt;/div&gt;
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     ...
 * &lt;/div&gt;
 *
 */

/*
    Additions for issue #342 marked as #342-dierk42
    ;-)
*/

// some dependencies
/**
@Grapes(
        [@Grab('org.jsoup:jsoup:1.8.2'),
         @Grab('org.codehaus.groovy.modules.http-builder:http-builder:0.6' ),
         @Grab('org.apache.httpcomponents:httpmime:4.5.1')]
)
**/
import org.jsoup.Jsoup
import org.jsoup.parser.Parser
import org.jsoup.nodes.Entities.EscapeMode
import org.jsoup.nodes.Document
import org.jsoup.nodes.Document.OutputSettings
import org.jsoup.nodes.Element
import org.jsoup.nodes.TextNode
import org.jsoup.select.Elements
import groovyx.net.http.RESTClient
import groovyx.net.http.HttpResponseException
import groovyx.net.http.HTTPBuilder
import groovyx.net.http.EncoderRegistry
import groovyx.net.http.ContentType
import java.security.MessageDigest
//to upload attachments:
import org.apache.http.entity.mime.MultipartEntity
import org.apache.http.entity.mime.content.StringBody
import org.apache.http.entity.mime.content.InputStreamBody
import org.apache.http.entity.mime.HttpMultipartMode
import groovyx.net.http.Method

def CDATA_PLACEHOLDER_START = '&lt;cdata-placeholder&gt;'
def CDATA_PLACEHOLDER_END = '&lt;/cdata-placeholder&gt;'

def baseUrl
def allPages
// configuration

def confluenceSpaceKey
def confluenceCreateSubpages
def confluencePagePrefix
def baseApiPath = new URI(config.confluence.api).path
// helper functions

def MD5(String s) {
    MessageDigest.getInstance("MD5").digest(s.bytes).encodeHex().toString()
}

// for getting better error message from the REST-API
// LuisMuniz: return the action's result, if successful.
def trythis(Closure action) {
    try {
        action.call()
    } catch (HttpResponseException error) {
        println "something went wrong - got an http response code "+error.response.status+":"
        switch (error.response.status) {
            case '401':
                println (error.response.data.toString().replaceAll("^.*Reason","Reason"))
                println "please check your confluence credentials in config file or passed parameters"
                throw new Exception("missing authentication credentials")
                break
            case '400':
                println error.response.data.message
                println "please check the ancestorId in your config file"
                throw new Exception("Parent does not exist")
                break
            default:
                println error.response.data
        }
        null
    }
}


def parseAdmonitionBlock(block, String type) {
    content = block.select(".content").first()
    titleElement = content.select(".title")
    titleText = ''
    if(titleElement != null) {
        titleText = "&lt;ac:parameter ac:name=\"title\"&gt;${titleElement.text()}&lt;/ac:parameter&gt;"
        titleElement.remove()
    }
    block.after("&lt;ac:structured-macro ac:name=\"${type}\"&gt;${titleText}&lt;ac:rich-text-body&gt;${content}&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;")
    block.remove()
}

/*  #342-dierk42

    add labels to a Confluence page. Labels are taken from :keywords: which
    are converted as meta tags in HTML. Building the array: see below

    Confluence allows adding labels only after creation of a page.
    Therefore we need extra API calls.

    Currently the labels are added one by one. Suggestion for improvement:
    Build a label structure of all labels an place them with one call.

    Replaces exisiting labels. No harm
    Does not check for deleted labels when keywords are deleted from source
    document!
*/
def addLabels = { def pageId, def labelsArray -&gt;
    //https://docs.atlassian.com/confluence/REST/latest/
    def api = new RESTClient(config.confluence.api)
    //this fixes the encoding (dierk42: Is this needed here? Don't know)
    api.encoderRegistry = new EncoderRegistry( charset: 'utf-8' )

    def headers = [
            'Authorization': 'Basic ' + config.confluence.credentials,
            'X-Atlassian-Token':'no-check'
    ]
    // Attach each label in a API call of its own. The only prefix possible
    // in our own Confluence is 'global'
    labelsArray.each { label -&gt;
        label_data = [
            prefix : 'global',
            name : label
        ]
        trythis {
            // attach label to page pageId
            // https://developer.atlassian.com/display/CONFDEV/Confluence+REST+API+Examples#ConfluenceRESTAPIExamples-Updatingapage
            def res = api.post(contentType: ContentType.JSON,
                              path: 'content/' + pageId + "/label", body: label_data, headers: headers)
            }
        println "added label " + label + " to page ID " + pageId
    }
}


def uploadAttachment = { def pageId, String url, String fileName, String note -&gt;
    def is
    def localHash
    if (url.startsWith('http')) {
        is = new URL(url).openStream()
        //build a hash of the attachment
        localHash = MD5(new URL(url).openStream().text)
    } else {
        is = new File(url).newDataInputStream()
        //build a hash of the attachment
        localHash = MD5(new File(url).newDataInputStream().text)
    }

    //https://docs.atlassian.com/confluence/REST/latest/
    def api = new RESTClient(config.confluence.api)
    //this fixes the encoding
    api.encoderRegistry = new EncoderRegistry( charset: 'utf-8' )
    if (config.confluence.proxy) {
        api.setProxy(config.confluence.proxy.host, config.confluence.proxy.port, config.confluence.proxy.schema ?: 'http')
    }

    def headers = [
            'Authorization': 'Basic ' + config.confluence.credentials,
            'X-Atlassian-Token':'no-check'
    ]
    //Add api key and value to REST API request header if configured - required for authentification.
    if (config.confluence.apikey)
    {
       headers.keyid = config.confluence.apikey
    }
    //check if attachment already exists
    def result = "nothing"
    def attachment = api.get(path: 'content/' + pageId + '/child/attachment',
            query: [
                    'filename': fileName,
            ], headers: headers).data
    def http
    if (attachment.size==1) {
        // attachment exists. need an update?
        def remoteHash = 0
        if (attachment.results[0].extensions.comment != null) {
            remoteHash = attachment.results[0].extensions.comment.replaceAll("(?sm).*#([^#]+)#.*",'$1')
        }
        if (remoteHash!=localHash) {
            //hash is different -&gt; attachment needs to be updated
            http = new HTTPBuilder(config.confluence.api + 'content/' + pageId + '/child/attachment/' + attachment.results[0].id + '/data')
            println "    updated attachment"
        }
    } else {
        http = new HTTPBuilder(config.confluence.api + 'content/' + pageId + '/child/attachment')

    }
    if (http) {
		if (config.confluence.proxy) {
            http.setProxy(config.confluence.proxy.host, config.confluence.proxy.port, config.confluence.proxy.schema ?: 'http')
        }
		
        http.request(Method.POST) { req -&gt;
            requestContentType: "multipart/form-data"
            MultipartEntity multiPartContent = new MultipartEntity(HttpMultipartMode.BROWSER_COMPATIBLE)
            // Adding Multi-part file parameter "file"
            multiPartContent.addPart("file", new InputStreamBody(is, fileName))
            // Adding another string parameter "comment"
            multiPartContent.addPart("comment", new StringBody(note + "\r\n#" + localHash + "#"))
            req.setEntity(multiPartContent)
            headers.each { key, value -&gt;
                req.addHeader(key, value)
            }
        }
    }
}


def realTitle = { pageTitle -&gt;
    confluencePagePrefix + pageTitle + confluencePageSuffix
}

def rewriteMarks = { body -&gt;
    // Confluence strips out mark elements.  Replace them with default formatting.
    body.select('mark').wrap('&lt;span style="background:#ff0;color:#000"&gt;&lt;/style&gt;').unwrap()
}

// #352-LuisMuniz: Helper methods
// Fetch all pages of the space. Only keep relevant info in the pages Map
// The map is indexed by lower-case title
def retrieveAllPages = { RESTClient api, Map headers, String spaceKey -&gt;
    if (allPages != null) {
        println "allPages already retrieved"
        allPages
    } else {

        boolean morePages=true
        int start=0
        def request = [
                'type'    : 'page',
                'spaceKey': spaceKey,
                'expand'  : 'ancestors',
                'limit'   : 100
        ]

        allPages =[:]
        while(morePages) {
            def results = trythis {
                request.start=start
                def args = [
                        'headers': headers,
                        'path'   : "${baseApiPath}content",
                        'query'  : request,
                ]
                api.get(args).data.results
            } ?: []

            if (results.empty) {
                morePages=false
            } else {
                start += results.size
            }

            results.inject(allPages) { Map acc, Map match -&gt;
                //unique page names in confluence, so we can get away with indexing by title
                def ancestors = match.ancestors.collect { it.id }

                acc[match.title.toLowerCase()] = [
                        title   : match.title,
                        id      : match.id,
                        parentId: ancestors.isEmpty() ? null : ancestors.last()
                ]
                acc
            }
        }

        allPages
    }
}

// Retrieve a page by id with contents and version
def retrieveFullPage = { RESTClient api, Map headers, String id -&gt;
    trythis {
        api.get(
                [
                        'headers': headers,
                        'path'   : "${baseApiPath}content/${id}",
                        'query'  : ['expand': 'body.storage,version'],
                ]
        ).data


    } ?: [:]
}

//if a parent has been specified, check whether a page has the same parent.
boolean hasRequestedParent(Map existingPage, String requestedParentId) {
    if (requestedParentId) {
        existingPage.parentId == requestedParentId
    } else {
        true
    }
}

def rewriteDescriptionLists = { body -&gt;
    def TAGS = [ dt: 'th', dd: 'td' ]
    body.select('dl').each { dl -&gt;
        // WHATWG allows wrapping dt/dd in divs, simply unwrap them
        dl.select('div').each { it.unwrap() }

        // group dts and dds that belong together, usually it will be a 1:1 relation
        // but HTML allows for different constellations
        def rows = []
        def current = [dt: [], dd: []]
        rows &lt;&lt; current
        dl.select('dt, dd').each { child -&gt;
            def tagName = child.tagName()
            if (tagName == 'dt' &amp;&amp; current.dd.size() &gt; 0) {
                // dt follows dd, start a new group
                current = [dt: [], dd: []]
                rows &lt;&lt; current
            }
            current[tagName] &lt;&lt; child.tagName(TAGS[tagName])
            child.remove()
        }

        rows.each { row -&gt;
            def sizes = [dt: row.dt.size(), dd: row.dd.size()]
            def rowspanIdx = [dt: -1, dd: sizes.dd - 1]
            def rowspan = Math.abs(sizes.dt - sizes.dd) + 1
            def max = sizes.dt
            if (sizes.dt &lt; sizes.dd) {
                max = sizes.dd
                rowspanIdx = [dt: sizes.dt - 1, dd: -1]
            }
            (0..&lt;max).each { idx -&gt;
                def tr = dl.appendElement('tr')
                ['dt', 'dd'].each { type -&gt;
                    if (sizes[type] &gt; idx) {
                        tr.appendChild(row[type][idx])
                        if (idx == rowspanIdx[type] &amp;&amp; rowspan &gt; 1) {
                            row[type][idx].attr('rowspan', "${rowspan}")
                        }
                    } else if (idx == 0) {
                        tr.appendElement(TAGS[type]).attr('rowspan', "${rowspan}")
                    }
                }
            }
        }

        dl.wrap('&lt;table&gt;&lt;/table&gt;')
            .unwrap()
    }
}

def rewriteInternalLinks = { body, anchors, pageAnchors -&gt;
    // find internal cross-references and replace them with link macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith('#')) {
            def anchor = href.substring(1)
            def pageTitle = anchors[anchor] ?: pageAnchors[anchor]
            if (pageTitle &amp;&amp; a.text()) {
                // as Confluence insists on link texts to be contained
                // inside CDATA, we have to strip all HTML and
                // potentially loose styling that way.
                a.html(a.text())
                a.wrap("&lt;ac:link${anchors.containsKey(anchor) ? ' ac:anchor="' + anchor + '"' : ''}&gt;&lt;/ac:link&gt;")
                   .before("&lt;ri:page ri:content-title=\"${realTitle pageTitle}\"/&gt;")
                   .wrap("&lt;ac:plain-text-link-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-link-body&gt;")
                   .unwrap()
            }
        }
    }
}

def rewriteJiraLinks = { body -&gt;
    // find links to jira tickets and replace them with jira macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith(config.jira.api + "/browse/")) {
                def ticketId = a.text()
                a.before("""&lt;ac:structured-macro ac:name=\"jira\" ac:schema-version=\"1\"&gt;
                     &lt;ac:parameter ac:name=\"key\"&gt;${ticketId}&lt;/ac:parameter&gt;
                     &lt;ac:parameter ac:name=\"serverId\"&gt;${config.confluence.jiraServerId}&lt;/ac:parameter&gt;
                     &lt;/ac:structured-macro&gt;""")
                a.remove()
        }
    }
}


def rewriteCodeblocks = { body -&gt;
    body.select('pre &gt; code').each { code -&gt;
        if (code.attr('data-lang')) {
            code.select('span[class]').each { span -&gt;
                span.unwrap()
            }
            code.select('i[class]').each { i -&gt;
                i.unwrap()
            }
            code.select('b').each { b -&gt;
                b.before(" // ")
                b.unwrap()
            }
            code.before("&lt;ac:parameter ac:name=\"language\"&gt;${code.attr('data-lang')}&lt;/ac:parameter&gt;")
        }
        code.parent() // pre now
            .wrap('&lt;ac:structured-macro ac:name="code"&gt;&lt;/ac:structured-macro&gt;')
            .unwrap()
        code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
            .unwrap()
    }
}

def rewriteOpenAPI = { org.jsoup.nodes.Element body -&gt;
         if (config.confluence.useOpenapiMacro == true || config.confluence.useOpenapiMacro == 'confluence-open-api') {
            body.select('div.openapi  pre &gt; code').each { code -&gt;
                def parent=code.parent()
                def rawYaml=code.wholeText()
                code.parent()
                        .wrap('&lt;ac:structured-macro ac:name="confluence-open-api" ac:schema-version="1" ac:macro-id="1dfde21b-6111-4535-928a-470fa8ae3e7d"&gt;&lt;/ac:structured-macro&gt;')
                        .unwrap()
                code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                        .replaceWith(new TextNode(rawYaml))
            }
         }
        else if (config.confluence.useOpenapiMacro == 'open-api') {
            body.select('div.openapi  pre &gt; code').each { code -&gt;
                def parent=code.parent()
                def rawYaml=code.wholeText()
                code.parent()
                        .wrap('&lt;ac:structured-macro ac:name="open-api" ac:schema-version="1" data-layout="default" ac:macro-id="4302c9d8-fca4-4f14-99a9-9885128870fa"&gt;&lt;/ac:structured-macro&gt;')
                        .unwrap()
                // default: show download button
                code.before('&lt;ac:parameter ac:name="showDownloadButton"&gt;true&lt;/ac:parameter&gt;')
                code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                        .replaceWith(new TextNode(rawYaml))
            }
    }
}

def unescapeCDATASections = { html -&gt;
    def start = html.indexOf(CDATA_PLACEHOLDER_START)
    while (start &gt; -1) {
        def end = html.indexOf(CDATA_PLACEHOLDER_END, start)
        if (end &gt; -1) {
            def prefix = html.substring(0, start) + CDATA_PLACEHOLDER_START
            def suffix = html.substring(end)
            def unescaped = html.substring(start + CDATA_PLACEHOLDER_START.length(), end)
                    .replaceAll('&amp;lt;', '&lt;').replaceAll('&amp;gt;', '&gt;')
                    .replaceAll('&amp;amp;', '&amp;')
            html = prefix + unescaped + suffix
        }
        start = html.indexOf(CDATA_PLACEHOLDER_START, start + 1)
    }
    html
}

//modify local page in order to match the internal confluence storage representation a bit better
//definition lists are not displayed by confluence, so turn them into tables
//body can be of type Element or Elements
def deferredUpload = []
def parseBody =  { body, anchors, pageAnchors -&gt;
    rewriteOpenAPI body

    body.select('div.paragraph').unwrap()
    body.select('div.ulist').unwrap()
    body.select('div.sect3').unwrap()
    [   'note':'info',
        'warning':'warning',
        'important':'warning',
        'caution':'note',
        'tip':'tip'            ].each { adType, cType -&gt;
        body.select('.admonitionblock.'+adType).each { block -&gt;
            parseAdmonitionBlock(block, cType)
        }
    }
    //special for the arc42-template
    body.select('div.arc42help').select('.content')
            .wrap('&lt;ac:structured-macro ac:name="expand"&gt;&lt;/ac:structured-macro&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;/ac:rich-text-body&gt;')
            .wrap('&lt;ac:structured-macro ac:name="info"&gt;&lt;/ac:structured-macro&gt;')
            .before('&lt;ac:parameter ac:name="title"&gt;arc42&lt;/ac:parameter&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;p&gt;&lt;/p&gt;&lt;/ac:rich-text-body&gt;')
    body.select('div.arc42help').unwrap()
    body.select('div.title').wrap("&lt;strong&gt;&lt;/strong&gt;").before("&lt;br /&gt;").wrap("&lt;div&gt;&lt;/div&gt;")
    body.select('div.listingblock').wrap("&lt;p&gt;&lt;/p&gt;").unwrap()
    // see if we can find referenced images and fetch them
    new File("tmp/images/.").mkdirs()
    // find images, extract their URLs for later uploading (after we know the pageId) and replace them with this macro:
    // &lt;ac:image ac:align="center" ac:width="500"&gt;
    // &lt;ri:attachment ri:filename="deployment-context.png"/&gt;
    // &lt;/ac:image&gt;
    body.select('img').each { img -&gt;
        img.attributes().each { attribute -&gt;
            //println attribute.dump()
        }
        def src = img.attr('src')
        def imgWidth = img.attr('width')?:500
        def imgAlign = img.attr('align')?:"center"
        println "    image: "+src

        //it is not an online image, so upload it to confluence and use the ri:attachment tag
        if(!src.startsWith("http")) {
          def newUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')+src
          def fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
          newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")

          trythis {
              deferredUpload &lt;&lt;  [0,newUrl,fileName,"automatically uploaded"]
          }
          img.after("&lt;ac:image ac:align=\"${imgAlign}\" ac:width=\"${imgWidth}\"&gt;&lt;ri:attachment ri:filename=\"${fileName}\"/&gt;&lt;/ac:image&gt;")
        }
        // it is an online image, so we have to use the ri:url tag
        else {
          img.after("&lt;ac:image ac:align=\"imgAlign\" ac:width=\"${imgWidth}\"&gt;&lt;ri:url ri:value=\"${src}\"/&gt;&lt;/ac:image&gt;")
        }
        img.remove()
    }


    if(config.confluence.enableAttachments){
        attachmentPrefix = config.confluence.attachmentPrefix ? config.confluence.attachmentPrefix : 'attachment'
        body.select('a').each { link -&gt;

            def src = link.attr('href')
            println "    attachment src: "+src

            //upload it to confluence and use the ri:attachment tag
            if(src.startsWith(attachmentPrefix)) {
                def newUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')+src
                def fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
                newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")

                trythis {
                    deferredUpload &lt;&lt;  [0,newUrl,fileName,"automatically uploaded non-image attachment by docToolchain"]
                }
                def uriArray=fileName.split("/")
                def pureFilename = uriArray[uriArray.length-1]
                def innerhtml = link.html()
                link.after("&lt;ac:structured-macro ac:name=\"view-file\" ac:schema-version=\"1\"&gt;&lt;ac:parameter ac:name=\"name\"&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
                link.after("&lt;ac:link&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;ac:plain-text-link-body&gt; &lt;![CDATA[\"${innerhtml}\"]]&gt;&lt;/ac:plain-text-link-body&gt;&lt;/ac:link&gt;")
                link.remove()

            }
        }
    }

    if(config.confluence.jiraServerId){
        rewriteJiraLinks body
    }

    rewriteMarks body
    rewriteDescriptionLists body
    rewriteInternalLinks body, anchors, pageAnchors
    //sanitize code inside code tags
    rewriteCodeblocks body
    def pageString = unescapeCDATASections body.html().trim()

    //change some html elements through simple substitutions
    pageString = pageString
            .replaceAll('&lt;br&gt;','&lt;br /&gt;')
            .replaceAll('&lt;/br&gt;','&lt;br /&gt;')
            .replaceAll('&lt;a([^&gt;]*)&gt;&lt;/a&gt;','')
            .replaceAll(CDATA_PLACEHOLDER_START,'&lt;![CDATA[')
            .replaceAll(CDATA_PLACEHOLDER_END,']]&gt;')

    return pageString
}

// the create-or-update functionality for confluence pages
// #342-dierk42: added parameter 'keywords'
def pushToConfluence = { pageTitle, pageBody, String parentId, anchors, pageAnchors, keywords -&gt;
    def api = new RESTClient(config.confluence.api)
    def headers = [
            'Authorization': 'Basic ' + config.confluence.credentials,
            'Content-Type':'application/json; charset=utf-8'
    ]
    //Add api key and value to REST API request header if configured - required for authentification.
    if (config.confluence.apikey)
    {
       headers.keyid = config.confluence.apikey
    }
    String realTitleLC = realTitle(pageTitle).toLowerCase()

    //this fixes the encoding
    api.encoderRegistry = new EncoderRegistry( charset: 'utf-8' )
    if (config.confluence.proxy) {
        api.setProxy(config.confluence.proxy.host, config.confluence.proxy.port, config.confluence.proxy.schema ?: 'http')
    }
    //try to get an existing page
    localPage = parseBody(pageBody, anchors, pageAnchors)
    def localHash = MD5(localPage)
    if(config.confluence.disableToC){
        def prefix = (config.confluence.extraPageContent?:'')
        localPage  = prefix+localPage
        localHash = MD5(localPage)
        localPage += '&lt;p style="display:none"&gt;hash: #'+localHash+'#&lt;/p&gt;'
    }else{
        def default_toc = '&lt;p&gt;&lt;ac:structured-macro ac:name="toc"/&gt;&lt;/p&gt;'
        def prefix = (config.confluence.tableOfContents?:default_toc)+(config.confluence.extraPageContent?:'')
        localPage  = prefix+localPage
        def default_children = '&lt;p&gt;&lt;ac:structured-macro ac:name="children"&gt;&lt;ac:parameter ac:name="sort"&gt;creation&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;&lt;/p&gt;'
        localPage += (config.confluence.tableOfChildren?:default_children)
        localHash = MD5(localPage)
        localPage += '&lt;p style="display:none"&gt;hash: #'+localHash+'#&lt;/p&gt;'
    }


    def request = [
            type : 'page',
            title: realTitle(pageTitle),
            space: [
                    key: confluenceSpaceKey
            ],
            body : [
                    storage: [
                            value         : localPage,
                            representation: 'storage'
                    ]
            ]
    ]
    if (parentId) {
        request.ancestors = [
                [ type: 'page', id: parentId]
        ]
    }

    def pages = retrieveAllPages(api, headers, config.confluence.spaceKey)

    // println "Suche nach vorhandener Seite: " + pageTitle
    Map existingPage = pages[realTitleLC]
    def page

    if (existingPage) {
        if (hasRequestedParent(existingPage, parentId)) {
            page = retrieveFullPage(api, headers, existingPage.id)
        } else {
            page = null
        }
    } else {
        page = null
    }
    // println "Gefunden: " + page.id + " Titel: " + page.title

    if (page) {
        println "found existing page: " + page.id +" version "+page.version.number

        //extract hash from remote page to see if it is different from local one

        def remotePage = page.body.storage.value.toString().trim()

        def remoteHash = remotePage =~ /(?ms)hash: #([^#]+)#/
        remoteHash = remoteHash.size()==0?"":remoteHash[0][1]

        // println "remoteHash: " + remoteHash
        // println "localHash:  " + localHash

        if (remoteHash == localHash) {
            println "page hasn't changed!"
            deferredUpload.each {
                uploadAttachment(page?.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        } else {
            trythis {
                // update page
                // https://developer.atlassian.com/display/CONFDEV/Confluence+REST+API+Examples#ConfluenceRESTAPIExamples-Updatingapage
                request.id      = page.id
                request.version = [number: (page.version.number as Integer) + 1]
                def res = api.put(contentType: ContentType.JSON,
                                  requestContentType : ContentType.JSON,
                                  path: 'content/' + page.id, body: request, headers: headers)
            }
            println "&gt; updated page "+page.id
            deferredUpload.each {
                uploadAttachment(page.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        }
    } else {
        //#352-LuisMuniz if the existing page's parent does not match the requested parentId, fail
        if (existingPage &amp;&amp; !hasRequestedParent(existingPage, parentId)) {
            throw new IllegalArgumentException("Cannot create page, page with the same "
                    + "title=${existingPage.title} "
                    + "with id=${existingPage.id} already exists in the space. "
                    + "A Confluence page title must be unique within a space, consider specifying a 'confluencePagePrefix' in ConfluenceConfig.groovy")
        }

        //create a page
        trythis {
            page = api.post(contentType: ContentType.JSON,
                            requestContentType: ContentType.JSON,
                            path: 'content', body: request, headers: headers)
        }
        println "&gt; created page "+page?.data?.id
        deferredUpload.each {
            uploadAttachment(page?.data?.id, it[1], it[2], it[3])
        }
        deferredUpload = []
        // #324-dierk42: Add keywords as labels to page.
        if (keywords) {
            addLabels(page?.data?.id, keywords)
        }
        return page?.data?.id
    }
}

def parseAnchors = { page -&gt;
    def anchors = [:]
    page.body.select('[id]').each { anchor -&gt;
        def name = anchor.attr('id')
        anchors[name] = page.title
        anchor.before("&lt;ac:structured-macro ac:name=\"anchor\"&gt;&lt;ac:parameter ac:name=\"\"&gt;${name}&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
    }
    anchors
}

def pushPages
pushPages = { pages, anchors, pageAnchors, labels -&gt;
    pages.each { page -&gt;
        println page.title
        def id = pushToConfluence page.title, page.body, page.parent, anchors, pageAnchors, labels
        page.children*.parent = id
        // println "Push children von id " + id
        pushPages page.children, anchors, pageAnchors, labels
        // println "Ende Push children von id " + id
    }
}

def recordPageAnchor = { head -&gt;
    def a = [:]
    if (head.attr('id')) {
        a[head.attr('id')] = head.text()
    }
    a
}

def promoteHeaders = { tree, start, offset -&gt;
    (start..7).each { i -&gt;
        tree.select("h${i}").tagName("h${i-offset}").before('&lt;br /&gt;')
    }
}

def retrievePageIdByName = { String name -&gt;
        def api = new RESTClient(config.confluence.api)
        def headers = [
            'Authorization': 'Basic ' + config.confluence.credentials,
            'Content-Type':'application/json; charset=utf-8'
        ]
        trythis {
            def request = [
                'title'    : name,
                'spaceKey' : confluenceSpaceKey
            ]
            api.get(
                [
                        'headers': headers,
                        'path'   : "${baseApiPath}content",
                        'query'  : request,
                ]
            ).data.results?.getAt(0)?.id
        } ?: null
}

config.confluence.input.each { input -&gt;

    input.file = "${docDir}/${input.file}"

    println "publish ${input.file}"

    if (input.file ==~ /.*[.](ad|adoc|asciidoc)$/) {
        println "convert ${input.file}"
        "groovy asciidoc2html.groovy ${input.file}".execute()
        input.file = input.file.replaceAll(/[.](ad|adoc|asciidoc)$/, '.html')
        println "to ${input.file}"
    }
//  assignend, but never used in pushToConfluence(...) (fixed here)
    confluenceSpaceKey = input.spaceKey ?: config.confluence.spaceKey
    confluenceCreateSubpages = (input.createSubpages != null) ? input.createSubpages : config.confluence.createSubpages
//  hard to read in case of using :sectnums: -&gt; so we add a suffix
    confluencePagePrefix = input.pagePrefix ?: config.confluence.pagePrefix
//  added
    confluencePageSuffix = input.pageSuffix ?: config.confluence.pageSuffix
    confluencePreambleTitle = input.preambleTitle ?: config.confluence.preambleTitle

    def html = input.file ? new File(input.file).getText('utf-8') : new URL(input.url).getText()
    baseUrl = input.file ? new File(input.file) : new URL(input.url)
    Document dom = Jsoup.parse(html, 'utf-8', Parser.xmlParser())
    dom.outputSettings().prettyPrint(false);//makes html() preserve linebreaks and spacing
    dom.outputSettings().escapeMode(org.jsoup.nodes.Entities.EscapeMode.xhtml); //This will ensure xhtml validity regarding entities
    dom.outputSettings().charset("UTF-8"); //does no harm :-)

    // if ancestorName is defined try to find machingAncestorId in confluence
    def retrievedAncestorId
    if (input.ancestorName) {
        // Retrieve a page id by name
        retrievedAncestorId = retrievePageIdByName(input.ancestorName)
        println("Retrieved pageId for given ancestorName '${input.ancestorName}' is ${retrievedAncestorId}")
    }

    // if input does not contain an ancestorName, check if there is ancestorId, otherwise check if there is a global one
    def parentId = retrievedAncestorId ?: input.ancestorId ?: config.confluence.ancestorId

    // if parentId is still not set, create a new parent page (parentId = null)
    parentId = parentId ?: null
    //println("ancestorName: '${input.ancestorName}', ancestorId: ${input.ancestorId} ---&gt; final parentId: ${parentId}")

    def anchors = [:]
    def pageAnchors = [:]
    def sections = pages = []
    // #342-dierk42: get the keywords from the meta tags
    def keywords = []
    dom.select('meta[name=keywords]').each { kw -&gt;
        kws = kw.attr('content').split(',')
        kws.each { skw -&gt;
            keywords &lt;&lt; skw.trim()
        }
        println "Keywords:" + keywords
    }
    // let's try to select the "first page" and push it to confluence
    dom.select('div#preamble div.sectionbody').each { pageBody -&gt;
        pageBody.select('div.sect2').unwrap()
        def preamble = [
            title: confluencePreambleTitle ?: "arc42",
            body: pageBody,
            children: [],
            parent: parentId
        ]
        pages &lt;&lt; preamble
        sections = preamble.children
        parentId = null
        anchors.putAll(parseAnchors(preamble))
    }
    // &lt;div class="sect1"&gt; are the main headings
    // let's extract these
    dom.select('div.sect1').each { sect1 -&gt;
        Elements pageBody = sect1.select('div.sectionbody')
        def currentPage = [
            title: sect1.select('h2').text(),
            body: pageBody,
            children: [],
            parent: parentId
        ]
        pageAnchors.putAll(recordPageAnchor(sect1.select('h2')))

        if (confluenceCreateSubpages) {
            pageBody.select('div.sect2').each { sect2 -&gt;
                def title = sect2.select('h3').text()
                pageAnchors.putAll(recordPageAnchor(sect2.select('h3')))
                sect2.select('h3').remove()
                def body = Jsoup.parse(sect2.toString(),'utf-8', Parser.xmlParser())
                body.outputSettings(new Document.OutputSettings().prettyPrint(false))
                def subPage = [
                    title: title,
                    body: body
                ]
                currentPage.children &lt;&lt; subPage
                promoteHeaders sect2, 4, 3
                anchors.putAll(parseAnchors(subPage))
            }
            pageBody.select('div.sect2').remove()
        } else {
            pageBody.select('div.sect2').unwrap()
            promoteHeaders sect1, 3, 2
        }
        sections &lt;&lt; currentPage
        anchors.putAll(parseAnchors(currentPage))
    }

    pushPages pages, anchors, pageAnchors, keywords
    if (parentId) {
        println "published to ${config.confluence.api - "rest/api/"}spaces/${confluenceSpaceKey}/pages/${parentId}"
    } else {
        println "published to ${config.confluence.api - "rest/api/"}spaces/${confluenceSpaceKey}"
    }
}
""</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_converttodocx">1.12. convertToDocx</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_3">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/convertToDocx.png" alt="convertToDocx">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_before_you_begin">Before You Begin</h5>
<div class="paragraph">
<p>Before using this task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install <a href="https://pandoc.org">pandoc</a>.</p>
</li>
<li>
<p>Ensure that 'docbook' and 'docx' are added to the inputFiles formats in Config.groovy.</p>
</li>
<li>
<p>As an optional step, specify a reference doc file with custom stylesheets (see task <a href="03_task_createReferenceDoc.html"><code>createReferenceDoc</code></a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources">Further Reading and Resources</h5>
<div class="paragraph">
<p>Read the <a href="https://rdmueller.github.io/create-docx/">Render AsciiDoc to docx (MS Word)</a> blog post.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_11">Source</h5>
<div class="listingblock">
<div class="title">pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task convertToDocx (
        group: 'docToolchain',
        description: 'converts file to .docx via pandoc. Needs pandoc installed.',
        type: Exec
) {
    // All files with option `docx` in config.groovy is converted to docbook and then to docx.
    def sourceFilesDocx = sourceFiles.findAll { 'docx' in it.formats }
    sourceFilesDocx.each {
        def sourceFile = it.file.replace('.adoc', '.xml')
        def targetFile = sourceFile.replace('.xml', '.docx')

        workingDir "$targetDir/docbook"
        executable = "pandoc"

        if(referenceDocFile?.trim()) {
            args = ["-r","docbook",
                    "-t","docx",
                    "-o","../docx/$targetFile",
                    "--reference-doc=${docDir}/${referenceDocFile}",
                    sourceFile]
        } else {
            args = ["-r","docbook",
                    "-t","docx",
                    "-o","../docx/$targetFile",
                    sourceFile]
        }
    }
    doFirst {
        new File("$targetDir/docx/").mkdirs()
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_createreferencedoc">1.13. createReferenceDoc</h4>
<div class="sect4">
<h5 id="_before_you_begin_2">Before You Begin</h5>
<div class="paragraph">
<p>Install <a href="https://pandoc.org">pandoc</a>.</p>
</div>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_7">About This Task</h5>
<div class="paragraph">
<p>This task creates a reference docx file used by <a href="https://pandoc.org">pandoc</a> during docbook-to-docx conversion.
Use task <a href="03_task_convertToDocx.html"><code>convertToDocx</code></a> to edit this file so it uses your preferred styles.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The contents of the reference docx are ignored, but its stylesheets and document properties (including margins, page size, header and footer) are used in the new docx.
For more information, see Pandoc User&#8217;s Guide: <a href="https://pandoc.org/MANUAL.html#options-affecting-specific-writers">Options affecting specific writers (--reference-doc)</a>
And if you have problems with changing the default table style: see <a href="https://github.com/jgm/pandoc/issues/3275" class="bare">https://github.com/jgm/pandoc/issues/3275</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_config_groovy_notes">Config.groovy Notes</h5>
<div class="paragraph">
<p>The 'referenceDocFile' property must be set to your custom reference file in Config.groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">inputPath = '.'

// use a style reference file in the input path for conversion from docbook to docx
referenceDocFile = "${inputPath}/my-ref-file.docx"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_12">Source</h5>
<div class="listingblock">
<div class="title">pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task createReferenceDoc (
        group: 'docToolchain helper',
        description: 'creates a docx file to be used as a format style reference in task convertToDocx. Needs pandoc installed.',
        type: Exec
) {
    workingDir "$docDir"
    executable = "pandoc"
    args = ["-o", "${docDir}/${referenceDocFile}",
            "--print-default-data-file",
            "reference.docx"]
    
    doFirst {
        if(!(referenceDocFile?.trim())) {
            throw new GradleException("Option `referenceDocFile` is not defined in config.groovy or has an empty value.")
        }
    }   
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_converttoepub">1.14. convertToEpub</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_4">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/convertToEpub.png" alt="convertToEpub">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dependency">Dependency</h5>
<div class="paragraph">
<p><a href="03_task_generateDocBook.html"><code>generateDocBook</code></a></p>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_8">About This Task</h5>
<div class="paragraph">
<p>This task uses <a href="https://pandoc.org">pandoc</a> to convert the DocBook output from AsciiDoctor to ePub.
This publishes the output as an eBook which can be read using any eBook reader.
The resulting file can be found in <code>build/docs/epub</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_2">Further Reading and Resources</h5>
<div class="paragraph">
<p><a href="https://rdmueller.github.io/create-epub/">Turn your Document into an Audio-Book</a> blog post.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_13">Source</h5>
<div class="listingblock">
<div class="title">pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task convertToEpub (
        group: 'docToolchain',
        description: 'converts file to .epub via pandoc. Needs pandoc installed.',
        type: Exec
) {
    // All files with option `epub` in config.groovy is converted to docbook and then to epub.
    def sourceFilesEpub = sourceFiles.findAll { 'epub' in it.formats }
    sourceFilesEpub.each {
        def sourceFile = it.file.replace('.adoc', '.xml')
        def targetFile = sourceFile.replace('.xml', '.epub')

        workingDir "$targetDir/docbook"
        executable = "pandoc"
        args = ['-r','docbook',
                '-t','epub',
                '-o',"../epub/$targetFile",
                sourceFile]
    }
    doFirst {
        new File("$targetDir/epub/").mkdirs()
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportea">1.15. exportEA</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>4 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_5">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportEA.png" alt="exportEA">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_9">About This Task</h5>
<div class="paragraph">
<p>By default, no special configuration is necessary.
However, several optional parameter configurations are available to support a project and packages to be used for export.
These parameters can be used independently from one another.
A sample of how to edit your projects' Config.groovy is provided in the 'Config.groovy' of the docToolchain project itself.</p>
</div>
</div>
<div class="sect4">
<h5 id="_important">Important</h5>
<div class="paragraph">
<p>Currently this feature is WINDOWS-only. See <a href="https://github.com/docToolchain/docToolchain/issues/231">this related issue</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_optional_parameter_configurations">The Optional Parameter Configurations</h5>
<div class="sect5">
<h6 id="_connection">connection</h6>
<div class="paragraph">
<p>Either set the connection to a certain project, or comment it out to use all project files inside the src folder or its child folder.</p>
</div>
</div>
<div class="sect5">
<h6 id="_packagefilter">packageFilter</h6>
<div class="paragraph">
<p>Add one or multiple packageGUIDs to be used for export. All packages are analysed, if no packageFilter is set.</p>
</div>
</div>
<div class="sect5">
<h6 id="_exportpath">exportPath</h6>
<div class="paragraph">
<p>Relative path to base 'docDir' to which the diagrams and notes are to be exported.
Default: "src/docs".
Example: docDir = 'D:\work\mydoc\' ; exportPath = 'src/pdocs' ;
Images will be exported to 'D:\work\mydoc\src\pdocs\images\ea',
Notes will be exported to 'D:\work\mydoc\src\pdocs\ea',</p>
</div>
</div>
<div class="sect5">
<h6 id="_searchpath">searchPath</h6>
<div class="paragraph">
<p>Relative path to base 'docDir', in which Enterprise Architect project files are searched
Default: "src/docs".
Example: docDir = 'D:\work\mydoc\' ; exportPath = 'src/projects' ;
Lookup for eap and eapx files starts in 'D:\work\mydoc\src\projects' and goes down the folder structure.
<strong>Note</strong>: In case parameter 'connection' is already defined, the searchPath value is also used.
exportEA starts opening the database parameter 'connection' first then looks for
further project files either in the searchPath (if set) or in the docDir folder of the project.</p>
</div>
</div>
<div class="sect5">
<h6 id="_glossaryasciidocformat">glossaryAsciiDocFormat</h6>
<div class="paragraph">
<p>Whether or not the EA project glossary is exported depends on this parameter.
If not set or an empty string, no glossary is exported.
The glossaryAsciiDocFormat string is used to format each glossary entry in a
certain AsciiDoc format.</p>
</div>
<div class="paragraph">
<p>The following placeholders are defined for the format string: ID, TERM, MEANING, TYPE.
One or more can be used by the output format. For example:</p>
</div>
<div class="paragraph">
<p>A valid output format is to include the glossary as a flat list.
The file can be included where needed in the documentation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>glossaryAsciiDocFormat = "TERM:: MEANING"</pre>
</div>
</div>
<div class="paragraph">
<p>Other format strings can be used to include it as a table row.
The glossary terms are sorted in alphabetical order.</p>
</div>
</div>
<div class="sect5">
<h6 id="_glossarytypes">glossaryTypes</h6>
<div class="paragraph">
<p>This parameter is used in case a glossaryAsciiDocFormat is defined, otherwise it
is not evaluated. It&#8217;s used to filter for certain types.
If the glossaryTypes list is empty, all entries will be used.
For example:</p>
</div>
<div class="paragraph">
<p>glossaryTypes = ["Business", "Technical"]</p>
</div>
</div>
<div class="sect5">
<h6 id="_diagramattributes">diagramAttributes</h6>
<div class="paragraph">
<p>If set, the string is used to create and store diagram attributes to be included in the document alongside a diagram.
These placeholders are defined and populated with the diagram attributes, if used in the
diagramAttributes string:</p>
</div>
<div class="paragraph">
<p><code>%DIAGRAM_AUTHOR%</code>,<br>
<code>%DIAGRAM_CREATED%</code>,<br>
<code>%DIAGRAM_GUID%</code>,<br>
<code>%DIAGRAM_MODIFIED%</code>,<br>
<code>%DIAGRAM_NAME%</code>,<br>
<code>%DIAGRAM_NOTES%</code>,<br>
<code>%DIAGRAM_DIAGRAM_TYPE%</code>,<br>
<code>%DIAGRAM_VERSION%</code>,<br>
<code>%NEWLINE%</code><br></p>
</div>
<div class="paragraph">
<p>Example: diagramAttributes = "Last modification: %DIAGRAM_MODIFIED%%NEWLINE%Version: %DIAGRAM_VERSION%"</p>
</div>
<div class="paragraph">
<p>You can add the string %NEWLINE% where a line break will be added.
The resulting text is stored next to the diagram image using the same path and file name, but a different file extension (.ad). This can be included in the document if required.
If diagramAttributes is not set or an empty string, no file is written.</p>
</div>
</div>
<div class="sect5">
<h6 id="_additionaloptions">additionalOptions</h6>
<div class="paragraph">
<p>This parameter is used to define the specific behavior of the export. Currently these options are supported:</p>
</div>
<div class="paragraph">
<p><code>KeepFirstDiagram</code></p>
</div>
<div class="paragraph">
<p>If diagrams are not uniquely named, the last diagram will be saved. If you want to prevent diagrams from being overwritten, add this parameter to additionalOptions.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_glossary_export">Glossary export</h5>
<div class="paragraph">
<p>By setting the glossaryAsciiDocFormat, the glossary terms stored in the EA project
will be exported into a folder named 'glossary' below the configured exportPath.
In case multiple EA projects are found for export, one glossary per project is
exported - each named using the project&#8217;s GUID plus extension '.ad'.</p>
</div>
<div class="paragraph">
<p>Each individual file will be filtered (see glossaryTypes) and sorted in alphabetical order.
In addition, a global glossary is created by using all single glossary files.
This global file is named 'glossary.ad' and is also placed in the glossary folder.
The global glossary is also filtered and sorted.
If there is only one EA project, only the global glossary is written.</p>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_3">Further Reading and Resources</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://rdmueller.github.io/jria2eac/">JIRA to Sparx EA</a> blog post.</p>
</li>
<li>
<p><a href="https://rdmueller.github.io/sparx-ea/">Did you Ever Wish you Had Better Diagrams?</a> blog post.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_source_14">Source</h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportEA(
        dependsOn: [streamingExecute],
        description: 'exports all diagrams and some texts from EA files',
        group: 'docToolchain'
) {
    doFirst {
    }
    doLast {
        logger.info("docToolchain &gt; exportEA: " + docDir)
        logger.info("docToolchain &gt; exportEA: " + mainConfigFile)
        def configFile = new File(docDir, mainConfigFile)
        def config = new ConfigSlurper().parse(configFile.text)
        def scriptParameterString = ""
        def exportPath = ""
        def searchPath = ""
        def glossaryPath = ""
        def readme = """This folder contains exported diagrams or notes from Enterprise Architect.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder	will be overwritten with each re-export!**

use `gradle exportEA` to re-export files
"""

        if (!config.exportEA.connection.isEmpty()) {
            logger.info("docToolchain &gt; exportEA: found " + config.exportEA.connection)
            scriptParameterString = scriptParameterString + "-c \"${config.exportEA.connection}\""
        }
        if (!config.exportEA.packageFilter.isEmpty()) {
            def packageFilterToCreate = config.exportEA.packageFilter as List
            logger.info("docToolchain &gt; exportEA: package filter list size: " + packageFilterToCreate.size())
            packageFilterToCreate.each { packageFilter -&gt;
                scriptParameterString = scriptParameterString + " -p \"${packageFilter}\""
            }
        }
        if (!config.exportEA.exportPath.isEmpty()) {
            exportPath = new File(docDir, config.exportEA.exportPath).getAbsolutePath()
        } else {
            exportPath = new File(docDir, 'src/docs').getAbsolutePath()
        }
        if (!config.exportEA.searchPath.isEmpty()) {
            searchPath = new File(docDir, config.exportEA.searchPath).getAbsolutePath()
        }
        else if (!config.exportEA.absoluteSearchPath.isEmpty()) {
        searchPath = new File(config.exportEA.absoluteSearchPath).getAbsolutePath()
        }
        else {
            searchPath = new File(docDir, 'src').getAbsolutePath()
        }
        scriptParameterString = scriptParameterString + " -d \"$exportPath\""
        scriptParameterString = scriptParameterString + " -s \"$searchPath\""
        logger.info("docToolchain &gt; exportEA: exportPath: " + exportPath)

        //remove old glossary files/folder if exist
        new File(exportPath, 'glossary').deleteDir()
        //set the glossary file path in case an output format is configured, other no glossary is written
        if (!config.exportEA.glossaryAsciiDocFormat.isEmpty()) {
            //create folder to store glossaries
            new File(exportPath, 'glossary/.').mkdirs()
            glossaryPath = new File(exportPath, 'glossary').getAbsolutePath()
            scriptParameterString = scriptParameterString + " -g \"$glossaryPath\""
        }
        //configure additional diagram attributes to be exported
        if (!config.exportEA.diagramAttributes.isEmpty()) {
            scriptParameterString = scriptParameterString + " -da \"$config.exportEA.diagramAttributes\""
        }
        //configure additional diagram attributes to be exported
        if (!config.exportEA.additionalOptions.isEmpty()) {
            scriptParameterString = scriptParameterString + " -ao \"$config.exportEA.additionalOptions\""
        }
        //make sure path for notes exists
        //and remove old notes
        new File(exportPath, 'ea').deleteDir()
        //also remove old diagrams
        new File(exportPath, 'images/ea').deleteDir()

        //create a readme to clarify things
        new File(exportPath, 'images/ea/.').mkdirs()
        new File(exportPath, 'images/ea/readme.ad').write(readme)
        new File(exportPath, 'ea/.').mkdirs()
        new File(exportPath, 'ea/readme.ad').write(readme)

        //execute through cscript in order to make sure that we get WScript.echo right
        logger.info("docToolchain &gt; exportEA: parameters: " + scriptParameterString)
        "%SystemRoot%\\System32\\cscript.exe //nologo ${projectDir}/scripts/exportEAP.vbs ${scriptParameterString}".executeCmd()
        //the VB Script is only capable of writing iso-8859-1-Files.
        //we now have to convert them to UTF-8
        new File(exportPath, 'ea/.').eachFileRecurse { file -&gt;
            if (file.isFile()) {
                println "exported notes " + file.canonicalPath
                file.write(file.getText('iso-8859-1'), 'utf-8')
            }
        }

        //sort, filter and reformat a glossary if an output format is configured
        if (!config.exportEA.glossaryAsciiDocFormat.isEmpty()) {
            def glossaryTypes

            if (!config.exportEA.glossaryTypes.isEmpty()) {
                glossaryTypes = config.exportEA.glossaryTypes as List
            }
            new GlossaryHandler().execute(glossaryPath, config.exportEA.glossaryAsciiDocFormat, glossaryTypes);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">scripts/exportEAP.vbs</div>
<div class="content">
<pre class="prettyprint highlight"><code>    ' based on the "Project Interface Example" which comes with EA
    ' http://stackoverflow.com/questions/1441479/automated-method-to-export-enterprise-architect-diagrams



    Dim EAapp 'As EA.App
    Dim Repository 'As EA.Repository
    Dim FS 'As Scripting.FileSystemObject

    Dim projectInterface 'As EA.Project

    Const   ForAppending = 8
    Const   ForWriting = 2

    ' Helper
    ' http://windowsitpro.com/windows/jsi-tip-10441-how-can-vbscript-create-multiple-folders-path-mkdir-command
    Function MakeDir (strPath)
      Dim strParentPath, objFSO
      Set objFSO = CreateObject("Scripting.FileSystemObject")
      On Error Resume Next
      strParentPath = objFSO.GetParentFolderName(strPath)

      If Not objFSO.FolderExists(strParentPath) Then MakeDir strParentPath
      If Not objFSO.FolderExists(strPath) Then objFSO.CreateFolder strPath
      On Error Goto 0
      MakeDir = objFSO.FolderExists(strPath)
    End Function

    ' Replaces certain characters with '_' to avoid unwanted file or folder names causing errors or structure failures.
    ' Regular expression can easily be extended with further characters to be replaced.
    Function NormalizeName(theName)
       dim re : Set re = new regexp
       re.Pattern = "[\\/\[\]\s]"
       re.Global = True
       NormalizeName = re.Replace(theName, "_")
    End Function

    Sub WriteNote(currentModel, currentElement, notes, prefix)
        If (Left(notes, 6) = "{adoc:") Then
            strFileName = Mid(notes,7,InStr(notes,"}")-7)
            strNotes = Right(notes,Len(notes)-InStr(notes,"}"))
            set objFSO = CreateObject("Scripting.FileSystemObject")
            If (currentModel.Name="Model") Then
              ' When we work with the default model, we don't need a sub directory
              path = objFSO.BuildPath(exportDestination,"ea/")
            Else
              path = objFSO.BuildPath(exportDestination,"ea/"&amp;NormalizeName(currentModel.Name)&amp;"/")
            End If
            MakeDir(path)

            post = ""
            If (prefix&lt;&gt;"") Then
                post = "_"
            End If
            MakeDir(path&amp;prefix&amp;post)

            set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;post&amp;strFileName&amp;".ad",ForAppending, True)
            name = currentElement.Name
            name = Replace(name,vbCr,"")
            name = Replace(name,vbLf,"")

            if (Left(strNotes, 3) = vbCRLF&amp;"|") Then
                ' content should be rendered as table - so don't interfere with it
                objFile.WriteLine(vbCRLF)
            else
                'let's add the name of the object
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name)
            End If
            objFile.WriteLine(vbCRLF&amp;strNotes)
            objFile.Close
            if (prefix&lt;&gt;"") Then
                ' write the same to a second file
                set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;".ad",ForAppending, True)
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name&amp;vbCRLF&amp;strNotes)
                objFile.Close
            End If
        End If
    End Sub

    Sub SyncJira(currentModel, currentDiagram)
        notes = currentDiagram.notes
        set currentPackage = Repository.GetPackageByID(currentDiagram.PackageID)
        updated = 0
        created = 0
        If (Left(notes, 6) = "{jira:") Then
            WScript.echo " &gt;&gt;&gt;&gt; Diagram jira tag found"
            strSearch = Mid(notes,7,InStr(notes,"}")-7)
            Set objShell = CreateObject("WScript.Shell")
            'objShell.CurrentDirectory = fso.GetFolder("./scripts")
            Set objExecObject = objShell.Exec ("cmd /K  groovy ./scripts/exportEAPJiraPrintHelper.groovy """ &amp; strSearch &amp;""" &amp; exit")
            strReturn = ""
            x = 0
            y = 0
            Do While Not objExecObject.StdOut.AtEndOfStream
                output = objExecObject.StdOut.ReadLine()
                ' WScript.echo output
                jiraElement = Split(output,"|")
                name = jiraElement(0)&amp;":"&amp;vbCR&amp;vbLF&amp;jiraElement(4)
                On Error Resume Next
                Set requirement = currentPackage.Elements.GetByName(name)
                On Error Goto 0
                if (IsObject(requirement)) then
                    ' element already exists
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    updated = updated + 1
                else
                    Set requirement = currentPackage.Elements.AddNew(name,"Requirement")
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    currentPackage.Elements.Refresh()
                    Set dia_obj = currentDiagram.DiagramObjects.AddNew("l="&amp;(10+x*200)&amp;";t="&amp;(10+y*50)&amp;";b="&amp;(10+y*50+44)&amp;";r="&amp;(10+x*200+180),"")
                    x = x + 1
                    if (x&gt;3) then
                      x = 0
                      y = y + 1
                    end if
                    dia_obj.ElementID = requirement.ElementID
                    dia_obj.Update()
                    created = created + 1
                end if
            Loop
            Set objShell = Nothing
            WScript.echo "created "&amp;created&amp;" requirements"
            WScript.echo "updated "&amp;updated&amp;" requirements"
        End If
    End Sub

    ' This sub routine checks if the format string defined in diagramAttributes
    ' does contain any characters. It replaces the known placeholders:
    ' %DIAGRAM_AUTHOR%, %DIAGRAM_CREATED%, %DIAGRAM_GUID%, %DIAGRAM_MODIFIED%,
    ' %DIAGRAM_NAME%, %DIAGRAM_NOTES%, %DIAGRAM_DIAGRAM_TYPE%, %DIAGRAM_VERSION%
    ' with the attribute values read from the EA diagram object.
    ' None, one or multiple number of placeholders can be used to create a diagram attribute
    ' to be added to the document. The attribute string is stored as a file with the same
    ' path and name as the diagram image, but with suffix .ad. So, it can
    ' easily be included in an asciidoc file.
    Sub SaveDiagramAttribute(currentDiagram, path, diagramName)
        If Len(diagramAttributes) &gt; 0 Then
            filledDiagAttr = diagramAttributes
            set objFSO = CreateObject("Scripting.FileSystemObject")
            filename = objFSO.BuildPath(path, diagramName &amp; ".ad")
            set objFile = objFSO.OpenTextFile(filename, ForWriting, True)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_AUTHOR%",       currentDiagram.Author)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_CREATED%",      currentDiagram.CreatedDate)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_GUID%",         currentDiagram.DiagramGUID)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_MODIFIED%",     currentDiagram.ModifiedDate)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_NAME%",         currentDiagram.Name)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_NOTES%",        currentDiagram.Notes)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_DIAGRAM_TYPE%", currentDiagram.Type)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_VERSION%",      currentDiagram.Version)
            filledDiagAttr = Replace(filledDiagAttr, "%NEWLINE%",              vbCrLf)
            objFile.WriteLine(filledDiagAttr)
            objFile.Close
        End If
    End Sub
    Sub SaveDiagram(currentModel, currentDiagram)
        Dim exportDiagram ' As Boolean

        ' Open the diagram
        Repository.OpenDiagram(currentDiagram.DiagramID)

        ' Save and close the diagram
        set objFSO = CreateObject("Scripting.FileSystemObject")
        If (currentModel.Name="Model") Then
            ' When we work with the default model, we don't need a sub directory
            path = objFSO.BuildPath(exportDestination,"/images/ea/")
        Else
            path = objFSO.BuildPath(exportDestination,"/images/ea/" &amp; NormalizeName(currentModel.Name) &amp; "/")
        End If
        path = objFSO.GetAbsolutePathName(path)
        MakeDir(path)

        diagramName = currentDiagram.Name
        diagramName = Replace(diagramName,vbCr,"")
        diagramName = Replace(diagramName,vbLf,"")
        diagramName = NormalizeName(diagramName)
        filename = objFSO.BuildPath(path, diagramName &amp; ".png")

        exportDiagram = True
        If objFSO.FileExists(filename) Then
            WScript.echo " --- " &amp; filename &amp; " already exists."
            If Len(additionalOptions) &gt; 0 Then
                If InStr(additionalOptions, "KeepFirstDiagram") &gt; 0 Then
                    WScript.echo " --- Skipping export -- parameter 'KeepFirstDiagram' set."
                Else
                    WScript.echo " --- Overwriting -- parameter 'KeepFirstDiagram' not set."
                    exportDiagram = False
                End If
            Else
                WScript.echo " --- Overwriting -- parameter 'KeepFirstDiagram' not set."
            End If
        End If
        If exportDiagram Then
          projectInterface.SaveDiagramImageToFile(filename)
          WScript.echo " extracted image to " &amp; filename
          If Not IsEmpty(diagramAttributes) Then
              SaveDiagramAttribute currentDiagram, path, diagramName
          End If
        End If
        Repository.CloseDiagram(currentDiagram.DiagramID)

        ' Write the note of the diagram
        WriteNote currentModel, currentDiagram, currentDiagram.Notes, diagramName&amp;"_notes"

        For Each diagramElement In currentDiagram.DiagramObjects
            Set currentElement = Repository.GetElementByID(diagramElement.ElementID)
            WriteNote currentModel, currentElement, currentElement.Notes, diagramName&amp;"_notes"
        Next
        For Each diagramLink In currentDiagram.DiagramLinks
            set currentConnector = Repository.GetConnectorByID(diagramLink.ConnectorID)
            WriteNote currentModel, currentConnector, currentConnector.Notes, diagramName&amp;"_links"
        Next
    End Sub
    '
    ' Recursively saves all diagrams under the provided package and its children
    '
    Sub DumpDiagrams(thePackage,currentModel)
        Set currentPackage = thePackage

        ' export element notes
        For Each currentElement In currentPackage.Elements
            WriteNote currentModel, currentElement, currentElement.Notes, ""
            ' export connector notes
            For Each currentConnector In currentElement.Connectors
                ' WScript.echo currentConnector.ConnectorGUID
                if (currentConnector.ClientID=currentElement.ElementID) Then
                    WriteNote currentModel, currentConnector, currentConnector.Notes, ""
                End If
            Next
            if (Not currentElement.CompositeDiagram Is Nothing) Then
                SyncJira currentModel, currentElement.CompositeDiagram
                SaveDiagram currentModel, currentElement.CompositeDiagram
            End If
            if (Not currentElement.Elements Is Nothing) Then
                DumpDiagrams currentElement,currentModel
            End If
        Next


        ' Iterate through all diagrams in the current package
        For Each currentDiagram In currentPackage.Diagrams
            SyncJira currentModel, currentDiagram
            SaveDiagram currentModel, currentDiagram
        Next

        ' Process child packages
        Dim childPackage 'as EA.Package
        ' otPackage = 5
        if (currentPackage.ObjectType = 5) Then
            For Each childPackage In currentPackage.Packages
                call DumpDiagrams(childPackage, currentModel)
            Next
        End If
    End Sub

    Function SearchEAProjects(path)
      For Each folder In path.SubFolders
        SearchEAProjects folder
      Next

      For Each file In path.Files
            If fso.GetExtensionName (file.Path) = "eap" OR fso.GetExtensionName (file.Path) = "eapx" Then
                WScript.echo "found "&amp;file.path
                If (Left(file.name, 1) = "_") Then
                    WScript.echo "skipping, because it start with `_` (replication)"
                Else
                    OpenProject(file.Path)
                End If
            End If
      Next
    End Function

    'Gets the package object as referenced by its GUID from the Enterprise Architect project.
    'Looks for the model node, the package is a child of as it is required for the diagram export.
    'Calls the Sub routine DumpDiagrams for the model and package found.
    'An error is printed to console only if the packageGUID is not found in the project.
    Function DumpPackageDiagrams(EAapp, packageGUID)
        WScript.echo "DumpPackageDiagrams"
        WScript.echo packageGUID
        Dim package
        Set package = EAapp.Repository.GetPackageByGuid(packageGUID)
        If (package Is Nothing) Then
          WScript.echo "invalid package - as package is not part of the project"
        Else
          Dim currentModel
          Set currentModel = package
          while currentModel.IsModel = false
            Set currentModel = EAapp.Repository.GetPackageByID(currentModel.parentID)
          wend
          ' Iterate through all child packages and save out their diagrams
          ' save all diagrams of package itself
          call DumpDiagrams(package, currentModel)
        End If
    End Function

    Function FormatStringToJSONString(inputString)
        outputString = Replace(inputString, "\", "\\")
        outputString = Replace(outputString, """", "\""")
        outputString = Replace(outputString, vbCrLf, "\n")
        outputString = Replace(outputString, vbLf, "\n")
        outputString = Replace(outputString, vbCr, "\n")
        FormatStringToJSONString = outputString
    End Function

    'If a valid file path is set, the glossary terms are read from EA repository,
    'formatted in a JSON compatible format and written into file.
    'The file is read and reformatted by the exportEA gradle task afterwards.
    Function ExportGlossaryTermsAsJSONFile(EArepo)
        If (Len(glossaryFilePath) &gt; 0) Then
            set objFSO = CreateObject("Scripting.FileSystemObject")
            GUID = Replace(EArepo.ProjectGUID,"{","")
            GUID = Replace(GUID,"}","")
            currentGlossaryFile = objFSO.BuildPath(glossaryFilePath,"/"&amp;GUID&amp;".ad")
            set objFile = objFSO.OpenTextFile(currentGlossaryFile,ForAppending, True)

            Set glossary = EArepo.Terms()
            objFile.WriteLine("[")
            dim counter
            counter = 0
            For Each term In glossary
                if (counter &gt; 0) Then
                    objFile.Write(",")
                end if
                objFile.Write("{ ""term"" : """&amp;FormatStringToJSONString(term.term)&amp;""", ""meaning"" : """&amp;FormatStringToJSONString(term.Meaning)&amp;""",")
                objFile.WriteLine(" ""termID"" : """&amp;FormatStringToJSONString(term.termID)&amp;""", ""type"" : """&amp;FormatStringToJSONString(term.type)&amp;""" }")
                counter = counter + 1
            Next
            objFile.WriteLine("]")

            objFile.Close
        End If
    End Function

    Sub OpenProject(file)
      ' open Enterprise Architect
      Set EAapp = CreateObject("EA.App")
      WScript.echo "opening Enterprise Architect. This might take a moment..."
      ' load project
      EAapp.Repository.OpenFile(file)
      ' make Enterprise Architect to not appear on screen
      EAapp.Visible = False

      ' get repository object
      Set Repository = EAapp.Repository
      ' Show the script output window
      ' Repository.EnsureOutputVisible("Script")
      call ExportGlossaryTermsAsJSONFile(Repository)

      Set projectInterface = Repository.GetProjectInterface()

      Dim childPackage 'As EA.Package
      ' Iterate through all model nodes
      Dim currentModel 'As EA.Package
      If (InStrRev(file,"{") &gt; 0) Then
        ' the filename references a GUID
        ' like {04C44F80-8DA1-4a6f-ECB8-982349872349}
        WScript.echo file
        GUID = Mid(file, InStrRev(file,"{")+0,38)
        WScript.echo GUID
        ' Iterate through all child packages and save out their diagrams
        call DumpPackageDiagrams(EAapp, GUID)
      Else
        If packageFilter.Count = 0 Then
          WScript.echo "done"
        ' Iterate through all model nodes
        For Each currentModel In Repository.Models
            ' Iterate through all child packages and save out their diagrams
            For Each childPackage In currentModel.Packages
                call DumpDiagrams(childPackage,currentModel)
            Next
        Next
        Else
          ' Iterate through all packages found in the package filter given by script parameter.
          For Each packageGUID In packageFilter
            call DumpPackageDiagrams(EAapp, packageGUID)
          Next
        End If
      End If
      EAapp.Repository.CloseFile()
      ' Since EA 15.2 the Enterprise Architect background process hangs without calling Exit explicitly
      EAapp.Repository.Exit()
    End Sub

  Private connectionString
  Private packageFilter
  Private exportDestination
  Private searchPath
  Private glossaryFilePath
  Private diagramAttributes
  Private additionalOptions

  exportDestination = "./src/docs"
  searchPath = "./src"
  Set packageFilter = CreateObject("System.Collections.ArrayList")
  Set objArguments = WScript.Arguments

  Dim argCount
  argCount = 0
  While objArguments.Count &gt; argCount+1
    Select Case objArguments(argCount)
      Case "-c"
        connectionString = objArguments(argCount+1)
      Case "-p"
        packageFilter.Add objArguments(argCount+1)
      Case "-d"
        exportDestination = objArguments(argCount+1)
      Case "-s"
        searchPath = objArguments(argCount+1)
      Case "-g"
        glossaryFilePath = objArguments(argCount+1)
      Case "-da"
        diagramAttributes = objArguments(argCount+1)
      Case "-ao"
        additionalOptions = objArguments(argCount+1)
    End Select
    argCount = argCount + 2
  WEnd
  set fso = CreateObject("Scripting.fileSystemObject")
  WScript.echo "Image extractor"

  ' Check both types in parallel - 1st check Enterprise Architect database connection, 2nd look for local project files
  If Not IsEmpty(connectionString) Then
     WScript.echo "opening database connection now"
     OpenProject(connectionString)
  End If
  WScript.echo "looking for .eap(x) files in " &amp; fso.GetAbsolutePathName(searchPath)
  ' Dim f As Scripting.Files
  SearchEAProjects fso.GetFolder(searchPath)

  WScript.echo "finished exporting images"</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportvisio">1.16. exportVisio</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_6">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportVisio.png" alt="exportVisio">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_10">About This Task</h5>
<div class="paragraph">
<p>This task searches for Visio files in the <code>/src/docs</code> folder then exports all diagrams and element notes to <code>/src/docs/images/visio</code> and <code>/src/docs/visio</code>.</p>
</div>
<div class="paragraph">
<p>Images are stored as <code>/images/visio/[filename]-[pagename].png</code>. Notes are stored as <code>/visio/[filename]-[pagename].adoc</code></p>
</div>
<div class="paragraph">
<p>You can specify a filename to export notes to by starting any comment with <code>{adoc:[filename].adoc}</code>.
It will then be written to <code>/visio/[filename].adoc</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_important_information_about_this_task">Important Information About This Task</h5>
<div class="ulist">
<ul>
<li>
<p>Currently, only Visio files stored directly in <code>/src/docs</code> are supported. All others will export to the wrong location.</p>
</li>
<li>
<p>Before running this task, close any open Visio instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_4">Further Reading and Resources</h5>
<div class="paragraph">
<p><a href="https://github.com/docToolchain/docToolchain/issues/112">Issue #112</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_15">Source</h5>
<div class="listingblock">
<div class="title">exportVisio.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportVisio(
        dependsOn: [streamingExecute],
        description: 'exports all diagrams and notes from visio files',
        group: 'docToolchain'
) {
    doLast {
        //make sure path for notes exists
        //and remove old notes
        new File(docDir, 'src/docs/visio').deleteDir()
        //also remove old diagrams
        new File(docDir, 'src/docs/images/visio').deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported diagrams and notes from visio files.
		
Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder	will be overwritten with each re-export!**

use `gradle exportVisio` to re-export files
"""
        new File(docDir, 'src/docs/images/visio/.').mkdirs()
        new File(docDir, 'src/docs/images/visio/readme.ad').write(readme)
        new File(docDir, 'src/docs/visio/.').mkdirs()
        new File(docDir, 'src/docs/visio/readme.ad').write(readme)
        def sourcePath = new File(docDir, 'src/docs/.').canonicalPath
        def scriptPath = new File(projectDir, 'scripts/VisioPageToPngConverter.ps1').canonicalPath
        "powershell ${scriptPath} -SourcePath ${sourcePath}".executeCmd()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">scripts/VisioPageToPngConverter.ps1</div>
<div class="content">
<pre class="prettyprint highlight"><code># Convert all pages in all visio files in the given directory to png files.
# A Visio windows might flash shortly.
# The converted png files are stored in the same directory
# The name of the png file is concatenated from the Visio file name and the page name.
# In addtion all the comments are stored in adoc files.
# If the Viso file is named "MyVisio.vsdx" and the page is called "FirstPage"
# the name of the png file will be "MyVisio-FirstPage.png" and the comment will
# be stored in "MyVisio-FirstPage.adoc".
# But for the name of the adoc files there is an alternative. It can be given in the first 
# line of the comment. If it is given in the comment it has to be given in curly brackes 
# with the prefix "adoc:", e.g. {adoc:MyCommentFile.adoc}
# Prerequisites: Viso and PowerShell has to be installed on the computer.
# Parameter: SourcePath where visio files can be found
# Example powershell VisoPageToPngConverter.ps1 -SourcePath c:\convertertest\

Param
(
    [Parameter(Mandatory=$true,ValueFromPipeline=$true,Position=0)]
    [Alias('p')][String]$SourcePath
)

Write-Output "starting to export visio"

If (!(Test-Path -Path $SourcePath))
{
    Write-Warning "The path ""$SourcePath"" does not exist or is not accessible, please input the correct path."
    Exit
}

# Extend the source path to get only Visio files of the given directory and not in subdircetories
If ($SourcePath.EndsWith("\"))
{
    $SourcePath  = "$SourcePath"
}
Else
{
    $SourcePath  = "$SourcePath\"
}

$VisioFiles = Get-ChildItem -Path "$SourcePath*" -Recurse -Include *.vsdx,*.vssx,*.vstx,*.vxdm,*.vssm,*.vstm,*.vsd,*.vdw,*.vss,*.vst

If(!($VisioFiles))
{
    Write-Warning "There are no Visio files in the path ""$SourcePath""."
    Exit
}

$VisioApp = New-Object -ComObject Visio.Application
$VisioApp.Visible = $false
    
# Extract the png from all the files in the folder
Foreach($File in $VisioFiles)
{
    $FilePath = $File.FullName
    Write-Output "found ""$FilePath"" ."
    $FileDirectory = $File.DirectoryName   # Get the folder containing the Visio file. Will be used to store the png and adoc files
    $FileBaseName = $File.BaseName -replace '[ :/\\*?|&lt;&gt;]','-'   # Get the filename to be used as part of the name of the png and adoc files
    
    Try
    {
        $Document = $VisioApp.Documents.Open($FilePath)
        $Pages = $VisioApp.ActiveDocument.Pages
        Foreach($Page in $Pages)
        {
            # Create valid filenames for the png and adoc files
            $PngFileName = $Page.Name -replace '[ :/\\*?|&lt;&gt;]','-'
            $PngFileName = "$FileBaseName-$PngFileName.png"
            $AdocFileName = $PngFileName.Replace(".png", ".adoc")

            #TODO: this needs better logic
            Write-Output("$SourcePath\images\visio\$PngFileName")
            $Page.Export("$SourcePath\images\visio\$PngFileName")
            
            $AllPageComments = ""
            ForEach($PageComment in $Page.Comments)
            {
                # Extract adoc filename from comment text if the syntax is valid
                # Remove the filename from the text and save the comment in a file with a valid name
                $EofStringIndex = $PageComment.Text.IndexOf(".adoc}")
                if ($PageComment.Text.StartsWith("{adoc") -And ($EofStringIndex -gt 6))
                {
                    $AdocFileName = $PageComment.Text.Substring(6, $EofStringIndex -1)
                    $AllPageComments += $PageComment.Text.Substring($EofStringIndex + 6)
                }
                else
                {
                    $AllPageComments += $PageComment.Text+"`n"
                }
            }
            If ($AllPageComments)
            {

                $AdocFileName = $AdocFileName -replace '[:/\\*?|&lt;&gt;]','-'
                #TODO: this needs better logic
                $stream = [System.IO.StreamWriter] "$SourcePath\visio\$AdocFileName"
                $stream.WriteLine($AllPageComments)
                $stream.close()
            }                    
        }
        $Document.Close()
    }
    Catch
    {
        if ($Document)
        {
            $Document.Close()
        }
        Write-Warning "One or more visio page(s) in file ""$FilePath"" have been lost in this converting."
        Write-Warning "Error was: $_"
    }
}
$VisioApp.Quit()</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportdrawio">1.17. exportDrawIo</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3f7fa472f24ae9ea4caaefd3a669f6ea?d=identicon" alt="Jared Morgan" width="32" height="32" title="Jared Morgan"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_11">About This Task</h5>
<div class="paragraph">
<p>There is no <code>exportDrawIo</code> task available in docToolchain because such a task is not required.
You can continue to use <a href="https://app.diagrams.net/">diagrams.net</a> (formerly known as draw.io) to edit your diagrams simply by making a change to your diagram-authoring workflow.</p>
</div>
</div>
<div class="sect4">
<h5 id="_about_diagrams_net">About diagrams.net</h5>
<div class="paragraph">
<p>diagrams.net offers free and open source desktop editors for all major operating system platforms.
Visit <a href="https://www.diagrams.net/integrations" class="bare">https://www.diagrams.net/integrations</a> to find a desktop editor application compatible with your operating system.
When you use the desktop version, just create your diagram with the <code>.png</code> (or even better, <code>.dio.png</code>) extension and diagrams.net will always save your diagram as a PNG with the source as metadata.</p>
</div>
<div class="paragraph">
<p>They have also launched a free plugin for VS Code and IntelliJ so you can edit your diagrams offline!</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_change_your_workflow_to_use_diagrams_net">How to Change Your Workflow to Use diagrams.net</h5>
<div class="paragraph">
<p>Export your diagrams.net/draw.io diagrams as a PNG with the source embedded in the file metadata.
This allows you to embed your diagrams into AsciiDoc source as you normally would (using the <code>image::</code> macro) with the added advantage of storing the diagram source with the image itself.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_convert_a_confluence_page_to_asciidoc">How to Convert a Confluence Page to AsciiDoc</h5>
<div class="paragraph">
<p>If you are converting a Confluence page with embedded draw.io diagrams to AsciiDoc, use this export workflow to continue using diagrams.net:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Export an editable PNG diagram from Confluence.</p>
</li>
<li>
<p>Load the diagram you want to export from Confluence.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">File</b>&#160;<b class="caret">&#8250;</b> <b class="submenu">Export as</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">PNG&#8230;&#8203;</b></span>.</p>
</li>
<li>
<p>In the Image modal, make sure that <strong>Include a copy of my diagram</strong> is selected.</p>
</li>
<li>
<p>Click <strong>Export</strong> to save the PNG file with the pattern <code>[file].dio.png</code>.</p>
</li>
<li>
<p>Commit the exported PNG file to source control.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your diagram can now be managed in source control, added to your documentation source and edited using a diagrams.net desktop version.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Specifying <code>.dio</code> (short for "<strong>d</strong>raw<strong>io</strong>") in the name will help you identify PNG files containing an embedded XML diagram source.
</td>
</tr>
</table>
</div>
<script src="https://plugins.jetbrains.com/assets/scripts/mp-widget.js"></script>
<script>
  // Please, replace #yourelement with a real element id on your webpage
  MarketplaceWidget.setupMarketplaceWidget('card', 15635, "#myelement");
</script>
<div id="myelement"></div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportchangelog">1.18. exportChangeLog</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/d2c684ec9e55edec506308356b67016?d=identicon" alt="Jakub J Jablonski" width="32" height="32" title="Jakub J Jablonski"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_7">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportChangeLog.png" alt="exportChangeLog">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_12">About This Task</h5>
<div class="paragraph">
<p>As the name suggests, this task exports the changelog to be referenced from within your documentation, if needed.
The changelog is written to <code>build/docs/changelog.adoc</code>.</p>
</div>
<div class="paragraph">
<p>This task can be configured to use a different source control system or a different directory.
To configure this task, copy <code>template_config/scripts/ChangelogConfig.groovy</code> to your directory and modify to suit your needs.
Then use -PchangelogConfigFile=&lt;your config file&gt; to add the path to your configuration file to the task.
See the description inside the template for more details.</p>
</div>
<div class="paragraph">
<p>By default, the source is the Git changelog for the path <code>src/docs</code> and only contains the commit messages for changes made to the documentation.
All changes to the build or other sources in the repository will not show up.
By default, the changelog contains changes made to <em>date</em>, <em>author</em> and <em>commit message</em> already formatted as AsciiDoc table content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>| 09.04.2017
| Ralf D. Mueller
| fix #24 template updated to V7.0

| 08.04.2017
| Ralf D. Mueller
| fixed typo</pre>
</div>
</div>
<div class="paragraph">
<p>You simply include it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.Changes
[options="header",cols="1,2,6"]
|====
| Date
| Author
| Comment

include::../../build/docs/changelog.adoc[]

|====</pre>
</div>
</div>
<div class="paragraph">
<p>By excluding the table definition, you can easily translate the table headings through different text snippets.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In a future docToolchain release, you will have the ability to include only certain commit messages from the changelog and exclude others (starting with <code>#</code> or <code>//</code>?).
This feature is not available just yet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_5">Further Reading and Resources</h5>
<div class="paragraph">
<p><a href="https://rdmueller.github.io/changelog/">The only constant in life is change</a> blog post.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_16">Source</h5>
<div class="listingblock">
<div class="title">exportChangelog.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportChangeLog(
        description: 'exports the change log from a git subpath',
        group: 'docToolchain'
) {
    doFirst {
        new File(targetDir).mkdirs()
    }
    doLast {
        logger.info("docToolchain&gt; docDir: "+docDir)
        logger.info("docToolchain&gt; mainConfigFile: "+mainConfigFile)
        def config = new ConfigSlurper().parse(new File(docDir, mainConfigFile).text)

        def cmd = "${config.changelog.cmd} ."
        def changes = cmd.execute(null, new File(docDir, config.changelog.dir)).text
        def changelog = new File(targetDir, 'changelog.adoc')
        logger.info "&gt; changelog exported ${changelog.canonicalPath}"
        changelog.write(changes)
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportcontributors">1.19. exportContributors</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_13">About This Task</h5>
<div class="paragraph">
<p>This task crawls through all Asciidoctor source files and extracts a list of contributors, which is then rendered as AsciiDoc images of each contributor&#8217;s gravatar picture.
The extracted list is stored in <code>/home/runner/work/docToolchain/docToolchain/build/contributors/015_tasks/03_task_exportContributors.adoc</code> so it can be easily included in your documents.</p>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_use_this_task">How to Use This Task</h5>
<div class="paragraph">
<p>The best way to use this task is to create a <code>feedback.adoc</code> file similar to this:</p>
</div>
<div class="listingblock">
<div class="title">feedback.adoc</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">ifndef::backend-pdf[] // <b class="conum">(1)</b>

    image::https://img.shields.io/badge/improve-this%20doc-orange.svg[link={manualdir}{filename}, float=right] // <b class="conum">(2)</b>
    image::https://img.shields.io/badge/create-an%20issue-blue.svg[link="https://github.com/docToolchain/documentation/issues/new?title=&amp;body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:{filename}", float=right] // <b class="conum">(3)</b>

endif::[]

include::{targetDir}/contributors/{filename}[] // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<div class="title">Key:</div>
<ol>
<li>
<p>Do not show this section when docs are rendered as PDF.</p>
</li>
<li>
<p>Create an <strong>Improve This Doc</strong> button which links to your GitHub sources.</p>
</li>
<li>
<p>Create a <strong>Create an Issue</strong> button which links to your issue tracker.</p>
</li>
<li>
<p>Include the list of contributors created by this task.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>(The task automatically adds the estimated reading time to the list of contributors.)</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_about_the_avatar_icons">About the Avatar-Icons</h5>
<div class="paragraph">
<p>It seems not to be possible to extract a link to the github avatar icons from the log.
So, the solution is to use <a href="https://gravatar.com">Gravatar</a> icons.
For this to work, the contributors email address is hashed and an icon link is generated from that hash.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon</pre>
</div>
</div>
<div class="paragraph">
<p>This result at least in an icon which has a distinct color.</p>
</div>
<div class="paragraph">
<p>Contributors can setup their own image through <a href="https://gravatar.com">Gravatar.com</a>.
For this to work, the git commits need to use an email address which can be verified by Gravatar.com.
Unfortunately, this is not the case if a contributor decided to make his email address private in the email sections of her github account.</p>
</div>
</div>
<div class="sect4">
<h5 id="_file_attributes">File Attributes</h5>
<div class="paragraph">
<p>This task also exports some GitHub file attributes.
The extracted attributes are stored in <code>/home/runner/work/docToolchain/docToolchain/build/fileattribs/015_tasks/03_task_exportContributors.adoc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:lastUpdated: 16.05.2019 06:22
:lastAuthorName: Ralf D. MÃ¼ller
:lastAuthorEmail: ralf.d.mueller@gmail.com
:lastAuthorAvatar: http://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon[32,32,role='gravatar',alt='Ralf D. MÃ¼ller',title='Ralf D. MÃ¼ller']
:lastMessage: #310 started to document config options</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can import and use these attributes in the same way as you import the contributors list.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
please make sure that you do not accidentally publish the email address if your contributors do not want it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">feedback.adoc</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">include::{targetDir}/fileattribs/{filename}[]

Last updated {lastUpdated} by {lastAuthorName}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportjiraissues">1.20. exportJiraIssues</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e0f7ac7994ea3ac2c1437a0da586ba63?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_8">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportJiraIssues.png" alt="exportJiraIssues">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_14">About This Task</h5>
<div class="paragraph">
<p>This task exports all issues for a given query or queries from Jira as either an AsciiDoc table or an Excel file.</p>
</div>
<div class="paragraph">
<p>The configuration for this task can be found within <code>Config.gradle</code> (<code>gradle.properties</code> can be used as a fallback).
Username/password is deprecated, so you need to use username/API-token instead.</p>
</div>
<div class="paragraph">
<p>An API-token can be created through <a href="https://id.atlassian.com/manage/api-tokens" class="bare">https://id.atlassian.com/manage/api-tokens</a>.
We recommend that you keep username and API-token out of your GitHub repository, and instead pass them as environment variables to docToolchain.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_2">Configuration</h5>
<div class="paragraph">
<p>Jira configuration support list requests to Jira where results of each requests will be saved in a file with specifies filename. Flags
<em>saveAsciidoc</em> &amp; <em>saveExcel</em> allow you to easily configure the format in which results should be saved.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The old configuration was based on the <strong>single Jira query is deprecated</strong> (single 'jql' parameter). Support for it will be removed in the near future. Please migrate to the new configuration which allows multiple Jira queries.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Configuration for Jira related tasks
jira = [:]

jira.with {

    // endpoint of the JiraAPI (REST) to be used
    api = 'https://your-jira-instance'

    /*
    WARNING: It is strongly recommended to store credentials securely instead of commiting plain text values to your git repository!!!

    Tool expects credentials that belong to an account which has the right permissions to read the JIRA issues for a given project.
    Credentials can be used in a form of:
     - passed parameters when calling script (-PjiraUser=myUsername -PjiraPass=myPassword) which can be fetched as a secrets on CI/CD or
     - gradle variables set through gradle properties (uses the 'jiraUser' and 'jiraPass' keys)
    Often, Jira &amp; Confluence credentials are the same, in which case it is recommended to pass CLI parameters for both entities as
    -Pusername=myUser -Ppassword=myPassword
    */

    // the key of the Jira project
    project = 'PROJECTKEY'

    // the format of the received date time values to parse
    dateTimeFormatParse = "yyyy-MM-dd'T'H:m:s.SSSz" // i.e. 2020-07-24'T'9:12:40.999 CEST

    // the format in which the date time should be saved to output
    dateTimeFormatOutput = "dd.MM.yyyy HH:mm:ss z" // i.e. 24.07.2020 09:02:40 CEST

    // the label to restrict search to
    label = 'label1'

    // Legacy settings for Jira query. This setting is deprecated &amp; support for it will soon be completely removed. Please use JiraRequests settings
    jql = "project='%jiraProject%' AND labels='%jiraLabel%' ORDER BY priority DESC, duedate ASC"

    // Base filename in which Jira query results should be stored
    resultsFilename = 'JiraTicketsContent'

    saveAsciidoc = true // if true, asciidoc file will be created with *.adoc extension
    saveExcel = true // if true, Excel file will be created with *.xlsx extension

    // Output folder for this task inside main outputPath
    resultsFolder = 'JiraRequests'

    /*
    List of requests to Jira API:
    These are basically JQL expressions bundled with a filename in which results will be saved.
    User can configure custom fields IDs and name those for column header,
    i.e. customfield_10026:'Story Points' for Jira instance that has custom field with that name and will be saved in a coloumn named "Story Points"
    */
    requests = [
        new JiraRequest(
            filename:"File1_Done_issues",
            jql:"project='%jiraProject%' AND status='Done' ORDER BY duedate ASC",
            customfields: [customfield_10026:'Story Points']
        ),
        new JiraRequest(
            filename:'CurrentSprint',
            jql:"project='%jiraProject%' AND Sprint in openSprints() ORDER BY priority DESC, duedate ASC",
            customfields: [customfield_10026:'Story Points']
        ),
    ]
}

@groovy.transform.Immutable
class JiraRequest {
    String filename  //filename (without extension) of the file in which JQL results will be saved. Extension will be determined automatically for Asciidoc or Excel file
    String jql // Jira Query Language syntax
    Map&lt;String,String&gt; customfields // map of customFieldId:displayName values for Jira fields which don't have default names, i.e. customfield_10026:StoryPoints
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_6">Further Reading and Resources</h5>
<div class="paragraph">
<p>Read the <a href="https://rdmueller.github.io/Jira/">Living Documents for Agile Projects</a> blog post.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_17">Source</h5>
<div class="listingblock">
<div class="title">exportJiraIssues.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportJiraIssues(
        description: 'exports all jira issues from a given search',
        group: 'docToolchain'
) {
    doLast {
        final String taskSubfolderName = config.jira.resultsFolder
        final File targetFolder = new File(targetDir + File.separator + taskSubfolderName)
        if (!targetFolder.exists()) targetFolder.mkdirs()
        logger.debug("Output folder for 'exportJiraIssues' task is: '${targetFolder}'")

        // map configuration from Config.groovy to existing variables for compatibility with naming of Jira settings in gradle.properties
        def jiraRoot = config.jira.api
        def jiraProject = config.jira.project
        def jiraLabel = config.jira.label
        def jiraResultsFilename = config.jira.resultsFilename
        def jiraDateTimeFormatParse = config.jira.dateTimeFormatParse
        def jiraDateTimeOutput = config.jira.dateTimeFormatOutput
        def defaultFields = 'priority,created,resolutiondate,summary,assignee,status'

        def jira = new groovyx.net.http.RESTClient(jiraRoot + '/rest/api/2/')
        jira.encoderRegistry = new groovyx.net.http.EncoderRegistry(charset: 'utf-8')
        def headers = [
                'Authorization': "Basic " + config.jira.credentials,
                'Content-Type' : 'application/json; charset=utf-8'
        ]

        def jiraRequests = config.jira.requests

        if (config.jira.jql) {
            logger.warn("&gt;&gt;&gt;Found legacy Jira requests. Please migrate to the new Jira configuration ASAP. Old config with jql will be removed soon")
            writeAsciiDocFileForLegacyConfiguration(targetFolder, jira, headers, config.jira)
        }

        jiraRequests.each {rq -&gt;
            logger.quiet("Request to Jira API for '${rq.filename}' with query: '${rq.jql}'")

            def allHeaders = "${defaultFields},${rq.customfields.values().join(",")}"
            def allFieldIds = "${defaultFields},${rq.customfields.keySet().join(",")}"
            logger.quiet("Preparing headers for default &amp; custom fields: ${allHeaders}")
            logger.quiet("Preparing field IDs for default &amp; custom fields: ${allFieldIds}")

            // Save AsciiDoc file
            if (config.jira.saveAsciidoc) {
                def extension = 'adoc'
                jiraResultsFilename = "${rq.filename}.${extension}"
                logger.info("Results will be saved in '${rq.filename}.${extension}' file")

                def jiraDataAsciidoc = new File(targetFolder, "${rq.filename}.${extension}")
                jiraDataAsciidoc.write(".${rq.filename}\n", 'utf-8')
                jiraDataAsciidoc.append("|=== \n")

                // AsciiDoc table headers (custom fields map needs values here)
                jiraDataAsciidoc.append("|Key ", 'utf-8')
                allHeaders.split(",").each {field -&gt;
                    jiraDataAsciidoc.append("|${field.capitalize()} ", 'utf-8')
                }
                jiraDataAsciidoc.append("\n", 'utf-8')

                jira.get(path: 'search',
                    query: ['jql'       : rq.jql.replaceAll('%jiraProject%', jiraProject).replaceAll('%jiraLabel%', jiraLabel),
                            'maxResults': 1000,
                            fields: "${allFieldIds}"
                    ],
                    headers: headers
                ).data.issues.each { issue -&gt;
                    //logger.quiet("&gt;&gt; Whole issue ${issue.key}:\n   ${issue.fields}")
                    jiraDataAsciidoc.append("| ${jiraRoot}/browse/${issue.key}[${issue.key}] ", 'utf-8')
                    jiraDataAsciidoc.append("| ${issue.fields.priority.name} ", 'utf-8')
                    jiraDataAsciidoc.append("| ${Date.parse(jiraDateTimeFormatParse, issue.fields.created).format(jiraDateTimeOutput)} ", 'utf-8')
                    jiraDataAsciidoc.append("| ${issue.fields.resolutiondate ? Date.parse(jiraDateTimeFormatParse, issue.fields.resolutiondate).format(jiraDateTimeOutput) : ''} ", 'utf-8')
                    jiraDataAsciidoc.append("| ${issue.fields.summary} ", 'utf-8')
                    jiraDataAsciidoc.append("| ${issue.fields.assignee ? issue.fields.assignee.displayName : 'not assigned'}", 'utf-8')
                    jiraDataAsciidoc.append("| ${issue.fields.status.name} ", 'utf-8')

                    rq.customfields.each { field -&gt;
                        def foundCustom = issue.fields.find {it.key == field.key}
                        //logger.quiet("Examining issue '${issue.key}' for custom field '${field.key}' has found: '${foundCustom}'")
                        jiraDataAsciidoc.append("| ${foundCustom ? foundCustom.value : '-'}\n", 'utf-8')
                    }
                }
                jiraDataAsciidoc.append("|=== \n")
            } else {
                logger.quiet("Set saveAsciidoc=true in '${mainConfigFile}' to save results in AsciiDoc file")
            }

            // Save Excel file
            if (config.jira.saveExcel) {
                def extension = 'xlsx'
                jiraResultsFilename = "${rq.filename}.${extension}"
                logger.quiet("&gt;&gt; Results will be saved in '${rq.filename}.${extension}' file")

                //def jiraDataAsciidoc = new File(targetFolder, "${rq.filename}.${extension}")

                def jiraDataXls = new File(targetFolder, jiraResultsFilename)
                def jiraFos = new FileOutputStream(jiraDataXls)

                Workbook wb = new XSSFWorkbook();
                CreationHelper hyperlinkHelper = wb.getCreationHelper();
                def sheetName = "${rq.filename}"
                def ws = wb.createSheet(sheetName)

                String rgbS = "A7A7A7"
                byte[] rgbB = Hex.decodeHex(rgbS)
                XSSFColor color = new XSSFColor(rgbB, null) //IndexedColorMap has no usage until now. So it can be set null.
                XSSFCellStyle headerCellStyle = (XSSFCellStyle) wb.createCellStyle()
                headerCellStyle.setFillForegroundColor(color)
                headerCellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND)

                def titleRow = ws.createRow(0);
                int cellNumber = 0;
                titleRow.createCell(cellNumber).setCellValue("Key")
                allHeaders.split(",").each {field -&gt;
                    titleRow.createCell(++cellNumber).setCellValue("${field.capitalize()}")
                }
                def lastRow = titleRow.getRowNum()
                titleRow.setRowStyle(headerCellStyle)

                jira.get(path: 'search',
                    query: ['jql'       : rq.jql.replaceAll('%jiraProject%', jiraProject).replaceAll('%jiraLabel%', jiraLabel),
                            'maxResults': 1000,
                            fields: "${allFieldIds}"
                    ],
                    headers: headers
                ).data.issues.each { issue -&gt;
                    int cellPosition = 0
                    def row = ws.createRow(++lastRow)
                    Hyperlink link = hyperlinkHelper.createHyperlink(HyperlinkType.URL)
                    link.setAddress("${jiraRoot}/browse/${issue.key}")
                    Cell cellWithUrl = row.createCell(cellPosition)
                    cellWithUrl.setCellValue("${issue.key}")
                    cellWithUrl.setHyperlink(link)

                    row.createCell(++cellPosition).setCellValue("${issue.fields.priority.name}")
                    row.createCell(++cellPosition).setCellValue("${Date.parse(jiraDateTimeFormatParse, issue.fields.created).format(jiraDateTimeOutput)}")
                    row.createCell(++cellPosition).setCellValue("${issue.fields.resolutiondate ? Date.parse(jiraDateTimeFormatParse, issue.fields.resolutiondate).format(jiraDateTimeOutput) : ''}")
                    row.createCell(++cellPosition).setCellValue("${issue.fields.summary}")
                    row.createCell(++cellPosition).setCellValue("${issue.fields.assignee ? issue.fields.assignee.displayName : ''}")
                    row.createCell(++cellPosition).setCellValue("${issue.fields.status.name}")

                    // Custom fields
                    rq.customfields.each { field -&gt;
                        def position = ++cellPosition
                        def foundCustom = issue.fields.find {it.key == field.key}
                        row.createCell(position).setCellValue("${foundCustom ? foundCustom.value : '-'}")
                    }
                }

                // set jira issue key column fits the content width

                for(int colNum = 0; colNum&lt;allHeaders.size()+1;colNum++) {
                    ws.autoSizeColumn(colNum)
                }
                // Set summary column width slightly wider but fixed size, so it doesn't change with every summary update
                ws.setColumnWidth(4, 25*384)


                wb.write(jiraFos)
            } else {
                logger.quiet("Set saveExcel=true in '${mainConfigFile}' to save results in Excel file")
            }
        }
    }
}

// This method can be removed when support for legacy Jira configuration is gone
def writeAsciiDocFileForLegacyConfiguration(def targetFolder, def restClient, def headers, def jiraConfig) {
    def resultsFilename = "${jiraConfig.resultsFilename}_legacy.adoc"

    def openIssues = new File(targetFolder, "${resultsFilename}")
    openIssues.write(".Table {Title}\n", 'utf-8')
    openIssues.append("|=== \n")
    openIssues.append("|Key |Priority |Created | Assignee | Summary\n", 'utf-8')
        def legacyJql = jiraConfig.jql.replaceAll('%jiraProject%', config.jira.project).replaceAll('%jiraLabel%', config.jira.label)
        println ("Results for legacy query '${legacyJql}' will be saved in '${resultsFilename}' file")

        restClient.get(path: 'search',
                query: ['jql'       : legacyJql,
                        'maxResults': 1000,
                        'fields'    : 'created,resolutiondate,priority,summary,timeoriginalestimate, assignee'
                ],
                headers: headers
      ).data.issues.each { issue -&gt;
        openIssues.append("| ${jiraRoot}/browse/${issue.key}[${issue.key}] ", 'utf-8')
        openIssues.append("| ${issue.fields.priority.name} ", 'utf-8')
        openIssues.append("| ${Date.parse(jiraConfig.dateTimeFormatParse, issue.fields.created).format(jiraConfig.dateTimeFormatOutput)} ", 'utf-8')
        openIssues.append("| ${issue.fields.assignee ? issue.fields.assignee.displayName : 'not assigned'}", 'utf-8')
        openIssues.append("| ${issue.fields.summary} ", 'utf-8')
    }
    openIssues.append("|=== \n")
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportjirasprintchangelogissues">1.21. exportJiraSprintChangelogIssues</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_15">About This Task</h5>
<div class="paragraph">
<p>This task exports a simplified (key and summary) list of Jira issues for a specific sprint defined in the task configuration. Only a few additional fields (such as assignee) can be switched using configuration flags.</p>
</div>
<div class="paragraph">
<p>Once you define the sprint, the relevant AsciiDoc and Excel files will be generated.
If a sprint is not defined in the configuration, changelogs for all sprints that match the configuration will be saved in separate AsciiDoc files and in different tabs within an Excel file.</p>
</div>
<div class="paragraph">
<p>The task configuration can be found within <code>Config.gradle</code>. In addition to the configuration snippet below, it is important to configure the Jira API and credentials in the Jira section of the configuration inside the same file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_3">Configuration</h5>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Sprint changelog configuration generate changelog lists based on tickets in sprints of an Jira instance.
// This feature requires at least Jira API &amp; credentials to be properly set in Jira section of this configuration
sprintChangelog = [:]
sprintChangelog.with {
    sprintState = 'closed' // it is possible to define multiple states, i.e. 'closed, active, future'
    ticketStatus = "Done, Closed" // it is possible to define multiple ticket statuses, i.e. "Done, Closed, 'in Progress'"

    showAssignee = false
    showTicketStatus = false
    showTicketType = true
    sprintBoardId = 12345  // Jira instance probably have multiple boards; here it can be defined which board should be used

    // Output folder for this task inside main outputPath
    resultsFolder = 'Sprints'

    // if sprintName is not defined or sprint with that name isn't found, release notes will be created on for all sprints that match sprint state configuration
    sprintName = 'PRJ Sprint 1' // if sprint with a given sprintName is found, release notes will be created just for that sprint
    allSprintsFilename = 'Sprints_Changelogs' // Extension will be automatically added.
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_18">Source</h5>
<div class="listingblock">
<div class="title">exportJiraSprintChangelog.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportJiraSprintChangelog(
        description: 'exports all jira issues from Sprint for release notes',
        group: 'docToolchain'
) {
    doLast {
        // Pre defined ticket fields for Changelog based on Jira Sprints
        def defaultTicketFields = 'summary,status,assignee,issuetype'

        // retrieving sprints for a given board
        def sprints = { apiSprints, headers, boardId, sprintState -&gt;
                apiSprints.get(path: "agile/latest/board/${boardId}/sprint",
                    query:[state: "${sprintState}"],
                    headers: headers
                ).data
        }

        // retrieving issues for given sprint
        def issues = { apiIssues, headers, boardId, sprintId, status -&gt;
            apiIssues.get(path: "agile/latest/board/${boardId}/sprint/${sprintId}/issue",
                    query: ['jql'       : "status in (${status}) ORDER BY type DESC, status ASC",
                            'maxResults': 1000,
                            fields: defaultTicketFields
                    ],
                    headers: headers
            ).data
        }

        // preparing target folder for generated files
        final String taskSubfolderName = config.sprintChangelog.resultsFolder
        final File targetFolder = new File(targetDir + File.separator + taskSubfolderName)
        if (!targetFolder.exists()) targetFolder.mkdirs()
        logger.debug("Output folder for 'exportJiraSprintChangelog' task is: '${targetFolder}'")

        // Getting configuration
        def jiraRoot = config.jira.api
        def jiraProject = config.jira.project

        def sprintState = config.sprintChangelog.sprintState
        def ticketStatusForReleaseNotes = config.sprintChangelog.ticketStatus
        def sprintBoardId = config.sprintChangelog.sprintBoardId
        def showAssignee = config.sprintChangelog.showAssignee
        def showTicketStatus = config.sprintChangelog.showTicketStatus
        def showTicketType = config.sprintChangelog.showTicketType
        def sprintName = config.sprintChangelog.sprintName
        def allSprintsFilename = config.sprintChangelog.allSprintsFilename

        logger.info("\n==========================\nJira Release notes config\n==========================")
        logger.info("Spring Board ID: ${sprintBoardId}")
        logger.info("Show assignees: ${showAssignee}. Show ticket status: ${showTicketStatus}. Show ticket type: ${showTicketType}")
        logger.info("Filtering for sprints with configured state: '${sprintState}'")
        logger.info("Filtering for issues with configured statuses: ${ticketStatusForReleaseNotes}")
        logger.info("Attempt to generate release notes for sprint with a name: '${sprintName}'")
        logger.info("Filename used for all sprints: '${allSprintsFilename}'")

        def api = new groovyx.net.http.RESTClient(jiraRoot + '/rest/')
        api.encoderRegistry = new groovyx.net.http.EncoderRegistry(charset: 'utf-8')
        def headers = [
                'Authorization': "Basic " + config.jira.credentials,
                'Content-Type' : 'application/json; charset=utf-8'
        ]

        def allChangelogsFilename = "${allSprintsFilename}.xlsx"
        logger.quiet("Changelogs of all sprints will be saved in '${allChangelogsFilename}' file")

        def changelogsXls = new File(targetFolder, allChangelogsFilename)
        def changelogsXlsFos = new FileOutputStream(changelogsXls)
        Workbook wb = new XSSFWorkbook();
        CreationHelper hyperlinkHelper = wb.getCreationHelper();

        String rgbS = "A7A7A7"
        byte[] rgbB = Hex.decodeHex(rgbS) // get byte array from hex string
        XSSFColor color = new XSSFColor(rgbB, null) //IndexedColorMap has no usage until now. So it can be set null.
        XSSFCellStyle headerCellStyle = (XSSFCellStyle) wb.createCellStyle()
        headerCellStyle.setFillForegroundColor(color)
        headerCellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND)

        // prepare tickets according to configuration
        def columns = ['key'].plus(defaultTicketFields.split(',').collect())
        if (!showAssignee) { columns = columns.minus('assignee')}
        if (!showTicketStatus) { columns = columns.minus('status')}
        if (!showTicketType) { columns = columns.minus('issuetype')}
        logger.info("Release notes will contain following info: ${columns}")

        logger.info("\n=====================\n      Sprints\n=====================")
        //
        def allMatchedSprints = sprints(api, headers, sprintBoardId, sprintState).values
        def foundExactSprint = allMatchedSprints.any {it.name == sprintName}
        logger.info("All sprints that matched configuration: ${allMatchedSprints.size()}")

        def sprintsForChangelog = foundExactSprint ? allMatchedSprints.stream().filter() {it.name == sprintName} : allMatchedSprints
        logger.info("Found exact Sprint with name '${sprintName}': ${foundExactSprint}.")

        sprintsForChangelog.each { sprint -&gt;
            logger.quiet("\nSprint: $sprint.name [id: $sprint.id] state &lt;$sprint.state&gt;")

            /* ================================================
                Create new worksheet inside existing excel file
               ================================================ */
            String safeSprintName = WorkbookUtil.createSafeSheetName("${sprint.name}")
            def ws = wb.createSheet(safeSprintName)

            // Add titles (typically key &amp; summary, but assignee, ticket status, ticket type can be configured in Config.groovy too)
            def titleRow = ws.createRow(0);
            int cellNumber = 0;
            columns.each {columnTitle -&gt; titleRow.createCell(cellNumber++).setCellValue("${columnTitle.capitalize()}")}

            def lastRow = titleRow.getRowNum()
            titleRow.setRowStyle(headerCellStyle)
            // set summary (at position 1) column wider than other columns
            ws.setColumnWidth(1, 35*256)

            /* =========================================
                      AsciiDoc file for each sprint
               ========================================= */
            def asciidocFilename = "${sprint.name.replaceAll(" ", "_")}.adoc"
            logger.info("Results will be saved in '${asciidocFilename}' file")

            def changeLogAdoc = new File(targetFolder, "${asciidocFilename}")
            changeLogAdoc.write(".Table ${sprint.name} Changelog\n", 'utf-8')
            changeLogAdoc.append("|=== \n")

            // AsciiDoc table columns
            columns.each {columnTitle -&gt; changeLogAdoc.append("|${columnTitle} ", 'utf-8')}

            /* =========================================
                      Add tickets for the sprint
               ========================================= */
            issues(api, headers, sprintBoardId, sprint.id, ticketStatusForReleaseNotes).issues.each {issue -&gt;
                def assignee = "${issue.fields.assignee ? issue.fields.assignee.displayName : 'unassigned'} "
                def message = showAssignee ? "by ${assignee} ": ""
                logger.quiet("Issue: [$issue.key] '$issue.fields.summary' ${message}&lt;$issue.fields.status.name&gt;")

                /* ===========================
                      Write ticket to Excel
                   =========================== */
                int cellPosition = 0
                def row = ws.createRow(++lastRow)

                Hyperlink link = hyperlinkHelper.createHyperlink(HyperlinkType.URL)
                link.setAddress("${jiraRoot}/browse/${issue.key}")
                Cell cellWithUrl = row.createCell(cellPosition)
                cellWithUrl.setCellValue("${issue.key}")
                cellWithUrl.setHyperlink(link)

                row.createCell(++cellPosition).setCellValue("${issue.fields.summary}")

                /* =============================
                      Write ticket to Asciidoc
                   ============================= */
                changeLogAdoc.append("\n", 'utf-8')
                changeLogAdoc.append("| ${jiraRoot}/browse/${issue.key}[${issue.key}] ", 'utf-8')
                changeLogAdoc.append("| ${issue.fields.summary} ", 'utf-8')

                /* === Write ticket status, assignee, ticket typee if configured to both Asciidoc &amp; Excel files === */
                if (showTicketStatus) {
                    row.createCell(++cellPosition).setCellValue("${issue.fields.status.name}")
                    changeLogAdoc.append("| ${issue.fields.status.name} ", 'utf-8')
                }

                if (showAssignee) {
                    row.createCell(++cellPosition).setCellValue("${assignee}")
                    changeLogAdoc.append("| ${assignee}", 'utf-8')
                }

                if (showTicketType) {
                    row.createCell(++cellPosition).setCellValue("${issue.fields.issuetype.name}")
                    changeLogAdoc.append("| ${issue.fields.issuetype.name} ", 'utf-8')
                }
            }
            // Close the asciidoc table
            changeLogAdoc.append("\n|=== \n",'utf-8')

            // Set auto-width to KEY column
            ws.autoSizeColumn(0);
        }
        // Write to Excel file
        wb.write(changelogsXlsFos)
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportppt">1.22. exportPPT</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_9">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportPPT.png" alt="exportPPT">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_16">About This Task</h5>
<div class="paragraph">
<p>This task lets you export AsciiDoc content to a series of PowerPoint slides.
It is currently a Windows-only task.</p>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_7">Further Reading and Resources</h5>
<div class="ulist">
<ul>
<li>
<p>Read the <a href="https://rdmueller.github.io/PPT-as-asciidoc-editor/">Do More with Slides</a> blog post.</p>
</li>
<li>
<p>Find more information about the Windows-only aspect of this task in <a href="https://github.com/docToolchain/docToolchain/issues/231">this issue</a>.</p>
</li>
<li>
<p>Check out <a href="https://github.com/uniqueck/asciidoctorj-office-extension">asciidoctorj-office-extension</a> for another way to use PPT slides in your docs.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_source_19">Source</h5>
<div class="listingblock">
<div class="title">exportPPT.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportPPT(
        dependsOn: [streamingExecute],
        description: 'exports all slides and some texts from PPT files',
        group: 'docToolchain'
) {
    doLast {
        //make sure path for notes exists
        //and remove old notes
        new File(projectDir, 'src/docs/ppt').deleteDir()
        //also remove old diagrams
        new File(projectDir, 'src/docs/images/ppt').deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported slides or notes from .ppt presentations.
		
Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder	will be overwritten with each re-export!**

use `gradle exportPPT` to re-export files
"""
        new File(projectDir, 'src/docs/images/ppt/.').mkdirs()
        new File(projectDir, 'src/docs/images/ppt/readme.ad').write(readme)
        new File(projectDir, 'src/docs/ppt/.').mkdirs()
        new File(projectDir, 'src/docs/ppt/readme.ad').write(readme)
        //execute through cscript in order to make sure that we get WScript.echo right
        "%SystemRoot%\\System32\\cscript.exe //nologo ${projectDir}/scripts/exportPPT.vbs".executeCmd()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">exportPPT.vbs</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="vbs">    Const   ForAppending = 8
    Const   ppPlaceholderBody = 2

    ' Helper
    ' http://windowsitpro.com/windows/jsi-tip-10441-how-can-vbscript-create-multiple-folders-path-mkdir-command
    Function MakeDir (strPath)
      Dim strParentPath, objFSO
      Set objFSO = CreateObject("Scripting.FileSystemObject")
      On Error Resume Next
      strParentPath = objFSO.GetParentFolderName(strPath)

      If Not objFSO.FolderExists(strParentPath) Then MakeDir strParentPath
      If Not objFSO.FolderExists(strPath) Then objFSO.CreateFolder strPath
      On Error Goto 0
      MakeDir = objFSO.FolderExists(strPath)

    End Function

	Function SearchPresentations(path)

		  For Each folder In path.SubFolders
		    SearchPresentations folder
		  Next

		  For Each file In path.Files
				If (Left(fso.GetExtensionName (file.Path), 3) = "ppt") OR (Left(fso.GetExtensionName (file.Path), 3) = "pps")  Then
					WScript.echo "found "&amp;file.path
					ExportSlides(file.Path)
				End If
		  Next

    End Function

    Sub ExportSlides(sFile)
        Set objRegEx = CreateObject("VBScript.RegExp")
        objRegEx.Global = True
        objRegEx.IgnoreCase = True
        objRegEx.MultiLine = True
        ' "." doesn't work for multiline in vbs, "[\s,\S]" does...
        objRegEx.Pattern = "[\s,\S]*{adoc}"
        ' http://www.pptfaq.com/FAQ00481_Export_the_notes_text_of_a_presentation.htm
        strFileName = fso.GetFIle(sFile).Name
        Set oPPT = CreateObject("PowerPoint.Application")
        Set oPres = oPPT.Presentations.Open(sFile, True, False, False) ' Read Only, No Title, No Window
        Set oSlides = oPres.Slides
        strNotesText = ""
        strImagePath = "/src/docs/images/ppt/" &amp; strFileName &amp; "/"
        MakeDir("." &amp; strImagePath)
        strNotesPath = "/src/docs/ppt/"
        MakeDir("." &amp; strNotesPath)
        For Each oSl In oSlides
           strSlideName = oSl.Name
           ' WScript.echo fso.GetAbsolutePathName(".") &amp; strImagePath &amp; strSlideName &amp; ".jpg"
           oSl.Export fso.GetAbsolutePathName(".") &amp; strImagePath &amp; strSlideName &amp; ".jpg", ".jpg"
            For Each oSh In oSl.NotesPage.Shapes
                If oSh.PlaceholderFormat.Type = ppPlaceholderBody  Then
                    If oSh.HasTextFrame Then
                        If oSh.TextFrame.HasText Then
                            strCurrentNotes = oSh.TextFrame.TextRange.Text
                            strCurrentNotes = Replace(strCurrentNotes,vbVerticalTab, vbCrLf)
                            strCurrentNotes = Replace(strCurrentNotes,"{slide}","image::ppt/"&amp;strFileName&amp;"/"&amp;strSlideName&amp;".jpg[]")
                            ' remove speaker notes before marker "{adoc}"
                            strCurrentNotes = objRegEx.Replace(strCurrentNotes,"")
                            strNotesText = strNotesText  &amp; vbCrLf &amp; strCurrentNotes &amp; vbCrLf &amp; vbCrLf
                        End If
                    End If
                End If
            Next
        Next
        ' WScript.echo fso.GetAbsolutePathName(".") &amp; strNotesPath&amp;""&amp;strFileName&amp;".ad"
        ' http://stackoverflow.com/questions/2524703/save-text-file-utf-8-encoded-with-vba

        Set fsT = CreateObject("ADODB.Stream")
        fsT.Type = 2 'Specify stream type - we want To save text/string data.
        fsT.Charset = "utf-8" 'Specify charset For the source text data.
        fsT.Open 'Open the stream And write binary data To the object
        fsT.WriteText "ifndef::imagesdir[:imagesdir: ../../images]"&amp;vbCrLf&amp;CStr(strNotesText)
        fsT.SaveToFile fso.GetAbsolutePathName(".") &amp; strNotesPath&amp;""&amp;strFileName&amp;".ad", 2 'Save binary data To disk
        oPres.Close()
        oPPT.Quit()
    End Sub

  set fso = CreateObject("Scripting.fileSystemObject")
  WScript.echo "Slide extractor"
  WScript.echo "looking for .ppt files in " &amp; fso.GetAbsolutePathName(".") &amp; "/src"
  SearchPresentations fso.GetFolder("./src")
  WScript.echo "finished exporting slides"</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_exportexcel">1.23. exportExcel</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_10">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportExcel.png" alt="exportExcel">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_17">About This Task</h5>
<div class="paragraph">
<p>Sometimes you need to include tabular data in your documentation.
Most likely, this data will be stored as a MS Excel spreadsheet, or you may like to use Excel to create and edit it.
Either way, this task lets you export an Excel spreadsheet and include it directly in your docs.
It searches for <code>.xlsx</code> files and exports each contained worksheet as <code>.csv</code> and as <code>.adoc</code>.
Note that formulas contained in your spreadsheet are evaluated and exported statically.</p>
</div>
<div class="paragraph">
<p>The generated files are written to <code>src/excel/[filename]/[worksheet].(adoc|cvs)</code>.
The <code>src</code> folder is used instead of the <code>build</code> folder because a better history of worksheet changes is captured.</p>
</div>
<div class="paragraph">
<p>The files can be included either as AsciiDoc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>include::excel/Sample.xlsx/Numerical.adoc[]</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;or as a CSV file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[options="header",format="csv"]
|===
include::excel/Sample.xlsx/Numerical.csv[]
|===</pre>
</div>
</div>
<div class="paragraph">
<p>The AsciiDoc version gives you a bit more control because the following are preserved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Horizontal and vertical alignment.</p>
</li>
<li>
<p>col-span and row-span.</p>
</li>
<li>
<p>Line breaks.</p>
</li>
<li>
<p>Column width relative to other columns.</p>
</li>
<li>
<p>Background colors.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_8">Further Reading and Resources</h5>
<div class="paragraph">
<p>See <a href="https://github.com/uniqueck/asciidoctorj-office-extension">asciidoctorj-office-extension</a> to learn another way to use Excel spreadsheets in your docs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_20">Source</h5>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportExcel(
        description: 'exports all excelsheets to csv and AsciiDoc',
        group: 'docToolchain'
) {
    doFirst {
        File sourceDir = file(srcDir)

        def tree = fileTree(srcDir).include('**/*.xlsx').exclude('**/~*')

        def exportFileDir = new File(sourceDir, 'excel')

        //make sure path for notes exists
        exportFileDir.deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported workbooks from Excel.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradle exportExcel` to re-export files
"""
        exportFileDir.mkdirs()
        new File(exportFileDir, '/readme.ad').write(readme)
    }
    doLast {
        File sourceDir = file(srcDir)
        def exportFileDir = new File(sourceDir, 'excel')
        def tree = fileTree(srcDir).include('**/*.xlsx').exclude('**/~*')

        def nl = System.getProperty("line.separator")

        def export = { sheet, evaluator, targetFileName -&gt;
            def targetFileCSV = new File(targetFileName + '.csv')
            def targetFileAD = new File(targetFileName + '.adoc')
            def df = new org.apache.poi.ss.usermodel.DataFormatter();
            def regions = []
            sheet.numMergedRegions.times {
                regions &lt;&lt; sheet.getMergedRegion(it)
            }
            logger.debug "sheet contains ${regions.size()} regions"
            def color = ''
            def resetColor = false
            def numCols = 0
            def headerCreated = false
            def emptyRows = 0
            for (int rowNum=0; rowNum&lt;=sheet.lastRowNum; rowNum++) {
                def row = sheet.getRow(rowNum)
                if (row &amp;&amp; !headerCreated) {
                    headerCreated = true
                    // create AsciiDoc table header
                    def width = []
                    numCols = row.lastCellNum
                    numCols.times { columnIndex -&gt;
                        width &lt;&lt; sheet.getColumnWidth((int) columnIndex)
                    }
                    //lets make those numbers nicer:
                    width = width.collect { Math.round(100 * it / width.sum()) }
                    targetFileAD.append('[options="header",cols="' + width.join(',') + '"]' + nl)
                    targetFileAD.append('|===' + nl)
                }
                def data = []
                def style = []
                def colors = []
                // For each row, iterate through each columns
                if (row &amp;&amp; (row?.lastCellNum!=-1)) {
                    numCols.times { columnIndex -&gt;
                        def cell = row.getCell(columnIndex)
                        if (cell) {
                            def cellValue = df.formatCellValue(cell, evaluator)
                            if (cellValue.startsWith('*') &amp;&amp; cellValue.endsWith('\u20AC')) {
                                // Remove special characters at currency
                                cellValue = cellValue.substring(1).trim();
                            }
                            def cellStyle = ''
                            def region = regions.find { it.isInRange(cell.rowIndex, cell.columnIndex) }
                            def skipCell = false
                            if (region) {
                                //check if we are in the upper left corner of the region
                                if (region.firstRow == cell.rowIndex &amp;&amp; region.firstColumn == cell.columnIndex) {
                                    def colspan = 1 + region.lastRow - region.firstRow
                                    def rowspan = 1 + region.lastColumn - region.firstColumn
                                    if (rowspan &gt; 1) {
                                        cellStyle += "${rowspan}"
                                    }
                                    if (colspan &gt; 1) {
                                        cellStyle += ".${colspan}"
                                    }
                                    cellStyle += "+"
                                } else {
                                    skipCell = true
                                }
                            }
                            if (!skipCell) {
                                switch (cell.cellStyle.alignmentEnum.toString()) {
                                    case 'RIGHT':
                                        cellStyle += '&gt;'
                                        break
                                    case 'CENTER':
                                        cellStyle += '^'
                                        break
                                }
                                switch (cell.cellStyle.verticalAlignmentEnum.toString()) {
                                    case 'BOTTOM':
                                        cellStyle += '.&gt;'
                                        break
                                    case 'CENTER':
                                        cellStyle += '.^'
                                        break
                                }
                                color = cell.cellStyle.fillForegroundXSSFColor?.RGB?.encodeHex()
                                color = color != null ? nl + "{set:cellbgcolor:#${color}}" : ''
                                data &lt;&lt; cellValue
                                if (color == '' &amp;&amp; resetColor) {
                                    colors &lt;&lt; nl + "{set:cellbgcolor!}"
                                    resetColor = false
                                } else {
                                    colors &lt;&lt; color
                                }
                                if (color != '') {
                                    resetColor = true
                                }
                                style &lt;&lt; cellStyle
                            } else {
                                data &lt;&lt; ""
                                colors &lt;&lt; ""
                                style &lt;&lt; "skip"
                            }
                        } else {
                            data &lt;&lt; ""
                            colors &lt;&lt; ""
                            style &lt;&lt; ""
                        }

                    }
                    emptyRows = 0
                } else {
                    if (emptyRows&lt;3) {
                        //insert empty row
                        numCols.times {
                            data &lt;&lt; ""
                            colors &lt;&lt; ""
                            style &lt;&lt; ""
                        }
                        emptyRows++
                    } else {
                        break
                    }
                }

                targetFileCSV.append(data
                        .collect {
                    "\"${it.replaceAll('"', '""')}\""
                }
                .join(',') + nl, 'UTF-8')
                targetFileAD.append(data
                        .withIndex()
                        .collect { value, index -&gt;
                    if (style[index] == "skip") {
                        ""
                    } else {
                        style[index] + "| ${value.replaceAll('[|]', '{vbar}').replaceAll("\n", ' +$0') + colors[index]}"
                    }
                }
                .join(nl) + nl * 2, 'UTF-8')
            }
            targetFileAD.append('|===' + nl)
        }


        tree.each { File excel -&gt;
            println "file: " + excel
            def excelDir = new File(exportFileDir, excel.getName())
            excelDir.mkdirs()
            InputStream inp
            inp = new FileInputStream(excel)
            def wb = org.apache.poi.ss.usermodel.WorkbookFactory.create(inp);
            def evaluator = wb.getCreationHelper().createFormulaEvaluator();
            for (int wbi = 0; wbi &lt; wb.getNumberOfSheets(); wbi++) {
                def sheetName = wb.getSheetAt(wbi).getSheetName()
                println " -- sheet: " + sheetName
                def targetFile = new File(excelDir, sheetName)
                export(wb.getSheetAt(wbi), evaluator, targetFile.getAbsolutePath())
            }
            inp.close();
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_18">2. About This Task</h3>
<div class="paragraph">
<p>The <em>exportMarkdown</em> task can be used to include <a href="https://markdown.de">markdown</a> files into the documentation.
It scans the <code>/src/docs</code> directory for markdown (<code>*.md</code>) files and converts them into Asciidoc files. The converted files can then be referenced from within the <code>/build</code>-folder.</p>
</div>
<div class="sect3">
<h4 id="_source_21">2.1. Source</h4>
<div class="listingblock">
<div class="title">exportMarkdown.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportMarkdown(
        description: 'exports all markdown files to AsciiDoc',
        group: 'docToolchain',
        type: Copy
) {
    from srcDir

    include("**/*.md") //include only markdown files
    includeEmptyDirs = false
    rename(/(.+).md/, '$1.adoc') //rename all files from *.md to *.adoc
    filter(Markdown2AdocFilter) // convert the content of the files

    into targetDir
}

class Markdown2AdocFilter extends FilterReader {
    Markdown2AdocFilter(Reader input) {
        super(new StringReader(nl.jworks.markdown_to_asciidoc.Converter.convertMarkdownToAsciiDoc(input.text)))
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
<div class="sect3">
<h4 id="_exportopenapi">2.2. exportOpenAPI</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_19">About This Task</h5>
<div class="paragraph">
<p>This task exports an OpenAPI Specification definition yaml file to a AsciiDoc document.
Currently this task depends on <a href="https://github.com/OpenAPITools/openapi-generator">OpenAPI Generator (v4.3.1)</a> and its <a href="https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-gradle-plugin">gradle plugin</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/manual/openAPI.png" alt="openAPI">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_4">Configuration</h5>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Configuration for OpenAPI related task
openApi = [:]

// 'specFile' is the name of OpenAPI specification yaml file. Tool expects this file inside working dir (as a filename or relative path with filename)
// 'infoUrl' and 'infoEmail' are specification metadata about further info related to the API. By default this values would be filled by openapi-generator plugin placeholders
//

openApi.with {
    specFile = 'src/docs/petstore-v2.0.yaml' // i.e. 'petstore.yaml', 'src/doc/petstore.yaml'
    infoUrl = 'https://my-api.company.com'
    infoEmail = 'info@company.com'
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_22">Source</h5>
<div class="listingblock">
<div class="title">exportOpenApi.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportOpenApi (
        type: org.openapitools.generator.gradle.plugin.tasks.GenerateTask,
        group: 'docToolchain',
        description: 'exports OpenAPI specification to the asciidoc file') {

    if (!specFile) {
        logger.info("\n---&gt; OpenAPI specification file not found in Config.groovy (https://doctoolchain.github.io/docToolchain/#_exportopenapi)")
        return
    } else {
        logger.info("Found OpenAPI specification in Config.groovy")
    }

    outputs.upToDateWhen { false }
    outputs.cacheIf { false }
    generatorName = 'asciidoc'
    outputDir = "${targetDir}/OpenAPI".toString()
    inputSpec = "${docDir}/${specFile}" // plugin is not able to find file if inputPath is defined as '.'

    logger.debug("\n=====================\nProject Config:\n=====================")
    logger.debug("Docdir: ${docDir}")
    logger.debug("Target: ${targetDir}")
    logger.info("\n=====================\nOpenAPI Config:\n=====================")
    logger.info("Specification file: ${specFile}")
    logger.info("inputSpec: ${inputSpec}")
    logger.info("outputDir: ${outputDir}\n")

    additionalProperties = [
        infoEmail:"${config.openApi.infoEmail}",
        infoUrl:"${config.openApi.infoUrl}"
    ]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_htmlsanitycheck">2.3. htmlSanityCheck</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Stefan Pfeiffer" width="32" height="32" title="Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_at_a_glance_11">At a Glance</h5>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/htmlSanityCheck.png" alt="htmlSanityCheck">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_20">About This Task</h5>
<div class="paragraph">
<p>This task invokes the <a href="https://github.com/aim42/htmlSanityCheck">htmlSanityCheck</a> gradle plugin.
It is a standalone (batch- and command-line) HTML sanity checker whose role is to detect missing images, dead links and duplicated bookmarks.
In docToolchain, the htmlSanityCheck task ensures that generated HTML contains no missing links or other problems.
It is the last default task, and creates a report in <code>build/report/htmlchecks/index.html</code> (see example below).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/manual/htmlSanityCheck.png" alt="htmlSanityCheck">
</div>
<div class="title">Figure 4. sample report</div>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_9">Further Reading and Resources</h5>
<div class="ulist">
<ul>
<li>
<p>Read the <a href="https://rdmueller.github.io/htmlSanityCheck/">Automated Quality-Checks</a> blog post.</p>
</li>
<li>
<p>Visit <a href="https://github.com/aim42/htmlSanityCheck" class="bare">https://github.com/aim42/htmlSanityCheck</a> for more information about this task.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_source_23">Source</h5>
<div class="listingblock">
<div class="title">htmlSanityCheck.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">htmlSanityCheck {
    sourceDir = new File(config.htmlSanityCheck.sourceDir?targetDir+"/"+config.htmlSanityCheck.sourceDir:"$targetDir/html5")
    // files to check - in Set-notation
    //sourceDocuments = [ "one-file.html", "another-file.html", "index.html"]

    // where to put results of sanityChecks...
    checkingResultsDir = new File(config.htmlSanityCheck.checkingResultsDir?:checkingResultsPath)
    // directory where the results written to in JUnit XML format
    junitResultsDir = new File(config.htmlSanityCheck.junitResultsDir?:"$targetDir/test-results/htmlchecks")

    // which statuscodes shall be interpreted as warning, error or success defaults to standard
    httpSuccessCodes = config.htmlSanityCheck.httpSuccessCodes?:[]
    httpWarningCodes = config.htmlSanityCheck.httpWarningCodes?:[]
    httpErrorCodes = config.htmlSanityCheck.httpErrorCodes?:[]

    // fail build on errors?
    failOnErrors = config.htmlSanityCheck.failOnErrors?:false

    logger.info "docToolchain&gt; HSC sourceDir: ${sourceDir}"
    logger.info "docToolchain&gt; HSC checkingResultsDir: ${checkingResultsDir}"
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect3">
<h4 id="_dependencyupdates">2.4. dependencyUpdates</h4>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. MÃ¼ller" width="32" height="32" title="Ralf D. MÃ¼ller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect4">
<h5 id="_about_this_task_21">About This Task</h5>
<div class="paragraph">
<p>This task uses the <a href="https://github.com/ben-manes/gradle-versions-plugin">Gradle versions plugin</a> created by Ben Manes to check for outdated build dependencies.
Use this task to keep all dependencies up to date.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you discover newer version, it doesn&#8217;t mean that versions and dependencies will play nicely together.
To ensure that everything works, we recommend the versions selected by docToolchain contributors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_further_reading_and_resources_10">Further Reading and Resources</h5>
<div class="paragraph">
<p>Read the <a href="https://rdmueller.github.io/dependency-update/">Handle Dependency Updates the Easy Way</a> blog post.</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::../010_manual/08_development.adoc[leveloffset=+1]</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::../010_manual/050_Frequently_asked_Questions.adoc[leveloffset=+1]</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::../010_manual/04_further_reading.adoc[leveloffset=+1]</p>
</div>
<div style="page-break-after: always;"></div>
<!-- endtoc -->
<script>
document.location.href = '../10_about/30_community.html';
</script>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Unresolved directive in &lt;stdin&gt; - include::../010_manual/100_config.adoc[leveloffset=+1]</p>
</div>
</div>
</div>
</div>
        </p>

        <style>
.feedback--answer {
    display: inline-block;
}

.feedback--answer-no {
    margin-left: 1em;
}

.feedback--response {
    display: none;
    margin-top: 1em;
}

.feedback--response__visible {
    display: block;
}
</style>

<div class="d-print-none">
    <h2 class="feedback--title">Feedback</h2>
    <p class="feedback--question">Was this page helpful?</p>
    <button class="feedback--answer feedback--answer-yes">Yes</button>
    <button class="feedback--answer feedback--answer-no">No</button>
    <p class="feedback--response feedback--response-yes">
        Glad to hear it! Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27%20%F0%9F%91%8D&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc">tell us
    how we can improve</a>.
    </p>
    <p class="feedback--response feedback--response-no">
        Sorry to hear that. Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27%20%F0%9F%91%8E&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc">tell
    us how we can improve</a>.
    </p>
</div>
<script>
    const yesButton = document.querySelector('.feedback--answer-yes');
    const noButton = document.querySelector('.feedback--answer-no');
    const yesResponse = document.querySelector('.feedback--response-yes');
    const noResponse = document.querySelector('.feedback--response-no');
    const disableButtons = () => {
        yesButton.disabled = true;
        noButton.disabled = true;
    };
    const sendFeedback = (value) => {
        if (typeof ga !== 'function') return;
        const args = {
            command: 'send',
            hitType: 'event',
            category: 'Helpful',
            action: 'click',
            label: window.location.pathname,
            value: value
        };
        ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
    };
    yesButton.addEventListener('click', () => {
        yesResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(1);
    });
    noButton.addEventListener('click', () => {
        noResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(0);
    });
</script>


        <br>

        <!--div class="text-muted mt-5 pt-3 border-top">Last modified July 3, 2019: <a
                href="https://github.com/google/docsy-example/commit/d6aa89c8b24089d7e6741030864eff209465e896">Added
            links to user guide repo (d6aa89c)</a>
        </div-->
    </div>


			</main>

		</div>
	</div>


	
    <!--footer class="footer mt-auto py-3 bg-light">
        <div class="container">
            <span class="text-muted">&copy; 2020 | based on <a href="https://arc42.org">arc42 7.0</a> | mixed with <a href="http://getbootstrap.com/">Bootstrap v5.0.0-beta</a> | Baked with <a href="http://jbake.org">JBake v2.6.7</a></span>
        </div>
    </footer-->

    <footer class="bg-dark py-5 row d-print-none">
        <div class="container-fluid mx-sm-5">
            <div class="row">
                <div class="col-6 col-sm-4 text-xs-center order-sm-2">


                    <ul class="list-inline mb-0">
                        
                        <li aria-label="User mailing list" class="list-inline-item mx-2 h3" data-original-title="User mailing list" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="mailto:info@docs-as-co.de" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fa fa-envelope"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Twitter" class="list-inline-item mx-2 h3" data-original-title="Twitter" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://twitter.com/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Stack Overflow" class="list-inline-item mx-2 h3" data-original-title="Stack Overflow" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://stackoverflow.com/questions/tagged/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-stack-overflow"></i>
                            </a>
                        </li>
                        
                    </ul>


                </div>
                <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">


                    <ul class="list-inline mb-0">

                        
                        <li aria-label="GitHub" class="list-inline-item mx-2 h3" data-original-title="GitHub" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://github.com/doctoolchain/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-github"></i>
                            </a>
                        </li>
                        

                        


                    </ul>


                </div>
                <div class="col-12 col-sm-4 text-center py-2 order-sm-2">

                        <small class="text-white">built with <a href="https://doctoolchain.org">docToolchain</a> and <a href="https://jbake.org">jBake</a> <br /> theme: <a href="https://www.docsy.dev/">docsy</a></small>

                </div>
            </div>
        </div>
    </footer>

    <script crossorigin="anonymous"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            src="../js/popper.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            src="../js/bootstrap.min.js"></script>


    <script crossorigin="anonymous"
            integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" src="..//js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/blocks.js" ></script>
    <script src="../js/prettify.js"></script>


</body>
</html>
