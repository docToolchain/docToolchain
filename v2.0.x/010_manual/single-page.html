<!doctype html>
<html lang="de">
<head>
    
    <!-- sourceuri: 010_manual/single-page.html -->
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="jbake" name="generator">
    <meta content="INDEX, FOLLOW" name="ROBOTS">

    <title>docToolchain Manual</title>
    <meta content="docToolchain" property="og:title">
    <meta content="build your dev docs the easy way..." property="og:description">
    <meta content="website" property="og:type">
    <meta content="docToolchain" property="og:site_name">
    <meta content="docToolchain" itemprop="name">
    <meta content="build your dev docs the easy way..." itemprop="description">
    <meta content="summary" name="twitter:card">
    <meta content="docToolchain" name="twitter:title">
    <meta content="build your dev docs the easy way..." name="twitter:description">

    <link as="style"
        href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css"
        rel="preload">
    <link href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css"
        integrity=""
        rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- favicon generated with https://www.favicon-generator.org/ -->
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <script src="../js/jquery-3.5.1.min.js"></script>
    <style>
    div.bg-light {
        background-color: rgba(127, 180, 224, 0.3) !important;
    }

    /* for blog posts */
    span.blogtag {
        border-radius: 10px;
        background-color: #30638E;
        color: white;
        padding: 5px 10px;
    }

    span.blogblogtag a {
        color: white;
        padding: 0
    }

    span.blogtag span {
        margin-left: 10px;
        border-radius: 10px;
        background-color: white;
        color: #30638E;
    }

    div.td-toc {
        height: calc(100vh - 5rem) !important;
    }

    div#toctitle {
        display: none
    }

    #td-section-nav {
        max-height: calc(100vh - 4rem);
        font-size: smaller;
        line-height: 1.1;
    }

    .td-page-meta {
        font-size: smaller;
        line-height: 1.1;
    }

    #td-section-nav ul.td-sidebar-nav__section {
        padding-left: 0;
    }

    span.navbar-logo {
        padding-right: 1.5em;
    }

    .match {
        font-size: smaller;
    }

    .admonitionblock td.icon .fa:before {
        font-size: xxx-large;
    }
    </style>

    <style>
    div.openblock.primary div.content, div.openblock.secondary div.content {
        border: 1px solid #7a2518;
        padding: 5px;
    }

    div.openblock.primary div.content div.content, div.openblock.secondary div.content div.content {
        border: 0 solid #7a2518;
        padding: 0;
    }

    .hidden {
        display: none;
    }

    .switch {
        border-width: 1px 1px 0 1px;
        border-style: solid;
        border-color: #7a2518;
        display: inline-block;
    }

    .switch--item {
        padding: 2px 10px;
        background-color: #ffffff;
        color: #7a2518;
        display: inline-block;
        cursor: pointer;
    }

    .switch--item:not(:first-child) {
        border-width: 0 0 0 1px;
        border-style: solid;
        border-color: #7a2518;
    }

    .switch--item.selected {
        background-color: #7a2519;
        color: #ffffff;
    }
    </style>

    <!-- copy-n-paste.js -->
    <style>
        div.listingblock {
            position: relative;
        }
        div.listingblock > span.icon {
            position: absolute;
            top: 2px;
            right: 6px;
            visibility: hidden;
            z-index: 2;
            cursor: pointer;
        }
        div.listingblock:hover > span.icon {
            visibility: visible;
        }
        div.listingblock div.content pre {
            margin: 0;
        }
    </style>
    <style>
        .td-sidebar-nav__section {
            padding-left: 9px;
        }
        details {
            margin-left: 10px;
        }
        summary {
            cursor: pointer;
            padding-left: 10px; /* Erhöhter linker Padding für den Pfeil */
            list-style: none;
            position: relative; /* Für absolute Positionierung des Pfeils */
        }
        summary::before {
            content: '>';
            position: absolute;
            left: 10px; /* Position des Pfeils */
            top: 50%;
            transform: translateY(-50%) translateX(-120%);
            transition: transform 0.3s;
        }
        details[open] > summary::before {
            transform: translateY(-50%) translateX(-120%) rotate(90deg);
        }
    </style>
</head>

<body onload="prettyPrint()" class="td-section">
<header>
	
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <a class="navbar-brand" href="../index.html">
        <span class="navbar-logo"><img src="../images/doctoolchain-logo-blue.png" alt="docToolchain" width="32px" /></span><span
            class="font-weight-bold">docToolchain</span>
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
        <ul class="navbar-nav mt-2 mt-lg-0">
    <li class="nav-item mr-4 mb-2 mb-lg-0"><!--img src="../images/status.png" alt="status" width="16" height="16" onerror="this.style.display='none'"--></li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../10_about/10_about-the-project.html"><span>About</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link active" href="../010_manual/20_install.html"><span>User Docs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../015_tasks/03_tasks.html"><span>Tasks</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../020_tutorial/010_Install.html"><span>Tutorial</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../025_development/005_contributing_to_docs.html"><span>For Devs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../030_news/index.html"><span>News</span></a>
            </li>

        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block" >
        <form action="../search.html">
        <input aria-label="Search this site…" autocomplete="off" class="form-control td-search-input"
               placeholder=" Search this site…" type="search" name="q">
        </form>
    </div>
</nav>

</header>
<div class="container-fluid td-outer">
	<div class="td-main">
		<div class="row flex-xl-nowrap">
			<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
				<div class="td-sidebar__inner" id="td-sidebar-menu" >
					
        <form class="td-sidebar__search d-flex align-items-center d-lg-none" action="../search.html">

            <input aria-label="Search this site…" name="q" autocomplete="off" class="form-control td-search-input"
                   placeholder=" Search this site…" type="search">


            <button aria-controls="td-docs-nav" aria-expanded="false"
                    aria-label="Toggle section navigation" class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" data-target="#td-section-nav"
                    data-toggle="collapse" type="button">
            </button>
        </form>

        <nav class="collapse td-sidebar-nav" id="td-section-nav" >

            <ul class="td-sidebar-nav__section pr-md-3">
                <ul>
                    <li class="collapse show" id="docs">
                        <ul class="td-sidebar-nav__section pr-md-3">
                <div id="toc" class="toc">
<div id="toctitle">toc-title</div>
<ul class="sectlevel1">
<li><a href="#_doctoolchain_manual">docToolchain Manual</a></li>
<li><a href="#_what_is_doctoolchain">1. What Is docToolchain?</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1. Introduction</a></li>
<li><a href="#_docs_as_code">1.2. Docs as Code</a></li>
<li><a href="#_arc42">1.3. arc42</a></li>
<li><a href="#_how_doctoolchain_brings_everything_together">1.4. How docToolchain Brings Everything Together</a></li>
<li><a href="#_what_you_get_with_doctoolchain">1.5. What You Get with docToolchain</a>
<ul class="sectlevel3">
<li><a href="#_a_ready_made_document_management_system">1.5.1. A Ready-Made Document Management System</a></li>
<li><a href="#_built_in_collaboration_and_review">1.5.2. Built-In Collaboration and Review</a></li>
<li><a href="#_image_references_and_code_snippets">1.5.3. Image References and Code Snippets</a></li>
<li><a href="#_compound_and_stakeholder_tailored_docs">1.5.4. Compound and Stakeholder-Tailored Docs</a></li>
<li><a href="#_and_so_much_more">1.5.5. And So Much More&#8230;&#8203;</a></li>
</ul>
</li>
<li><a href="#_install_doctoolchain">1.6. Install docToolchain</a>
<ul class="sectlevel3">
<li><a href="#_installation_overview">1.6.1. Installation Overview</a></li>
<li><a href="#_install_dtcw_in_your_project_directory">1.6.2. Install <code>dtcw</code> in your project directory</a></li>
<li><a href="#run-dtc-in-container">1.6.3. Run docToolchain in a container</a></li>
<li><a href="#install-dtc-with-dtcw">1.6.4. Install docToolchain with <code>dtcw</code></a></li>
<li><a href="#install-dtc-with-sdk">1.6.5. Install docToolchain with SDKMAN!</a></li>
<li><a href="#first-command">1.6.6. Run your First Command</a></li>
<li><a href="#_configure_doctoolchain_to_use_existing_documents">1.6.7. Configure docToolchain to Use Existing Documents</a></li>
<li><a href="#_create_a_new_documentation_project_from_scratch_with_arc42">1.6.8. Create a New Documentation Project from Scratch with Arc42</a></li>
<li><a href="#_generate_html_and_pdf">1.6.9. Generate HTML and PDF</a></li>
<li><a href="#_upgrading_to_a_new_doctoolchain_release">1.6.10. Upgrading to a New docToolchain Release</a></li>
</ul>
</li>
<li><a href="#_using_doctoolchain_to_build_docs">1.7. Using docToolchain to Build Docs</a></li>
</ul>
</li>
<li><a href="#_doctoolchain_tasks">2. docToolchain Tasks</a></li>
<li><a href="#_autobuildsite">3. autobuildSite</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task">3.1. About This Task</a></li>
<li><a href="#_source">3.2. Source</a></li>
</ul>
</li>
<li><a href="#_generatehtml">4. generateHTML</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_2">4.1. About This Task</a></li>
<li><a href="#_generating_single_file_html_output">4.2. Generating Single-File HTML Output</a></li>
<li><a href="#_creating_text_based_diagrams">4.3. Creating Text-Based Diagrams</a></li>
<li><a href="#_controlling_diagram_size">4.4. Controlling Diagram Size</a></li>
<li><a href="#_further_reading_and_resources">4.5. Further Reading and Resources</a></li>
<li><a href="#_source_2">4.6. Source</a></li>
</ul>
</li>
<li><a href="#task-copyThemes">5. copyThemes</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_3">5.1. About This Task</a></li>
<li><a href="#_source_3">5.2. Source</a></li>
</ul>
</li>
<li><a href="#_fixencoding">6. fixEncoding</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_4">6.1. About This Task</a></li>
<li><a href="#_source_4">6.2. Source</a></li>
</ul>
</li>
<li><a href="#_prependfilename">7. prependFilename</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_5">7.1. About This Task</a></li>
<li><a href="#_source_5">7.2. Source</a></li>
</ul>
</li>
<li><a href="#_collectincludes">8. collectIncludes</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_6">8.1. About This Task</a></li>
<li><a href="#_the_optional_parameter_configurations">8.2. The Optional Parameter Configurations</a></li>
<li><a href="#_example">8.3. Example</a></li>
<li><a href="#_source_6">8.4. Source</a></li>
</ul>
</li>
<li><a href="#_generatepdf">9. generatePDF</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_7">9.1. About This Task</a></li>
<li><a href="#_creating_a_custom_pdf_theme">9.2. Creating a Custom PDF Theme</a></li>
<li><a href="#_further_reading_and_resources_2">9.3. Further Reading and Resources</a></li>
<li><a href="#_source_7">9.4. Source</a></li>
</ul>
</li>
<li><a href="#task_generatesite">10. generateSite</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_8">10.1. About This Task</a></li>
<li><a href="#_pages">10.2. Pages</a></li>
<li><a href="#config">10.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_menu">10.3.1. Menu</a></li>
<li><a href="#_links">10.3.2. Links</a></li>
<li><a href="#_configuring_the_jbake_plugin">10.3.3. Configuring the JBake plugin</a></li>
</ul>
</li>
<li><a href="#_templates_and_style">10.4. Templates and Style</a></li>
<li><a href="#_landing_page">10.5. Landing Page</a></li>
<li><a href="#_blog">10.6. Blog</a></li>
<li><a href="#_search">10.7. Search</a></li>
<li><a href="#_cicd">10.8. CI/CD</a></li>
<li><a href="#_further_reading_and_resources_3">10.9. Further Reading and Resources</a></li>
<li><a href="#_source_8">10.10. Source</a></li>
</ul>
</li>
<li><a href="#_generatedocbook">11. generateDocbook</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_9">11.1. About This Task</a></li>
<li><a href="#_source_9">11.2. Source</a></li>
</ul>
</li>
<li><a href="#_generatedeck">12. generateDeck</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_10">12.1. About This Task</a>
<ul class="sectlevel3">
<li><a href="#_configure_revealjs">12.1.1. Configure RevealJs</a></li>
</ul>
</li>
<li><a href="#_source_10">12.2. Source</a></li>
</ul>
</li>
<li><a href="#_publishtoconfluence">13. publishToConfluence</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_11">13.1. About This Task</a></li>
<li><a href="#_special_features">13.2. Special Features</a>
<ul class="sectlevel3">
<li><a href="#_easy_code_block_conversion">13.2.1. Easy Code Block Conversion</a></li>
<li><a href="#_minimal_impact_on_non_techie_confluence_users">13.2.2. Minimal Impact on Non-Techie Confluence Users</a></li>
<li><a href="#_keywords_automatically_attached_as_labels">13.2.3. Keywords Automatically Attached as Labels</a></li>
</ul>
</li>
<li><a href="#_configuration">13.3. Configuration</a></li>
<li><a href="#_attributes">13.4. Attributes</a></li>
<li><a href="#_css_styling">13.5. CSS Styling</a></li>
<li><a href="#_source_11">13.6. Source</a></li>
</ul>
</li>
<li><a href="#_converttodocx">14. convertToDocx</a>
<ul class="sectlevel2">
<li><a href="#_before_you_begin">14.1. Before You Begin</a></li>
<li><a href="#_further_reading_and_resources_4">14.2. Further Reading and Resources</a></li>
<li><a href="#_source_12">14.3. Source</a></li>
</ul>
</li>
<li><a href="#_createreferencedoc">15. createReferenceDoc</a>
<ul class="sectlevel2">
<li><a href="#_before_you_begin_2">15.1. Before You Begin</a></li>
<li><a href="#_about_this_task_12">15.2. About This Task</a></li>
<li><a href="#_config_groovy_notes">15.3. Config.groovy Notes</a></li>
<li><a href="#_source_13">15.4. Source</a></li>
</ul>
</li>
<li><a href="#_converttoepub">16. convertToEpub</a>
<ul class="sectlevel2">
<li><a href="#_dependency">16.1. Dependency</a></li>
<li><a href="#_about_this_task_13">16.2. About This Task</a></li>
<li><a href="#_further_reading_and_resources_5">16.3. Further Reading and Resources</a></li>
<li><a href="#_source_14">16.4. Source</a></li>
</ul>
</li>
<li><a href="#_exportea">17. exportEA</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_14">17.1. About This Task</a></li>
<li><a href="#_important">17.2. Important</a></li>
<li><a href="#_the_optional_parameter_configurations_2">17.3. The Optional Parameter Configurations</a>
<ul class="sectlevel3">
<li><a href="#_connection">17.3.1. connection</a></li>
<li><a href="#_packagefilter">17.3.2. packageFilter</a></li>
<li><a href="#_exportpath">17.3.3. exportPath</a></li>
<li><a href="#_searchpath">17.3.4. searchPath</a></li>
<li><a href="#_glossaryasciidocformat">17.3.5. glossaryAsciiDocFormat</a></li>
<li><a href="#_glossarytypes">17.3.6. glossaryTypes</a></li>
<li><a href="#_diagramattributes">17.3.7. diagramAttributes</a></li>
<li><a href="#_imageformat">17.3.8. imageFormat</a></li>
<li><a href="#_additionaloptions">17.3.9. additionalOptions</a></li>
</ul>
</li>
<li><a href="#_glossary_export">17.4. Glossary export</a></li>
<li><a href="#_further_reading_and_resources_6">17.5. Further Reading and Resources</a></li>
<li><a href="#_source_15">17.6. Source</a></li>
</ul>
</li>
<li><a href="#_exportvisio">18. exportVisio</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_15">18.1. About This Task</a></li>
<li><a href="#_important_information_about_this_task">18.2. Important Information About This Task</a></li>
<li><a href="#_further_reading_and_resources_7">18.3. Further Reading and Resources</a></li>
<li><a href="#_source_16">18.4. Source</a></li>
</ul>
</li>
<li><a href="#_exportdrawio">19. exportDrawIo</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_16">19.1. About This Task</a></li>
<li><a href="#_about_diagrams_net">19.2. About diagrams.net</a></li>
<li><a href="#_how_to_change_your_workflow_to_use_diagrams_net">19.3. How to Change Your Workflow to Use diagrams.net</a></li>
<li><a href="#_how_to_convert_a_confluence_page_to_asciidoc">19.4. How to Convert a Confluence Page to AsciiDoc</a></li>
</ul>
</li>
<li><a href="#_exportchangelog">20. exportChangeLog</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_17">20.1. About This Task</a></li>
<li><a href="#_further_reading_and_resources_8">20.2. Further Reading and Resources</a></li>
<li><a href="#_source_17">20.3. Source</a></li>
</ul>
</li>
<li><a href="#_exportcontributors">21. exportContributors</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_18">21.1. About This Task</a></li>
<li><a href="#_how_to_use_this_task">21.2. How to Use This Task</a></li>
<li><a href="#_about_the_avatar_icons">21.3. About the Avatar-Icons</a></li>
<li><a href="#_file_attributes">21.4. File Attributes</a></li>
</ul>
</li>
<li><a href="#_exportjiraissues">22. exportJiraIssues</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_19">22.1. About This Task</a></li>
<li><a href="#_migrate_configuration_to_version_3_2_0">22.2. Migrate configuration to version &gt;= 3.2.0</a></li>
<li><a href="#_configuration_2">22.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_deprecation_notice">22.3.1. Deprecation Notice</a></li>
<li><a href="#_configuration_options">22.3.2. Configuration Options</a></li>
</ul>
</li>
<li><a href="#_source_18">22.4. Source</a></li>
</ul>
</li>
<li><a href="#_exportjirasprintchangelogissues">23. exportJiraSprintChangelogIssues</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_20">23.1. About This Task</a></li>
<li><a href="#_configuration_3">23.2. Configuration</a></li>
<li><a href="#_source_19">23.3. Source</a></li>
</ul>
</li>
<li><a href="#_exportppt">24. exportPPT</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_21">24.1. About This Task</a></li>
<li><a href="#_further_reading_and_resources_9">24.2. Further Reading and Resources</a></li>
<li><a href="#_source_20">24.3. Source</a></li>
</ul>
</li>
<li><a href="#_exportexcel">25. exportExcel</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_22">25.1. About This Task</a></li>
<li><a href="#_further_reading_and_resources_10">25.2. Further Reading and Resources</a></li>
<li><a href="#_source_21">25.3. Source</a></li>
</ul>
</li>
<li><a href="#_exportmarkdown">26. exportMarkdown</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_23">26.1. About This Task</a></li>
<li><a href="#_source_22">26.2. Source</a></li>
</ul>
</li>
<li><a href="#_exportopenapi">27. exportOpenAPI</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_24">27.1. About This Task</a></li>
<li><a href="#_configuration_4">27.2. Configuration</a></li>
<li><a href="#_source_23">27.3. Source</a></li>
</ul>
</li>
<li><a href="#_exportstructurizr">28. exportStructurizr</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_25">28.1. About This Task</a></li>
<li><a href="#_configuration_5">28.2. Configuration</a></li>
<li><a href="#_example_configuration">28.3. Example Configuration</a></li>
<li><a href="#_source_24">28.4. Source</a></li>
</ul>
</li>
<li><a href="#_htmlsanitycheck">29. htmlSanityCheck</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_26">29.1. About This Task</a></li>
<li><a href="#_further_reading_and_resources_11">29.2. Further Reading and Resources</a></li>
<li><a href="#_source_25">29.3. Source</a></li>
</ul>
</li>
<li><a href="#_dependencyupdates">30. dependencyUpdates</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task_27">30.1. About This Task</a></li>
<li><a href="#_further_reading_and_resources_12">30.2. Further Reading and Resources</a></li>
<li><a href="#_development">30.3. Development</a></li>
<li><a href="#_setting_up_a_dev_environment">30.4. Setting Up a Dev Environment</a>
<ul class="sectlevel3">
<li><a href="#_before_you_begin_3">30.4.1. Before You Begin</a></li>
<li><a href="#_do_a_local_install_for_docker_and_sdkman">30.4.2. Do a Local Install for Docker and SDKMAN!</a></li>
<li><a href="#_create_gradle_independent_tasks">30.4.3. Create Gradle-Independent Tasks</a></li>
<li><a href="#_create_or_change_a_theme">30.4.4. Create or Change a Theme</a></li>
<li><a href="#_special_functionality_for_themes_config_fragments">30.4.5. Special Functionality for Themes (Config Fragments)</a></li>
</ul>
</li>
<li><a href="#_running_tests">30.5. Running Tests</a>
<ul class="sectlevel3">
<li><a href="#_execute_tests">30.5.1. Execute Tests</a></li>
<li><a href="#_execute_a_specific_test">30.5.2. Execute a specific test</a></li>
<li><a href="#_workaround_to_ensure_correct_proxy_settings_for_tests">30.5.3. Workaround to Ensure Correct Proxy Settings for Tests</a></li>
</ul>
</li>
<li><a href="#_creating_a_new_release">30.6. Creating a New Release</a>
<ul class="sectlevel3">
<li><a href="#_before_you_begin_4">30.6.1. Before You Begin</a></li>
<li><a href="#_github">30.6.2. GitHub</a></li>
<li><a href="#_docker_hub">30.6.3. Docker Hub</a></li>
<li><a href="#_blog_post">30.6.4. Blog Post</a></li>
<li><a href="#_doctoolchain_wrapper_dtcw">30.6.5. docToolchain-Wrapper (dtcw)</a></li>
<li><a href="#_sdkman">30.6.6. SDKMAN!</a></li>
</ul>
</li>
<li><a href="#_debugging">30.7. Debugging</a>
<ul class="sectlevel3">
<li><a href="#_environment">30.7.1. Environment</a></li>
<li><a href="#_gradle">30.7.2. Gradle</a></li>
<li><a href="#_jbake_templates">30.7.3. jBake Templates</a></li>
<li><a href="#_theming_menu_and_images">30.7.4. Theming, Menu and Images</a></li>
<li><a href="#_script_execution_debugging">30.7.5. Script Execution Debugging</a></li>
</ul>
</li>
<li><a href="#_solutions_to_common_problems">30.8. Solutions to Common Problems</a>
<ul class="sectlevel3">
<li><a href="#_references">30.8.1. References</a></li>
<li><a href="#_images">30.8.2. Images</a></li>
<li><a href="#_sparx_enterprise_architect">30.8.3. Sparx Enterprise Architect</a></li>
<li><a href="#_known_error_messages">30.8.4. Known error Messages</a></li>
</ul>
</li>
<li><a href="#_useful_resources">30.9. Useful Resources</a>
<ul class="sectlevel3">
<li><a href="#_introduction_2">30.9.1. Introduction</a></li>
<li><a href="#_underlying_technologies">30.9.2. Underlying Technologies</a></li>
<li><a href="#_books">30.9.3. Books</a></li>
</ul>
</li>
<li><a href="#_configuration_6">30.10. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_mainconfigfile_and_docdir">30.10.1. <code>mainConfigFile</code> and <code>docDir</code></a></li>
<li><a href="#_asciidoc_config">30.10.2. AsciiDoc config</a></li>
<li><a href="#_command_line_parameters">30.10.3. Command Line Parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                        </ul>
                    </li>
                </ul>
        </nav>

				</div>
			</div>
			<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
				<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
					
        <a href="https://github.com/doctoolchain/doctoolchain/edit/ng/src/docs/010_manual/single-page.adoc"
           target="_blank"><i class="fa fa-edit fa-fw"></i> Improve this doc</a>
        <!--a href="https://github.com/google/docsy-example/new/master/content/en/docs/_index.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A"
           target="_blank"><i class="fa fa-edit fa-fw"></i> Create child page</a-->
        <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc" target="_blank"><i
                class="fab fa-github fa-fw"></i> Create an issue</a>
        <!--a href="https://github.com/google/docsy/issues/new" target="_blank"><i
                class="fas fa-tasks fa-fw"></i> Create project issue</a-->
        <!--a href="https://example.docsy.dev/docs/_print/" id="print"><i class="fa fa-print fa-fw"></i> Print
        entire section</a-->
        

				</div>
			</div>
			<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
				    <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
        <ol class="breadcrumb spb-1">
            <!--li aria-current="page" class="breadcrumb-item active">
                <a href="https://example.docsy.dev/docs/">Documentation</a>
            </li-->

        </ol>
    </nav>


    <div class="td-content">
        <p>
            
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div class="sect1">
<h2 id="_doctoolchain_manual">docToolchain Manual</h2>
<div class="sectionbody">
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_doctoolchain">1. What Is docToolchain?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/844846c6a8d3374a4c6f633e41316db7?d=identicon" alt="Andac Aydin" width="32" height="32" title="Andac Aydin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9b0b56e9974b34b65604e98f98a769d5?d=identicon" alt="Markus Napp" width="32" height="32" title="Markus Napp"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3ab6e54862dd8caaa33e9984edd5e550?d=identicon" alt="Michael Müller" width="32" height="32" title="Michael Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>4 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_introduction">1.1. Introduction</h3>
<div class="paragraph">
<p><a href="https://github.com/docToolchain/docToolchain">docToolchain</a> is a documentation generation tool that uses the <a href="https://www.writethedocs.org/guide/docs-as-code/">Docs as Code</a> approach as a basis for its architecture, plus some additional automation provided by the <a href="https://arc42.org">arc42 template</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_docs_as_code">1.2. Docs as Code</h3>
<div class="paragraph">
<p>‘Docs as code’ refers to a philosophy that you should write documentation using the same tools as you use to write code. If you need to write technical docs for your software project, why not use the same tools and processes as you use for your source code? There are so many benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You don’t have to learn a complicated docs management system.</p>
</li>
<li>
<p>Developers feel more at home in the docs because they look and feel like code.</p>
</li>
<li>
<p>You can manage docs using standard version control like GitHub.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_arc42">1.3. arc42</h3>
<div class="paragraph">
<p>arc42 has been a part of docToolchain since the earliest version. But what is arc42?</p>
</div>
<div class="paragraph">
<p>Dr. Gernot Starke and Peter Hruschka created the arc42 template as a standard for software architecture documentation. They used their experience of software architectures both in the template structure and the explanations that appear in each chapter to guide you when you’re writing your documentation.</p>
</div>
<div class="paragraph">
<p>arc42 is available in well-known formats including MS Word, textile, and Confluence. All of these formats are automatically generated from a single golden master which is formatted in <a href="https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">AsciiDoc</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_doctoolchain_brings_everything_together">1.4. How docToolchain Brings Everything Together</h3>
<div class="paragraph">
<p>To follow a docs as code approach, you need a build script that automates steps like exporting diagrams and rendering Markdown (or AsciiDoc in the case of docToolchain) to the target format.</p>
</div>
<div class="paragraph">
<p>Creating this type of build script is not easy (and even harder to maintain). There are also lots of questions to answer: “How do I create .docx?” and “Why doesn’t lib x work with lib y?”</p>
</div>
<div class="paragraph">
<p>docToolchain is the result of <a href="https://rdmueller.github.io">one developer’s journey</a> through the docs as code universe. The goal of docToolchain is to automate the creation of technical docs through an easy-to-use build script that only needs to be configured not modified, and that is nurtured and cared for by a <a href="https://doctoolchain.org/docToolchain/v2.0.x/10_about/30_community.html">diverse open source community</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_you_get_with_doctoolchain">1.5. What You Get with docToolchain</h3>
<div class="sect3">
<h4 id="_a_ready_made_document_management_system">1.5.1. A Ready-Made Document Management System</h4>
<div class="paragraph">
<p>By using a version control system like <a href="https://git-scm.com/">Git</a>, you get a perfect document management system for free. Git allows you to version your docs, branch them, and also leaves an audit trail. You can even check who wrote which part of the docs. Isn’t that great?</p>
</div>
<div class="paragraph">
<p>And because your docs are simple plain text, it’s easy to do a diff and see exactly what has changed. Bonus: storing your docs in the same repo as your code means they’re always in sync!</p>
</div>
</div>
<div class="sect3">
<h4 id="_built_in_collaboration_and_review">1.5.2. Built-In Collaboration and Review</h4>
<div class="paragraph">
<p>As a distributed version control system, Git comes with doc collaboration and review processes built in. People can fork the docs and send pull requests for the changes they make. You review the changes. Done!</p>
</div>
<div class="paragraph">
<p>Most Git frontends like <a href="https://www.bitbucket.org">Bitbucket</a>, <a href="https://gitlab.com">GitLab</a> and <a href="https://github.com">GitHub</a> also allow you to reject pull requests with comments.</p>
</div>
</div>
<div class="sect3">
<h4 id="_image_references_and_code_snippets">1.5.3. Image References and Code Snippets</h4>
<div class="paragraph">
<p>Instead of pasting images into a binary document format, docToolchain lets you reference images. This ensures that your imagery is always up-to-date every time you rebuild your documents.</p>
</div>
<div class="paragraph">
<p>You can also reference code snippets directly from your source code. You&#8217;ll save so much time because your docs and code will always be in sync and completely up to date!</p>
</div>
</div>
<div class="sect3">
<h4 id="_compound_and_stakeholder_tailored_docs">1.5.4. Compound and Stakeholder-Tailored Docs</h4>
<div class="paragraph">
<p>As if image refs and code snippets weren&#8217;t enough, docToolchain also lets you split docs into several sub-documents plus a master for greater cohesion. And you&#8217;re not restricted to one master. You can create master docs for different stakeholders that only contain the chapters they need.</p>
</div>
</div>
<div class="sect3">
<h4 id="_and_so_much_more">1.5.5. And So Much More&#8230;&#8203;</h4>
<div class="paragraph">
<p>If you can dream it, you can script it! Want to include a list of open issues from Jira? You can! Want to include a changelog from Git? Go for it! Want to use inline text-based diagrams? Knock yourself out!</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_install_doctoolchain">1.6. Install docToolchain</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/731a5235048e4f10b4da43a7744dbe18?d=identicon" alt="Markus Napp" width="32" height="32" title="Markus Napp"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/956972ffd7485b110d52339c857c1915?d=identicon" alt="Markus Napp" width="32" height="32" title="Markus Napp"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/78242a5c34ff5cf18790ec35024edfe1?d=identicon" alt="RFUCN" width="32" height="32" title="RFUCN"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/04fc7581a71ad407c1452000fe07b200?d=identicon" alt="Simon" width="32" height="32" title="Simon"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/8a8d424110b84c60a6e502b582d78216?d=identicon" alt="rmi2hi" width="32" height="32" title="rmi2hi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c33eb1ed72be96e0d02144769ea23c8e?d=identicon" alt="Kevin Latka" width="32" height="32" title="Kevin Latka"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0dfa58a10da1e9368266584d3a0a3efc?d=identicon" alt="Max Hofer" width="32" height="32" title="Max Hofer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/02a288e6154b56aad8c7191ac00285d7?d=identicon" alt="Frank Joseph" width="32" height="32" title="Frank Joseph"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9abb5e6a1b9da84d820acce9f24be11?d=identicon" alt="Jochen Kraushaar" width="32" height="32" title="Jochen Kraushaar"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5a5f4f4cb007274a31a00ca53975ad5c?d=identicon" alt="Miranda Boerlage" width="32" height="32" title="Miranda Boerlage"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/4f103261b35ad85b347310ca448fb351?d=identicon" alt="Nicca3006" width="32" height="32" title="Nicca3006"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0af2ddd81694aba35cd520f469ab0c42?d=identicon" alt="Bennykillua" width="32" height="32" title="Bennykillua"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/7c4c4a3d249b712651df3a1d1c28ab97?d=identicon" alt="Jérémie Bresson" width="32" height="32" title="Jérémie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e97f08ba2eb556167306cbd06ca82ffc?d=identicon" alt="T8xi" width="32" height="32" title="T8xi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c2ebd5942c5c72df68458314fc750b9f?d=identicon" alt="Michael Krauße" width="32" height="32" title="Michael Krauße"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/f1d121d3bcc84d897239a0b41224df68?d=identicon" alt="feinstaub" width="32" height="32" title="feinstaub"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0d2c684ec9e55edec506308356b67016?d=identicon" alt="Jakub J Jablonski" width="32" height="32" title="Jakub J Jablonski"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/399cd7a37bd45f40c31dae5bb9f6cafe?d=identicon" alt="Jorge" width="32" height="32" title="Jorge"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/df21e0a05d621d59a147b9091a56ebdc?d=identicon" alt="Dr. Gernot Starke" width="32" height="32" title="Dr. Gernot Starke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>11 minutes to read</pre>
</div>
</div>
<div class="sect3">
<h4 id="_installation_overview">1.6.1. Installation Overview</h4>
<div class="paragraph">
<p>docToolchain is composed of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doctoolchain</code> which is the toolchain used to create your documentation</p>
</li>
<li>
<p>the docToolchain shell wrapper script installed in your project which calls the toolchain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The use of this setup has the following advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s easy to build your documentation within your project folder.</p>
</li>
<li>
<p>Ensures that everyone in the project uses the same docToolchain version.</p>
</li>
<li>
<p>Keeps all docToolchain technology out of your project repository.</p>
</li>
<li>
<p>Facilitates the installation of the docToolchain if not installed.</p>
</li>
<li>
<p>Makes it easier to upgrade to newer versions of docToolchain.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_install_dtcw_in_your_project_directory">1.6.2. Install <code>dtcw</code> in your project directory</h4>
<div class="paragraph">
<p>The docToolchain wrapper script <code>dtcw</code>, respective <code>dtcw.ps1</code> or <code>dtcw.bat</code> for MS Windows, is meant to be installed in your project root directory.
The wrapper script simplifies calls to the docToolchain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if you are going to use docToolchain in multiple projects, the toolchain will only be installed once on your system.
</td>
</tr>
</table>
</div>
<div class="openblock primary">
<div class="title">Steps for MacOS/Linux/WSL2 with bash</div>
<div class="content">
<div class="paragraph">
<p>If you have an Apple Silicon (M1/M2) Mac, make sure that you have docker up and running and type the following commands in the Terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">`arch -x86_64 /bin/bash`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, download <code>dtcw</code> into your project directory and make the script executable with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">cd &lt;your project&gt;
curl -Lo dtcw https://doctoolchain.org/dtcw
chmod +x dtcw</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have <code>curl</code> installed, you can also use <code>wget</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">cd &lt;your project&gt;
wget doctoolchain.org/dtcw
chmod +x dtcw</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with Powershell</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">cd &lt;your project&gt;
Invoke-WebRequest doctoolchain.org/dtcw.ps1 -Outfile dtcw.ps1</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Got an error message that you are not allowed to execute powershell scripts?
Try to switch to an unrestricted powershell by executing <code>powershell.exe -ExecutionPolicy Unrestricted</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with cmd.exe</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd">cd &lt;your project&gt;
curl -Lo dtcw.bat doctoolchain.org/dtcw.bat</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dtcw.bat</code> wraps the <code>dtcw.ps1</code> script and executes it in powershell. This might be easier to use if you haven&#8217;t yet configured your powershell as a developer.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In case your development team uses different operating systems, put the wrapper scripts for the desired operating systems (<code>dtcw</code>, <code>dtcw.ps1</code>, and <code>dtcw.bat</code>) into your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the docToolchain wrapper is installed in your project directory you have to decide how to install the toolchain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#run-dtc-in-container">Run docToolchain in a container</a> with the <a href="https://hub.docker.com/r/doctoolchain/doctoolchain">docToolchain container image</a> or <a href="#run-dtc-in-custom-container">Use your custom docker image</a>.</p>
</li>
<li>
<p><a href="#install-dtc-with-dtcw">Install docToolchain with <code>dtcw</code></a> in the users home directory <code>$HOME/.doctoolchain</code></p>
</li>
<li>
<p><a href="#install-dtc-with-sdk">Install docToolchain with SDKMAN!</a> a tool for managing parallel versions of multiple Software Development Kits.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">docToolchain depends on Java 11 (Java 11, 14, and 17 are also supported)</div>
<div class="paragraph">
<p>If you don&#8217;t use the docToolchain container image you have to install Java on your system.
In case you have Java already installed, make sure <code>JAVA_HOME</code> is set.</p>
</div>
<div class="paragraph">
<p>You may use <code>dtcw</code> to install the correct Java version, as shown in the next steps.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="run-dtc-in-container">1.6.3. Run docToolchain in a container</h4>
<div class="paragraph">
<p>The docToolchain project provides a container image of approximately 900 MB from the <a href="https://hub.docker.com/r/doctoolchain/doctoolchain">Docker Hub</a> container registry.
The Dockerfile from which the image is created may be found at <a href="https://github.com/docToolchain/docker-image" class="bare">https://github.com/docToolchain/docker-image</a>.</p>
</div>
<div class="paragraph">
<p>To run docToolchain in a container you need an installed container engine.
The best known container engine is <a href="https://docs.docker.com/get-docker/">Docker</a>.</p>
</div>
<div class="paragraph">
<p>If the container engine is installed you can <a href="#first-command">Run your First Command</a>.
The docToolchain wrapper script in your project directory will detect the
container engine and pull the docToolchain image on the first invocation.</p>
</div>
<div class="sect4">
<h5 id="run-dtc-in-custom-container">Use your custom docker image</h5>
<div class="paragraph">
<p>Some might need to create their own docker image to add additional tooling or configurations, e.g. proxy settings.
In this case you can pass the image name via parameter <code>image</code> directly after <code>docker</code>:</p>
</div>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw docker image &lt;image_name&gt; generateHTML</code></pre>
</div>
</div>
<hr>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">.\dtcw.ps1 docker image &lt;image_name&gt; generateHTML</code></pre>
</div>
</div>
<hr>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd">.\dtcw.bat docker image &lt;image_name&gt; generateHTML</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-environment-variables-to-docker">Pass environment variables to docker containers</h5>
<div class="paragraph">
<p>To pass any environment variable to the docker container you can make use of an <a href="https://docs.docker.com/engine/reference/commandline/run/#env">environment file</a>.
The environment file must have the name <code>dtcw_docker.env</code> and must be located in the same folder as <code>dtcw</code>.</p>
</div>
<div class="paragraph">
<p>An example content is e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd"># set environment variables for docToolchain docker container
PROJECT=TEST_PROJECT
TEAM=TEST_TEAM</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-additional-parameter-to-docker">Pass additional parameter to docker containers</h5>
<div class="paragraph">
<p>To pass additional parameters to the docker container you can make use of the parameter <code>extra_arguments</code> followed by a string with the additional parameters.</p>
</div>
<div class="paragraph">
<p>One usecase is to enable you to set environment variables to dynamic values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw docker image &lt;image_name&gt; extra_arguments "--env USER=${USERNAME} --env REPO_LOCATION=`git config remote.origin.url`" generateHTML</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="install-dtc-with-dtcw">1.6.4. Install docToolchain with <code>dtcw</code></h4>
<div class="openblock primary">
<div class="title">Steps for MacOS/Linux/WSL2 with bash</div>
<div class="content">
<div class="paragraph">
<p>To install docToolchain in <code>$HOME/.doctoolchain</code> execute the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw install doctoolchain</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you have no Java installed you may use <code>dtcw</code> to install Java in a subdirectory of <code>$HOME/.doctoolchain</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw install java</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unable to locate Java Runtime - check your Bash environment</div>
<div class="paragraph">
<p>If <code>dtcw</code> complains about not being able to locate a Java Runtime, make sure Java is found in your Bash shell, the shell used by <code>dtcw</code>.</p>
</div>
<div class="paragraph">
<p>If you use <code>dtcw</code> from another shell like <code>zsh</code>, it may be that your shell finds the supported Java version but your bash setup doesn&#8217;t.
In that case, please switch to bash and make sure that a supported Java version is found. Afterwards, you can switch back to your shell.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with Powershell</div>
<div class="content">
<div class="paragraph">
<p>In case you have no Java installed you can use <code>dtcw.ps1</code> to install Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">.\dtcw.ps1 install java</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with cmd.exe</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd">dtcw.bat install java</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the docToolchain installation finished successfully, you are ready to <a href="#first-command">Run your First Command</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="install-dtc-with-sdk">1.6.5. Install docToolchain with SDKMAN!</h4>
<div class="paragraph">
<p>TODO: description how to install docToolchain with <a href="https://sdkman.io/">SDKMAN!</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="first-command">1.6.6. Run your First Command</h4>
<div class="paragraph">
<p>Call the docToolchain wrapper with <code>tasks --group doctoolchain</code> to show all tasks provided by docToolchain.
Those tasks may be used when invoking the docToolchain wrapper script.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first time docToolchain is called, it downloads all necessary dependencies.
Therefore, the execution of the command may take some time. Subsequent calls to docToolchain will be faster.
</td>
</tr>
</table>
</div>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw tasks --group=doctoolchain
dtcw 0.50 - 8061694f
docToolchain 2.3.0
Available docToolchain environments: local <i class="conum" data-value="1"></i><b>(1)</b>
Environments with docToolchain [2.3.0]: local <i class="conum" data-value="2"></i><b>(2)</b>
Using environment: local <i class="conum" data-value="3"></i><b>(3)</b>
Using Java 17.0.6 [/home/john_doe/.doctoolchain/jdk/bin/java] <i class="conum" data-value="4"></i><b>(4)</b>
Downloading https://services.gradle.org/distributions/gradle-7.5.1-bin.zip <i class="conum" data-value="5"></i><b>(5)</b>
..........10%..........20%..........30%...........40%..........50%..........60%..........70%...........80%..........90%..........100%

Welcome to Gradle 7.5.1!

Here are the highlights of this release:
 - Support for Java 18
 - Support for building with Groovy 4
 - Much more responsive continuous builds
 - Improved diagnostics for dependency resolution

For more details see https://docs.gradle.org/7.5.1/release-notes.html

To honour the JVM settings for this build a single-use Daemon process will be forked. See https://docs.gradle.org/7.5.1/userguide/gradle_daemon.html#sec:disabling_the_daemon.
Daemon will be stopped at the end of the build

&gt; Configure project :

Config file '/code/docToolchainConfig.groovy' does not exist' <i class="conum" data-value="6"></i><b>(6)</b>
[ant:input]
[ant:input] do you want me to create a default one for you? (y, n)
y</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>List of available docToolchain environments. The output may vary depending on your system. In our example only the <code>local</code> environment is available since neither <code>sdk</code> nor <code>docker</code> was found.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Environments in which docToolchain s available. The output may vary depending on how you installed docToolchain. In our example docToolchain was found in the user&#8217;s local environment in <code>$HOME/.doctoolchain</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Shows the used docToolchain environment. In case docToolchain is installed in more than one environment the wrapper script picks the environment in the following order: <code>local</code>, <code>sdk</code>, and then <code>docker</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Location of the used Java. In our example Java was installed in the local environment with the docToolchain wrapper script.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>docToolchain was invoked the first time, thus it is downloading its dependencies.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The docToolchain configuration file <code>docToolchainConfig.groovy</code> wasn&#8217;t found in the project repository. docToolchain asks if it should create a new one.</td>
</tr>
</table>
</div>
<hr>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">.\dtcw.ps1 tasks --group=doctoolchain</code></pre>
</div>
</div>
<hr>
<hr>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd">dtcw.bat tasks --group=doctoolchain</code></pre>
</div>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are behind a corporate proxy, you might need to consider build-script dependencies are fetched from a repository referenced by the property <code>mavenRepository</code>.
By default, the value <code><a href="https://plugins.gradle.org/m2/" class="bare">https://plugins.gradle.org/m2/</a></code> is used. When a repository requiring credentials is used the properties <code>mavenUsername</code> and <code>mavenPassword</code> can be set as well.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example command passing a custom maven repository with credentials from the command line</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="sh">DTC_OPTS="-PmavenRepository=your_maven_repo -PmavenUsername=your_username -PmavenPassword=your_pw" ./dtcw tasks --group=doctoolchain --info</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_doctoolchain_to_use_existing_documents">1.6.7. Configure docToolchain to Use Existing Documents</h4>
<div class="paragraph">
<p>If your project already has documents in AsciiDoc format, you&#8217;ll need to tell docToolchain where to find them.</p>
</div>
<div class="paragraph">
<p>To do so, take a look at the created <code>docToolchainConfig.groovy</code> and update it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_documentation_project_from_scratch_with_arc42">1.6.8. Create a New Documentation Project from Scratch with Arc42</h4>
<div class="paragraph">
<p>If you want to use the <a href="https://arc42.org">arc42</a> template in your project, you can get it in AsciiDoc format by using the following commands.</p>
</div>
<div class="openblock primary">
<div class="title">Linux / WSL2 with bash</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw downloadTemplate</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with Powershell</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">.\dtcw.ps1 downloadTemplate</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows with cmd.exe</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="cmd">dtcw.bat downloadTemplate</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generate_html_and_pdf">1.6.9. Generate HTML and PDF</h4>
<div class="paragraph">
<p>By now, the docToolchain wrapper <code>dtcw</code> should be in your project folder along with the arc42 template.</p>
</div>
<div class="paragraph">
<p>Now Let&#8217;s render arc42 to HTML and PDF. To do so, run the commands below:</p>
</div>
<div class="openblock primary">
<div class="title">Linux / WSL2 with bash</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">./dtcw generateHTML
./dtcw generatePDF</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock secondary">
<div class="title">Windows</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell">.\dtcw.ps1 generateHTML
.\dtcw.ps1 generatePDF</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As a result, you will see the progress of your build together with some warnings which you can just ignore for the moment.</p>
</div>
<div class="paragraph">
<p>The first build generated some files within the <code>build</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>build
|-- html5
|   |-- arc42
|   |   `-- arc42.html
|   `-- images
|       |-- 05_building_blocks-EN.png
|       |-- 08-Crosscutting-Concepts-Structure-EN.png
|       `-- arc42-logo.png
`-- pdf
    |-- arc42
    |   `-- arc42.pdf
    `-- images
        |-- 05_building_blocks-EN.png
        |-- 08-Crosscutting-Concepts-Structure-EN.png
        `-- arc42-logo.png</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Congratulations!</strong> If you see the same folder structure, you&#8217;ve just rendered the standard arc42 template as HTML and PDF!</p>
</div>
<div class="paragraph">
<p>Please raise an issue on <a href="https://github.com/docToolchain/docToolchain/issues">github</a> if you didn&#8217;t get the right output.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Blog-Posts: <a href="https://rdmueller.github.io/enterprise-edition/">Behind the great Firewall</a>, <a href="https://rdmueller.github.io/enterprise-edition2/">Enterprise AsciiDoctor</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_upgrading_to_a_new_doctoolchain_release">1.6.10. Upgrading to a New docToolchain Release</h4>
<div class="paragraph">
<p>If there is a new <a href="https://github.com/docToolchain/docToolchain/releases">docToolchain release</a> you wish to use, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the docToolchain wrapper script (<code>dtcw</code>, respective <code>dtcw.ps1</code> and <code>dtcw.bat</code>) in your favourite text editor and look for the line with <code>DTC_VERSION</code> which should be located near the start of the file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># See https://github.com/docToolchain/docToolchain/releases for available versions.
# Set DTC_VERSION to "latest" to get the latest, yet unreleased docToolchain version.
VERSION=2.1.0</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change it to match the desired release.</p>
</li>
<li>
<p>In case you want to install docToolchain in local user environment install the new docToolchain release with the following command:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>./dtcw install doctoolchain</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you want to test a not-yet-released feature, you can set the <code>DTC_VERSION</code> to <code>latest</code> and <code>dtcw</code> will <code>clone</code> or <code>pull</code> the current default branch of the project. Please note this only works with a local copy, not with a Docker install.</p>
</li>
<li>
<p>If you want to develop new features for docToolchain, you can also use <code>latestdev</code> as version. In this case, <code>dtcw</code> will try to clone the docToolchain repository with the ssh-git protocol to a fork in <code>$HOME/.doctoolchain/docToolchain-latest</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>latest</code> and <code>latestdev</code> currently only work with the bash version of the wrapper.
</td>
</tr>
</table>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_using_doctoolchain_to_build_docs">1.7. Using docToolchain to Build Docs</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/0af2ddd81694aba35cd520f469ab0c42?d=identicon" alt="Bennykillua" width="32" height="32" title="Bennykillua"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c2ebd5942c5c72df68458314fc750b9f?d=identicon" alt="Michael Krauße" width="32" height="32" title="Michael Krauße"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/f1d121d3bcc84d897239a0b41224df68?d=identicon" alt="feinstaub" width="32" height="32" title="feinstaub"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0d2c684ec9e55edec506308356b67016?d=identicon" alt="Jakub J Jablonski" width="32" height="32" title="Jakub J Jablonski"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/399cd7a37bd45f40c31dae5bb9f6cafe?d=identicon" alt="Jorge" width="32" height="32" title="Jorge"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/df21e0a05d621d59a147b9091a56ebdc?d=identicon" alt="Dr. Gernot Starke" width="32" height="32" title="Dr. Gernot Starke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="paragraph">
<p>docToolchain implements many features via scripts, which you call through the command line. These scripts are called <code>tasks</code> in this documentation.</p>
</div>
<div class="paragraph">
<p>Learn more about these scripts in the <a href="../015_tasks/03_tasks.html">Tasks</a> menu.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_doctoolchain_tasks">2. docToolchain Tasks</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
<div class="sect1">
<h2 id="_autobuildsite">3. autobuildSite</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c8d80df8d69ee21f98fc9a9bfa527897?d=identicon" alt="Julian Elve" width="32" height="32" title="Julian Elve"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task">3.1. About This Task</h3>
<div class="paragraph">
<p>This script starts an endless loop which checks for changes to your docs source then re-runs the <code>generateSite</code>-task whenever it detects changes.
The output will be logged to <code>build/generateSite.log</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source">3.2. Source</h3>
<details>
<summary class="title">Show source code of <code>bin/autobuildSite.bash</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/bin/autobuildSite.bash" target="_blank" rel="noopener">GitHub · docToolchain/bin/autobuildSite.bash</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">bin/autobuildSite.bash</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">#!/bin/bash
DIR_TO_WATCH='src/'
#COMMAND='rm -r build || true &amp;&amp; mkdir -p build/microsite/output/images/ &amp;&amp; ./dtcw generateSite 2&gt;&amp;1 | tee build/generateSite.log'
COMMAND='mkdir -p build/microsite/output/images/ &amp;&amp; ./dtcw generateSite 2&gt;&amp;1 | tee build/generateSite.log'

#execute first time
cp src/docs/images/ready.png build/microsite/output/images/status.png
#eval $COMMAND

#wait for changes and execute
while true ; do
  watch --no-title --chgexit "ls -lR ${DIR_TO_WATCH} | sha1sum"
  cp src/docs/images/building.png build/microsite/output/images/status.png
  eval "$COMMAND"
  cp src/docs/images/ready.png build/microsite/output/images/status.png
  sleep 6
done</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generatehtml">4. generateHTML</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/396a442cdf8e71070a810ed30f8d2285?d=identicon" alt="Jan Hendriks" width="32" height="32" title="Jan Hendriks"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/73252f762a6ec69bb59a23c8ff861c4a?d=identicon" alt="David M. Carr" width="32" height="32" title="David M. Carr"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_2">4.1. About This Task</h3>
<div class="paragraph">
<p>This is the standard Asciidoctor generator which is supported out of the box.
The result is written to <code>build/html5</code> (the HTML files need the images folder to be in the same directory to display correctly).</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_single_file_html_output">4.2. Generating Single-File HTML Output</h3>
<div class="paragraph">
<p>If you would like the generator to produce a single-file HTML, you can configure Asciidoctor to store the images inline as <code>data-uri</code> by setting <code>:data-uri:</code> in the config of your AsciiDoc file.
But be warned. The file can quickly become very large and some browsers might struggle to render it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_text_based_diagrams">4.3. Creating Text-Based Diagrams</h3>
<div class="paragraph">
<p>docToolchain is configured to use the <a href="https://asciidoctor.org/docs/asciidoctor-diagram/">asciidoctor-diagram</a> plugin to create PlantUML diagrams.
The plugin also supports many other text-based diagrams, but <a href="http://plantuml.com/">PlantUML</a> is the most common.
To use the plugin, specify your PlantUML code like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.example diagram
[plantuml, "{plantUMLDir}demoPlantUML", png] <i class="conum" data-value="1"></i><b>(1)</b>
----
class BlockProcessor
class DiagramBlock
class DitaaBlock
class PlantUmlBlock

BlockProcessor &lt;|-- DiagramBlock
DiagramBlock &lt;|-- DitaaBlock
DiagramBlock &lt;|-- PlantUmlBlock
----</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The element of this list specifies the diagram tool <code>plantuml</code> to be used.
The second element is the name of the image to be created, and the third specifies the image type.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>{plantUMLDir}</code> ensures that PlantUML also works for the <a href="03_task_generatePDF.html"><code>generatePDF</code></a> task.
Without it, <a href="03_task_generateHTML.html"><code>generateHTML</code></a> works fine, but the PDF will not contain the generated images.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be sure to specify a unique image name for each diagram, otherwise they will overwrite each other.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example renders as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUML.png" alt="{plantUMLDir}demoPlantUML" width="265" height="234">
</div>
<div class="title">Figure 1. example diagram</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_diagram_size">4.4. Controlling Diagram Size</h3>
<div class="paragraph">
<p>If you want to control the size of the diagram in the output, configure the "width" attribute (in pixels) or the "scale" attribute (floating point ratio) passed to <a href="https://asciidoctor.org/docs/asciidoctor-diagram/">asciidoctor-diagram</a>.
The following example updates the diagram above by changing the declaration to one of the versions below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[plantuml, target="{plantUMLDir}demoPlantUMLWidth", format=png, width=250]
# rest of the diagram definition

[plantuml, target="{plantUMLDir}demoPlantUMLScale", format=png, scale=0.75]
# rest of the diagram definition</pre>
</div>
</div>
<div class="paragraph">
<p>The output will render like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUMLWidth.png" alt="{plantUMLDir}demoPlantUMLWidth" width="250" height="234">
</div>
<div class="title">Figure 2. example diagram (with specified width)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/{plantUMLDir}demoPlantUMLScale.png" alt="{plantUMLDir}demoPlantUMLScale" width="198" height="175">
</div>
<div class="title">Figure 3. example diagram (with specified scale)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To work correctly, PlantUML needs Graphviz dot installed.
If you can&#8217;t install it, use the Java-based version of the dot library instead.
Just add <code>!pragma layout smetana</code> as the first line of your diagram definition.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources">4.5. Further Reading and Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://rdmueller.github.io/single-file-html/">This blog post</a> explains more about single-file HTML.</p>
</li>
<li>
<p>Read <a href="https://rdmueller.github.io/plantuml-without-graphviz/">this blog post</a> to understand how to use PlantUML without Graphviz dot.</p>
</li>
<li>
<p>Other helpful posts related to the <code>generateHTML</code> task:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://rdmueller.github.io/plantuml-gradle/">PlantUML with Gradle</a></p>
</li>
<li>
<p><a href="https://rdmueller.github.io/plantUML-and-pdf/">PlantUML with Asciidoctor-pdf</a></p>
</li>
<li>
<p><a href="https://rdmueller.github.io/plantUML-revisited/">PlantUML Revisited</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_2">4.6. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/AsciiDocBasics.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/AsciiDocBasics.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/AsciiDocBasics.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateHTML (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use html5 as asciidoc backend') {
        attributes (
            'plantUMLDir'         : file("${docDir}/${config.outputPath}/html5").toURI().relativize(new File("${docDir}/${config.outputPath}/html5/plantUML/").toURI()).getPath(),
        )

    // specify output folder explicitly to avoid cleaning targetDir from other generated content
    outputDir = file(targetDir + '/html5/')

    outputOptions {
        separateOutputDirs = false
        backends = ['html5']
    }

    def sourceFilesHTML = findSourceFilesByType(['html'])
//    onlyIf {
//        sourceFilesHTML
//    }

    sources {
        sourceFilesHTML.each {
            include it.file

            File useFile = new File(srcDir, it.file)
            if (!useFile.exists()) {
                throw new Exception ("""
                The file $useFile in HTML config does not exist!
                Please check the configuration 'inputFiles' in $mainConfigFile.""")
            }
        }
    }
    resources {
        config.imageDirs.each { imageDir -&gt;
            from(new File(file(srcDir),imageDir))
            logger.info ('imageDir: '+imageDir)
            into './images'
        }
        config.resourceDirs.each { resource -&gt;
            from(new File(file(srcDir),resource.source))
            logger.info ('resource: '+resource.source)
            into resource.target
        }
    }

    doFirst {
        if (sourceFilesHTML.size()==0) {
            throw new Exception ("""
            &gt;&gt; No source files defined for type 'html'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task-copyThemes">5. copyThemes</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_3">5.1. About This Task</h3>
<div class="paragraph">
<p>docToolchain provides you with a simple Twitter bootstrap default theme to get you started.
You can use the <code>copyThemes</code> task to apply a different theme (either jBakeTheme or pdfTheme) to your project.
Feel free to remove all files which should remain as the default and change all others.
When you next run docToolchain, your theme files will be laid over the default theme in order to generate the PDF or site.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_3">5.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/copyThemes.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/copyThemes.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/copyThemes.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/copyThemes.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//tag::copyThemes[]
task copyThemes(
    description: 'copy some default files to your project for you to modify',
    group: 'docToolchain helper'
) {
    doFirst {
    }
    doLast {
        def color = { color, text -&gt;
            def colors = [black: 30, red: 31, green: 32, yellow: 33, blue: 34, magenta: 35, cyan: 36, white: 37]
            return new String((char) 27) + "[${colors[color]}m${text}" + new String((char) 27) + "[0m"
        }
        def lang = ant.input(message: "${color 'green', 'What do you want me to copy?'}", validargs: 'pdfTheme,jBakeTheme', addproperty: 'what')
        switch (ant.what) {
            case 'pdfTheme':
                def targetDir = new File(pdfThemeDir)
                /**
                if (targetDir.exists()) {
                    println "${targetDir.canonicalPath} already exists"
                    println "in order to re-install the theme, please remove the folder first and re-run the script"
                    throw new RuntimeException("pdfTheme folder already exists")
                }
                **/
                targetDir.mkdirs()
                def source = new File(projectDir, 'template_config/pdfTheme')
                println source.canonicalPath
                println targetDir.canonicalPath
                copy {
                    from new File(projectDir, 'template_config/pdfTheme')
                    into targetDir
                }
                println "pdfTheme copied into ${targetDir}"
                break
            case 'jBakeTheme':
                def targetDir = new File(new File(docDir, inputPath), config.microsite.siteFolder?:'../site')
                /**
                if (targetDir.exists()) {
                    println "${targetDir.canonicalPath} already exists"
                    println "in order to re-install the theme, please remove the folder first and re-run the script"
                    throw new RuntimeException("jBakeTheme folder already exists")
                }
                **/
                targetDir.mkdirs()
                copy {
                    from new File(projectDir, 'src/site')
                    into targetDir
                }
                def siteTheme = System.getenv('DTC_SITETHEME')?:""
                def themeFolder = new File(projectDir, "../themes/" + siteTheme.md5())
                copy {
                    from(themeFolder) {}
                    into targetDir
                }

                println "jBakeTheme copied into ${targetDir.canonicalPath}"
                break
        }
    }
}
//end::copyThemes[]</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fixencoding">6. fixEncoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_4">6.1. About This Task</h3>
<div class="paragraph">
<p>Whenever Asciidoctor has to process a file that is not UTF-8 encoded, Ruby tries to read it, then throws an error similar to this one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>asciidoctor: FAILED: /home/demo/test.adoc: Failed to load AsciiDoc document - invalid byte sequence in UTF-8</pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, finding the incorrectly encoded file is difficult if a lot of <code>includes::</code> are used, and Asciidoctor will only show the name of the main document. This is not Asciidoctor&#8217;s fault. The fault lies with the Ruby interpreter that sits underneath.</p>
</div>
<div class="paragraph">
<p>The fixEncoding task crawls through all <code>*.ad</code> and <code>*.adoc</code> files and checks their encoding.
If it comes across a file which is not UTF-8 encoded, it will rewrite it with the UTF-8 encoding.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_4">6.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/fixEncoding.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/fixEncoding.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/fixEncoding.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/fixEncoding.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.util.*
import static groovy.io.FileType.*

task fixEncoding(
        description: 'finds and converts non UTF-8 adoc files to UTF-8',
        group: 'docToolchain helper',
) {
    doLast {
        File sourceFolder = new File("${docDir}/${inputPath}")
        println("sourceFolder: " + sourceFolder.canonicalPath)
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^.*(ad|adoc|asciidoc)$') {
                CharsetToolkit toolkit = new CharsetToolkit(file);
                // guess the encoding
                def guessedCharset = toolkit.getCharset().toString().toUpperCase();
                if (guessedCharset!='UTF-8') {
                    def text = file.text
                    file.write(text, "utf-8")
                    println("  converted ${file.name} from '${guessedCharset}' to 'UFT-8'")
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prependfilename">7. prependFilename</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_5">7.1. About This Task</h3>
<div class="paragraph">
<p>When Asciidoctor renders a file, the file context only knows the name of the top-level AsciiDoc file. But an include file doesn&#8217;t know that it is being included.
It simply gets the name of the master file and has no chance to get its own name as an attribute.
This task crawls through all AsciiDoc files and prepends the name of the current file like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>:filename: 015_tasks/03_task_prependFilename.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>This way, each file gets its own filename.
This enables features like the inclusion of file contributors (see exportContributors-task).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This task skips all files named <code>config.*</code>, <code>_config.*</code>, <code>feedback.*</code> and <code>_feedback.*</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_source_5">7.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/prependFilename.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/prependFilename.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/prependFilename.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/prependFilename.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.io.FileType.*

task prependFilename(
        description: 'crawls through all AsciiDoc files and prepends the name of the current file',
        group: 'docToolchain helper',
) {
    doLast {
        File sourceFolder = new File("${docDir}/${inputPath}")
        println("sourceFolder: " + sourceFolder.canonicalPath)
        sourceFolder.traverse(type: FILES) { file -&gt;
            if (file.name ==~ '^.*(ad|adoc|asciidoc)$') {
                if (file.name.split('[.]')[0] in ["feedback", "_feedback", "config", "_config"]) {
                    println "skipped "+file.name
                } else {
                    def text = file.getText('utf-8')
                    def name = file.canonicalPath - sourceFolder.canonicalPath
                    name = name.replace("\\", "/").replaceAll("^/", "")
                    if (text.contains(":filename:")) {
                        text = text.replaceAll(":filename:.*", ":filename: $name")
                        println "updated "+name
                    } else {
                        text = ":filename: $name\n" + text
                        println "added   "+name
                    }
                    file.write(text,'utf-8')
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collectincludes">8. collectIncludes</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="PacoVK" width="32" height="32" title="PacoVK"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/8a8d424110b84c60a6e502b582d78216?d=identicon" alt="rmi2hi" width="32" height="32" title="rmi2hi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c8d80df8d69ee21f98fc9a9bfa527897?d=identicon" alt="Julian Elve" width="32" height="32" title="Julian Elve"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Mueller" width="32" height="32" title="Ralf D. Mueller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_6">8.1. About This Task</h3>
<div class="paragraph">
<p>This task crawls through your entire project looking for AsciiDoc files with a specific name pattern, then creates a single AsciiDoc file which includes only those files.</p>
</div>
<div class="paragraph">
<p>When you create modular documentation, most includes are static.
For example, the arc42-template has 12 chapters and a master template that includes those 12 chapters.</p>
</div>
<div class="paragraph">
<p>Normally when you work with dynamic modules like ADRs (Architecture Decision Records) you create those files on the fly.
Maybe not within your <code>/src/docs</code> folder, but alongside the code file for which you wrote the ADR.
In order to include these files in your documentation, you have to add the file with its whole relative path to one of your AsciiDoc files.</p>
</div>
<div class="paragraph">
<p>This task will handle it for you!</p>
</div>
<div class="paragraph">
<p>Just stick to this file-naming pattern <code>^[A-Za-z]{3,}[-_].*</code> (begin with at least three letters and a dash/underscore) and this task will collect the file and write it to your build folder.
You only have to include this generated file from within your documentation.
If you provide templates for the documents, those templates are skipped if the name matches the pattern <code>^.\*[-\_][tT]emplate
[-\_].*</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_optional_parameter_configurations">8.2. The Optional Parameter Configurations</h3>
<div class="paragraph">
<p>You can configure which files are found by the script be setting the parameters in the Config.groovy file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">collectIncludes = [:]

collectIncludes.with {

    fileFilter = "adoc" // define which files are considered. default: "ad|adoc|asciidoc"

    minPrefixLength = "3" // define what minimum length the prefix. default: "3"

    maxPrefixLength = "3" // define what maximum length the prefix. default: ""

    separatorChar = "_" // define the allowed separators after prefix. default: "-_"

    cleanOutputFolder = true // should the output folder be emptied before generation? default: false

    excludeDirectories = [] // define additional directories that should not be traversed.

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example">8.3. Example</h3>
<div class="paragraph">
<p>You have a file called:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/src/java/yourCompany/domain/books/ADR-1-whyWeUseTheAISINInsteadOFISBN.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>The task will collect this file and write another file called:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/build/docs/_includes/ADR_includes.adoc</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which will look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>include::../../../src/java/yourCompany/domain/books/ADR-1-whyWeUseTheAISINInsteadOFISBN.adoc[]</pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, you&#8217;ll reap the most benefits if the task has several ADR files to collect.
😎</p>
</div>
<div class="paragraph">
<p>You can then include these files in your main documentation by using a single include:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>include::{targetDir}/docs/_includes/ADR_includes.adoc[]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_6">8.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/collectIncludes.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/collectIncludes.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/collectIncludes.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/collectIncludes.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import static groovy.io.FileType.*
import static groovy.io.FileVisitResult.*
import java.security.MessageDigest

task collectIncludes(
        description: 'collect all ADRs as includes in one file',
        group: 'docToolchain'
) {
    doFirst {
        boolean cleanOutputFolder = config.collectIncludes.cleanOutputFolder?:false
        String outputFolder = targetDir + '/_includes'
        if (cleanOutputFolder){
            delete fileTree(outputFolder)
        }

        new File(outputFolder).mkdirs()
    }
    doLast {
        //let's search the whole project for files, not only the docs folder
        //exclude typical system folders
        final defaultExcludedDirectories = [
            '.git', '.github', '.idea', '.gradle', '.repo', '.svn', 'build', 'node_modules'
        ]

        //running as subproject? set scandir to main project
        String scanDir_save = scanDir
        if (project.name!=rootProject.name &amp;&amp; scanDir=='.') {
            scanDir = project(':').projectDir.path
        }
        if (docDir.startsWith('.')) {
            docDir = file(new File(projectDir, docDir).canonicalPath)
        }
        logger.info "docToolchain&gt; docDir: ${docDir}"
        logger.info "docToolchain&gt; scanDir: ${scanDir}"
        if (scanDir.startsWith('.')) {
            scanDir = file(new File(docDir, scanDir).canonicalPath)
        } else {
            scanDir = file(new File(scanDir, "").canonicalPath)
        }
        logger.info "docToolchain&gt; scanDir: ${scanDir}"

        logger.info "docToolchain&gt; includeRoot: ${includeRoot}"

        if (includeRoot.startsWith('.')) {
            includeRoot = file(new File(docDir, includeRoot).canonicalPath)
        }
        logger.info "docToolchain&gt; includeRoot: ${includeRoot}"

        File sourceFolder = scanDir
        println "sourceFolder: " + sourceFolder.canonicalPath
        def collections = [:]

        String fileFilter = config.collectIncludes.fileFilter?:"ad|adoc|asciidoc"
        String minPrefixLength = config.collectIncludes.minPrefixLength?:"3"
        String maxPrefixLength = config.collectIncludes.maxPrefixLength?:""
        String separatorChar = config.collectIncludes.separatorChar?:"-_"
        def extraExcludeDirectories = config.collectIncludes.excludeDirectories?:[]

        def excludedDirectories = defaultExcludedDirectories + extraExcludeDirectories

        String prefixRegEx = "[A-Za-z]{" + minPrefixLength + "," + maxPrefixLength + "}"
        String separatorCharRegEx = "[" + separatorChar + "]"
        String fileFilterRegEx = "^" + prefixRegEx + separatorCharRegEx + ".*[.](" + fileFilter + ")\$"

        logger.info "considering files with this pattern: " + fileFilterRegEx

        sourceFolder.traverse(
            type: FILES,
            preDir : { if (it.name in excludedDirectories) return SKIP_SUBTREE },
            excludeNameFilter: excludedDirectories
        ) { file -&gt;
            if (file.name ==~ fileFilterRegEx) {
                String typeRegEx = "^(" + prefixRegEx + ")" + separatorCharRegEx + ".*\$"
                def type = file.name.replaceAll(typeRegEx,'\$1').toUpperCase()
                if (!collections[type]) {
                    collections[type] = []
                }
                logger.info "file: " + file.canonicalPath
                def fileName = (file.canonicalPath - scanDir.canonicalPath)[1..-1]
                if (file.name ==~ '^.*[Tt]emplate.*$') {
                    logger.info "ignore template file: " + fileName
                } else {
                    String includeFileRegEx = "^.*" + prefixRegEx + "_includes.adoc\$"
                    if (file.name ==~ includeFileRegEx) {
                        logger.info "ignore generated _includes files: " + fileName
                    } else {
                        if ( fileName.startsWith('docToolchain') || fileName.replace("\\", "/").matches('^.*/docToolchain/.*$')) {
                            //ignore docToolchain as submodule
                        } else {
                            logger.info "include corrected file: " + fileName
                            collections[type] &lt;&lt; fileName
                        }
                    }
                }
            }
        }
        println "targetFolder: " + (targetDir - docDir)
        logger.info "targetDir - includeRoot: " + (targetDir - includeRoot)
        def pathDiff = '../' * ((targetDir - docDir)
                                    .replaceAll('^/','')
                                    .replaceAll('/$','')
                                    .replaceAll("[^/]",'').size()+1)

        logger.info "pathDiff: " + pathDiff
        collections.each { type, fileNames -&gt;
            if (fileNames) {
                def outFile = new File(targetDir + '/_includes', type + '_includes.adoc')
                logger.info outFile.canonicalPath-sourceFolder.canonicalPath
                outFile.write("// this is autogenerated\n")
                logger.info "docToolchain&gt; Use Antora integration: ${useAntoraIntegration}"
                fileNames.sort().each { fileName -&gt;
                    if (useAntoraIntegration) {
                        outFile.append("ifndef::optimize-content[]\n")
                        outFile.append ("include::../" + pathDiff + scanDir_save + "/" + fileName.replace("\\", "/")+"[]\n")
                        outFile.append("endif::optimize-content[]\n\n")
                        outFile.append("ifdef::optimize-content[]\n")
                        outFile.append ("include::example\$" + fileName.replace("\\", "/").replace("${inputPath}/modules/ROOT/examples/", "")+"[]\n")
                        outFile.append("endif::optimize-content[]\n\n")
                    } else {
                        outFile.append ("include::../" + pathDiff + scanDir_save + "/" + fileName.replace("\\", "/")+"[]\n\n")
                    }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generatepdf">9. generatePDF</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_7">9.1. About This Task</h3>
<div class="paragraph">
<p>This task makes use of the <a href="https://asciidoctor.org/docs/convert-asciidoc-to-pdf/">asciidoctor-pdf</a> plugin to render your documents as pretty PDF files.
Files are written to <code>build/pdf</code>.
The PDF is generated directly from your AsciiDoc sources. There is no need for an intermediate format or other tools.
The result looks more like a nicely rendered book than a print-to-PDF HTML page.</p>
</div>
<div class="paragraph">
<p>For a file to be rendered, it has to be configured in the <code>doctoolchainConfig.groovy</code> file.
There you will find a section that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>inputFiles = [
        [file: 'manual.adoc',       formats: ['html','pdf']],
        /** inputFiles **/
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the files that you want to be rendered, along with the desired format.
In this case <code>pdf</code>.</p>
</div>
<details>
<summary class="title">Hint</summary>
<div class="content">
<div class="paragraph">
<p>Why do you need to configure the files to be rendered?</p>
</div>
<div class="paragraph">
<p>Asciidoctor renders all <code>.adoc</code> files by default. It doesn&#8217;t matter if they are the main documents or chapters you want to include.
Most people only want to convert selected files to PDF, so that&#8217;s why you need to configure which ones.</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_creating_a_custom_pdf_theme">9.2. Creating a Custom PDF Theme</h3>
<div class="paragraph">
<p>If you want to change colors, fonts or page headers and footers, you can do so by creating a <code>custom-theme.yml</code> file.
Copy the file <code>src/docs/pdfTheme/custom-theme.yml</code> from docToolchain to your project and reference it from your main <code>.adoc`file by setting the `:pdf-themesdir:</code>.
In addition, set the <code>:pdf-theme:</code> to the name of your theme. In this case <code>custom</code>.
For example, insert the following at the top of your document to reference <code>custom-theme.yml</code> from the <code>/pdfTheme</code> folder.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>:pdf-themesdir: ../pdfTheme
:pdf-theme: custom</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_2">9.3. Further Reading and Resources</h3>
<div class="ulist">
<ul>
<li>
<p>Learn how to modify a theme by reading <a href="https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc">asciidoctor-pdf theming guide</a>.</p>
</li>
<li>
<p>The <a href="https://rdmueller.github.io/pdf-output/">Beyond HTML</a> blog post is also an excellent resource if you want to dig a little deeper.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_7">9.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/AsciiDocBasics.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/AsciiDocBasics.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/AsciiDocBasics.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generatePDF (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use pdf as asciidoc backend') {

    attributes (
        'plantUMLDir'         : file("${docDir}/${config.outputPath}/pdf/images/plantUML/").path,
    )

    outputDir = file(targetDir + '/pdf/')

    attributes (
        'data-uri': 'true',
        'plantUMLDir'         : file("${docDir}/${config.outputPath}/images/").path,
        'imagesoutdir'        : file("${docDir}/${config.outputPath}/images/").path
    )

    def sourceFilesPDF = findSourceFilesByType(['pdf'])
//    onlyIf {
//        sourceFilesPDF
//    }

    sources {
        sourceFilesPDF.each {
            include it.file
            logger.info it.file

            File useFile = new File(srcDir, it.file)
            if (!useFile.exists()) {
                throw new Exception ("""
                The file $useFile in PDF config does not exist!
                Please check the configuration 'inputFiles' in $mainConfigFile.""")
            }
        }
    }

    outputOptions {
        backends = ['pdf']
    }

    doFirst {
        if (sourceFilesPDF.size()==0) {
            throw new Exception ("""
            &gt;&gt; No source files defined for type 'pdf'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
    }

    /**
    //check if a remote pdfTheme is defined
    def pdfTheme = System.getenv('DTC_PDFTHEME')
    def themeFolder = pdfTheme.md5()
    if (pdfTheme) {
        //check if it is already installed
        //TODO: finish this...
    }
    **/
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task_generatesite">10. generateSite</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>8 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_8">10.1. About This Task</h3>
<div class="paragraph">
<p>When you have only one document, the output of <code>generateHTML</code> might meet your requirements.
But as your documentation grows, and you have multiple documents, you will need a microsite which bundles all the information.
The <code>generateSite</code> task uses <a href="https://jbake.org">jBake</a> to create a static site with a landing page, a blog and search.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pages">10.2. Pages</h3>
<div class="paragraph">
<p>The microsite is page-oriented, not document-oriented.
If you have already organized your documents by chapter, use them as pages to create a great user experience.
The arc42-template sources are a good example.</p>
</div>
<div class="paragraph">
<p>To include a page in the microsite, add a metadata header to it.</p>
</div>
<div class="listingblock">
<div class="title">page metadata</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:jbake-menu: arc42
:jbake-title: Solution Strategy
:jbake-order: 4
:jbake-type: page_toc
:jbake-status: published
:filename: 015_tasks/03_task_generateSite.adoc

:toc:

[[section-solution-strategy]]
=== Solution Strategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an overview of each element:</p>
</div>
<div class="paragraph">
<p><strong>jbake-menu</strong></p>
</div>
<div class="paragraph">
<p>The top-level menu&#8217;s code for this page.
Defaults to the top-level folder name (without the order prefix) of the .adoc file within the <code>docDir</code>.
Example: if the top-level folder name is <code>10_news</code> it will default to the value <code>news</code>.</p>
</div>
<div class="paragraph">
<p>For each code, the display text and the order in the top-level menu can be <a href="#top-menu-config">configured</a>.</p>
</div>
<div class="paragraph">
<p><strong>jbake-title</strong></p>
</div>
<div class="paragraph">
<p>The title to be displayed in the drop-down top-level menu.
Defaults to the first headline of the file.</p>
</div>
<div class="paragraph">
<p><strong>jbake-order</strong></p>
</div>
<div class="paragraph">
<p>Applies a sort order to drop-down entries.
Defaults to a prefixed file number, such as <code><strong>04</strong>_filename.adoc</code> or to the prefixed number of the second-level folder name.
When nothing is defined the default value is <code>-1</code> or <code>-987654321</code> for <code>index</code> pages.</p>
</div>
<div class="paragraph">
<p><strong>jbake-type</strong></p>
</div>
<div class="paragraph">
<p>The page type.
Controls which template is used to render the page.
You will mostly use <code>page</code> for a full-width page or <code>page_toc</code> for a page with a table of contents (toc) rendered on the left.
Defaults to <code>page_toc</code>.</p>
</div>
<div class="paragraph">
<p><strong>jbake-status</strong></p>
</div>
<div class="paragraph">
<p>Either <code>draft</code> or <code>published</code>.
Only <code>published</code> pages will be rendered.
Defaults to <code>published</code> for files with a <code>jbake-order</code> and <code>draft</code> for files without <code>jbake-order</code> or files prefixed with <code>_</code>.</p>
</div>
<div class="paragraph">
<p><strong>filename</strong></p>
</div>
<div class="paragraph">
<p>Required for edit and feedback links (coming soon).
Defaults to the filename :-).</p>
</div>
<div class="paragraph">
<p><strong>ifndef</strong></p>
</div>
<div class="paragraph">
<p>Fixes the imagesdir according to the nesting level of your docs folder.
Defaults to the main <code>docDir/images</code>.</p>
</div>
<div class="paragraph">
<p><strong>toc</strong></p>
</div>
<div class="paragraph">
<p>For <code>:jbake-type: page_toc</code>, you need this line to generate the toc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Start your pages with a <code>==</code> level headline.
You can fix the level offset when you include the page in a larger document with <code>include::chapter.adoc[leveloffset=+1]</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="config">10.3. Configuration</h3>
<div class="paragraph">
<p>The configuration follows the <em>convention-over-configuration</em> approach.
If you follow the conventions, you don&#8217;t have to configure anything.
But if you want to, you can override the convention behaviour with a configuration.</p>
</div>
<div class="sect3">
<h4 id="_menu">10.3.1. Menu</h4>
<div class="sect4">
<h5 id="_navigation_elements">Navigation elements</h5>
<div class="paragraph">
<p>The navigation is organized with following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A top level menu.</p>
</li>
<li>
<p>For each item of this top level menu, a section sidebar on the left.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The location of a page in the top-level menu and in the section sidebar depends on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Its location in the folder structure</p>
</li>
<li>
<p>Page attributes</p>
</li>
<li>
<p>Site configurations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>src/docs/
├── 10_foo
│   ├── 10_first.adoc
│   └── 20_second.adoc
└── 20_bar
    ├── 10_lorem.adoc
    ├── 20_ipsum
    │   ├── 10_topic-A.adoc
    │   └── 20_topic-B.adoc
    └── 30_delis
        ├── 10_one.adoc
        ├── 20_two.adoc
        └── index.adoc</code></pre>
</div>
</div>
<div class="paragraph">
<p>The top level folders (<code>10_foo</code> and <code>20_bar</code>) are used to determine to which menu-code the page belongs (<code>foo</code> and <code>bar</code>, unless overridden by the <code>:jbake-menu:</code> inside each page).</p>
</div>
<div class="paragraph">
<p>In the section sidebar, the navigation tree is determined by the folder structure.
Folders are nodes in the sidebar tree.
Each node can contain pages (leafs) or other folders (child nodes).
The order is controlled by the prefix of the file or folder name (unless overridden by the <code>:jbake-order:</code> inside each page).</p>
</div>
<div class="paragraph">
<p>When an index page is present (like <code>20_bar/30_delis/index.adoc</code> in the example) then the navigation tree node corresponds to this index page (you can click on it and the title is taken from the page).
When this <code>index.adoc</code> does not declare a specific order with <code>:jbake-order:</code> then the order of the parent folder (for the example: <code>30</code> because the folder is named <code>30_delis</code>).</p>
</div>
<div class="paragraph">
<p>When the index page is absent (like there is no <code>20_bar/20_ipsum/index.adoc</code> in the example) then the name of the folder is used to create the node, and you can not click on the node because no pages is associated with this node.
You can still define the order with the name (for the example <code>20</code> because the folder is named <code>20_ipsum</code>).</p>
</div>
<div class="paragraph">
<p>When there is no sub-folder, only a flat list of pages is created.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When an <code>index.adoc</code> page is defined inside the top level folder (like: <code>10_foo/index.adoc</code> or <code>20_bar/index.adoc</code>) then the page will be listed in the section navigation tree in the sidebar as any other regular page. By default, it will be the first element of the tree, unless the value is overridden by a <code>:jbake-order:</code> attribute.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="top-menu-config">Configuring the top level menu</h5>
<div class="paragraph">
<p>The <code>:jbake-menu:</code> is only the code for the menu entry to be created.
You can map these codes to menu entries through the configuration (<code>microsite</code>-Section) in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">menu = [code1: 'Some Title 1', code2: 'Other Title 2', code3: '-']</code></pre>
</div>
</div>
<div class="paragraph">
<p>When no mapping is defined in the configuration file, the code is used as title.</p>
</div>
<div class="paragraph">
<p>The menu configuration is also impacting the display order.</p>
</div>
<div class="paragraph">
<p>If you have four files, located in following folder structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>src/docs
├── code1
│   ├── demo1.adoc
│   └── demo2.adoc
└── code3
    ├── demo3.adoc
    └── _demo4.adoc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>demo1.adoc</code> and <code>demo3.adoc</code> contain no <code>:jbake-menu:</code> header, <code>demo2.adoc</code> contains <code>:jbake-menu: code2</code>, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>demo1.adoc</code> will have a menu-code of <code>code1</code> because it is located in the folder <code>code1</code>.
This code is translated through the configuration to the menu named <code>Some Title 1</code>.</p>
</li>
<li>
<p><code>demo2.adoc</code> is in the same folder, but the <code>:jbake-menu:</code> attribute has a higher precedence which results in menu-code <code>code2</code>.
This code is translated through the configuration to the menu named <code>Other Title 2</code>.</p>
</li>
<li>
<p><code>demo3.adoc</code> will have a menu-code <code>code3</code> because it is located in the folder <code>code3</code>.
This code is translated through the configuration to the special menu <code>-</code> which will not be displayed.
This is an easy way to hide a menu in the rendered microsite.</p>
</li>
<li>
<p><code>_demo4.adoc</code> starts with an underscore <code>_</code> and thus will be handled as <code>draft</code> (<code>:jbake-status: draft</code>).
It will not be rendered as part of any menu, but it will be available in the microsite as "hidden" <code>_demo4-draft.html</code>.
Feel free to remove these draft renderings before you publish your microsite.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_links">10.3.2. Links</h4>
<div class="paragraph">
<p>In the column on the right, links are driven by the values defined in <code>docToolchainConfig.groovy</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Improve this doc": displayed when <code>gitRepoUrl</code> is set.</p>
</li>
<li>
<p>"Create an issue": displayed when <code>issueUrl</code> is set.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_jbake_plugin">10.3.3. Configuring the JBake plugin</h4>
<div class="paragraph">
<p>Behind the scene the <code>generateSite</code> task is relying on Jbake.</p>
</div>
<div class="paragraph">
<p>In the <code>docToolchainConfig.groovy</code> it is possible to amend the configuration of the jbake gradle plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add additional asciidoctorj plugins (add dependencies to the <code>jbake</code> configuration)</p>
</li>
<li>
<p>Add additional asciidoctor attributes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">jbake configuration</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//customization of the Jbake gradle plugin used by the generateSite task
jbake.with {
    // possibility to configure additional asciidoctorj plugins used by jbake
    plugins = [ ]

    // possibiltiy to configure additional asciidoctor attributes passed to the jbake task
    asciidoctorAttributes = [ ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugins are retrieved from a repository (by default maven-central) configured with project property <code>depsMavenRepository</code>.
When a repository requiring credentials is used the properties <code>depsMavenUsername</code> and <code>depsMavenPassword</code> can be set as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_templates_and_style">10.4. Templates and Style</h3>
<div class="paragraph">
<p>The jBake templates and CSS are hidden for convenience.</p>
</div>
<div class="paragraph">
<p>The basic template uses <a href="http://getbootstrap.com/">Twitter Bootstrap 5</a> as its CSS framework.
Use the <a href="03_task_copy_themes.html"><code>copyThemes</code></a> task to copy all hidden jBake resources to your project.
You can then remove the resources you don&#8217;t need, and change those you want to change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>copyThemes</code> overwrites existing files, but because your code is safely managed using version control, this shouldn&#8217;t be a problem.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_landing_page">10.5. Landing Page</h3>
<div class="paragraph">
<p>Place an <code>index.gsp</code> page as your landing page in <code>src/site/templates</code>.
This landing page is plain HTML5 styled with Twitter Bootstrap.
The page header and footer are added by docToolchain.
An example can be found at <a href="03_task_copy_themes.html"><code>copyThemes</code></a> or <a href="https://github.com/docToolchain/docToolchain/blob/ng/src/site/templates/index.gsp">on GitHub</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_blog">10.6. Blog</h3>
<div class="paragraph">
<p>The microsite also contains a simple but powerful blog.
Use it to inform your team about changes, as well as architecture decision records (ADRs).</p>
</div>
<div class="paragraph">
<p>To create a new blog post, create a new file in <code>src/docs/blog/&lt;year&gt;/&lt;post-name&gt;.adoc</code> with the following template:</p>
</div>
<div class="listingblock">
<div class="title">blog post template</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:jbake-title: &lt;title-of your post&gt;
:jbake-date: &lt;date formatted as 2021-02-28&gt;
:jbake-type: post
:jbake-tags: &lt;blog, asciidoc&gt;
:jbake-status: published

:imagesdir: ../../images

= {jbake-title}
{jbake-author}
{jbake-date}

&lt;insert your text here&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_search">10.7. Search</h3>
<div class="paragraph">
<p>The microsite does not have its own local search.
But it does have a search input field which can be used to link to another search engine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cicd">10.8. CI/CD</h3>
<div class="paragraph">
<p>When running in an automated build, set the environment variable <code>DTC_HEADLESS</code> to <code>true</code> or <code>1</code>. This stops docToolchain from asking to install the configured theme, and it will simply assume that you do want to install it.
You can also avoid the theme downloading with every build by copying the themes folder from <code>$HOME/.doctoolchain/themes</code> to the corresponding folder in your build container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_3">10.9. Further Reading and Resources</h3>
<div class="paragraph">
<p>Read about the <code>previewSite</code> task <a href="03_task_previewSite.html">here.</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_source_8">10.10. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/generateSite.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/generateSite.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/generateSite.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/generateSite.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">import groovy.util.*
import static groovy.io.FileType.*

buildscript {
    repositories {
        maven {
            credentials {
                username mavenUsername
                password mavenPassword
            }
            url mavenRepository
        }
    }
    dependencies {
        classpath libs.asciidoctorj.diagram
    }
}
repositories {
    maven {
        credentials {
            username depsMavenUsername
            password depsMavenPassword
        }
        url depsMavenRepository
    }
}
dependencies {
    jbake libs.asciidoctorj.diagram
    jbake libs.pebble
    config.jbake.plugins.each { plugin -&gt;
        jbake plugin
    }
}

apply plugin: 'org.jbake.site'

def color = { color, text -&gt;
    def colors = [black: 30, red: 31, green: 32, yellow: 33, blue: 34, magenta: 35, cyan: 36, white: 37]
    return new String((char) 27) + "[${colors[color]}m${text}" + new String((char) 27) + "[0m"
}

jbake {
    version = '2.6.7'
    srcDirName = "${targetDir}/microsite/tmp/site"
    destDirName = "${targetDir}/microsite/output"
    configuration['asciidoctor.option.requires'] = "asciidoctor-diagram"
    config.microsite.each { key, value -&gt;
        configuration['site.'+key-'config.microsite.'] = value?:''
        //println 'site.'+key-'config.microsite.' +" = "+ value
    }

    def micrositeContextPath = config.microsite.contextPath?:'/'

    configuration['asciidoctor.attributes'] = [
        "sourceDir=${targetDir}",
        'source-highlighter=prettify@',
        //'imagesDir=../images@',
        "imagesoutDir=${targetDir}/microsite/output/images@",
        "imagesDir=${micrositeContextPath.endsWith('/') ? micrositeContextPath : micrositeContextPath.concat('/')}images@",
        "targetDir=${targetDir}",
        "docDir=${docDir}",
        "projectRootDir=${new File(docDir).canonicalPath}@",
    ]
    if(config.jbake.asciidoctorAttributes) {
        config.jbake.asciidoctorAttributes.each { entry -&gt;
            configuration['asciidoctor.attributes'] &lt;&lt; entry
        }
    }

}

def prepareAndCopyTheme = {
    //copy internal theme
    println "copy internal theme ${new File(projectDir, 'src/site').canonicalPath}"
    copy {
        from('src/site')
        into("${targetDir}/microsite/tmp/site")
    }
    //check if a remote pdfTheme is defined
    def siteTheme = System.getenv('DTC_SITETHEME')?:""
    def themeFolder = new File(projectDir, "../themes/" + siteTheme.md5())
    try {
        if (siteTheme) {
            println "use siteTheme $siteTheme"
            //check if it is already installed
            if (!themeFolder.exists()) {
                if (System.getenv('DTC_HEADLESS')) {
                    ant.yesno = "y"
                } else {
                    println "${color 'green', """\nTheme '$siteTheme' is not installed yet. """}"
                    def input = ant.input(message: """
${color 'green', 'do you want me to download and install it to '}
${color 'green', '   ' + themeFolder.canonicalPath}
${color 'green', 'for you?'}\n""",
                        validargs: 'y,n', addproperty: 'yesno')
                }
                if (ant.yesno == "y") {
                    themeFolder.mkdirs()
                    download.run {
                        src siteTheme
                        dest new File(themeFolder, 'siteTheme.zip')
                        overwrite true
                    }
                    copy {
                        from zipTree(new File(themeFolder, 'siteTheme.zip'))
                        into themeFolder
                    }
                    delete {
                        delete new File(themeFolder, 'siteTheme.zip')
                    }

                } else {
                    println "${color 'green', """\nI will continue without the theme for now... """}"
                    siteTheme = ""
                }

            }
            //copy external theme
            if (siteTheme) {
                copy {
                    from(themeFolder) {}
                    into("${targetDir}/microsite/tmp/")
                }
                //check if the config has to be updated
                // check if config still contains /** microsite **/
                def configFile = new File(docDir, mainConfigFile)
                def configFileText = configFile.text
                if (configFileText.contains("/** start:microsite **/")) {
                    def configFragment = new File(targetDir,'/microsite/tmp/site/configFragment.groovy')
                    if (configFragment.exists()) {
                        println "${color 'green', """
    It seems that this theme is used for the first time in this project.
    Let's configure it!
    If you are unsure, change these settings later in your config file
    $configFile.canonicalPath
    """}"
                        def comment = ""
                        def conf = ""
                        def example = ""
                        def i = 0
                        configFragment.eachLine { line -&gt;
                            if (line.trim()) {
                                if (line.startsWith("//")) {
                                    conf += "    " + line + "\n"
                                    def tmp = line[2..-1].trim()
                                    comment += color('green', tmp) + "\n"
                                    if (tmp.toLowerCase().startsWith("example")) {
                                        example = tmp.replaceAll("[^ ]* ", "")
                                    }
                                } else {
                                    //only prompt if there is something to prompt
                                    if (line.contains("##")) {
                                        def property = line.replaceAll("[ =].*", "")
                                        if (!example) {
                                            example = config.microsite[property]
                                        }
                                        comment = color('blue', "$property") + "\n" + comment
                                        if (example) {
                                            ant.input(message: comment,
                                                addproperty: 'res' + i, defaultvalue: example)
                                        } else {
                                            ant.input(message: comment,
                                                addproperty: 'res' + i)
                                        }
                                        (comment, example) = ["", ""]
                                        line = line.replaceAll("##.+##", ant['res' + i])
                                        conf += "    " + line + "\n"
                                        i++
                                    } else {
                                        conf += "    " + line + "\n"
                                    }
                                }
                            } else {
                                conf += "\n"
                            }
                        }
                        configFile.write(configFileText.replaceAll("(?sm)/[*][*] start:microsite [*][*]/.*/[*][*] end:microsite [*][*]/", "%%marker%%").replace("%%marker%%", conf))
                        println color('green', "config written\nopen ${targetDir}/microsite/output/index.html in your browser\nto see your microsite!")
                    }
                    //copy the dummy docs (blog, landing page) to the project repository
                    copy {
                        from(new File(themeFolder, 'site/doc')) {}
                        into(new File(docDir, inputPath))
                    }
                }
            }
        }
    } catch (Exception e) {
        println color('red', e.message)
        if (e.message.startsWith("Not Found")) {
            themeFolder.deleteDir()
            throw new GradleException("Couldn't find theme. Did you specify the right URL?\n"+e.message)
        } else {
            throw new GradleException(e.message)
        }
    }
    //copy project theme
    if (config.microsite.siteFolder) {
        def projectTheme = new File(new File(docDir, inputPath), config.microsite.siteFolder)
        println "copy project theme ${projectTheme.canonicalPath}"
        copy {
            from(projectTheme) {}
            into("${targetDir}/microsite/tmp/site")
        }
    }

}

def convertAdditionalFormats = {
    if (config.microsite.additionalConverters) {
        File sourceFolder = new File(targetDir, '/microsite/tmp/site/doc')
        sourceFolder.traverse(type: FILES) { file -&gt;
            def extension = '.' + file.name.split("[.]")[-1]
            if (config.microsite.additionalConverters[extension]) {
                def command = config.microsite.additionalConverters[extension].command
                def type = config.microsite.additionalConverters[extension].type
                def binding = new Binding([
                    file  : file,
                    config: config
                ])
                def shell = new GroovyShell(getClass().getClassLoader(), binding)
                switch (type) {
                    case 'groovy':
                        shell.evaluate(command)
                        break
                    case 'groovyFile':
                        shell.evaluate(new File(docDir, command).text)
                        break
                    case 'bash':
                        if (command=='dtcw:rstToHtml.py') {
                            // this is an internal script
                            command = projectDir.canonicalPath+'/scripts/rstToHtml.py'
                        }
                        command = ['bash', '-c', command + ' "' + file + '"']
                        def process = command.execute([], new File(docDir))
                        process.waitFor()
                        if (process.exitValue()) {
                            def error = process.err.text
                            println """
can't convert '${file.canonicalPath-docDir-'/build/microsite/tmp/site/doc'}':
${error}
"""
                            throw new Exception("""
can't convert '${file.canonicalPath-docDir-'/build/microsite/tmp/site/doc'}':
${error}
""")
                        }
                }
            }
        }
    }

}

def parseAsciiDocAttribs = { origText, jbake -&gt;
    def parseAttribs = true
    def text = ""
    def beforeToc = ""
    origText.eachLine { line -&gt;
        if (parseAttribs &amp;&amp; line.startsWith(":jbake")) {
            def parsedJbakeAttribute = (line - ":jbake-").split(": +", 2)
            if(parsedJbakeAttribute.length != 2) {
                logger.warn("jbake-attribute is not valid or Asciidoc conform: $line")
                logger.warn("jbake-attribute $line will be ignored, trying to continue...")
            } else {
                jbake[parsedJbakeAttribute[0]] = parsedJbakeAttribute[1]
            }
        } else {
            if (line.startsWith("[")) {
                // stop parsing jBake-attribs when a [source] - block starts which might contain those attribs as example
                parseAttribs = false
            }
            text += line+"\n"
            //there are some attributes which have to be set before the toc
            if (line.startsWith(":toc") ) {
                beforeToc += line+"\n"
            }
        }
    }
    return [text, beforeToc]
}

def parseOtherAttribs = { origText, jbake -&gt;
    if (origText.contains('~~~~~~')) {
        def parseAttribs = true
        def text = ""
        origText.eachLine { line -&gt;
            if (parseAttribs &amp;&amp; line.contains("=")) {
                line = (line - "jbake-").split("=", 2)
                jbake[line[0]] = line[1]
            } else {
                if (line.startsWith("~~~~~~")) {
                    // stop parsing jBake-attribs when delimiter shows up
                    parseAttribs = false
                } else {
                    text += line + "\n"
                }
            }
        }
        return text
    } else {
        return origText
    }
}

def renderHeader = { fileName, jbake -&gt;
    def header = ''
    if (fileName.toLowerCase() ==~ '^.*(html|md)$') {
        jbake.each { key, value -&gt;
            if (key == 'order') {
                header += "jbake-${key}=${(value ?: '1') as Integer}\n"
            } else {
                if (key in ['type', 'status']) {
                    header += "${key}=${value}\n"
                } else {
                    header += "jbake-${key}=${value}\n"
                }
            }
        }
        header += "~~~~~~\n\n"

    } else {
        jbake.each { key, value -&gt;
            if (key == 'order') {
                header += ":jbake-${key}: ${(value ?: '1') as Integer}\n"
            } else {
                header += ":jbake-${key}: ${value}\n"
            }
        }
    }
    return header
}
def fixMetaDataHeader = {
    //fix MetaData-Header
    File sourceFolder = new File(targetDir, '/microsite/tmp/site/doc')
    logger.info("sourceFolder: " + sourceFolder.canonicalPath)
    sourceFolder.traverse(type: FILES) { file -&gt;
        if (file.name.toLowerCase() ==~ '^.*(ad|adoc|asciidoc|html|md)$') {
            if (file.name.startsWith("_") || file.name.startsWith(".")) {
                //ignore
            } else {
                def origText = file.text
                //parse jbake attributes
                def text = ""
                def jbake = [
                    status: "published",
                    order: -1,
                    type: 'page_toc'
                ]
                if (file.name.toLowerCase() ==~ '^.*(md|html)$') {
                    // we don't have a toc for md or html
                    jbake.type = 'page'
                }
                def beforeToc = ""
                if (file.name.toLowerCase() ==~ '^.*(ad|adoc|asciidoc)$') {
                    (text, beforeToc) = parseAsciiDocAttribs(origText, jbake)
                } else {
                    text = parseOtherAttribs(origText, jbake)
                }
                def name = file.canonicalPath - (sourceFolder.canonicalPath+File.separator)
                if (File.separator=='\\') {
                    name = name.split("\\\\")
                } else {
                    name = name.split("/")
                }
                if (name.size()&gt;1) {
                    if (!jbake.menu) {
                        jbake.menu = name[0]
                        if (jbake.menu ==~ /[0-9]+[-_].*/) {
                            jbake.menu = jbake.menu.split("[-_]", 2)[1]
                        }
                    }
                    def docname = name[-1]
                    if (docname ==~ /[0-9]+[-_].*/) {
                        jbake.order = docname.split("[-_]",2)[0]
                        docname     = docname.split("[-_]",2)[1]
                    }
                    if (name.size() &gt; 2) {
                        if ((jbake.order as Integer)==0) {
                            // let's take the order from the second level dir or file and not the file
                            def secondLevel = name[1]
                            if (secondLevel ==~ /[0-9]+[-_].*/) {
                                jbake.order = secondLevel.split("[-_]",2)[0]
                            }
                        } else {
                            if (((jbake.order?:'1') as Integer) &gt; 0) {
                                //
                            } else {
                                jbake.status = "draft"
                            }
                        }
                    }
                    if (jbake.order==-1 &amp;&amp; docname.startsWith('index')) {
                        jbake.order = -987654321 // special 'magic value' given to index pages.
                        jbake.status = "published"
                    }
                    // news blog
                    if (jbake.order==-1 &amp;&amp; jbake.type=='post') {
                        jbake.order = 0
                        try {
                            jbake.order = Date.parse("yyyy-MM-dd", jbake.date).time / 100000
                        } catch ( Exception e) {
                            System.out.println "unparsable date ${jbake.date} in $name"
                        }
                        jbake.status = "published"
                    }
                    def leveloffset = 0
                    if (file.name.toLowerCase() ==~ '^.*(ad|adoc|asciidoc)$') {
                        text.eachLine { line -&gt;
                            if (!jbake.title &amp;&amp; line ==~ "^=+ .*") {
                                jbake.title = (line =~ "^=+ (.*)")[0][1]
                                def level = (line =~ "^(=+) .*")[0][1]
                                if (level == "=") {
                                    leveloffset = 1
                                }
                            }
                        }
                    } else {
                        if (file.name.toLowerCase() ==~ '^.*(html)$') {
                            if (!jbake.title) {
                                text.eachLine { line -&gt;
                                    if (!jbake.title &amp;&amp; line ==~ "^&lt;h[1-9]&gt;.*&lt;/h.*") {
                                        jbake.title = (line =~ "^&lt;h[1-9]&gt;(.*)&lt;/h.*")[0][1]
                                    }
                                }
                            }
                        } else {
                            // md
                            if (!jbake.title) {
                                text.eachLine { line -&gt;
                                    if (!jbake.title &amp;&amp; line ==~ "^#+ .*") {
                                        jbake.title = (line =~ "^#+ (.*)")[0][1]
                                    }
                                }
                            }
                        }
                    }
                    if (!jbake.title) {
                        jbake.title = docname
                    }
                    if (leveloffset==1) {
                        //leveloffset needed
                        // we always start with "==" not with "="
                        // only used for adoc
                        text = text.replaceAll("(?ms)^(=+) ", '$1= ')
                    }
                    if (config.microsite.customConvention) {
                        def binding = new Binding([
                            file  : file,
                            sourceFolder : sourceFolder,
                            config: config,
                            headers : jbake
                        ])
                        def shell = new GroovyShell(getClass().getClassLoader(), binding)
                        shell.evaluate(config.microsite.customConvention)
                        System.out.println jbake

                    }
                    def header = renderHeader(file.name, jbake)
                    if (file.name.toLowerCase() ==~ '^.*(ad|adoc|asciidoc)$') {
                        file.write(header + "\nifndef::dtc-magic-toc[]\n:dtc-magic-toc:\n$beforeToc\n\n:toc: left\n\n++++\n&lt;!-- endtoc --&gt;\n++++\nendif::[]\n" + text, "utf-8")
                    } else {
                        file.write(header + "\n" + text, "utf-8")
                    }
                }
            }
        }
    }

}

task generateSite(
    group: 'docToolchain',
    description: 'generate a microsite using jBake.') {
    doLast {
        new File("${targetDir}/microsite/tmp").mkdirs()
        println new File("${targetDir}/microsite/tmp/").canonicalPath

        prepareAndCopyTheme()

        //copy docs
        copy {
            from(new File(docDir, inputPath)) {}
            into("${targetDir}/microsite/tmp/site/doc")
        }

        // if configured, convert restructuredText or anything else
        convertAdditionalFormats()

        // convention over configuration
        fixMetaDataHeader()

    }
}

task previewSite(
    group: 'docToolchain',
    dependsOn: [],
    description: 'preview your Microsite',
) {
    doLast {
        println("previewSite command has been deprecated.")
        println("To preview your site, open ${targetDir}/microsite/output/index.html in your browser.")
        println("To read alternative ways to preview your site, please consult the documentation.")
    }
}
previewSite.dependsOn(generateSite)
previewSite.mustRunAfter(bake)

task copyImages(type: Copy) {
    config.imageDirs.each { imageDir -&gt;
        from(new File (new File(docDir, inputPath),imageDir)) {}
        logger.info ('imageDir: '+imageDir)
        into("${targetDir}/microsite/output/images")
    }
    config.resourceDirs.each { resource -&gt;
        from(new File(file(srcDir),resource.source))
        logger.info ('resource: '+resource.source)
        into("${targetDir}/microsite/output/" + resource.target)
    }
}

bake.dependsOn copyImages
generateSite.finalizedBy bake</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generatedocbook">11. generateDocbook</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_9">11.1. About This Task</h3>
<div class="paragraph">
<p>A helper task, generateDocbook generates the intermediate format for <a href="03_task_convertToDocx.html"><code>convertToDocx</code></a>&lt;&lt;&gt;&gt; and <a href="03_task_convertToEpub.html"><code>convertToEpub</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_9">11.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/AsciiDocBasics.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/AsciiDocBasics.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/AsciiDocBasics.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateDocbook (
        type: AsciidoctorTask,
        group: 'docToolchain',
        description: 'use docbook as asciidoc backend') {

    def sourceFilesDOCBOOK = findSourceFilesByType(['docbook', 'epub', 'docx'])
//    onlyIf {
//        sourceFilesDOCBOOK
//    }

    sources {
        sourceFilesDOCBOOK.each {
            include it.file
            logger.info it.file

            File useFile = new File(srcDir, it.file)
            if (!useFile.exists()) {
                throw new Exception ("""
                The file $useFile in DOCBOOK config does not exist!
                Please check the configuration 'inputFiles' in $mainConfigFile.""")
            }
        }
    }

    outputOptions {
        backends = ['docbook']
    }

    outputDir = file(targetDir+'/docbook/')

    doFirst {
        if (sourceFilesDOCBOOK.size()==0) {
            throw new Exception ("""
            &gt;&gt; No source files defined for type of '[docbook, epub, docx]'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generatedeck">12. generateDeck</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_10">12.1. About This Task</h3>
<div class="paragraph">
<p>This task makes use of the <a href="https://github.com/asciidoctor/asciidoctor-reveal.js/">asciidoctor-reveal.js</a> backend to render your documents into an HTML-based presentation.
It creates a PowerPoint presentation, then enriches it by adding reveal.js slide definitions in AsciiDoc to the speaker notes.
For best results, use this task with the <a href="03_task_exportPPT.html"><code>exportPPT</code></a> task.</p>
</div>
<div class="sect3">
<h4 id="_configure_revealjs">12.1.1. Configure RevealJs</h4>
<div class="paragraph">
<p>docToolchain comes with some opinionated, sane defaults for RevealJs.
You can overwrite any of them and provide further configuration as per <a href="https://docs.asciidoctor.org/reveal.js-converter/latest/converter/revealjs-options/">asciidoctor-reveal.js</a> documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_10">12.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/AsciiDocBasics.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/AsciiDocBasics.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/AsciiDocBasics.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/AsciiDocBasics.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task generateDeck (
    type: AsciidoctorJRevealJSTask,
    group: 'docToolchain',
    description: 'use revealJs as asciidoc backend to create a presentation') {

    // corresponding Asciidoctor reveal.js config
    // :revealjs_theme:
    theme = 'black'

    revealjsOptions {
        // :revealjs_hideAddressBar:
        hideAddressBarOnMobile = 'true'
        // :revealjs_history:
        pushToHistory = 'true'
        // :revealjs_progress:
        progressBar = 'true'
        // :revealjs_slideNumber:
        slideNumber = 'true'
        // :revealjs_touch:
        touchMode = 'true'
        // :revealjs_transition:
        transition = 'linear'
    }

    attributes (
        'idprefix': 'slide-',
        'idseparator': '-',
        'docinfo1': '',
    )

    def sourceFilesREVEAL = findSourceFilesByType(['revealjs'])

    sources {
        sourceFilesREVEAL.each {
            include it.file
            logger.info it.file

            File useFile = new File(srcDir, it.file)
            if (!useFile.exists()) {
                throw new Exception ("""
                The file $useFile in REVEAL config does not exist!
                Please check the configuration 'inputFiles' in $mainConfigFile.""")
            }
        }
    }

    outputDir = file(targetDir+'/decks/')

    resources {
        from(sourceDir) {
            include 'images/**'
        }
        into("")
        logger.info "${docDir}/${config.outputPath}/images"
    }

    doFirst {
        if (sourceFilesREVEAL.size()==0) {
            throw new Exception ("""
            &gt;&gt; No source files defined for type 'revealjs'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
    }
}
generateDeck.dependsOn asciidoctorGemsPrepare</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishtoconfluence">13. publishToConfluence</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/8ef7eec3e8d0d4f6cf243e8009c1cee8?d=identicon" alt="Bence Hornák" width="32" height="32" title="Bence Hornák"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5a5f4f4cb007274a31a00ca53975ad5c?d=identicon" alt="apparatchick" width="32" height="32" title="apparatchick"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/ad30b590d12622a076b6fe3767266c47?d=identicon" alt="Adelrich König (koa)" width="32" height="32" title="Adelrich König (koa)"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/ddc89ccc2b60ccbd48c6cfa1516573b6?d=identicon" alt="Andreas Klemp (EXT)" width="32" height="32" title="Andreas Klemp (EXT)"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Rosi" width="32" height="32" title="Rosi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/1a867bc36c58b6d45b3dde4d87f9410a?d=identicon" alt="Martin" width="32" height="32" title="Martin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/fc4dffda746759e7e98470ed9cfcc074?d=identicon" alt="Jan-Niklas Vierheller" width="32" height="32" title="Jan-Niklas Vierheller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/26543494012e9d554d707ae10121bcf3?d=identicon" alt="Denny Israel" width="32" height="32" title="Denny Israel"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/518a75fcbe5adea38aa4bec267d7572b?d=identicon" alt="Nikolay Orozov" width="32" height="32" title="Nikolay Orozov"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6dd2fe167fd7d2a84322787e3428d14e?d=identicon" alt="Joseph Staub" width="32" height="32" title="Joseph Staub"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/7107bc30257a84fd371a188bda07309f?d=identicon" alt="oliver drewes" width="32" height="32" title="oliver drewes"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/415bf2233be007b088ca81b749f02071?d=identicon" alt="Nils Mahlstaedt" width="32" height="32" title="Nils Mahlstaedt"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/be47969496f94a5a89159d70cd82bda0?d=identicon" alt="sabatmonk" width="32" height="32" title="sabatmonk"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/4280fc350b2b3cb323d151be608be3f8?d=identicon" alt="Alexander Herrmann" width="32" height="32" title="Alexander Herrmann"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/aacd09e76c0affa36f76f8ef337a1536?d=identicon" alt="Luis Muniz" width="32" height="32" title="Luis Muniz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c5a117679f7101b5de26dd25a2a8e98?d=identicon" alt="Dierk Höppner" width="32" height="32" title="Dierk Höppner"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e7d9e6618a36e94b35d43cbd2925aee0?d=identicon" alt="bit-jkraushaar" width="32" height="32" title="bit-jkraushaar"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/d2017e2cab333d23e2c7285cb62fdc43?d=identicon" alt="Constantin" width="32" height="32" title="Constantin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c384e5d2b684c60fc8f062d75dae3f7?d=identicon" alt="Alfon" width="32" height="32" title="Alfon"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2dc2929d0609d6338d2794446156f312?d=identicon" alt="Thomas Grabietz" width="32" height="32" title="Thomas Grabietz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/73252f762a6ec69bb59a23c8ff861c4a?d=identicon" alt="David M. Carr" width="32" height="32" title="David M. Carr"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>10 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_11">13.1. About This Task</h3>
<div class="paragraph">
<p>This task takes a generated HTML file, splits it by headline, and pushes it to your instance of <a href="https://www.atlassian.com/software/confluence">Confluence</a>.
This lets you use the <a href="https://www.writethedocs.org/guide/docs-as-code/">docs-as-code approach</a> even if your organisation insists on using Confluence as its main document repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From the 01.01.2024 on, Atlassian turns off API V1 for Confluence Cloud, if there is a V2 equivalent. docToolchain versions from 3.1 on support API V2. If you are using an older version of docToolchain, you&#8217;ll need to upgrade to a newer version.
To <strong>enable API V2</strong>, set <code>useV1Api</code> to <code>false</code> in the Confluence section of the docToolchain configuration file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, docToolchain only has full support for the old Confluence editor. The new editor is not fully supported yet. You can use the new editor, but you may experience some unexpected layout issues/ changes. To make use of the new editor you need to set <code>enforceNewEditor</code> to <code>true</code> in the Confluence section of the docToolchain configuration file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_special_features">13.2. Special Features</h3>
<div class="sect3">
<h4 id="_easy_code_block_conversion">13.2.1. Easy Code Block Conversion</h4>
<div class="paragraph">
<p><code>[source]</code>-blocks are converted to code-macro blocks in Confluence.</p>
</div>
<div class="paragraph">
<p>Confluence supports a very limited list of languages supported for code block syntax highlighting.
When specifying an unknown language, it would even display an error.
Therefore, some transformation is applied.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no language is given in the source block, it is explicitly set to plain text (because the default would be Java that might not always apply).</p>
</li>
<li>
<p>Some known and common AsciiDoc source languages are mapped to Confluence code block languages.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">source</th>
<th class="tableblock halign-left valign-top">target</th>
<th class="tableblock halign-left valign-top">note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">produces an acceptable highlighting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only a specific shell is supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yaml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">different name of language</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>If the language of the source block is not supported by Confluence, it is set to plain text as fallback to avoid the error.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Get a list of valid languages (and learn how to add others) <a href="https://confluence.atlassian.com/doc/code-block-macro-139390.html">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_minimal_impact_on_non_techie_confluence_users">13.2.2. Minimal Impact on Non-Techie Confluence Users</h4>
<div class="paragraph">
<p>Only pages and images that changed between task runs are published, and only those changes are notified to page watchers, cutting down on 'spam'.</p>
</div>
</div>
<div class="sect3">
<h4 id="_keywords_automatically_attached_as_labels">13.2.3. Keywords Automatically Attached as Labels</h4>
<div class="paragraph">
<p><code>:keywords:</code> are attached as labels to every Confluence page generated using the <code>publishToConfluence</code> task.
See <a href="https://confluence.atlassian.com/doc/add-remove-and-search-for-labels-136419.html">Atlassian&#8217;s own guidelines on labels</a>.
Several keywords are allowed, and they must be separated by commas. For example: <code>:keywords: label_1, label-2, label3, &#8230;&#8203;</code>.
Labels (keywords) must not contain a space character. Use either '_' or '-'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">13.3. Configuration</h3>
<div class="paragraph">
<p>You configure the publishToConfluence task in the file docToolchainConfig.groovy. It is located in the root of your project folder. We try to make the configuration self-explanatory, but below is some more information about each config option.</p>
</div>
<div class="paragraph">
<p><strong>input</strong></p>
</div>
<div class="paragraph">
<p>is an array of files to upload to Confluence with the ability
to configure a different parent page for each file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attributes">13.4. Attributes</h3>
<div class="ulist">
<ul>
<li>
<p><code>file</code>: absolute or relative path to the asciidoc generated html file to be exported</p>
</li>
<li>
<p><code>url</code>: absolute URL to an asciidoc generated html file to be exported</p>
</li>
<li>
<p><code>ancestorName</code> (optional): the name of the parent page in Confluence as string;
this attribute has priority over ancestorId, but if page with given name doesn&#8217;t exist,
ancestorId will be used as a fallback</p>
</li>
<li>
<p><code>ancestorId</code> (optional): the id of the parent page in Confluence as string; leave this empty
if a new parent shall be created in the space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following four keys can also be used in the global section below</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spaceKey</code>: page specific variable for the key of the confluence space to write to
case sensitive! If the case is not correct, it can be that new page will be
created but can&#8217;t be updated in the next run.</p>
</li>
<li>
<p><code>subpagesForSections</code> (optional): The number of nested sub-pages to create. Default is '1'.
'0' means creating all on one page.
The following migration for removed configuration can be used.</p>
<div class="ulist">
<ul>
<li>
<p><code>allInOnePage = true</code> is the same as <code>subpagesForSections = 0</code></p>
</li>
<li>
<p><code>allInOnePage = false &amp;&amp; createSubpages = false</code> is the same as <code>subpagesForSections = 1</code></p>
</li>
<li>
<p><code>allInOnePage = false &amp;&amp; createSubpages = true</code> is the same as <code>subpagesForSections = 2</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>pagePrefix</code> (optional): page specific variable, the pagePrefix will be a prefix for the page title and it&#8217;s sub-pages
use this if you only have access to one confluence space but need to store several
pages with the same title - a different pagePrefix will make them unique</p>
</li>
<li>
<p><code>pageSuffix</code> (optional): same usage as prefix but appended to the title and it&#8217;s subpages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>only 'file' or 'url' is allowed. If both are given, 'url' is ignored</p>
</div>
<div class="paragraph">
<p><strong>ancestorId</strong></p>
</div>
<div class="paragraph">
<p>The page ID of the parent page where you want your docs to be published.
Go to this page, click <strong>Edit</strong> and the required ID will show up in the URL.
Specify the ID as a string within the config file.</p>
</div>
<div class="paragraph">
<p><strong>api</strong></p>
</div>
<div class="paragraph">
<p>Endpoint of the confluenceAPI (REST) to be used and looks like <code>https://[yourServer]/[context]</code>, while <code>[context]</code> is optional.
If you use Confluence Cloud, you can omit the context.
If you use Confluence Server, you may need to set a context, depending on your Confluence configuration.</p>
</div>
<div class="paragraph">
<p><strong>rateLimit</strong> (since 3.2.0), The rate limit for Confluence requests. Default is 10 requests per second.</p>
</div>
<div class="paragraph">
<p><strong>useV1Api</strong></p>
</div>
<div class="paragraph">
<p><strong><em>This feature is available for docToolchain &gt;= 3.1 only</em></strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you set this to <code>false</code>, ensure the <code>api</code> config is set to <code>https://[yourCloudDomain]</code>. (Mind no <em>context</em> given here)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Confluence Cloud, you can set this to <code>false</code> to use the new API V2. If you are using Confluence Server, you can set this to <code>true</code> to use the old API V1. If you are using Confluence Cloud and set this to <code>false</code>, you will get an error message, once Atlassian turns off API V1 (starting 01.01.2024).</p>
</div>
<div class="paragraph">
<p><strong>enforceNewEditor</strong></p>
</div>
<div class="paragraph">
<p>Atlassian is currently rolling out a new editor for Confluence. If you want to use the new editor, you can set this to <code>true</code>. If you are using the old editor, you can set this to <code>false</code>. If you are using the new editor, you may experience some unexpected layout issues/ changes, since the new editor has yet no feature parity and therefore may be incompatible.</p>
</div>
<div class="paragraph">
<p><strong>disableToC</strong></p>
</div>
<div class="paragraph">
<p>This boolean configuration determines whether the table of contents (ToC) is disabled on the page once uploaded to Confluence. <code>false</code> by default, so the ToC is active.</p>
</div>
<div class="paragraph">
<p><strong>pagePrefix/pageSuffix</strong></p>
</div>
<div class="paragraph">
<p>Confluence can&#8217;t handle two pages with the same name - even with different casing (lowercase, UPPERCASE, a mix).
This script matches pages regardless of case and refuses to replace a page whose name differs from an existing page only by casing.
Ideally, you should create a new Confluence space for each piece of larger documentation.
If you are restricted and can&#8217;t create new spaces, you can use <code>pagePrefix</code>/<code>pageSuffix</code> to define a prefix/suffix for the doc so that it doesn&#8217;t conflict with other page names.</p>
</div>
<div class="paragraph">
<p><strong>pageVersionComment</strong></p>
</div>
<div class="paragraph">
<p>Set an optional comment for the new page version in Confluence.</p>
</div>
<div class="paragraph">
<p><strong>credentials</strong></p>
</div>
<div class="paragraph">
<p>For security reasons it is highly recommended to store your credentials in a separate file outside the Git repository, such as in your Home folder.</p>
</div>
<div class="paragraph">
<p>To authenticate with username and API token, use:
    credentials = "user:${new File("/users/me/apitoken").text}" or
    credentials = "user:${new File("/users/me/apitoken").text}"`.bytes.encodeBase64().toString()` to &#8230;&#8203;&#8230;&#8203;..
You can create an API-token in <a href="https://confluence.atlassian.com/cloud/api-tokens-938839638.html">your profile</a>.</p>
</div>
<div class="paragraph">
<p>To authenticate with username and password, use:
    credentials = &#8230;&#8203;&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>You can also set your username, password of apitoken as an environment variable. You then do the following:
1. Open the file that contains the environment variables:
    a. On a Mac, go to your Home folder and open the file .zpfrofile.
2. &#8230;&#8203;.</p>
</div>
<div class="paragraph">
<p>If you wish to simplify the injection of credentials from external sources, do the following:
1. In docToolchainConfig.groovy, do not enter the credentials. Make sure the credentials are escaped.
2. Create a <code>gradle.properties</code> file in the project or home directory. See <a href="https://docs.gradle.org/current/userguide/build_environment.html">the gradle user guide</a>.
3. Open the file, and put the variables in it:
    - confluenceUser=myusername, and on a new line
    - confluencePass=myuserpassword</p>
</div>
<div class="paragraph">
<p><strong>apikey</strong></p>
</div>
<div class="paragraph">
<p>In situations where you have to use full user authorisation because of internal Confluence permission handling, you&#8217;ll need to add the API-token in addition to the credentials.
The API-token cannot be added to the credentials because it&#8217;s used for user and password exchange.
Therefore, the API-token can be added as parameter <code>apikey</code>, which makes the addition of the token a separate header field with key: <code>keyId</code> and value of <code>apikey</code>.
An example (including storing of the real value outside this configuration) is: <code>apikey = "${new File("/home/me/apitoken").text}"</code>.</p>
</div>
<div class="paragraph">
<p><strong>bearerToken</strong></p>
</div>
<div class="paragraph">
<p>You can pass a <a href="https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.html">Confluence
Personal Access Token</a> as the <code>bearerToken</code>. It is an alternative to
<code>credentials</code>. Do not confuse it with <code>apiKey</code>.</p>
</div>
<div class="paragraph">
<p><strong>extraPageContent</strong></p>
</div>
<div class="paragraph">
<p>If you need to prefix your pages with a warning stating that 'this is generated content', this is where you do it.</p>
</div>
<div class="paragraph">
<p><strong>enableAttachments</strong></p>
</div>
<div class="paragraph">
<p>If value is set to <code>true</code>, any links to local file references will be uploaded as attachments. The current implementation only supports a single folder, the name of which will be used as a prefix to validate whether your file should be uploaded.
If you enable this feature, and use a folder which starts with 'attachment', an adaption of this prefix is required.</p>
</div>
<div class="paragraph">
<p><strong>pageLimit</strong></p>
</div>
<div class="paragraph">
<p>Limits the number of pages retrieved from the server to check if a page with this name already exists.</p>
</div>
<div class="paragraph">
<p><strong>jiraServerId</strong>
Only required if you are using Jira on-premise. If you are using Jira cloud you do not need to set this value.
Stores the Jira server ID that your Confluence instance is connected to. If a value is set, all anchors pointing to a Jira ticket will be replaced by the Confluence Jira macro. How-To find your Jira server ID <a href="https://confluence.atlassian.com/adminjiraserver/finding-your-server-id-938847652.html">please check the Atlassian documentation</a>.</p>
</div>
<div class="paragraph">
<p>All files to attach will need to be linked inside the document:
<code>link:attachment/myfolder/myfile.json[My API definition]</code></p>
</div>
<div class="paragraph">
<p><strong>attachmentPrefix</strong></p>
</div>
<div class="paragraph">
<p>Stores the expected foldername of your output directory. Default is <code>attachment</code>.</p>
</div>
<div class="paragraph">
<p><strong>proxy</strong></p>
</div>
<div class="paragraph">
<p>If you need to provide proxy to access Confluence, you can set a map with the keys <code>host</code> (e.g. <code>'my.proxy.com'</code>), <code>port</code> (e.g. <code>'1234'</code>) and <code>schema</code> (e.g. <code>'http'</code>) of your proxy.</p>
</div>
<div class="paragraph">
<p><strong>useOpenapiMacro</strong></p>
</div>
<div class="paragraph">
<p>If this option is present and equal to <code>confluence-open-api</code> or <code>swagger-open-api</code> then any source block marked with <code>class openapi</code> will be wrapped in the Elitesoft Swagger Editor macro (see <a href="https://marketplace.atlassian.com/apps/1218914/open-api-swagger-editor-for-confluence">Elitesoft Swagger Editor</a>). The key depends on the version of the macro.</p>
</div>
<div class="paragraph">
<p>For backward compatibility, if this option is present and equal to <code>true</code>, then again the Elitesoft Swagger Editor macro will be used.</p>
</div>
<div class="paragraph">
<p>If this option is present and equal to "open-api" then any source block marked with class openapi will be wrapped in Open API Documentation for Confluence macro:  (see <a href="https://marketplace.atlassian.com/apps/1215176/open-api-documentation-for-confluence">Open API Documentation for Confluence</a>). A download source (yaml) button is shown by default.<br>
Using the plugin can be handled on different ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>copy/paste the content of the YAML file to the plugin without linking to the origin source by using the url to the YAML file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml]
    ----
    \include::https://my-domain.com/path-to-yaml[]
    ----</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>copy/paste the content of the YAML file to the plugin without linking to the origin source by using a YAML file in your project structure:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml]
    ----
    \include::my-yaml-file.yaml[]
    ----</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>create a link between the plugin and the YAML file without copying the content into the plugin. The advantage following this way is that even in case the API specification is changed without re-generating the documentation, the new version of the configuration is used in Confluence.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml,role="url:https://my-domain.com/path-to-yaml"]
    ----
    \include::https://my-domain.com/path-to-yaml[]
    ----</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//Configureation for publishToConfluence

confluence = [:]

// 'input' is an array of files to upload to Confluence with the ability
//          to configure a different parent page for each file.
//
// Attributes
// - 'file': absolute or relative path to the asciidoc generated html file to be exported
// - 'url': absolute URL to an asciidoc generated html file to be exported
// - 'ancestorName' (optional): the name of the parent page in Confluence as string;
//                             this attribute has priority over ancestorId, but if page with given name doesn't exist,
//                             ancestorId will be used as a fallback
// - 'ancestorId' (optional): the id of the parent page in Confluence as string; leave this empty
//                            if a new parent shall be created in the space
//                            Set it for every file so the page scanning is done only for the given ancestor page trees.
//
// The following four keys can also be used in the global section below
// - 'spaceKey' (optional): page specific variable for the key of the confluence space to write to
// - 'subpagesForSections' (optional): The number of nested sub-pages to create. Default is '1'.
//                                     '0' means creating all on one page.
//                                     The following migration for removed configuration can be used.
//                                     'allInOnePage = true' is the same as 'subpagesForSections = 0'
//                                     'allInOnePage = false &amp;&amp; createSubpages = false' is the same as 'subpagesForSections = 1'
//                                     'allInOnePage = false &amp;&amp; createSubpages = true' is the same as 'subpagesForSections = 2'
// - 'pagePrefix' (optional): page specific variable, the pagePrefix will be a prefix for the page title and it's sub-pages
//                            use this if you only have access to one confluence space but need to store several
//                            pages with the same title - a different pagePrefix will make them unique
// - 'pageSuffix' (optional): same usage as prefix but appended to the title and it's subpages
// only 'file' or 'url' is allowed. If both are given, 'url' is ignored
confluence.with {
    input = [
            [ file: "build/docs/html5/arc42-template-de.html" ],
    ]

    // endpoint of the confluenceAPI (REST) to be used
    // https://[yourServer]
    api = 'https://[yourServer]'

    // requests per second for confluence API calls
    rateLimit = 10

//    Additionally, spaceKey, subpagesForSections, pagePrefix and pageSuffix can be globally defined here. The assignment in the input array has precedence

    // the key of the confluence space to write to
    spaceKey = 'asciidoc'

    // if true, all pages will be created using the new editor v2
    // enforceNewEditor = false

    // variable to determine how many layers of sub pages should be created
    subpagesForSections = 1

    // the pagePrefix will be a prefix for each page title
    // use this if you only have access to one confluence space but need to store several
    // pages with the same title - a different pagePrefix will make them unique
    pagePrefix = ''

    pageSuffix = ''

    /*
    WARNING: It is strongly recommended to store credentials securely instead of commiting plain text values to your git repository!!!

    Tool expects credentials that belong to an account which has the right permissions to to create and edit confluence pages in the given space.
    Credentials can be used in a form of:
     - passed parameters when calling script (-PconfluenceUser=myUsername -PconfluencePass=myPassword) which can be fetched as a secrets on CI/CD or
     - gradle variables set through gradle properties (uses the 'confluenceUser' and 'confluencePass' keys)
    Often, same credentials are used for Jira &amp; Confluence, in which case it is recommended to pass CLI parameters for both entities as
    -Pusername=myUser -Ppassword=myPassword
    */

    //optional API-token to be added in case the credentials are needed for user and password exchange.
    //apikey = "[API-token]"

    // HTML Content that will be included with every page published
    // directly after the TOC. If left empty no additional content will be
    // added
    // extraPageContent = '&lt;ac:structured-macro ac:name="warning"&gt;&lt;ac:parameter ac:name="title" /&gt;&lt;ac:rich-text-body&gt;This is a generated page, do not edit!&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;
    extraPageContent = ''

    // enable or disable attachment uploads for local file references
    enableAttachments = false

    // default attachmentPrefix = attachment - All files to attach will require to be linked inside the document.
    // attachmentPrefix = "attachment"


    // Optional proxy configuration, only used to access Confluence
    // schema supports http and https
    // proxy = [host: 'my.proxy.com', port: 1234, schema: 'http']

    // Optional: specify which Confluence OpenAPI Macro should be used to render OpenAPI definitions
    // possible values: ["confluence-open-api", "open-api", "swagger-open-api", true]. true is the same as "confluence-open-api" for backward compatibility
    // useOpenapiMacro = "confluence-open-api"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_css_styling">13.5. CSS Styling</h3>
<div class="paragraph">
<p>Some AsciiDoctor features depend on specific CSS style definitions.
Unless these styles are defined, some formatting that is present in the HTML version will not be represented when published to Confluence.
To configure Confluence to include additional style definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to Confluence as a space admin.</p>
</li>
<li>
<p>Go to the desired space.</p>
</li>
<li>
<p>Select <strong>Space tools &gt; Look and Feel &gt; Stylesheet</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> then enter the desired style definitions.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The default style definitions can be found in the AsciiDoc project as <a href="https://raw.githubusercontent.com/asciidoctor/asciidoctor/master/data/stylesheets/asciidoctor-default.css">asciidoctor-default.css</a>.
You will most likely <strong>NOT</strong> want to include the entire thing, as some of the definitions are likely to disrupt Confluence&#8217;s layout.</p>
</div>
<div class="paragraph">
<p>The following style definitions are Confluence-compatible, and will enable the use of the built-in roles (<code>big</code>/<code>small</code>, <code>underline</code>/<code>overline</code>/<code>line-through</code>, <code><em>COLOR</em></code>/<code><em>COLOR</em>-background</code> for the <a href="https://en.wikipedia.org/wiki/Web_colors#HTML_color_names">sixteen HTML color names</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="css">.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_11">13.6. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/publishToConfluence.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/publishToConfluence.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/publishToConfluence.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task publishToConfluence(
        description: 'publishes the HTML rendered output to confluence',
        group: 'docToolchain'
) {
    doLast {
        logger.info("docToolchain&gt; docDir: "+docDir)
        config.confluence.api = findProperty("confluence.api")?:config.confluence.api
        //TODO default should be false, if the V1 has been removed in cloud
        config.confluence.useV1Api = findProperty("confluence.useV1Api") != null ?
            findProperty("confluence.useV1Api") : config.confluence.useV1Api != [:] ?
            config.confluence.useV1Api :true
        Asciidoc2ConfluenceTask.From(config, docDir).execute()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">Show source code of <code>core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy" target="_blank" rel="noopener">GitHub · docToolchain/core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package org.docToolchain.scripts

/**
 * THIS SCRIPT HAS BEEN DEPRECATED. IT IS NOT USED ANYMORE. PLEASE REFER TO THE NEW Asciidoc2ConfluenceTask
 * IMPLEMENTATION INSTEAD. REFERENCE ONLY.
 */

import org.docToolchain.atlassian.transformer.HtmlTransformer

/**
 * Created by Ralf D. Mueller and Alexander Heusingfeld
 * https://github.com/rdmueller/asciidoc2confluence
 *
 * this script expects an HTML document created with AsciiDoctor
 * in the following style (default AsciiDoctor output)
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     &lt;div class="sectionbody"&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *     &lt;/div&gt;
 * &lt;/div&gt;
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     ...
 * &lt;/div&gt;
 *
 */

/*
    Additions for issue #342 marked as #342-dierk42
    ;-)
*/

// some dependencies

import org.jsoup.nodes.Document
import org.jsoup.nodes.Element
import org.jsoup.nodes.Entities
import org.jsoup.nodes.TextNode
import org.jsoup.select.Elements

import groovy.transform.Field

import java.nio.charset.Charset
import java.nio.file.Path
import java.security.MessageDigest
import static groovy.io.FileType.FILES

import org.docToolchain.atlassian.confluence.clients.ConfluenceClientV1
import org.docToolchain.atlassian.confluence.clients.ConfluenceClientV2
import org.docToolchain.configuration.ConfigService
import org.docToolchain.atlassian.confluence.ConfluenceService

@Field
ConfigService configService = new ConfigService(config)

@Field
ConfluenceService confluenceService = new ConfluenceService(configService)

@Field
def confluenceClient = configService.getConfigProperty("confluence.useV1Api") ?
        new ConfluenceClientV1(configService) :
        new ConfluenceClientV2(configService)

@Field
def CDATA_PLACEHOLDER_START = '&lt;cdata-placeholder&gt;'

@Field
def CDATA_PLACEHOLDER_END = '&lt;/cdata-placeholder&gt;'

@Field
def baseUrl
def allPages
// #938-mksiva: global variable to hold input spaceKey passed in the Config.groovy
def spaceKeyInput
// configuration

def confluenceSpaceKey
def confluenceSubpagesForSections
@Field
def confluencePagePrefix
@Field
def confluencePageSuffix
//def baseApiPath = new URI(config.confluence.api).path
// helper functions

def MD5(String s) {
    MessageDigest.getInstance("MD5").digest(s.bytes).encodeHex().toString()
}

def parseAdmonitionBlock(block, String type) {
    content = block.select(".content").first()
    titleElement = content.select(".title")
    titleText = ''
    if(titleElement != null) {
        titleText = "&lt;ac:parameter ac:name=\"title\"&gt;${titleElement.text()}&lt;/ac:parameter&gt;"
        titleElement.remove()
    }
    block.after("&lt;ac:structured-macro ac:name=\"${type}\"&gt;${titleText}&lt;ac:rich-text-body&gt;${content}&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;")
    block.remove()
}

/*  #342-dierk42

    add labels to a Confluence page. Labels are taken from :keywords: which
    are converted as meta tags in HTML. Building the array: see below

    Confluence allows adding labels only after creation of a page.
    Therefore we need extra API calls.

    Currently the labels are added one by one. Suggestion for improvement:
    Build a label structure of all labels an place them with one call.

    Replaces exisiting labels. No harm
    Does not check for deleted labels when keywords are deleted from source
    document!
*/
def addLabels = { def pageId, def labelsArray -&gt;
    // Attach each label in a API call of its own. The only prefix possible
    // in our own Confluence is 'global'
    labelsArray.each { label -&gt;
        label_data = [
            prefix : 'global',
            name : label
        ]
        confluenceClient.addLabel(pageId, label_data)
        println "added label " + label + " to page ID " + pageId
    }
}


def uploadAttachment = { def pageId, String url, String fileName, String note -&gt;
    def is
    def localHash
    if (url.startsWith('http')) {
        is = new URL(url).openStream()
        //build a hash of the attachment
        localHash = MD5(new URL(url).openStream().text)
    } else {
        is = new File(url).newDataInputStream()
        //build a hash of the attachment
        localHash = MD5(new File(url).newDataInputStream().text)
    }

    def attachment = confluenceClient.getAttachment(pageId, fileName)
    if (attachment?.results) {
        // attachment exists. need an update?
        if (confluenceClient.attachmentHasChanged(attachment, localHash)) {
            //hash is different -&gt; attachment needs to be updated
            confluenceClient.updateAttachment(pageId, attachment.results[0].id, is, fileName, note, localHash)
            println "    updated attachment"
        }
    } else {
        confluenceClient.createAttachment(pageId, is, fileName, note, localHash)
    }
}

def realTitle(pageTitle){
    confluencePagePrefix + pageTitle + confluencePageSuffix
}

def rewriteMarks (body) {
    // Confluence strips out mark elements.  Replace them with default formatting.
    body.select('mark').wrap('&lt;span style="background:#ff0;color:#000"&gt;&lt;/style&gt;').unwrap()
}

// #352-LuisMuniz: Helper methods
// Fetch all pages of the defined config ancestorsIds. Only keep relevant info in the pages Map
// The map is indexed by lower-case title
def retrieveAllPages = { String spaceKey -&gt;
    // #938-mksiva: added a condition spaceKeyInput is null, if it is null, it means that, space key is different, so re fetch all pages.
    if (allPages != null &amp;&amp; spaceKeyInput == null) {
        println "allPages already retrieved"
        allPages
    } else {
        def pageIds = []
        def checkSpace = false
        int pageLimit = config.confluence.pageLimit ? config.confluence.pageLimit : 100
        config.confluence.input.each { input -&gt;
            if (!input.ancestorId) {
                // if one ancestorId is missing we should scan the whole space
                checkSpace = true;
                return
            }
            pageIds.add(input.ancestorId)
        }
        println (".")

        if(checkSpace) {
            allPages = confluenceClient.fetchPagesBySpaceKey(spaceKey, pageLimit)
        } else {
            allPages = confluenceClient.fetchPagesByAncestorId(pageIds, pageLimit)
        }
        allPages
    }
}


// Retrieve a page by id with contents and version
def retrieveFullPage = { String id -&gt;
    println("retrieving page with id " + id)
    confluenceClient.retrieveFullPageById(id)
}

//if a parent has been specified, check whether a page has the same parent.
boolean hasRequestedParent(Map existingPage, String requestedParentId) {
    if (requestedParentId) {
        existingPage.parentId == requestedParentId
    } else {
        true
    }
}

def rewriteDescriptionLists(body) {
    def TAGS = [ dt: 'th', dd: 'td' ]
    body.select('dl').each { dl -&gt;
        // WHATWG allows wrapping dt/dd in divs, simply unwrap them
        dl.select('div').each { it.unwrap() }

        // group dts and dds that belong together, usually it will be a 1:1 relation
        // but HTML allows for different constellations
        def rows = []
        def current = [dt: [], dd: []]
        rows &lt;&lt; current
        dl.select('dt, dd').each { child -&gt;
            def tagName = child.tagName()
            if (tagName == 'dt' &amp;&amp; current.dd.size() &gt; 0) {
                // dt follows dd, start a new group
                current = [dt: [], dd: []]
                rows &lt;&lt; current
            }
            current[tagName] &lt;&lt; child.tagName(TAGS[tagName])
            child.remove()
        }

        rows.each { row -&gt;
            def sizes = [dt: row.dt.size(), dd: row.dd.size()]
            def rowspanIdx = [dt: -1, dd: sizes.dd - 1]
            def rowspan = Math.abs(sizes.dt - sizes.dd) + 1
            def max = sizes.dt
            if (sizes.dt &lt; sizes.dd) {
                max = sizes.dd
                rowspanIdx = [dt: sizes.dt - 1, dd: -1]
            }
            (0..&lt;max).each { idx -&gt;
                def tr = dl.appendElement('tr')
                ['dt', 'dd'].each { type -&gt;
                    if (sizes[type] &gt; idx) {
                        tr.appendChild(row[type][idx])
                        if (idx == rowspanIdx[type] &amp;&amp; rowspan &gt; 1) {
                            row[type][idx].attr('rowspan', "${rowspan}")
                        }
                    } else if (idx == 0) {
                        tr.appendElement(TAGS[type]).attr('rowspan', "${rowspan}")
                    }
                }
            }
        }

        dl.wrap('&lt;table&gt;&lt;/table&gt;')
            .unwrap()
    }
}

def rewriteInternalLinks (body, anchors, pageAnchors) {
    // find internal cross-references and replace them with link macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith('#')) {
            def anchor = href.substring(1)
            def pageTitle = anchors[anchor] ?: pageAnchors[anchor]
            if (pageTitle &amp;&amp; a.text()) {
                // as Confluence insists on link texts to be contained
                // inside CDATA, we have to strip all HTML and
                // potentially loose styling that way.
                a.html(a.text())
                a.wrap("&lt;ac:link${anchors.containsKey(anchor) ? ' ac:anchor="' + anchor + '"' : ''}&gt;&lt;/ac:link&gt;")
                   .before("&lt;ri:page ri:content-title=\"${realTitle pageTitle}\"/&gt;")
                   .wrap("&lt;ac:plain-text-link-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-link-body&gt;")
                   .unwrap()
            }
        }
    }
}

def rewriteJiraLinks = { body -&gt;
    // find links to jira tickets and replace them with jira macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith(config.jira.api + "/browse/")) {
                def ticketId = a.text()
                a.before("""&lt;ac:structured-macro ac:name=\"jira\" ac:schema-version=\"1\"&gt;
                     &lt;ac:parameter ac:name=\"key\"&gt;${ticketId}&lt;/ac:parameter&gt;
                     &lt;ac:parameter ac:name=\"serverId\"&gt;${config.confluence.jiraServerId}&lt;/ac:parameter&gt;
                     &lt;/ac:structured-macro&gt;""")
                a.remove()
        }
    }
}

def rewriteOpenAPI (org.jsoup.nodes.Element body) {
    if (config.confluence.useOpenapiMacro == true || config.confluence.useOpenapiMacro == 'confluence-open-api') {
        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()
            code.parent()
                    .wrap('&lt;ac:structured-macro ac:name="confluence-open-api" ac:schema-version="1" ac:macro-id="1dfde21b-6111-4535-928a-470fa8ae3e7d"&gt;&lt;/ac:structured-macro&gt;')
                    .unwrap()
            code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
        }
    } else if (config.confluence.useOpenapiMacro == 'swagger-open-api') {
        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()
            code.parent()
                    .wrap('&lt;ac:structured-macro ac:name="swagger-open-api" ac:schema-version="1" ac:macro-id="f9deda8a-1375-4488-8ca5-3e10e2e4ee70"&gt;&lt;/ac:structured-macro&gt;')
                    .unwrap()
            code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
        }
    } else if (config.confluence.useOpenapiMacro == 'open-api') {
        def includeURL=null

        for (Element e : body.select('div .listingblock.openapi')) {
            for (String s : e.className().split(" ")) {
                if (s.startsWith("url")) {
                    //include the link to the URL for the macro
                    includeURL = s.replace('url:', '')
                }
            }
        }

        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()

            code.parent()
                .wrap('&lt;ac:structured-macro ac:name="open-api" ac:schema-version="1" data-layout="default" ac:macro-id="4302c9d8-fca4-4f14-99a9-9885128870fa"&gt;&lt;/ac:structured-macro&gt;')
                .unwrap()

            if (includeURL!=null)
            {
                code.before('&lt;ac:parameter ac:name="url"&gt;'+includeURL+'&lt;/ac:parameter&gt;')
            }
            else {
                //default: show download button
                code.before('&lt;ac:parameter ac:name="showDownloadButton"&gt;true&lt;/ac:parameter&gt;')
                code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
            }
        }
    }
}

def getEmbeddedImageData(src){
    def imageData = src.split("[;:,]")
    def fileExtension = imageData[1].split("/")[1]
    // treat svg+xml as svg to be able to create a file from the embedded image
    // more MIME types: https://www.iana.org/assignments/media-types/media-types.xhtml#image
    if(fileExtension == "svg+xml"){
        fileExtension = "svg"
    }
    return Map.of(
        "fileExtension", fileExtension,
        "encoding", imageData[2],
        "encodedContent", imageData[3]
    )
}

def handleEmbeddedImage(basePath, fileName, fileExtension, encodedContent) {
    def imageDir = "images/"
    if(config.imageDirs.size() &gt; 0){
        def dir = config.imageDirs.find { it -&gt;
            def configureImagesDir = it.replace('./', '/')
            Path.of(basePath, configureImagesDir, fileName).toFile().exists()
        }
        if(dir != null){
            imageDir = dir.replace('./', '/')
        }
    }

    if(!Path.of(basePath, imageDir, fileName).toFile().exists()){
        println "Could not find embedded image at a known location"
        def embeddedImagesLocation = "/confluence/images/"
        new File(basePath + embeddedImagesLocation).mkdirs()
        def imageHash = MD5(encodedContent)
        println "Embedded Image Hash " + imageHash
        def image = new File(basePath + embeddedImagesLocation + imageHash + ".${fileExtension}")
        if(!image.exists()){
            println "Creating image at " + basePath + embeddedImagesLocation
            image.withOutputStream {output -&gt;
                output.write(encodedContent.decodeBase64())}
        }
        fileName = imageHash + ".${fileExtension}"
        return Map.of(
            "filePath", image.canonicalPath,
            "fileName", fileName
        )
    } else {
        return Map.of(
            "filePath", basePath + imageDir + fileName,
            "fileName", fileName
        )
    }
}

//modify local page in order to match the internal confluence storage representation a bit better
//definition lists are not displayed by confluence, so turn them into tables
//body can be of type Element or Elements

def parseBody(body, anchors, pageAnchors) {
    def uploads = []
    rewriteOpenAPI body

    body.select('div.paragraph').unwrap()
    body.select('div.ulist').unwrap()
    //body.select('div.sect3').unwrap()
    [   'note':'info',
        'warning':'warning',
        'important':'warning',
        'caution':'note',
        'tip':'tip'            ].each { adType, cType -&gt;
        body.select('.admonitionblock.'+adType).each { block -&gt;
            parseAdmonitionBlock(block, cType)
        }
    }
    //special for the arc42-template
    body.select('div.arc42help').select('.content')
            .wrap('&lt;ac:structured-macro ac:name="expand"&gt;&lt;/ac:structured-macro&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;/ac:rich-text-body&gt;')
            .wrap('&lt;ac:structured-macro ac:name="info"&gt;&lt;/ac:structured-macro&gt;')
            .before('&lt;ac:parameter ac:name="title"&gt;arc42&lt;/ac:parameter&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;p&gt;&lt;/p&gt;&lt;/ac:rich-text-body&gt;')
    body.select('div.arc42help').unwrap()
    body.select('div.title').wrap("&lt;strong&gt;&lt;/strong&gt;").before("&lt;br /&gt;").wrap("&lt;div&gt;&lt;/div&gt;")
    body.select('div.listingblock').wrap("&lt;p&gt;&lt;/p&gt;").unwrap()
    // see if we can find referenced images and fetch them
    new File("tmp/images/.").mkdirs()
    // find images, extract their URLs for later uploading (after we know the pageId) and replace them with this macro:
    // &lt;ac:image ac:align="center" ac:width="500"&gt;
    // &lt;ri:attachment ri:filename="deployment-context.png"/&gt;
    // &lt;/ac:image&gt;

    body.select('img').each { img -&gt;
        def src = img.attr('src')
        def imgWidth = img.attr('width')?:500
        def imgAlign = img.attr('align')?:"center"

        //it is not an online image, so upload it to confluence and use the ri:attachment tag
        if(!src.startsWith("http")) {
            def sanitizedBaseUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')
            def newUrl
            def fileName
            //it is an embedded image
            if(src.startsWith("data:image")){
                def imageData = getEmbeddedImageData(src)
                def fileExtension = imageData.get("fileExtension")
                def encodedContent = imageData.get("encodedContent")
                fileName = img.attr('alt').replaceAll(/\s+/,"_").concat(".${fileExtension}")
                def embeddedImage = handleEmbeddedImage(sanitizedBaseUrl, fileName, fileExtension, encodedContent)
                newUrl = embeddedImage.get("filePath")
                fileName = embeddedImage.get("fileName")
            }else {
                newUrl = sanitizedBaseUrl + src
                fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
            }
            newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")
            println "    image: "+newUrl
            uploads &lt;&lt;  [0,newUrl,fileName,"automatically uploaded"]
            img.after("&lt;ac:image ac:align=\"${imgAlign}\" ac:width=\"${imgWidth}\"&gt;&lt;ri:attachment ri:filename=\"${fileName}\"/&gt;&lt;/ac:image&gt;")
        }
        // it is an online image, so we have to use the ri:url tag
        else {
            img.after("&lt;ac:image ac:align=\"imgAlign\" ac:width=\"${imgWidth}\"&gt;&lt;ri:url ri:value=\"${src}\"/&gt;&lt;/ac:image&gt;")
        }
        img.remove()
    }


    if(config.confluence.enableAttachments){
        attachmentPrefix = config.confluence.attachmentPrefix ? config.confluence.attachmentPrefix : 'attachment'
        body.select('a').each { link -&gt;

            def src = link.attr('href')
            println "    attachment src: "+src

            //upload it to confluence and use the ri:attachment tag
            if(src.startsWith(attachmentPrefix)) {
                def newUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')+src
                def fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
                newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")

                uploads &lt;&lt;  [0,newUrl,fileName,"automatically uploaded non-image attachment by docToolchain"]
                def uriArray=fileName.split("/")
                def pureFilename = uriArray[uriArray.length-1]
                def innerhtml = link.html()
                link.after("&lt;ac:structured-macro ac:name=\"view-file\" ac:schema-version=\"1\"&gt;&lt;ac:parameter ac:name=\"name\"&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
                link.after("&lt;ac:link&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;ac:plain-text-link-body&gt; &lt;![CDATA[\"${innerhtml}\"]]&gt;&lt;/ac:plain-text-link-body&gt;&lt;/ac:link&gt;")
                link.remove()

            }
        }
    }

    if(config.confluence.jiraServerId){
        rewriteJiraLinks body
    }

    rewriteMarks body
    rewriteDescriptionLists body
    rewriteInternalLinks body, anchors, pageAnchors
    //not really sure if must check here the type
    String bodyString = body
    if(body instanceof Element){
        bodyString = body.html()
    }
    Element saneHtml = new Document("")
        .outputSettings(new Document.OutputSettings().syntax(Document.OutputSettings.Syntax.xml).prettyPrint(false))
        .html(bodyString)
    def pageString = new HtmlTransformer().transformToConfluenceFormat(saneHtml)

    return Map.of(
        "page", pageString,
        "uploads", uploads
    )
}

def generateAndAttachToC(localPage) {
    def content
    if(config.confluence.disableToC){
        def prefix = (config.confluence.extraPageContent?:'')
        content  = prefix+localPage
    }else{
        def default_toc = '&lt;p&gt;&lt;ac:structured-macro ac:name="toc"/&gt;&lt;/p&gt;'
        def prefix = (config.confluence.tableOfContents?:default_toc)+(config.confluence.extraPageContent?:'')
        content  = prefix+localPage
        def default_children = '&lt;p&gt;&lt;ac:structured-macro ac:name="children"&gt;&lt;ac:parameter ac:name="sort"&gt;creation&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;&lt;/p&gt;'
        content += (config.confluence.tableOfChildren?:default_children)
    }
    def localHash = MD5(localPage)
    content += '&lt;ac:placeholder&gt;hash: #'+localHash+'#&lt;/ac:placeholder&gt;'
    return content
}



// the create-or-update functionality for confluence pages
// #342-dierk42: added parameter 'keywords'
def pushToConfluence = { pageTitle, pageBody, parentId, anchors, pageAnchors, keywords -&gt;
    parentId = parentId?.toString()

    def deferredUpload = []
    String realTitleLC = realTitle(pageTitle).toLowerCase()
    String realTitle = realTitle(pageTitle)

    //try to get an existing page
    def parsedBody = parseBody(pageBody, anchors, pageAnchors)
    localPage = parsedBody.get("page")
    deferredUpload.addAll(parsedBody.get("uploads"))
    def localHash = MD5(localPage)
    localPage = generateAndAttachToC(localPage)

    // #938-mksiva: Changed the 3rd parameter from 'config.confluence.spaceKey' to 'confluenceSpaceKey' as it was always taking the default spaceKey
    // instead of the one passed in the input for each row.
    def pages = retrieveAllPages(confluenceSpaceKey)
    println("pages retrieved")
    // println "Suche nach vorhandener Seite: " + pageTitle
    Map existingPage = pages[realTitleLC]
    def page

    if (existingPage) {
        if (hasRequestedParent(existingPage, parentId)) {
            page = retrieveFullPage(existingPage.id as String)
        } else {
            page = null
        }
    } else {
        page = null
    }
    // println "Gefunden: " + page.id + " Titel: " + page.title

    if (page) {
        println "found existing page: " + page.id +" version "+page.version.number

        //extract hash from remote page to see if it is different from local one
        def remotePage = page.body.storage.value.toString().trim()

        def remoteHash = remotePage =~ /(?ms)hash: #([^#]+)#/
        remoteHash = remoteHash.size()==0?"":remoteHash[0][1]

        // println "remoteHash: " + remoteHash
        // println "localHash:  " + localHash

        if (remoteHash == localHash) {
            println "page hasn't changed!"
            deferredUpload.each {
                uploadAttachment(page?.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        } else {
            def newPageVersion = (page.version.number as Integer) + 1

            confluenceClient.updatePage(
                    page.id,
                    realTitle,
                    confluenceSpaceKey,
                    localPage,
                    newPageVersion,
                    config.confluence.pageVersionComment ?: '',
                    parentId
            )
            println "&gt; updated page "+page.id
            deferredUpload.each {
                uploadAttachment(page.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        }
    } else {
        //#352-LuisMuniz if the existing page's parent does not match the requested parentId, fail
        if (existingPage &amp;&amp; !hasRequestedParent(existingPage, parentId)) {
            throw new IllegalArgumentException("Cannot create page, page with the same "
                    + "title=${existingPage.title} "
                    + "with id=${existingPage.id} already exists in the space. "
                    + "A Confluence page title must be unique within a space, consider specifying a 'confluencePagePrefix' in ConfluenceConfig.groovy")
        }
        //create a page
        page = confluenceClient.createPage(
                realTitle,
                confluenceSpaceKey,
                localPage,
                config.confluence.pageVersionComment ?: '',
                parentId
        )
        println "&gt; created page "+page?.id
        deferredUpload.each {
            uploadAttachment(page?.id, it[1], it[2], it[3])
        }
        deferredUpload = []
        // #324-dierk42: Add keywords as labels to page.
        if (keywords) {
            addLabels(page?.id, keywords)
        }
        return page?.id
    }
}

def parseAnchors(page) {
    def anchors = [:]
    page.body.select('[id]').each { anchor -&gt;
        def name = anchor.attr('id')
        anchors[name] = page.title
        anchor.before("&lt;ac:structured-macro ac:name=\"anchor\"&gt;&lt;ac:parameter ac:name=\"\"&gt;${name}&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
    }
    anchors
}

def pushPages
pushPages = { pages, anchors, pageAnchors, labels -&gt;
    pages.each { page -&gt;
        page.title = page.title.trim()
        println page.title
        def id = pushToConfluence page.title, page.body, page.parent, anchors, pageAnchors, labels
        page.children*.parent = id
        // println "Push children von id " + id
        pushPages page.children, anchors, pageAnchors, labels
        // println "Ende Push children von id " + id
    }
}

def recordPageAnchor(head) {
    def a = [:]
    if (head.attr('id')) {
        a[head.attr('id')] = head.text()
    }
    a
}

def promoteHeaders(tree, start, offset) {
    (start..7).each { i -&gt;
        tree.select("h${i}").tagName("h${i-offset}").before('&lt;br /&gt;')
    }
}

def retrievePageIdByName = { String name -&gt;
    def data = confluenceClient.retrievePageIdByName(name, confluenceSpaceKey)
    return data?.results?.get(0)?.id
}

def getPagesRecursive(Element element, String parentId, Map anchors, Map pageAnchors, int level, int maxLevel) {
    def pages = []
    element.select("div.sect${level}").each { sect -&gt;
        def title = sect.select("h${level + 1}").text()
        pageAnchors.putAll(recordPageAnchor(sect.select("h${level + 1}")))
        Elements pageBody
        if (level == 1) {
            pageBody = sect.select('div.sectionbody')
        } else {
            pageBody = new Elements(sect)
            pageBody.select("h${level + 1}").remove()
        }
        def currentPage = [
            title: title,
            body: pageBody,
            children: [],
            parent: parentId
        ]

        if (maxLevel &gt; level) {
            currentPage.children.addAll(getPagesRecursive(sect, null, anchors, pageAnchors, level + 1, maxLevel))
            pageBody.select("div.sect${level + 1}").remove()
        } else {
            pageBody.select("div.sect${level + 1}").unwrap()
        }
        promoteHeaders sect, level + 2, level + 1
        pages &lt;&lt; currentPage
        anchors.putAll(parseAnchors(currentPage))
    }
    return pages
}

def getPages(Document dom, String parentId, int maxLevel) {
    def anchors = [:]
    def pageAnchors = [:]
    def sections = pages = []
    def title = dom.select('h1').text()
    if (maxLevel &lt;= 0) {
        dom.select('div#content').each { pageBody -&gt;
            pageBody.select('div.sect2').unwrap()
            promoteHeaders pageBody, 2, 1
            def page = [title   : title,
                        body    : pageBody,
                        children: [],
                        parent  : parentId]
            pages &lt;&lt; page
            sections = page.children
            parentId = null
            anchors.putAll(parseAnchors(page))
        }
    } else {
        // let's try to select the "first page" and push it to confluence
        dom.select('div#preamble div.sectionbody').each { pageBody -&gt;
            pageBody.select('div.sect2').unwrap()
            def preamble = [
                title: title,
                body: pageBody,
                children: [],
                parent: parentId
            ]
            pages &lt;&lt; preamble
            sections = preamble.children
            parentId = null
            anchors.putAll(parseAnchors(preamble))
        }
        sections.addAll(getPagesRecursive(dom, parentId, anchors, pageAnchors, 1, maxLevel))
    }
    return [pages, anchors, pageAnchors]
}

if(config.confluence.inputHtmlFolder) {
    htmlFolder = "${docDir}/${config.confluence.inputHtmlFolder}"
    println "Starting processing files in folder: " + config.confluence.inputHtmlFolder
    def dir = new File(htmlFolder)

    dir.eachFileRecurse (FILES) { fileName -&gt;
        if (fileName.isFile()){
            def map = [file: config.confluence.inputHtmlFolder+fileName.getName()]
            config.confluence.input.add(map)
        }
    }
}

config.confluence.input.each { input -&gt;
    // TODO check why this is necessary
    if(input.file) {
        input.file = confluenceService.checkAndBuildCanonicalFileName(input.file)
        //  assignend, but never used in pushToConfluence(...) (fixed here)
        // #938-mksiva: assign spaceKey passed for each file in the input
        spaceKeyInput = input.spaceKey
        confluenceSpaceKey = input.spaceKey ?: config.confluence.spaceKey
        confluenceCreateSubpages = (input.createSubpages != null) ? input.createSubpages : config.confluence.createSubpages
        confluenceAllInOnePage = (input.allInOnePage != null) ? input.allInOnePage : config.confluence.allInOnePage
        if (!(confluenceCreateSubpages instanceof ConfigObject &amp;&amp; confluenceAllInOnePage instanceof ConfigObject)) {
            println "ERROR:"
            println "Deprecated configuration, migrate as follows:"
            println "allInOnePage = true -&gt; subpagesForSections = 0"
            println "allInOnePage = false &amp;&amp; createSubpages = false -&gt; subpagesForSections = 1"
            println "allInOnePage = false &amp;&amp; createSubpages = true -&gt; subpagesForSections = 2"
            throw new RuntimeException("config problem")
        }
        confluenceSubpagesForSections = (input.subpagesForSections != null) ? input.subpagesForSections : config.confluence.subpagesForSections
        if (confluenceSubpagesForSections instanceof ConfigObject) {
            confluenceSubpagesForSections = 1
        }
    //  hard to read in case of using :sectnums: -&gt; so we add a suffix
        confluencePagePrefix = input.pagePrefix ?: config.confluence.pagePrefix
    //  added
        confluencePageSuffix = input.pageSuffix ?: config.confluence.pageSuffix
        confluencePreambleTitle = input.preambleTitle ?: config.confluence.preambleTitle
        if (!(confluencePreambleTitle instanceof ConfigObject)) {
            println "ERROR:"
            println "Deprecated configuration, use first level heading in document instead of preambleTitle configuration"
            throw new RuntimeException("config problem")
        }
        File htmlFile = new File(input.file)
        baseUrl = htmlFile
        Document dom = confluenceService.parseFile(htmlFile)

        // if ancestorName is defined try to find machingAncestorId in confluence
        def retrievedAncestorId
        if (input.ancestorName) {
            // Retrieve a page id by name
            retrievedAncestorId = retrievePageIdByName(input.ancestorName)
            println("Retrieved pageId for given ancestorName '${input.ancestorName}' is ${retrievedAncestorId}")
        }
        // if input does not contain an ancestorName, check if there is ancestorId, otherwise check if there is a global one
        def parentId = retrievedAncestorId ?: input.ancestorId ?: config.confluence.ancestorId

        // if parentId is still not set, create a new parent page (parentId = null)
        parentId = parentId ?: null
        //println("ancestorName: '${input.ancestorName}', ancestorId: ${input.ancestorId} ---&gt; final parentId: ${parentId}")

        // #342-dierk42: get the keywords from the meta tags
        def keywords = confluenceService.getKeywords(dom)

        def (pages, anchors, pageAnchors) = getPages(dom, parentId, confluenceSubpagesForSections)
        pushPages pages, anchors, pageAnchors, keywords
        if (parentId) {
            println "published to ${config.confluence.api - "rest/api/"}/spaces/${confluenceSpaceKey}/pages/${parentId}"
        } else {
            println "published to ${config.confluence.api - "rest/api/"}/spaces/${confluenceSpaceKey}"
        }
    }
}
""</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_converttodocx">14. convertToDocx</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_before_you_begin">14.1. Before You Begin</h3>
<div class="paragraph">
<p>Before using this task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install <a href="https://pandoc.org">pandoc</a>.</p>
</li>
<li>
<p>Ensure that 'docbook' and 'docx' are added to the inputFiles formats in Config.groovy.</p>
</li>
<li>
<p>As an optional step, specify a reference doc file with custom stylesheets (see task <a href="03_task_createReferenceDoc.html"><code>createReferenceDoc</code></a>).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_4">14.2. Further Reading and Resources</h3>
<div class="paragraph">
<p>Read the <a href="https://rdmueller.github.io/create-docx/">Render AsciiDoc to docx (MS Word)</a> blog post.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_12">14.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/pandoc.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/pandoc.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/pandoc.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task convertToDocx (
        group: 'docToolchain',
        description: 'converts file to .docx via pandoc. Needs pandoc installed.',
        type: Exec
) {
    // All files with option `docx` in config.groovy is converted to docbook and then to docx.
    def sourceFilesDocx = sourceFiles.findAll { 'docx' in it.formats }
    def explicitSourceFilesCount = sourceFilesDocx.size()
    if(explicitSourceFilesCount==0){
        sourceFilesDocx = sourceFiles.findAll { 'docbook' in it.formats }
    }
    sourceFilesDocx.each {
        def sourceFile = it.file.replace('.adoc', '.xml')
        def targetFile = sourceFile.replace('.xml', '.docx')

        new File("$targetDir/docx/$targetFile")
            .getParentFile()
            .getAbsoluteFile().mkdirs()

        workingDir "$targetDir/docbook"
        executable = "pandoc"

        def pandocOptions = config.pandocOptions ?: []

        if(referenceDocFile?.trim()) {
            args = ["-r","docbook",
                    "-t","docx",
                    "-o","../docx/$targetFile",
                    *pandocOptions,
                    "--reference-doc=${docDir}/${referenceDocFile}",
                    sourceFile]
        } else {
            args = ["-r","docbook",
                    "-t","docx",
                    "-o","./../docx/$targetFile",
                    *pandocOptions,
                    sourceFile]
        }
    }
    doFirst {
        if(sourceFilesDocx.size()==0){
            throw new Exception ("""
            &gt;&gt; No source files defined for type 'docx'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
        if(explicitSourceFilesCount==0) {
            logger.warn('WARNING: No source files defined for type "docx". Converting with best effort')
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_createreferencedoc">15. createReferenceDoc</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_before_you_begin_2">15.1. Before You Begin</h3>
<div class="paragraph">
<p>Install <a href="https://pandoc.org">pandoc</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_12">15.2. About This Task</h3>
<div class="paragraph">
<p>This task creates a reference docx file used by <a href="https://pandoc.org">pandoc</a> during docbook-to-docx conversion.
Use task <a href="03_task_convertToDocx.html"><code>convertToDocx</code></a> to edit this file so it uses your preferred styles.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The contents of the reference docx are ignored, but its stylesheets and document properties (including margins, page size, header and footer) are used in the new docx.
For more information, see Pandoc User&#8217;s Guide: <a href="https://pandoc.org/MANUAL.html#options-affecting-specific-writers">Options affecting specific writers (--reference-doc)</a>
And if you have problems with changing the default table style: see <a href="https://github.com/jgm/pandoc/issues/3275" class="bare">https://github.com/jgm/pandoc/issues/3275</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_config_groovy_notes">15.3. Config.groovy Notes</h3>
<div class="paragraph">
<p>The 'referenceDocFile' property must be set to your custom reference file in Config.groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">inputPath = '.'

// use a style reference file in the input path for conversion from docbook to docx
referenceDocFile = "${inputPath}/my-ref-file.docx"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_13">15.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/pandoc.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/pandoc.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/pandoc.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task createReferenceDoc (
        group: 'docToolchain helper',
        description: 'creates a docx file to be used as a format style reference in task convertToDocx. Needs pandoc installed.',
        type: Exec
) {
    workingDir "$docDir"
    executable = "pandoc"
    args = ["-o", "${docDir}/${referenceDocFile}",
            "--print-default-data-file",
            "reference.docx"]

    doFirst {
        if(!(referenceDocFile?.trim())) {
            throw new GradleException("Option `referenceDocFile` is not defined in config.groovy or has an empty value.")
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_converttoepub">16. convertToEpub</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_dependency">16.1. Dependency</h3>
<div class="paragraph">
<p><a href="03_task_generateDocBook.html"><code>generateDocBook</code></a></p>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_13">16.2. About This Task</h3>
<div class="paragraph">
<p>This task uses <a href="https://pandoc.org">pandoc</a> to convert the DocBook output from AsciiDoctor to ePub.
This publishes the output as an eBook which can be read using any eBook reader.
The resulting file can be found in <code>build/docs/epub</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_5">16.3. Further Reading and Resources</h3>
<div class="paragraph">
<p><a href="https://rdmueller.github.io/create-epub/">Turn your Document into an Audio-Book</a> blog post.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_14">16.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/pandoc.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/pandoc.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/pandoc.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/pandoc.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task convertToEpub (
        group: 'docToolchain',
        description: 'converts file to .epub via pandoc. Needs pandoc installed.',
        type: Exec
) {
    // All files with option `epub` in config.groovy is converted to docbook and then to epub.
    def sourceFilesEpub = sourceFiles.findAll { 'epub' in it.formats }
    def explicitSourceFilesCount = sourceFilesEpub.size()
    if(explicitSourceFilesCount==0){
        sourceFilesEpub = sourceFiles.findAll { 'docbook' in it.formats }
    }
    sourceFilesEpub.each {
        def sourceFile = it.file.replace('.adoc', '.xml')
        def targetFile = sourceFile.replace('.xml', '.epub')

        new File("$targetDir/epub/$targetFile")
            .getParentFile()
            .getAbsoluteFile().mkdirs()

        workingDir "$targetDir/docbook"
        executable = "pandoc"
        args = ['-r','docbook',
                '-t','epub',
                '-o',"../epub/$targetFile",
                sourceFile]
    }
    doFirst {
        if(sourceFilesEpub.size()==0){
            throw new Exception ("""
            &gt;&gt; No source files defined for type 'epub'.
            &gt;&gt; Please specify at least one inputFile in your docToolchainConfig.groovy
            """)
        }
        if(explicitSourceFilesCount==0) {
            logger.warn('WARNING: No source files defined for type "epub". Converting with best effort')
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportea">17. exportEA</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/8a8d424110b84c60a6e502b582d78216?d=identicon" alt="rmi2hi" width="32" height="32" title="rmi2hi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>4 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_14">17.1. About This Task</h3>
<div class="paragraph">
<p>By default, no special configuration is necessary.
However, several optional parameter configurations are available to support a project and packages to be used for export.
These parameters can be used independently from one another.
A sample of how to edit your projects' Config.groovy is provided in the 'Config.groovy' of the docToolchain project itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_important">17.2. Important</h3>
<div class="paragraph">
<p>Currently this feature is WINDOWS-only. See <a href="https://github.com/docToolchain/docToolchain/issues/231">this related issue</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_optional_parameter_configurations_2">17.3. The Optional Parameter Configurations</h3>
<div class="sect3">
<h4 id="_connection">17.3.1. connection</h4>
<div class="paragraph">
<p>Either set the connection to a certain project, or comment it out to use all project files inside the src folder or its child folder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_packagefilter">17.3.2. packageFilter</h4>
<div class="paragraph">
<p>Add one or multiple packageGUIDs to be used for export. All packages are analysed, if no packageFilter is set.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exportpath">17.3.3. exportPath</h4>
<div class="paragraph">
<p>Relative path to base 'docDir' to which the diagrams and notes are to be exported.
Default: "src/docs".
Example: docDir = 'D:\work\mydoc\' ; exportPath = 'src/pdocs' ;
Images will be exported to 'D:\work\mydoc\src\pdocs\images\ea',
Notes will be exported to 'D:\work\mydoc\src\pdocs\ea',</p>
</div>
</div>
<div class="sect3">
<h4 id="_searchpath">17.3.4. searchPath</h4>
<div class="paragraph">
<p>Relative path to base 'docDir', in which Enterprise Architect project files are searched
Default: "src/docs".
Example: docDir = 'D:\work\mydoc\' ; exportPath = 'src/projects' ;
Lookup for eap and eapx files starts in 'D:\work\mydoc\src\projects' and goes down the folder structure.
<strong>Note</strong>: In case parameter 'connection' is already defined, the searchPath value is also used.
exportEA starts opening the database parameter 'connection' first then looks for
further project files either in the searchPath (if set) or in the docDir folder of the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_glossaryasciidocformat">17.3.5. glossaryAsciiDocFormat</h4>
<div class="paragraph">
<p>Whether the EA project glossary is exported depends on this parameter.
If not set or an empty string, no glossary is exported.
The glossaryAsciiDocFormat string is used to format each glossary entry in a
certain AsciiDoc format.</p>
</div>
<div class="paragraph">
<p>The following placeholders are defined for the format string: ID, TERM, MEANING, TYPE.
One or more can be used by the output format. For example:</p>
</div>
<div class="paragraph">
<p>A valid output format is to include the glossary as a flat list.
The file can be included where needed in the documentation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>glossaryAsciiDocFormat = "TERM:: MEANING"</pre>
</div>
</div>
<div class="paragraph">
<p>Other format strings can be used to include it as a table row.
The glossary terms are sorted in alphabetical order.</p>
</div>
</div>
<div class="sect3">
<h4 id="_glossarytypes">17.3.6. glossaryTypes</h4>
<div class="paragraph">
<p>This parameter is used in case a glossaryAsciiDocFormat is defined, otherwise it
is not evaluated. It&#8217;s used to filter for certain types.
If the glossaryTypes list is empty, all entries will be used.
For example:</p>
</div>
<div class="paragraph">
<p>glossaryTypes = ["Business", "Technical"]</p>
</div>
</div>
<div class="sect3">
<h4 id="_diagramattributes">17.3.7. diagramAttributes</h4>
<div class="paragraph">
<p>If set, the string is used to create and store diagram attributes to be included in the document alongside a diagram.
These placeholders are defined and populated with the diagram attributes, if used in the
diagramAttributes string:</p>
</div>
<div class="paragraph">
<p><code>%DIAGRAM_AUTHOR%</code>,<br>
<code>%DIAGRAM_CREATED%</code>,<br>
<code>%DIAGRAM_GUID%</code>,<br>
<code>%DIAGRAM_MODIFIED%</code>,<br>
<code>%DIAGRAM_NAME%</code>,<br>
<code>%DIAGRAM_NOTES%</code>,<br>
<code>%DIAGRAM_DIAGRAM_TYPE%</code>,<br>
<code>%DIAGRAM_VERSION%</code>,<br>
<code>%NEWLINE%</code><br></p>
</div>
<div class="paragraph">
<p>Example: diagramAttributes = "Last modification: %DIAGRAM_MODIFIED%%NEWLINE%Version: %DIAGRAM_VERSION%"</p>
</div>
<div class="paragraph">
<p>You can add the string %NEWLINE% where a line break will be added.
The resulting text is stored next to the diagram image using the same path and file name, but a different file extension (.ad). This can be included in the document if required.
If diagramAttributes is not set or an empty string, no file is written.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imageformat">17.3.8. imageFormat</h4>
<div class="paragraph">
<p>If set, the set image format is used to export the diagrams.
Default is set to ".png".</p>
</div>
<div class="paragraph">
<p>Please check your Enterprise Architect version which formats are supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_additionaloptions">17.3.9. additionalOptions</h4>
<div class="paragraph">
<p>This parameter is used to define the specific behavior of the export. Currently, these options are supported:</p>
</div>
<div class="paragraph">
<p><code>KeepFirstDiagram</code></p>
</div>
<div class="paragraph">
<p>If diagrams are not uniquely named, the last diagram will be saved. If you want to prevent diagrams from being overwritten, add this parameter to additionalOptions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_glossary_export">17.4. Glossary export</h3>
<div class="paragraph">
<p>By setting the glossaryAsciiDocFormat, the glossary terms stored in the EA project
will be exported into a folder named 'glossary' below the configured exportPath.
In case multiple EA projects are found for export, one glossary per project is
exported - each named using the project&#8217;s GUID plus extension '.ad'.</p>
</div>
<div class="paragraph">
<p>Each individual file will be filtered (see glossaryTypes) and sorted in alphabetical order.
In addition, a global glossary is created by using all single glossary files.
This global file is named 'glossary.ad' and is also placed in the glossary folder.
The global glossary is also filtered and sorted.
If there is only one EA project, only the global glossary is written.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_6">17.5. Further Reading and Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://rdmueller.github.io/jria2eac/">JIRA to Sparx EA</a> blog post.</p>
</li>
<li>
<p><a href="https://rdmueller.github.io/sparx-ea/">Did you Ever Wish you Had Better Diagrams?</a> blog post.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_15">17.6. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportEA.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportEA.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportEA.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportEA.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportEA(
        dependsOn: [streamingExecute],
        description: 'exports all diagrams and some texts from EA files',
        group: 'docToolchain'
) {
    doFirst {
    }
    doLast {
        logger.info("docToolchain &gt; exportEA: " + docDir)
        logger.info("docToolchain &gt; exportEA: " + mainConfigFile)
        def configFile = new File(docDir, mainConfigFile)
        def config = new ConfigSlurper().parse(configFile.text)
        def scriptParameterString = ""
        def exportPath = ""
        def searchPath = ""
        def glossaryPath = ""
        def readme = """This folder contains exported diagrams or notes from Enterprise Architect.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder	will be overwritten with each re-export!**

use `gradle exportEA` to re-export files
"""

        if (!config.exportEA.connection.isEmpty()) {
            logger.info("docToolchain &gt; exportEA: found " + config.exportEA.connection)
            scriptParameterString = scriptParameterString + "-c \"${config.exportEA.connection}\""
        }
        if (!config.exportEA.packageFilter.isEmpty()) {
            def packageFilterToCreate = config.exportEA.packageFilter as List
            logger.info("docToolchain &gt; exportEA: package filter list size: " + packageFilterToCreate.size())
            packageFilterToCreate.each { packageFilter -&gt;
                scriptParameterString = scriptParameterString + " -p \"${packageFilter}\""
            }
        }
        if (!config.exportEA.exportPath.isEmpty()) {
            exportPath = new File(docDir, config.exportEA.exportPath).getAbsolutePath()
        } else {
            exportPath = new File(docDir, 'src/docs').getAbsolutePath()
        }
        if (!config.exportEA.searchPath.isEmpty()) {
            searchPath = new File(docDir, config.exportEA.searchPath).getAbsolutePath()
        }
        else if (!config.exportEA.absoluteSearchPath.isEmpty()) {
        searchPath = new File(config.exportEA.absoluteSearchPath).getAbsolutePath()
        }
        else {
            searchPath = new File(docDir, 'src').getAbsolutePath()
        }
        if (config.exportEA.imageFormat.isEmpty()) {
            imageFormat = ".png"
        } else if(!config.exportEA.imageFormat.startsWith(".")) {
            imageFormat = "." + config.exportEA.imageFormat
        } else {
            imageFormat = config.exportEA.imageFormat
        }
        scriptParameterString = scriptParameterString + " -d \"$exportPath\""
        scriptParameterString = scriptParameterString + " -s \"$searchPath\""
        scriptParameterString = scriptParameterString + " -f \"$imageFormat\""
        logger.info("docToolchain &gt; exportEA: exportPath: " + exportPath)

        //remove old glossary files/folder if exist
        new File(exportPath, 'glossary').deleteDir()
        //set the glossary file path in case an output format is configured, other no glossary is written
        if (!config.exportEA.glossaryAsciiDocFormat.isEmpty()) {
            //create folder to store glossaries
            new File(exportPath, 'glossary/.').mkdirs()
            glossaryPath = new File(exportPath, 'glossary').getAbsolutePath()
            scriptParameterString = scriptParameterString + " -g \"$glossaryPath\""
        }
        //configure additional diagram attributes to be exported
        if (!config.exportEA.diagramAttributes.isEmpty()) {
            scriptParameterString = scriptParameterString + " -da \"$config.exportEA.diagramAttributes\""
        }
        //configure additional diagram attributes to be exported
        if (!config.exportEA.additionalOptions.isEmpty()) {
            scriptParameterString = scriptParameterString + " -ao \"$config.exportEA.additionalOptions\""
        }
        //make sure path for notes exists
        //and remove old notes
        new File(exportPath, 'ea').deleteDir()
        //also remove old diagrams
        new File(exportPath, 'images/ea').deleteDir()

        //create a readme to clarify things
        new File(exportPath, 'images/ea/.').mkdirs()
        new File(exportPath, 'images/ea/readme.ad').write(readme)
        new File(exportPath, 'ea/.').mkdirs()
        new File(exportPath, 'ea/readme.ad').write(readme)

        //execute through cscript in order to make sure that we get WScript.echo right
        logger.info("docToolchain &gt; exportEA: parameters: " + scriptParameterString)
        "%SystemRoot%\\System32\\cscript.exe //nologo ${projectDir}/scripts/exportEAP.vbs ${scriptParameterString}".executeCmd()
        //the VB Script is only capable of writing iso-8859-1-Files.
        //we now have to convert them to UTF-8
        new File(exportPath, 'ea/.').eachFileRecurse { file -&gt;
            if (file.isFile()) {
                println "exported notes " + file.canonicalPath
                file.write(file.getText('iso-8859-1'), 'utf-8')
            }
        }

        //sort, filter and reformat a glossary if an output format is configured
        if (!config.exportEA.glossaryAsciiDocFormat.isEmpty()) {
            def glossaryTypes

            if (!config.exportEA.glossaryTypes.isEmpty()) {
                glossaryTypes = config.exportEA.glossaryTypes as List
            }
            new GlossaryHandler().execute(glossaryPath, config.exportEA.glossaryAsciiDocFormat, glossaryTypes);
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">Show source code of <code>scripts/exportEAP.vbs</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportEAP.vbs" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportEAP.vbs</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportEAP.vbs</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="vbscript">    ' based on the "Project Interface Example" which comes with EA
    ' http://stackoverflow.com/questions/1441479/automated-method-to-export-enterprise-architect-diagrams



    Dim EAapp 'As EA.App
    Dim Repository 'As EA.Repository
    Dim FS 'As Scripting.FileSystemObject

    Dim projectInterface 'As EA.Project

    Const   ForAppending = 8
    Const   ForWriting = 2

    ' Helper
    ' http://windowsitpro.com/windows/jsi-tip-10441-how-can-vbscript-create-multiple-folders-path-mkdir-command
    Function MakeDir (strPath)
      Dim strParentPath, objFSO
      Set objFSO = CreateObject("Scripting.FileSystemObject")
      On Error Resume Next
      strParentPath = objFSO.GetParentFolderName(strPath)

      If Not objFSO.FolderExists(strParentPath) Then MakeDir strParentPath
      If Not objFSO.FolderExists(strPath) Then objFSO.CreateFolder strPath
      On Error Goto 0
      MakeDir = objFSO.FolderExists(strPath)
    End Function

    ' Replaces certain characters with '_' to avoid unwanted file or folder names causing errors or structure failures.
    ' Regular expression can easily be extended with further characters to be replaced.
    Function NormalizeName(theName)
       dim re : Set re = new regexp
       re.Pattern = "[\\/\[\]\s:]"
       re.Global = True
       NormalizeName = re.Replace(theName, "_")
    End Function

    Sub WriteNote(currentModel, currentElement, notes, prefix)
        If (Left(notes, 6) = "{adoc:") Then
            strFileName = Trim(Mid(notes,7,InStr(notes,"}")-7))
            strNotes = Right(notes,Len(notes)-InStr(notes,"}"))
            set objFSO = CreateObject("Scripting.FileSystemObject")
            If (currentModel.Name="Model") Then
              ' When we work with the default model, we don't need a sub directory
              path = objFSO.BuildPath(exportDestination,"ea/")
            Else
              path = objFSO.BuildPath(exportDestination,"ea/"&amp;NormalizeName(currentModel.Name)&amp;"/")
            End If
            MakeDir(path)

            post = ""
            If (prefix&lt;&gt;"") Then
                post = "_"
            End If
            MakeDir(path&amp;prefix&amp;post)

            set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;post&amp;"/"&amp;strFileName&amp;".ad",ForAppending, True)
            name = currentElement.Name
            name = Replace(name,vbCr,"")
            name = Replace(name,vbLf,"")

            strCombinedNotes = "_all_notes.ad"
            set objCombinedNotesFile = objFSO.OpenTextFile(path&amp;prefix&amp;post&amp;"/"&amp;strCombinedNotes,ForAppending, True)

            if (Left(strNotes, 3) = vbCRLF&amp;"|") Then
                ' content should be rendered as table - so don't interfere with it
                objFile.WriteLine(vbCRLF)
                objCombinedNotesFile.WriteLine(vbCRLF)
            else
                'let's add the name of the object
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name)
                objCombinedNotesFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name)
            End If
            objFile.WriteLine(vbCRLF&amp;strNotes)
            objFile.Close
            objCombinedNotesFile.WriteLine(vbCRLF&amp;strNotes)
            objCombinedNotesFile.Close
            if (prefix&lt;&gt;"") Then
                ' write the same to a second file
                set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;".ad",ForAppending, True)
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name&amp;vbCRLF&amp;strNotes)
                objFile.Close
            End If
        End If
    End Sub

    Sub SyncJira(currentModel, currentDiagram)
        notes = currentDiagram.notes
        set currentPackage = Repository.GetPackageByID(currentDiagram.PackageID)
        updated = 0
        created = 0
        If (Left(notes, 6) = "{jira:") Then
            WScript.echo " &gt;&gt;&gt;&gt; Diagram jira tag found"
            strSearch = Mid(notes,7,InStr(notes,"}")-7)
            Set objShell = CreateObject("WScript.Shell")
            'objShell.CurrentDirectory = fso.GetFolder("./scripts")
            Set objExecObject = objShell.Exec ("cmd /K  groovy ./scripts/exportEAPJiraPrintHelper.groovy """ &amp; strSearch &amp;""" &amp; exit")
            strReturn = ""
            x = 0
            y = 0
            Do While Not objExecObject.StdOut.AtEndOfStream
                output = objExecObject.StdOut.ReadLine()
                ' WScript.echo output
                jiraElement = Split(output,"|")
                name = jiraElement(0)&amp;":"&amp;vbCR&amp;vbLF&amp;jiraElement(4)
                On Error Resume Next
                Set requirement = currentPackage.Elements.GetByName(name)
                On Error Goto 0
                if (IsObject(requirement)) then
                    ' element already exists
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    updated = updated + 1
                else
                    Set requirement = currentPackage.Elements.AddNew(name,"Requirement")
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    currentPackage.Elements.Refresh()
                    Set dia_obj = currentDiagram.DiagramObjects.AddNew("l="&amp;(10+x*200)&amp;";t="&amp;(10+y*50)&amp;";b="&amp;(10+y*50+44)&amp;";r="&amp;(10+x*200+180),"")
                    x = x + 1
                    if (x&gt;3) then
                      x = 0
                      y = y + 1
                    end if
                    dia_obj.ElementID = requirement.ElementID
                    dia_obj.Update()
                    created = created + 1
                end if
            Loop
            Set objShell = Nothing
            WScript.echo "created "&amp;created&amp;" requirements"
            WScript.echo "updated "&amp;updated&amp;" requirements"
        End If
    End Sub

    ' This sub routine checks if the format string defined in diagramAttributes
    ' does contain any characters. It replaces the known placeholders:
    ' %DIAGRAM_AUTHOR%, %DIAGRAM_CREATED%, %DIAGRAM_GUID%, %DIAGRAM_MODIFIED%,
    ' %DIAGRAM_NAME%, %DIAGRAM_NOTES%, %DIAGRAM_DIAGRAM_TYPE%, %DIAGRAM_VERSION%
    ' with the attribute values read from the EA diagram object.
    ' None, one or multiple number of placeholders can be used to create a diagram attribute
    ' to be added to the document. The attribute string is stored as a file with the same
    ' path and name as the diagram image, but with suffix .ad. So, it can
    ' easily be included in an asciidoc file.
    Sub SaveDiagramAttribute(currentDiagram, path, diagramName)
        If Len(diagramAttributes) &gt; 0 Then
            filledDiagAttr = diagramAttributes
            set objFSO = CreateObject("Scripting.FileSystemObject")
            filename = objFSO.BuildPath(path, diagramName &amp; ".ad")
            set objFile = objFSO.OpenTextFile(filename, ForWriting, True)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_AUTHOR%",       currentDiagram.Author)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_CREATED%",      currentDiagram.CreatedDate)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_GUID%",         currentDiagram.DiagramGUID)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_MODIFIED%",     currentDiagram.ModifiedDate)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_NAME%",         currentDiagram.Name)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_NOTES%",        currentDiagram.Notes)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_DIAGRAM_TYPE%", currentDiagram.Type)
            filledDiagAttr = Replace(filledDiagAttr, "%DIAGRAM_VERSION%",      currentDiagram.Version)
            filledDiagAttr = Replace(filledDiagAttr, "%NEWLINE%",              vbCrLf)
            objFile.WriteLine(filledDiagAttr)
            objFile.Close
        End If
    End Sub
    Sub SaveDiagram(currentModel, currentDiagram)
        Dim exportDiagram ' As Boolean

        ' Open the diagram
        Repository.OpenDiagram(currentDiagram.DiagramID)

        ' Save and close the diagram
        set objFSO = CreateObject("Scripting.FileSystemObject")
        If (currentModel.Name="Model") Then
            ' When we work with the default model, we don't need a sub directory
            path = objFSO.BuildPath(exportDestination,"/images/ea/")
        Else
            path = objFSO.BuildPath(exportDestination,"/images/ea/" &amp; NormalizeName(currentModel.Name) &amp; "/")
        End If
        path = objFSO.GetAbsolutePathName(path)
        MakeDir(path)

        diagramName = currentDiagram.Name
        diagramName = Replace(diagramName,vbCr,"")
        diagramName = Replace(diagramName,vbLf,"")
        diagramName = NormalizeName(diagramName)
        filename = objFSO.BuildPath(path, diagramName &amp; imageFormat)

        exportDiagram = True
        If objFSO.FileExists(filename) Then
            WScript.echo " --- " &amp; filename &amp; " already exists."
            If Len(additionalOptions) &gt; 0 Then
                If InStr(additionalOptions, "KeepFirstDiagram") &gt; 0 Then
                    WScript.echo " --- Skipping export -- parameter 'KeepFirstDiagram' set."
                Else
                    WScript.echo " --- Overwriting -- parameter 'KeepFirstDiagram' not set."
                    exportDiagram = False
                End If
            Else
                WScript.echo " --- Overwriting -- parameter 'KeepFirstDiagram' not set."
            End If
        End If
        If exportDiagram Then
          projectInterface.SaveDiagramImageToFile(filename)
          WScript.echo " extracted image to " &amp; filename
          If Not IsEmpty(diagramAttributes) Then
              SaveDiagramAttribute currentDiagram, path, diagramName
          End If
        End If
        Repository.CloseDiagram(currentDiagram.DiagramID)

        ' Write the note of the diagram
        WriteNote currentModel, currentDiagram, currentDiagram.Notes, diagramName&amp;"_notes"

        For Each diagramElement In currentDiagram.DiagramObjects
            Set currentElement = Repository.GetElementByID(diagramElement.ElementID)
            WriteNote currentModel, currentElement, currentElement.Notes, diagramName&amp;"_notes"
        Next
        For Each diagramLink In currentDiagram.DiagramLinks
            set currentConnector = Repository.GetConnectorByID(diagramLink.ConnectorID)
            WriteNote currentModel, currentConnector, currentConnector.Notes, diagramName&amp;"_links"
        Next
    End Sub
    '
    ' Recursively saves all diagrams under the provided package and its children
    '
    Sub DumpDiagrams(thePackage,currentModel)
        Set currentPackage = thePackage

        ' export element notes
        For Each currentElement In currentPackage.Elements
            WriteNote currentModel, currentElement, currentElement.Notes, ""
            ' export connector notes
            For Each currentConnector In currentElement.Connectors
                ' WScript.echo currentConnector.ConnectorGUID
                if (currentConnector.ClientID=currentElement.ElementID) Then
                    WriteNote currentModel, currentConnector, currentConnector.Notes, ""
                End If
            Next
            if (Not currentElement.CompositeDiagram Is Nothing) Then
                SyncJira currentModel, currentElement.CompositeDiagram
                SaveDiagram currentModel, currentElement.CompositeDiagram
            End If
            if (Not currentElement.Elements Is Nothing) Then
                DumpDiagrams currentElement,currentModel
            End If
        Next


        ' Iterate through all diagrams in the current package
        For Each currentDiagram In currentPackage.Diagrams
            SyncJira currentModel, currentDiagram
            SaveDiagram currentModel, currentDiagram
        Next

        ' Process child packages
        Dim childPackage 'as EA.Package
        ' otPackage = 5
        if (currentPackage.ObjectType = 5) Then
            For Each childPackage In currentPackage.Packages
                call DumpDiagrams(childPackage, currentModel)
            Next
        End If
    End Sub

    Function SearchEAProjects(path)
      For Each folder In path.SubFolders
        SearchEAProjects folder
      Next

      For Each file In path.Files
            If fso.GetExtensionName (file.Path) = "eap" OR fso.GetExtensionName (file.Path) = "eapx" OR fso.GetExtensionName (file.Path) = "qea" OR fso.GetExtensionName (file.Path) = "qeax" Then
                WScript.echo "found "&amp;file.path
                If (Left(file.name, 1) = "_") Then
                    WScript.echo "skipping, because it start with `_` (replication)"
                Else
                    OpenProject(file.Path)
                End If
            End If
      Next
    End Function

    'Gets the package object as referenced by its GUID from the Enterprise Architect project.
    'Looks for the model node, the package is a child of as it is required for the diagram export.
    'Calls the Sub routine DumpDiagrams for the model and package found.
    'An error is printed to console only if the packageGUID is not found in the project.
    Function DumpPackageDiagrams(EAapp, packageGUID)
        WScript.echo "DumpPackageDiagrams"
        WScript.echo packageGUID
        Dim package
        Set package = EAapp.Repository.GetPackageByGuid(packageGUID)
        If (package Is Nothing) Then
          WScript.echo "invalid package - as package is not part of the project"
        Else
          Dim currentModel
          Set currentModel = package
          while currentModel.IsModel = false
            Set currentModel = EAapp.Repository.GetPackageByID(currentModel.parentID)
          wend
          ' Iterate through all child packages and save out their diagrams
          ' save all diagrams of package itself
          call DumpDiagrams(package, currentModel)
        End If
    End Function

    Function FormatStringToJSONString(inputString)
        outputString = Replace(inputString, "\", "\\")
        outputString = Replace(outputString, """", "\""")
        outputString = Replace(outputString, vbCrLf, "\n")
        outputString = Replace(outputString, vbLf, "\n")
        outputString = Replace(outputString, vbCr, "\n")
        FormatStringToJSONString = outputString
    End Function

    'If a valid file path is set, the glossary terms are read from EA repository,
    'formatted in a JSON compatible format and written into file.
    'The file is read and reformatted by the exportEA gradle task afterwards.
    Function ExportGlossaryTermsAsJSONFile(EArepo)
        If (Len(glossaryFilePath) &gt; 0) Then
            set objFSO = CreateObject("Scripting.FileSystemObject")
            GUID = Replace(EArepo.ProjectGUID,"{","")
            GUID = Replace(GUID,"}","")
            currentGlossaryFile = objFSO.BuildPath(glossaryFilePath,"/"&amp;GUID&amp;".ad")
            set objFile = objFSO.OpenTextFile(currentGlossaryFile,ForAppending, True)

            Set glossary = EArepo.Terms()
            objFile.WriteLine("[")
            dim counter
            counter = 0
            For Each term In glossary
                if (counter &gt; 0) Then
                    objFile.Write(",")
                end if
                objFile.Write("{ ""term"" : """&amp;FormatStringToJSONString(term.term)&amp;""", ""meaning"" : """&amp;FormatStringToJSONString(term.Meaning)&amp;""",")
                objFile.WriteLine(" ""termID"" : """&amp;FormatStringToJSONString(term.termID)&amp;""", ""type"" : """&amp;FormatStringToJSONString(term.type)&amp;""" }")
                counter = counter + 1
            Next
            objFile.WriteLine("]")

            objFile.Close
        End If
    End Function

    Sub OpenProject(file)
      ' open Enterprise Architect
      Set EAapp = CreateObject("EA.App")
      WScript.echo "opening Enterprise Architect. This might take a moment..."
      ' load project
      EAapp.Repository.OpenFile(file)
      ' make Enterprise Architect to not appear on screen
      EAapp.Visible = False

      ' get repository object
      Set Repository = EAapp.Repository
      ' Show the script output window
      ' Repository.EnsureOutputVisible("Script")
      call ExportGlossaryTermsAsJSONFile(Repository)

      Set projectInterface = Repository.GetProjectInterface()

      Dim childPackage 'As EA.Package
      ' Iterate through all model nodes
      Dim currentModel 'As EA.Package
      If (InStrRev(file,"{") &gt; 0) Then
        ' the filename references a GUID
        ' like {04C44F80-8DA1-4a6f-ECB8-982349872349}
        WScript.echo file
        GUID = Mid(file, InStrRev(file,"{")+0,38)
        WScript.echo GUID
        ' Iterate through all child packages and save out their diagrams
        call DumpPackageDiagrams(EAapp, GUID)
      Else
        If packageFilter.Count = 0 Then
          WScript.echo "done"
        ' Iterate through all model nodes
        For Each currentModel In Repository.Models
            ' Iterate through all child packages and save out their diagrams
            For Each childPackage In currentModel.Packages
                call DumpDiagrams(childPackage,currentModel)
            Next
        Next
        Else
          ' Iterate through all packages found in the package filter given by script parameter.
          For Each packageGUID In packageFilter
            call DumpPackageDiagrams(EAapp, packageGUID)
          Next
        End If
      End If
      EAapp.Repository.CloseFile()
      ' Since EA 15.2 the Enterprise Architect background process hangs without calling Exit explicitly
      On Error Resume Next
        EAapp.Repository.CloseFile()
        EAapp.Repository.Exit()
        EAapp.Repository = null
      ' end fix EA
    End Sub

  Private connectionString
  Private packageFilter
  Private exportDestination
  Private searchPath
  Private glossaryFilePath
  Private imageFormat
  Private diagramAttributes
  Private additionalOptions

  exportDestination = "./src/docs"
  searchPath = "./src"
  Set packageFilter = CreateObject("System.Collections.ArrayList")
  Set objArguments = WScript.Arguments

  Dim argCount
  argCount = 0
  While objArguments.Count &gt; argCount+1
    Select Case objArguments(argCount)
      Case "-c"
        connectionString = objArguments(argCount+1)
      Case "-p"
        packageFilter.Add objArguments(argCount+1)
      Case "-d"
        exportDestination = objArguments(argCount+1)
      Case "-s"
        searchPath = objArguments(argCount+1)
      Case "-g"
        glossaryFilePath = objArguments(argCount+1)
      Case "-f"
        imageFormat = objArguments(argCount+1)
      Case "-da"
        diagramAttributes = objArguments(argCount+1)
      Case "-ao"
        additionalOptions = objArguments(argCount+1)
      Case Else
        WScript.echo "unknown argument: " &amp; objArguments(argCount)
    End Select
    argCount = argCount + 2
  WEnd
  set fso = CreateObject("Scripting.fileSystemObject")
  WScript.echo "Image extractor"

  ' Check both types in parallel - 1st check Enterprise Architect database connection, 2nd look for local project files
  If Not IsEmpty(connectionString) Then
     WScript.echo "opening database connection now"
     OpenProject(connectionString)
  End If
  WScript.echo "looking for .eap(x) and .qea(x) files in " &amp; fso.GetAbsolutePathName(searchPath)
  ' Dim f As Scripting.Files
  SearchEAProjects fso.GetFolder(searchPath)

  WScript.echo "finished exporting images"</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportvisio">18. exportVisio</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_15">18.1. About This Task</h3>
<div class="paragraph">
<p>This task searches for Visio files in the <code>/src/docs</code> folder then exports all diagrams and element notes to <code>/src/docs/images/visio</code> and <code>/src/docs/visio</code>.</p>
</div>
<div class="paragraph">
<p>Images are stored as <code>/images/visio/[filename]-[pagename].png</code>. Notes are stored as <code>/visio/[filename]-[pagename].adoc</code></p>
</div>
<div class="paragraph">
<p>You can specify a filename to export notes to by starting any comment with <code>{adoc:[filename].adoc}</code>.
It will then be written to <code>/visio/[filename].adoc</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_important_information_about_this_task">18.2. Important Information About This Task</h3>
<div class="ulist">
<ul>
<li>
<p>Currently, only Visio files stored directly in <code>/src/docs</code> are supported. All others will export to the wrong location.</p>
</li>
<li>
<p>Before running this task, close any open Visio instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_7">18.3. Further Reading and Resources</h3>
<div class="paragraph">
<p><a href="https://github.com/docToolchain/docToolchain/issues/112">Issue #112</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_16">18.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportVisio.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportVisio.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportVisio.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportVisio.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportVisio(
        dependsOn: [streamingExecute],
        description: 'exports all diagrams and notes from visio files',
        group: 'docToolchain'
) {
    doLast {
        //make sure path for notes exists
        //and remove old notes
        new File(docDir, 'src/docs/visio').deleteDir()
        //also remove old diagrams
        new File(docDir, 'src/docs/images/visio').deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported diagrams and notes from visio files.
		
Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradle exportVisio` to re-export files
"""
        new File(docDir, 'src/docs/images/visio/.').mkdirs()
        new File(docDir, 'src/docs/images/visio/readme.ad').write(readme)
        new File(docDir, 'src/docs/visio/.').mkdirs()
        new File(docDir, 'src/docs/visio/readme.ad').write(readme)
        def sourcePath = new File(docDir, 'src/docs/.').canonicalPath
        def scriptPath = new File(projectDir, 'scripts/VisioPageToPngConverter.ps1').canonicalPath
        "powershell ${scriptPath} -SourcePath ${sourcePath}".executeCmd()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">Show source code of <code>scripts/VisioPageToPngConverter.ps1</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/VisioPageToPngConverter.ps1" target="_blank" rel="noopener">GitHub · docToolchain/scripts/VisioPageToPngConverter.ps1</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/VisioPageToPngConverter.ps1</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="powershell"># Convert all pages in all visio files in the given directory to png files.
# A Visio windows might flash shortly.
# The converted png files are stored in the same directory
# The name of the png file is concatenated from the Visio file name and the page name.
# In addtion all the comments are stored in adoc files.
# If the Viso file is named "MyVisio.vsdx" and the page is called "FirstPage"
# the name of the png file will be "MyVisio-FirstPage.png" and the comment will
# be stored in "MyVisio-FirstPage.adoc".
# But for the name of the adoc files there is an alternative. It can be given in the first 
# line of the comment. If it is given in the comment it has to be given in curly brackes 
# with the prefix "adoc:", e.g. {adoc:MyCommentFile.adoc}
# Prerequisites: Viso and PowerShell has to be installed on the computer.
# Parameter: SourcePath where visio files can be found
# Example powershell VisoPageToPngConverter.ps1 -SourcePath c:\convertertest\

Param
(
    [Parameter(Mandatory=$true,ValueFromPipeline=$true,Position=0)]
    [Alias('p')][String]$SourcePath
)

Write-Output "starting to export visio"

If (!(Test-Path -Path $SourcePath))
{
    Write-Warning "The path ""$SourcePath"" does not exist or is not accessible, please input the correct path."
    Exit
}

# Extend the source path to get only Visio files of the given directory and not in subdircetories
If ($SourcePath.EndsWith("\"))
{
    $SourcePath  = "$SourcePath"
}
Else
{
    $SourcePath  = "$SourcePath\"
}

$VisioFiles = Get-ChildItem -Path "$SourcePath*" -Recurse -Include *.vsdx,*.vssx,*.vstx,*.vxdm,*.vssm,*.vstm,*.vsd,*.vdw,*.vss,*.vst

If(!($VisioFiles))
{
    Write-Warning "There are no Visio files in the path ""$SourcePath""."
    Exit
}

$VisioApp = New-Object -ComObject Visio.Application
$VisioApp.Visible = $false
    
# Extract the png from all the files in the folder
Foreach($File in $VisioFiles)
{
    $FilePath = $File.FullName
    Write-Output "found ""$FilePath"" ."
    $FileDirectory = $File.DirectoryName   # Get the folder containing the Visio file. Will be used to store the png and adoc files
    $FileBaseName = $File.BaseName -replace '[ :/\\*?|&lt;&gt;]','-'   # Get the filename to be used as part of the name of the png and adoc files
    
    Try
    {
        $Document = $VisioApp.Documents.Open($FilePath)
        $Pages = $VisioApp.ActiveDocument.Pages
        Foreach($Page in $Pages)
        {
            # Create valid filenames for the png and adoc files
            $PngFileName = $Page.Name -replace '[ :/\\*?|&lt;&gt;]','-'
            $PngFileName = "$FileBaseName-$PngFileName.png"
            $AdocFileName = $PngFileName.Replace(".png", ".adoc")

            #TODO: this needs better logic
            Write-Output("$SourcePath\images\visio\$PngFileName")
            $Page.Export("$SourcePath\images\visio\$PngFileName")
            
            $AllPageComments = ""
            ForEach($PageComment in $Page.Comments)
            {
                # Extract adoc filename from comment text if the syntax is valid
                # Remove the filename from the text and save the comment in a file with a valid name
                $EofStringIndex = $PageComment.Text.IndexOf(".adoc}")
                if ($PageComment.Text.StartsWith("{adoc") -And ($EofStringIndex -gt 6))
                {
                    $AdocFileName = $PageComment.Text.Substring(6, $EofStringIndex -1)
                    $AllPageComments += $PageComment.Text.Substring($EofStringIndex + 6)
                }
                else
                {
                    $AllPageComments += $PageComment.Text+"`n"
                }
            }
            If ($AllPageComments)
            {

                $AdocFileName = $AdocFileName -replace '[:/\\*?|&lt;&gt;]','-'
                #TODO: this needs better logic
                $stream = [System.IO.StreamWriter] "$SourcePath\visio\$AdocFileName"
                $stream.WriteLine($AllPageComments)
                $stream.close()
            }                    
        }
        $Document.Close()
    }
    Catch
    {
        if ($Document)
        {
            $Document.Close()
        }
        Write-Warning "One or more visio page(s) in file ""$FilePath"" have been lost in this converting."
        Write-Warning "Error was: $_"
    }
}
$VisioApp.Quit()</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportdrawio">19. exportDrawIo</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3f7fa472f24ae9ea4caaefd3a669f6ea?d=identicon" alt="Jared Morgan" width="32" height="32" title="Jared Morgan"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_16">19.1. About This Task</h3>
<div class="paragraph">
<p>There is no <code>exportDrawIo</code> task available in docToolchain because such a task is not required.
You can continue to use <a href="https://app.diagrams.net/">diagrams.net</a> (formerly known as draw.io) to edit your diagrams simply by making a change to your diagram-authoring workflow.</p>
</div>
</div>
<div class="sect2">
<h3 id="_about_diagrams_net">19.2. About diagrams.net</h3>
<div class="paragraph">
<p>diagrams.net offers free and open source desktop editors for all major operating system platforms.
Visit <a href="https://www.diagrams.net/integrations" class="bare">https://www.diagrams.net/integrations</a> to find a desktop editor application compatible with your operating system.
When you use the desktop version, just create your diagram with the <code>.png</code> (or even better, <code>.dio.png</code>) extension and diagrams.net will always save your diagram as a PNG with the source as metadata.</p>
</div>
<div class="paragraph">
<p>They have also launched a free plugin for VS Code and IntelliJ, so you can edit your diagrams offline!</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_change_your_workflow_to_use_diagrams_net">19.3. How to Change Your Workflow to Use diagrams.net</h3>
<div class="paragraph">
<p>Export your diagrams.net/draw.io diagrams as a PNG with the source embedded in the file metadata.
This allows you to embed your diagrams into AsciiDoc source as you normally would (using the <code>image::</code> macro) with the added advantage of storing the diagram source with the image itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_convert_a_confluence_page_to_asciidoc">19.4. How to Convert a Confluence Page to AsciiDoc</h3>
<div class="paragraph">
<p>If you are converting a Confluence page with embedded draw.io diagrams to AsciiDoc, use this export workflow to continue using diagrams.net:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Export an editable PNG diagram from Confluence.</p>
</li>
<li>
<p>Load the diagram you want to export from Confluence.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Export as</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">PNG&#8230;&#8203;</b></span>.</p>
</li>
<li>
<p>In the Image modal, make sure that <strong>Include a copy of my diagram</strong> is selected.</p>
</li>
<li>
<p>Click <strong>Export</strong> to save the PNG file with the pattern <code>[file].dio.png</code>.</p>
</li>
<li>
<p>Commit the exported PNG file to source control.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your diagram can now be managed in source control, added to your documentation source and edited using a diagrams.net desktop version.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Specifying <code>.dio</code> (short for "<strong>d</strong>raw<strong>io</strong>") in the name will help you identify PNG files containing an embedded XML diagram source.
</td>
</tr>
</table>
</div>
<script src="https://plugins.jetbrains.com/assets/scripts/mp-widget.js"></script>
<script>
  // Please, replace #yourelement with a real element id on your webpage
  MarketplaceWidget.setupMarketplaceWidget('card', 15635, "#myelement");
</script>
<div id="myelement"></div>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportchangelog">20. exportChangeLog</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0d2c684ec9e55edec506308356b67016?d=identicon" alt="Jakub J Jablonski" width="32" height="32" title="Jakub J Jablonski"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_17">20.1. About This Task</h3>
<div class="paragraph">
<p>As the name suggests, this task exports the changelog to be referenced from within your documentation, if needed.
The changelog is written to <code>build/docs/changelog.adoc</code>.</p>
</div>
<div class="paragraph">
<p>This task can be configured to use a different source control system or a different directory.
To configure this task, copy <code>template_config/scripts/ChangelogConfig.groovy</code> to your directory and modify to suit your needs.
Then use -PchangelogConfigFile=&lt;your config file&gt; to add the path to your configuration file to the task.
See the description inside the template for more details.</p>
</div>
<div class="paragraph">
<p>By default, the source is the Git changelog for the path <code>src/docs</code> and only contains the commit messages for changes made to the documentation.
All changes to the build or other sources in the repository will not show up.
By default, the changelog contains changes made to <em>date</em>, <em>author</em> and <em>commit message</em> already formatted as AsciiDoc table content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>| 09.04.2017
| Ralf D. Mueller
| fix #24 template updated to V7.0

| 08.04.2017
| Ralf D. Mueller
| fixed typo</pre>
</div>
</div>
<div class="paragraph">
<p>You simply include it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.Changes
[options="header",cols="1,2,6"]
|====
| Date
| Author
| Comment

include::../../build/docs/changelog.adoc[]

|====</pre>
</div>
</div>
<div class="paragraph">
<p>By excluding the table definition, you can easily translate the table headings through different text snippets.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a future docToolchain release, you will have the ability to include only certain commit messages from the changelog and exclude others (starting with <code>#</code> or <code>//</code>?).
This feature is not available just yet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_8">20.2. Further Reading and Resources</h3>
<div class="paragraph">
<p><a href="https://rdmueller.github.io/changelog/">The only constant in life is change</a> blog post.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_17">20.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportChangelog.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportChangelog.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportChangelog.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportChangelog.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportChangeLog(
        description: 'exports the change log from a git subpath',
        group: 'docToolchain'
) {
    doFirst {
        new File(targetDir).mkdirs()
    }
    doLast {
        logger.info("docToolchain&gt; docDir: "+docDir)
        logger.info("docToolchain&gt; mainConfigFile: "+mainConfigFile)
        def config = new ConfigSlurper().parse(new File(docDir, mainConfigFile).text)

        def cmd = "${config.changelog.cmd} ."
        def changes = cmd.execute(null, new File(docDir, config.changelog.dir)).text
        def changelog = new File(targetDir, 'changelog.adoc')
        logger.info "&gt; changelog exported ${changelog.canonicalPath}"
        changelog.write(changes)
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportcontributors">21. exportContributors</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_18">21.1. About This Task</h3>
<div class="paragraph">
<p>This task crawls through all Asciidoctor source files and extracts a list of contributors, which is then rendered as AsciiDoc images of each contributor&#8217;s gravatar picture.
The extracted list is stored in <code>/home/runner/work/docToolchain/docToolchain/build/contributors/015_tasks/03_task_exportContributors.adoc</code> so it can be easily included in your documents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use_this_task">21.2. How to Use This Task</h3>
<div class="paragraph">
<p>The best way to use this task is to create a <code>feedback.adoc</code> file similar to this:</p>
</div>
<div class="listingblock">
<div class="title">feedback.adoc</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">ifndef::backend-pdf[] <i class="conum" data-value="1"></i><b>(1)</b>

    image::https://img.shields.io/badge/improve-this%20doc-orange.svg[link={manualdir}{filename}, float=right] <i class="conum" data-value="2"></i><b>(2)</b>
    image::https://img.shields.io/badge/create-an%20issue-blue.svg[link="https://github.com/docToolchain/documentation/issues/new?title=&amp;body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:{filename}", float=right] <i class="conum" data-value="3"></i><b>(3)</b>

endif::[]

include::{targetDir}/contributors/{filename}[] <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<div class="title">Key:</div>
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Do not show this section when docs are rendered as PDF.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an <strong>Improve This Doc</strong> button which links to your GitHub sources.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a <strong>Create an Issue</strong> button which links to your issue tracker.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Include the list of contributors created by this task.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(The task automatically adds the estimated reading time to the list of contributors.)</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_about_the_avatar_icons">21.3. About the Avatar-Icons</h3>
<div class="paragraph">
<p>It seems not to be possible to extract a link to the github avatar icons from the log.
So, the solution is to use <a href="https://gravatar.com">Gravatar</a> icons.
For this to work, the contributors email address is hashed and an icon link is generated from that hash.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon</pre>
</div>
</div>
<div class="paragraph">
<p>This result at least in an icon which has a distinct color.</p>
</div>
<div class="paragraph">
<p>Contributors can set up their own image through <a href="https://gravatar.com">Gravatar.com</a>.
For this to work, the git commits need to use an email address which can be verified by Gravatar.com.
Unfortunately, this is not the case if a contributor decided to make his email address private in the email sections of her github account.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_attributes">21.4. File Attributes</h3>
<div class="paragraph">
<p>This task also exports some GitHub file attributes.
The extracted attributes are stored in <code>/home/runner/work/docToolchain/docToolchain/build/fileattribs/015_tasks/03_task_exportContributors.adoc</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">:lastUpdated: 16.05.2019 06:22
:lastAuthorName: Ralf D. Müller
:lastAuthorEmail: ralf.d.mueller@gmail.com
:lastAuthorAvatar: http://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon[32,32,role='gravatar',alt='Ralf D. Müller',title='Ralf D. Müller']
:lastMessage: #310 started to document config options</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can import and use these attributes in the same way as you import the contributors list.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
please make sure that you do not accidentally publish the email address if your contributors do not want it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">feedback.adoc</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">include::{targetDir}/fileattribs/{filename}[]

Last updated {lastUpdated} by {lastAuthorName}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportjiraissues">22. exportJiraIssues</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e0f7ac7994ea3ac2c1437a0da586ba63?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_19">22.1. About This Task</h3>
<div class="paragraph">
<p>This task exports all issues for a given query or queries from Jira as either an AsciiDoc table, an Excel file or both.</p>
</div>
<div class="paragraph">
<p>The configuration for this task can be found within <code>Config.gradle</code> (<code>gradle.properties</code> can be used as a fallback).
Username/password is deprecated, so you need to use username/API-token instead.</p>
</div>
<div class="paragraph">
<p>An API-token can be created through <a href="https://id.atlassian.com/manage/api-tokens" class="bare">https://id.atlassian.com/manage/api-tokens</a>.
We recommend that you keep username and API-token out of your GitHub repository, and instead pass them as environment variables to docToolchain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migrate_configuration_to_version_3_2_0">22.2. Migrate configuration to version &gt;= 3.2.0</h3>
<div class="paragraph">
<p>Since version 3.2.0, the configuration <code>requests</code> is deprecated. Please migrate to and use <code>exports</code> instead. The old configuration will be removed in the near future.
To migrate your configuration, replace the JiraRequest class with a Map. The following example shows how to migrate a configuration with a single JiraRequest to the new configuration:</p>
</div>
<div class="listingblock">
<div class="title">Prior to 3.2.0</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jira.requests = [
   new JiraRequest(
      filename: 'jiraIssues',
      jql: 'project = %jiraProject% AND labels = %jiraLabel%',
      customfields: [
         'customfield_10026': 'StoryPoints'
      ]
   )
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be migrated to:</p>
</div>
<div class="listingblock">
<div class="title">From 3.2.0 onwards</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">jira.exports = [
    [
        filename: 'jiraIssues',
        jql: 'project = %jiraProject% AND labels = %jiraLabel%',
        customfields: [
            'customfield_10026': 'StoryPoints'
        ]
    ]
]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2">22.3. Configuration</h3>
<div class="paragraph">
<p>Jira configuration support list requests to Jira where results of each request will be saved in a file with specifies filename.
Flags <em>saveAsciidoc</em> &amp; <em>saveExcel</em> allow you to easily configure the format in which results should be saved.</p>
</div>
<div class="sect3">
<h4 id="_deprecation_notice">22.3.1. Deprecation Notice</h4>
<div class="ulist">
<ul>
<li>
<p>The old configuration was based on the <strong>single Jira query is deprecated</strong> (single 'jql' parameter). Support for it will be removed in the near future. Please migrate to the new configuration which allows multiple Jira queries.</p>
</li>
<li>
<p>Since version 3.2.0, the configuration <code>requests</code> is deprecated. Please migrate to and use <code>exports</code> instead. The old configuration will be removed in the near future.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_options">22.3.2. Configuration Options</h4>
<div class="paragraph">
<p><strong>exports</strong> (since 3.2.0), List of Maps that contains the following keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>filename</code>: The filename of the exported file. The file extension will be added automatically.</p>
</li>
<li>
<p><code>jql</code>: The Jira query to be executed. Can have placeholders that are interpolated. Allowed placeholders are: <code>%jiraProject%</code> (interpolated with <code>jira.project</code>), <code>%jiraLabel%</code> (interpolated with <code>jira.label</code>)</p>
</li>
<li>
<p><code>customfields</code>: A Map of custom fields to be included in the export. Key is the technical name of the custom field in Jira, value is the name of the column in the export.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>rateLimit</strong> (since 3.2.0), The rate limit for Jira requests. Default is 10 requests per second.</p>
</div>
<div class="paragraph">
<p><strong>requests</strong> (<em><strong>deprecated</strong></em> since 3.2.0, please use <code>exports</code> instead),
List of JiraRequest that has the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">class JiraRequest {
String filename  //filename (without extension) of the file in which JQL results will be saved. Extension will be determined automatically for Asciidoc or Excel file
String jql // Jira Query Language syntax
Map&lt;String,String&gt; customfields // map of customFieldId:displayName values for Jira fields which don't have default names, i.e. customfield_10026:StoryPoints
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Full configuration options:</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Configuration for Jira related tasks
jira = [:]

jira.with {

    // endpoint of the JiraAPI (REST) to be used
    api = 'https://your-jira-instance'

    // requests per second for Jira API calls
    rateLimit = 10

    /*
    WARNING: It is strongly recommended to store credentials securely instead of commiting plain text values to your git repository!!!

    Tool expects credentials that belong to an account which has the right permissions to read the JIRA issues for a given project.
    Credentials can be used in a form of:
     - passed parameters when calling script (-PjiraUser=myUsername -PjiraPass=myPassword) which can be fetched as a secrets on CI/CD or
     - gradle variables set through gradle properties (uses the 'jiraUser' and 'jiraPass' keys)
    Often, Jira &amp; Confluence credentials are the same, in which case it is recommended to pass CLI parameters for both entities as
    -Pusername=myUser -Ppassword=myPassword
    */

    // the key of the Jira project
    project = 'PROJECTKEY'

    // the format of the received date time values to parse
    dateTimeFormatParse = "yyyy-MM-dd'T'H:m:s.SSSz" // i.e. 2020-07-24'T'9:12:40.999 CEST

    // the format in which the date time should be saved to output
    dateTimeFormatOutput = "dd.MM.yyyy HH:mm:ss z" // i.e. 24.07.2020 09:02:40 CEST

    // the label to restrict search to
    label = 'label1'

    // Legacy settings for Jira query. This setting is deprecated &amp; support for it will soon be completely removed. Please use JiraRequests settings
    jql = "project='%jiraProject%' AND labels='%jiraLabel%' ORDER BY priority DESC, duedate ASC"

    // Base filename in which Jira query results should be stored
    resultsFilename = 'JiraTicketsContent'

    saveAsciidoc = true // if true, asciidoc file will be created with *.adoc extension
    saveExcel = true // if true, Excel file will be created with *.xlsx extension

    // Output folder for this task inside main outputPath
    resultsFolder = 'JiraRequests'

    /*
    List of requests to Jira API:
    These are basically JQL expressions bundled with a filename in which results will be saved.
    User can configure custom fields IDs and name those for column header,
    i.e. customfield_10026:'Story Points' for Jira instance that has custom field with that name and will be saved in a coloumn named "Story Points"
    */
    exports = [
        [
            filename:"File1_Done_issues",
            jql:"project='%jiraProject%' AND status='Done' ORDER BY duedate ASC",
            customfields: [customfield_10026:'Story Points']
        ],
        [
            filename:'CurrentSprint',
            jql:"project='%jiraProject%' AND Sprint in openSprints() ORDER BY priority DESC, duedate ASC",
            customfields: [customfield_10026:'Story Points']
        ]
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_18">22.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportJiraIssues.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportJiraIssues.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportJiraIssues.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportJiraIssues.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportJiraIssues(
        description: 'exports all jira issues from a given search',
        group: 'docToolchain'
) {
    doLast {
        config.targetDir = targetDir
        new ExportJiraIssuesTask(config).execute()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportjirasprintchangelogissues">23. exportJiraSprintChangelogIssues</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_20">23.1. About This Task</h3>
<div class="paragraph">
<p>This task exports a simplified (key and summary) list of Jira issues for a specific sprint defined in the task configuration. Only a few additional fields (such as assignee) can be switched using configuration flags.</p>
</div>
<div class="paragraph">
<p>Once you define the sprint, the relevant AsciiDoc and Excel files will be generated.
If a sprint is not defined in the configuration, changelogs for all sprints that match the configuration will be saved in separate AsciiDoc files and in different tabs within an Excel file.</p>
</div>
<div class="paragraph">
<p>The task configuration can be found within <code>Config.gradle</code>. In addition to the configuration snippet below, it is important to configure the Jira API and credentials in the Jira section of the configuration inside the same file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3">23.2. Configuration</h3>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Sprint changelog configuration generate changelog lists based on tickets in sprints of an Jira instance.
// This feature requires at least Jira API &amp; credentials to be properly set in Jira section of this configuration
sprintChangelog = [:]
sprintChangelog.with {
    sprintState = 'closed' // it is possible to define multiple states, i.e. 'closed, active, future'
    ticketStatus = "Done, Closed" // it is possible to define multiple ticket statuses, i.e. "Done, Closed, 'in Progress'"

    showAssignee = false
    showTicketStatus = false
    showTicketType = true
    sprintBoardId = 12345  // Jira instance probably have multiple boards; here it can be defined which board should be used

    // Output folder for this task inside main outputPath
    resultsFolder = 'Sprints'

    // if sprintName is not defined or sprint with that name isn't found, release notes will be created on for all sprints that match sprint state configuration
    sprintName = 'PRJ Sprint 1' // if sprint with a given sprintName is found, release notes will be created just for that sprint
    allSprintsFilename = 'Sprints_Changelogs' // Extension will be automatically added.
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_19">23.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportJiraSprintChangelog.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportJiraSprintChangelog.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportJiraSprintChangelog.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportJiraSprintChangelog.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportJiraSprintChangelog(
        description: 'exports all jira issues from Sprint for release notes',
        group: 'docToolchain'
) {
    doLast {
        config.targetDir = targetDir
        new ExportJiraSprintChangelogTask(config).execute()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportppt">24. exportPPT</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/61c257b76a94d988f747a87850b7e114?d=identicon" alt="ghp-dev" width="32" height="32" title="ghp-dev"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_21">24.1. About This Task</h3>
<div class="paragraph">
<p>This task lets you export a series of PowerPoint slides to be used within your AsciiDoc documentation.
It is currently a Windows-only task.</p>
</div>
<div class="paragraph">
<p>It exports the slides as <code>.jpg</code> files and the speaker notes as one <code>.adoc</code> file.
The tag <code>{slide}</code> within the speaker notes will be replaced with the corresponding image reference.
This will help you to get a stable result, even when you insert or delete slides.</p>
</div>
<div class="paragraph">
<p>Use the <a href="https://docs.asciidoctor.org/asciidoc/latest/directives/include-tagged-regions/">tagged regions (<code>//tag::[</a></code>) feature of asciidoctor] to include only certain slides or parts of your speaker notes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_9">24.2. Further Reading and Resources</h3>
<div class="ulist">
<ul>
<li>
<p>Read the <a href="https://rdmueller.github.io/PPT-as-asciidoc-editor/">Do More with Slides</a> blog post.</p>
</li>
<li>
<p>Find more information about the Windows-only aspect of this task in <a href="https://github.com/docToolchain/docToolchain/issues/231">this issue</a>.</p>
</li>
<li>
<p>Check out <a href="https://github.com/uniqueck/asciidoctorj-office-extension">asciidoctorj-office-extension</a> for another way to use PPT slides in your docs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_20">24.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportPPT.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportPPT.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportPPT.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportPPT.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportPPT(
        dependsOn: [streamingExecute],
        description: 'exports all slides and some texts from PPT files',
        group: 'docToolchain'
) {
    doLast {
        File sourceDir = file(srcDir)
        logger.info("sourceDir: ${sourceDir}")
        //make sure path for notes exists
        //and remove old notes
        new File(sourceDir, 'ppt').deleteDir()
        //also remove old diagrams
        new File(sourceDir, 'images/ppt').deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported slides or notes from .ppt presentations.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradle exportPPT` to re-export files
"""
        new File(sourceDir, 'images/ppt/.').mkdirs()
        new File(sourceDir, 'images/ppt/readme.ad').write(readme)
        new File(sourceDir, 'ppt/.').mkdirs()
        new File(sourceDir, 'ppt/readme.ad').write(readme)
        def searchPath = new File(sourceDir, 'ppt')
        //execute through cscript in order to make sure that we get WScript.echo right
        "%SystemRoot%\\System32\\cscript.exe //nologo ${projectDir}/scripts/exportPPT.vbs -s ${sourceDir.absolutePath}".executeCmd()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">Show source code of <code>scripts/exportPPT.vbs</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportPPT.vbs" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportPPT.vbs</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportPPT.vbs</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="vbs">    Const   ForAppending = 8
    Const   ppPlaceholderBody = 2

    ' Helper
    ' http://windowsitpro.com/windows/jsi-tip-10441-how-can-vbscript-create-multiple-folders-path-mkdir-command
    Function MakeDir (strPath)
      Dim strParentPath, objFSO
      Set objFSO = CreateObject("Scripting.FileSystemObject")
      On Error Resume Next
      strParentPath = objFSO.GetParentFolderName(strPath)

      If Not objFSO.FolderExists(strParentPath) Then MakeDir strParentPath
      If Not objFSO.FolderExists(strPath) Then objFSO.CreateFolder strPath
      On Error Goto 0
      MakeDir = objFSO.FolderExists(strPath)

    End Function

	Function SearchPresentations(path)

		  For Each folder In path.SubFolders
		    SearchPresentations folder
		  Next

		  For Each file In path.Files
				If (Left(fso.GetExtensionName (file.Path), 3) = "ppt") OR (Left(fso.GetExtensionName (file.Path), 3) = "pps")  Then
					WScript.echo "found "&amp;file.path
					ExportSlides(file.Path)
				End If
		  Next

    End Function

    Sub ExportSlides(sFile)
        Set objRegEx = CreateObject("VBScript.RegExp")
        objRegEx.Global = True
        objRegEx.IgnoreCase = True
        objRegEx.MultiLine = True
        ' "." doesn't work for multiline in vbs, "[\s,\S]" does...
        objRegEx.Pattern = "[\s,\S]*{adoc}"
        ' http://www.pptfaq.com/FAQ00481_Export_the_notes_text_of_a_presentation.htm
        strFileName = fso.GetFIle(sFile).Name
        Err.Clear
        Set oPPT = CreateObject("PowerPoint.Application")
        Set oPres = oPPT.Presentations.Open(sFile, True, False, False) ' Read Only, No Title, No Window
        On Error resume next
        Set oSlides = oPres.Slides
        WScript.echo "number slides: "&amp;oSlides.Count
        strNotesText = ""
        strImagePath = "/images/ppt/" &amp; strFileName &amp; "/"
        MakeDir(searchPath &amp; strImagePath)
        strNotesPath = "/ppt/"
        MakeDir(searchPath &amp; strNotesPath)
        For Each oSl In oSlides
           strSlideName = oSl.Name
           'WScript.echo fso.GetAbsolutePathName(searchPath) &amp; strImagePath &amp; strSlideName &amp; ".jpg"
           oSl.Export fso.GetAbsolutePathName(searchPath) &amp; strImagePath &amp; strSlideName &amp; ".jpg", ".jpg"

            For Each oSh In oSl.NotesPage.Shapes
                If oSh.PlaceholderFormat.Type = ppPlaceholderBody  Then
                    If oSh.HasTextFrame Then
                        If oSh.TextFrame.HasText Then
                            strCurrentNotes = oSh.TextFrame.TextRange.Text
                            strCurrentNotes = Replace(strCurrentNotes,vbVerticalTab, vbCrLf)
                            strCurrentNotes = Replace(strCurrentNotes,"{slide}","image::ppt/"&amp;strFileName&amp;"/"&amp;strSlideName&amp;".jpg[]")
                            ' remove speaker notes before marker "{adoc}"
                            strCurrentNotes = objRegEx.Replace(strCurrentNotes,"")
                            strNotesText = strNotesText  &amp; vbCrLf &amp; strCurrentNotes &amp; vbCrLf &amp; vbCrLf
                        End If
                    End If
                End If
            Next
        Next
        ' WScript.echo fso.GetAbsolutePathName(".") &amp; strNotesPath&amp;""&amp;strFileName&amp;".ad"
        ' http://stackoverflow.com/questions/2524703/save-text-file-utf-8-encoded-with-vba

        Set fsT = CreateObject("ADODB.Stream")
        fsT.Type = 2 'Specify stream type - we want To save text/string data.
        fsT.Charset = "utf-8" 'Specify charset For the source text data.
        fsT.Open 'Open the stream And write binary data To the object
        fsT.WriteText "ifndef::imagesdir[:imagesdir: ../../images]"&amp;vbCrLf&amp;CStr(strNotesText)
        fsT.SaveToFile fso.GetAbsolutePathName(searchPath) &amp; strNotesPath&amp;""&amp;strFileName&amp;".ad", 2 'Save binary data To disk
        oPres.Close()
        oPPT.Quit()

        If Err.Number &lt;&gt; 0 Then
            WScript.Echo "Error: " &amp; Err.Number
            WScript.Echo "Error (Hex): " &amp; Hex(Err.Number)
            WScript.Echo "Source: " &amp;  Err.Source
            WScript.Echo "Description: " &amp;  Err.Description
            Err.Clear             ' Clear the Error
        End If
    End Sub

  set fso = CreateObject("Scripting.fileSystemObject")
  WScript.echo "Slide extractor"
    Set objArguments = WScript.Arguments

    Dim argCount
    argCount = 0
    While objArguments.Count &gt; argCount+1
      Select Case objArguments(argCount)
        Case "-s"
          searchPath = objArguments(argCount+1)
      End Select
      argCount = argCount + 2
    WEnd

  WScript.echo "looking for .ppt files in " &amp; fso.GetAbsolutePathName(searchPath)
  SearchPresentations fso.GetFolder(searchPath)
  WScript.echo "finished exporting slides"</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportexcel">25. exportExcel</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Schrotti" width="32" height="32" title="Schrotti"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_22">25.1. About This Task</h3>
<div class="paragraph">
<p>Sometimes you need to include tabular data in your documentation.
Most likely, this data will be stored as a MS Excel spreadsheet, or you may like to use Excel to create and edit it.
Either way, this task lets you export an Excel spreadsheet and include it directly in your docs.
It searches for <code>.xlsx</code> files and exports each contained worksheet as <code>.csv</code> and as <code>.adoc</code>.
Note that formulas contained in your spreadsheet are evaluated and exported statically.</p>
</div>
<div class="paragraph">
<p>The generated files are written to <code>src/excel/[filename]/[worksheet].(adoc|cvs)</code>.
The <code>src</code> folder is used instead of the <code>build</code> folder because a better history of worksheet changes is captured.</p>
</div>
<div class="paragraph">
<p>The files can be included either as AsciiDoc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>include::excel/Sample.xlsx/Numerical.adoc[]</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;or as a CSV file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[options="header",format="csv"]
|===
include::excel/Sample.xlsx/Numerical.csv[]
|===</pre>
</div>
</div>
<div class="paragraph">
<p>The AsciiDoc version gives you a bit more control because the following are preserved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Horizontal and vertical alignment.</p>
</li>
<li>
<p>col-span and row-span.</p>
</li>
<li>
<p>Line breaks.</p>
</li>
<li>
<p>Column width relative to other columns.</p>
</li>
<li>
<p>Background colors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_10">25.2. Further Reading and Resources</h3>
<div class="paragraph">
<p>See <a href="https://github.com/uniqueck/asciidoctorj-office-extension">asciidoctorj-office-extension</a> to learn another way to use Excel spreadsheets in your docs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_21">25.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportExcel.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportExcel.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportExcel.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportExcel.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportExcel(
        description: 'exports all excelsheets to csv and AsciiDoc',
        group: 'docToolchain'
) {
    doFirst {
        File sourceDir = file(srcDir)

        def tree = fileTree(srcDir).include('**/*.xlsx').exclude('**/~*')

        def exportFileDir = new File(sourceDir, 'excel')

        //make sure path for notes exists
        exportFileDir.deleteDir()
        //create a readme to clarify things
        def readme = """This folder contains exported workbooks from Excel.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradle exportExcel` to re-export files
"""
        exportFileDir.mkdirs()
        new File(exportFileDir, '/readme.ad').write(readme)
    }
    doLast {
        File sourceDir = file(srcDir)
        def exportFileDir = new File(sourceDir, 'excel')
        def tree = fileTree(srcDir).include('**/*.xlsx').exclude('**/~*')

        def nl = System.getProperty("line.separator")

        def export = { sheet, evaluator, targetFileName -&gt;
            def targetFileCSV = new File(targetFileName + '.csv')
            def targetFileAD = new File(targetFileName + '.adoc')
            def df = new org.apache.poi.ss.usermodel.DataFormatter();
            def regions = []
            sheet.numMergedRegions.times {
                regions &lt;&lt; sheet.getMergedRegion(it)
            }
            logger.debug "sheet contains ${regions.size()} regions"
            def color = ''
            def resetColor = false
            def numCols = 0
            def headerCreated = false
            def emptyRows = 0
            for (int rowNum=0; rowNum&lt;=sheet.lastRowNum; rowNum++) {
                def row = sheet.getRow(rowNum)
                if (row &amp;&amp; !headerCreated) {
                    headerCreated = true
                    // create AsciiDoc table header
                    def width = []
                    numCols = row.lastCellNum
                    numCols.times { columnIndex -&gt;
                        width &lt;&lt; sheet.getColumnWidth((int) columnIndex)
                    }
                    //lets make those numbers nicer:
                    width = width.collect { Math.round(100 * it / width.sum()) }
                    targetFileAD.append('[options="header",cols="' + width.join(',') + '"]' + nl)
                    targetFileAD.append('|===' + nl)
                }
                def data = []
                def style = []
                def colors = []
                // For each row, iterate through each columns
                if (row &amp;&amp; (row?.lastCellNum!=-1)) {
                    numCols.times { columnIndex -&gt;
                        def cell = row.getCell(columnIndex)
                        if (cell) {
                            def cellValue = df.formatCellValue(cell, evaluator)
                            if (cellValue.startsWith('*') &amp;&amp; cellValue.endsWith('\u20AC')) {
                                // Remove special characters at currency
                                cellValue = cellValue.substring(1).trim();
                            }
                            def cellStyle = ''
                            def region = regions.find { it.isInRange(cell.rowIndex, cell.columnIndex) }
                            def skipCell = false
                            if (region) {
                                //check if we are in the upper left corner of the region
                                if (region.firstRow == cell.rowIndex &amp;&amp; region.firstColumn == cell.columnIndex) {
                                    def colspan = 1 + region.lastRow - region.firstRow
                                    def rowspan = 1 + region.lastColumn - region.firstColumn
                                    if (rowspan &gt; 1) {
                                        cellStyle += "${rowspan}"
                                    }
                                    if (colspan &gt; 1) {
                                        cellStyle += ".${colspan}"
                                    }
                                    cellStyle += "+"
                                } else {
                                    skipCell = true
                                }
                            }
                            if (!skipCell) {
                                switch (cell.cellStyle.getCellAlignment().getHorizontal().toString()) {
                                    case 'RIGHT':
                                        cellStyle += '&gt;'
                                        break
                                    case 'CENTER':
                                        cellStyle += '^'
                                        break
                                }
                                switch (cell.cellStyle.getCellAlignment().getVertical().toString()) {
                                    case 'BOTTOM':
                                        cellStyle += '.&gt;'
                                        break
                                    case 'CENTER':
                                        cellStyle += '.^'
                                        break
                                }
                                color = cell.cellStyle.fillForegroundXSSFColor?.RGB?.encodeHex()
                                color = color != null ? nl + "{set:cellbgcolor:#${color}}" : ''
                                data &lt;&lt; cellValue
                                if (color == '' &amp;&amp; resetColor) {
                                    colors &lt;&lt; nl + "{set:cellbgcolor!}"
                                    resetColor = false
                                } else {
                                    colors &lt;&lt; color
                                }
                                if (color != '') {
                                    resetColor = true
                                }
                                style &lt;&lt; cellStyle
                            } else {
                                data &lt;&lt; ""
                                colors &lt;&lt; ""
                                style &lt;&lt; "skip"
                            }
                        } else {
                            data &lt;&lt; ""
                            colors &lt;&lt; ""
                            style &lt;&lt; ""
                        }

                    }
                    emptyRows = 0
                } else {
                    if (emptyRows&lt;3) {
                        //insert empty row
                        numCols.times {
                            data &lt;&lt; ""
                            colors &lt;&lt; ""
                            style &lt;&lt; ""
                        }
                        emptyRows++
                    } else {
                        break
                    }
                }

                targetFileCSV.append(data
                        .collect {
                    "\"${it.replaceAll('"', '""')}\""
                }
                .join(',') + nl, 'UTF-8')

                // fix #1192 https://github.com/docToolchain/docToolchain/issues/1192
                // remove unnecessary spans which break Asciidoctor rendering
                def prev = ''
                def removed = []
                def useRemoved = true
                style.eachWithIndex { s, i -&gt;
                    if (s!="skip") {
                        if (s.contains('+')) {
                            def span = s.split('[+]')[0].split('[.]')
                            def current = ""
                            if (span.size()&gt;1) {
                                current = span[1]
                            }
                            if (span[0] != '') {
                                removed &lt;&lt; span[0] + '+' + s.split('[+]')[1]
                            } else {
                                removed &lt;&lt; s.split('[+]')[1]
                            }
                            if (i &gt; 0) {
                                if (current != prev) {
                                    useRemoved = false
                                }
                            }
                            prev = current
                        } else {
                            removed &lt;&lt; s
                            useRemoved = false
                        }
                    } else {
                        removed &lt;&lt; "skip"
                    }
                }
                if (useRemoved) { style = removed }
                // fix #1192 https://github.com/docToolchain/docToolchain/issues/1192

                targetFileAD.append(data
                        .withIndex()
                        .collect { value, index -&gt;
                    if (style[index] == "skip") {
                        ""
                    } else {
                        style[index] + "| ${value.replaceAll('[|]', '{vbar}').replaceAll("\n", ' +$0') + colors[index]}"
                    }
                }
                .join(nl) + nl * 2, 'UTF-8')
            }
            targetFileAD.append('|===' + nl)
            // rewrite file to remove consecutive nl
            targetFileAD.write(targetFileAD.text.replaceAll("(?m)(\\r?\\n){2,}", nl+nl))
        }


        tree.each { File excel -&gt;
            println "file: " + excel
            def excelDir = new File(exportFileDir, excel.getName())
            excelDir.mkdirs()
            InputStream inp
            inp = new FileInputStream(excel)
            def wb = org.apache.poi.ss.usermodel.WorkbookFactory.create(inp);
            def evaluator = wb.getCreationHelper().createFormulaEvaluator();
            for (int wbi = 0; wbi &lt; wb.getNumberOfSheets(); wbi++) {
                def sheetName = wb.getSheetAt(wbi).getSheetName()
                println " -- sheet: " + sheetName
                def targetFile = new File(excelDir, sheetName)
                export(wb.getSheetAt(wbi), evaluator, targetFile.getAbsolutePath())
            }
            inp.close();
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportmarkdown">26. exportMarkdown</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_23">26.1. About This Task</h3>
<div class="paragraph">
<p>The <em>exportMarkdown</em> task can be used to include <a href="https://markdown.de">markdown</a> files into the documentation.
It scans the <code>/src/docs</code> directory for markdown (<code>*.md</code>) files and converts them into Asciidoc files. The converted files can then be referenced from within the <code>/build</code>-folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_22">26.2. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportMarkdown.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportMarkdown.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportMarkdown.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportMarkdown.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportMarkdown(
        description: 'exports all markdown files to AsciiDoc',
        group: 'docToolchain',
        type: Copy
) {
    from srcDir

    include("**/*.md") //include only markdown files
    includeEmptyDirs = false
    rename(/(.+).md/, '$1.adoc') //rename all files from *.md to *.adoc
    filter(Markdown2AdocFilter) // convert the content of the files

    into targetDir
}

class Markdown2AdocFilter extends FilterReader {
    Markdown2AdocFilter(Reader input) {
        super(new StringReader(nl.jworks.markdown_to_asciidoc.Converter.convertMarkdownToAsciiDoc(input.text)))
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportopenapi">27. exportOpenAPI</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_24">27.1. About This Task</h3>
<div class="paragraph">
<p>This task exports an OpenAPI Specification definition yaml file to a AsciiDoc document.
Currently, this task depends on <a href="https://github.com/OpenAPITools/openapi-generator">OpenAPI Generator (v4.3.1)</a> and its <a href="https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-gradle-plugin">gradle plugin</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/manual/openAPI.png" alt="openAPI">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_4">27.2. Configuration</h3>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Configuration for OpenAPI related task
openApi = [:]

// 'specFile' is the name of OpenAPI specification yaml file. Tool expects this file inside working dir (as a filename or relative path with filename)
// 'infoUrl' and 'infoEmail' are specification metadata about further info related to the API. By default this values would be filled by openapi-generator plugin placeholders
//

openApi.with {
    specFile = 'src/docs/petstore-v2.0.yaml' // i.e. 'petstore.yaml', 'src/doc/petstore.yaml'
    infoUrl = 'https://my-api.company.com'
    infoEmail = 'info@company.com'
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_23">27.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportOpenApi.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportOpenApi.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportOpenApi.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportOpenApi.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportOpenApi (
        type: org.openapitools.generator.gradle.plugin.tasks.GenerateTask,
        group: 'docToolchain',
        description: 'exports OpenAPI specification to the asciidoc file') {

    if (!specFile) {
        logger.info("\n---&gt; OpenAPI specification file not found in Config.groovy (https://doctoolchain.github.io/docToolchain/#_exportopenapi)")
        return
    } else {
        logger.info("Found OpenAPI specification in Config.groovy")
    }

    outputs.upToDateWhen { false }
    outputs.cacheIf { false }
    generatorName = 'asciidoc'
    outputDir = "${targetDir}/OpenAPI".toString()
    inputSpec = "${docDir}/${specFile}" // plugin is not able to find file if inputPath is defined as '.'

    logger.debug("\n=====================\nProject Config:\n=====================")
    logger.debug("Docdir: ${docDir}")
    logger.debug("Target: ${targetDir}")
    logger.info("\n=====================\nOpenAPI Config:\n=====================")
    logger.info("Specification file: ${specFile}")
    logger.info("inputSpec: ${inputSpec}")
    logger.info("outputDir: ${outputDir}\n")

    additionalProperties = [
        infoEmail:"${config.openApi.infoEmail}",
        infoUrl:"${config.openApi.infoUrl}"
    ]
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exportstructurizr">28. exportStructurizr</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0dfa58a10da1e9368266584d3a0a3efc?d=identicon" alt="Max Hofer" width="32" height="32" title="Max Hofer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>3 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_25">28.1. About This Task</h3>
<div class="paragraph">
<p><a href="https://structurizr.com">Structurizr</a> builds upon "diagrams as code", allowing you to create multiple diagrams from a single model, using a number of tools and programming languages.
Structurizr is specifically designed to support the <a href="https://c4model.com/">C4 model for visualising software architecture</a>.</p>
</div>
<div class="paragraph">
<p>This task exports <a href="https://plantuml.com/">PlantUML</a> (respective <a href="https://github.com/plantuml-stdlib/C4-PlantUML">C4-PlantUML</a>) diagrams from a software architecture model described with the <a href="https://structurizr.com/help/dsl">Structurizr DSL</a>.
The generated diagrams can be integrated into the AsciiDoc documentation.</p>
</div>
<div class="paragraph">
<p>The software architecture model is integral part of the software architecture documentation.
As such we strongly suggest to put the Structurizr workspace file under revision control integrating it in the <code>src/docs</code> directory.
The user would edit the software architecture model by this file.</p>
</div>
<div class="paragraph">
<p>This Structurizr DSL example below creates two diagrams, based upon a single set of elements and relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>workspace {

    model {
        user = person "User"
        softwareSystem = softwareSystem "Software System" {
            webapp = container "Web Application" {
                user -&gt; this "Uses"
            }
            container "Database" {
                webapp -&gt; this "Reads from and writes to"
            }
        }
    }

    views {
        systemContext softwareSystem {
            include *
            autolayout lr
        }

        container softwareSystem {
            include *
            autolayout lr
        }

        theme default
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here the diagrams defined by the views in the example above rendered by the Structurizr web renderer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/manual/structurizr-system-context-diagram.png" alt="System Context Diagram">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/manual/structurizr-container-diagram.png" alt="Container Diagram">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_5">28.2. Configuration</h3>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// Configuration for Structurizr related tasks
structurizr = [:]

structurizr.with {

    // Configure where `exportStructurizr` looks for the Structurizr model.
    workspace = {
        // The directory in which the Structurizr workspace file is located.
        // path = 'src/docs/structurizr'

        // By default `exportStructurizr` looks for a file '${structurizr.workspace.path}/workspace.dsl'
        // You can customize this behavior with 'filename'. Note that the workspace filename is provided without '.dsl' extension.
        // filename = 'workspace'
    }

    export = {
        // Directory for the exported diagrams.
        //
        // WARNING: Do not put manually created/changed files into this directory.
        // If a valid Structurizr workspace file is found the directory is deleted before the diagram files are generated.
        // outputPath = 'src/docs/structurizr/diagrams'

        // Format of the exported diagrams. Defaults to 'plantuml' if the parameter is not provided.
        //
        // Following formats are supported:
        // - 'plantuml': the same as 'plantuml/structurizr'
        // - 'plantuml/structurizr': exports views to PlantUML
        // - 'plantuml/c4plantuml': exports views to PlantUML with https://github.com/plantuml-stdlib/C4-PlantUML
        // format = 'plantuml'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_configuration">28.3. Example Configuration</h3>
<div class="paragraph">
<p>The example below shows a possible directory layout with a <code>src/docs/structurizr</code> directory containing the <code>workspace.dsl</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── docToolchainConfig.groovy
├── dtcw
└── src
    └── docs
        ├── example
        │   └── example.adoc
        ├── images
        │   ├── some-pics-1.png
        │   └── some-pics-2.png
        └── structurizr
            └── workspace.dsl</pre>
</div>
</div>
<div class="paragraph">
<p>The minimal configuration for the <code>exportStructurizr</code> task in your <code>docToolchainConfig.groovy</code> would look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">structurizr = [:]

structurizr.with {
    workspace = {
        path = 'src/docs/structurizr'
    }
    export = {
        outputPath = "src/docs/structurizr/diagrams"
        // The format is optional.
        // format = 'plantuml'
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You probably want to put the directory configured with <code>structurizr.export.outputPath</code> into your <code>.gitignore</code> file.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not put manually created/changed files into the directory provided with <code>structurizr.export.outputPath</code>.
If a valid Structurizr workspace file is provided the directory is deleted before the diagram files are generated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Calling <code>./dtcw exportStructurizr</code> generates the diagrams in the <code>structurizr.export.outputPath</code> directory.</p>
</div>
<div class="listingblock">
<div class="title">Directory layout after exporting the diagrams</div>
<div class="content">
<pre>├── docToolchainConfig.groovy
├── dtcw
└── src
    └── docs
        ├── example
        │   └── example.adoc
        ├── images
        │   ├── some-pics-1.png
        │   └── some-pics-2.png
        └── structurizr
            ├── diagrams
            |   ├── Container-001-key.puml
            |   ├── Container-001.puml
            |   ├── SystemContext-001-key.puml
            |   └── SystemContext-001.puml
            └── workspace.dsl</pre>
</div>
</div>
<div class="paragraph">
<p>Following our example the exported diagrams may be included in the Asciidoc document <code>example.adoc</code> with</p>
</div>
<div class="listingblock">
<div class="content">
<pre>plantuml::../structurizr/diagrams/SystemContext-001.puml["structurizr-SystemContext",format=svg]

plantuml::../structurizr/diagrams/Container-001.puml["structurizr-Container",format=svg]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_24">28.4. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/exportStructurizr.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/exportStructurizr.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/exportStructurizr.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/exportStructurizr.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task exportStructurizr (
        group: 'docToolchain',
        description: 'exports the views of a Structurizr DSL file to diagramms'
) {
    doLast {
        logger.debug("\n=====================\nStructurizr Config - before property replacement:\n=====================")
        logger.debug("structurizr.workspace.path: ${config.structurizr.workspace.path}")
        logger.debug("structurizr.workspace.filename: ${config.structurizr.workspace.filename}")
        logger.debug("structurizr.export.outputPath: ${config.structurizr.export.outputPath}")
        logger.debug("structurizr.export.format: ${config.structurizr.export.format}")

        // First we check the parameters
        def workspacePath = findProperty("structurizr.workspace.path")?:config.structurizr.workspace.path
        if (!workspacePath) {
            throw new GradleException("Missing configuration parameter 'structurizr.workspace.path': please provide the path where the Structurizr workspace file is located.")
        }
        // If 'workspace.filename' is not provided, default to 'workspace' (without extension).
        def filename = (findProperty("structurizr.workspace.filename")?:config.structurizr.workspace.filename)?:'workspace'

        def outputPath = findProperty("structurizr.export.outputPath")?:config.structurizr.export.outputPath
        if (!outputPath) {
            throw new GradleException("Missing configuration parameter 'structurizr.export.outputPath': please provide the directory where the diagrams should be exported.")
        }

        // If 'format' parameter is not provided, default to 'plantuml'.
        def format = (findProperty("structurizr.export.format")?:config.structurizr.export.format)?:'plantuml'
        //  Assure valid 'format' configuration parameter.
        DiagramExporter exporter
        switch(format) {
            case 'plantuml':
            case 'plantuml/structurizr':
                exporter = new StructurizrPlantUMLExporter()
                break
            case 'plantuml/c4plantuml':
                exporter = new C4PlantUMLExporter()
                break
            default:
                throw new GradleException("unknown structurizr.format '${format}': supported formats are 'plantuml' and 'plantuml/c4plantuml'.")
        }

        logger.info("\n=====================\nStructurizr Config:\n=====================")
        logger.info("structurizr.workspace.path: ${workspacePath}")
        logger.info("structurizr.workspace.filename: ${filename}")
        logger.info("structurizr.export.outputPath: ${outputPath}")
        logger.info("structurizr.export.format: ${format}")

        def workspaceFile = new File(docDir, workspacePath+'/'+filename+'.dsl')
        logger.info("Parsing Structurizr workspace file '${workspaceFile}'")
        StructurizrDslParser parser = new StructurizrDslParser()
        // TODO: provide better error output in case parsing fails
        parser.parse(workspaceFile)
        Workspace workspace = parser.getWorkspace()
        ThemeUtils.loadThemes(workspace)

        // Cleanup existing diagrams and then make sure the directory exists where the diagrams are exported
        new File(docDir, outputPath).deleteDir()
        // Create a readme to clarify things
        def readme = """This folder contains exported diagrams from a model described with Structurizr DSL.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradlew exportStructurizr` to re-export the diagrams
"""
        new File(docDir, outputPath).mkdirs()
        new File(docDir, outputPath+'/README.adoc').write(readme)

        Collection&lt;Diagram&gt; diagrams = exporter.export(workspace);
        diagrams.each { diagram -&gt;
            def file = new File(docDir, outputPath+"/"+diagram.key+'.'+diagram.getFileExtension())
            file.write(diagram.definition)
            if (diagram.legend) {
                def legend = new File(docDir, outputPath+"/"+diagram.key+"-key."+diagram.getFileExtension())
                legend.write(diagram.legend.definition)
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_htmlsanitycheck">29. htmlSanityCheck</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b75bf2d43c618f7eb22b0c76ee8514?d=identicon" alt="Gerd Aschemann" width="32" height="32" title="Gerd Aschemann"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Stefan Pfeiffer" width="32" height="32" title="Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_26">29.1. About This Task</h3>
<div class="paragraph">
<p>This task invokes the <a href="https://github.com/aim42/htmlSanityCheck">htmlSanityCheck</a> gradle plugin.
It is a standalone (batch- and command-line) HTML sanity checker whose role is to detect missing images, dead links and duplicated bookmarks.
In docToolchain, the htmlSanityCheck task ensures that generated HTML contains no missing links or other problems.
It is the last default task, and creates a report in <code>build/reports/htmlchecks/index.html</code> (see example below).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/manual/htmlSanityCheck.png" alt="htmlSanityCheck">
</div>
<div class="title">Figure 4. sample report</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_11">29.2. Further Reading and Resources</h3>
<div class="ulist">
<ul>
<li>
<p>Read the <a href="https://rdmueller.github.io/htmlSanityCheck/">Automated Quality-Checks</a> blog post.</p>
</li>
<li>
<p>Visit <a href="https://github.com/aim42/htmlSanityCheck" class="bare">https://github.com/aim42/htmlSanityCheck</a> for more information about this task.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_source_25">29.3. Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/htmlSanityCheck.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/htmlSanityCheck.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/htmlSanityCheck.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/htmlSanityCheck.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">htmlSanityCheck {
    sourceDir = new File(config.htmlSanityCheck.sourceDir?targetDir+"/"+config.htmlSanityCheck.sourceDir:"$targetDir/html5")
    // files to check - in Set-notation
    //sourceDocuments = [ "one-file.html", "another-file.html", "index.html"]

    // where to put results of sanityChecks...
    checkingResultsDir = new File(config.htmlSanityCheck.checkingResultsDir?:checkingResultsPath)
    // directory where the results written to in JUnit XML format
    junitResultsDir = new File(config.htmlSanityCheck.junitResultsDir?:"$targetDir/test-results/htmlchecks")

    // which statuscodes shall be interpreted as warning, error or success defaults to standard
    httpSuccessCodes = config.htmlSanityCheck.httpSuccessCodes?:[]
    httpWarningCodes = config.htmlSanityCheck.httpWarningCodes?:[]
    httpErrorCodes = config.htmlSanityCheck.httpErrorCodes?:[]

    // fail build on errors?
    failOnErrors = config.htmlSanityCheck.failOnErrors?:false

    logger.info "docToolchain&gt; HSC sourceDir: ${sourceDir}"
    logger.info "docToolchain&gt; HSC checkingResultsDir: ${checkingResultsDir}"
}</code></pre>
</div>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependencyupdates">30. dependencyUpdates</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task_27">30.1. About This Task</h3>
<div class="paragraph">
<p>This task uses the <a href="https://github.com/ben-manes/gradle-versions-plugin">Gradle versions plugin</a> created by Ben Manes to check for outdated build dependencies.
Use this task to keep all dependencies up to date.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you discover newer version, it doesn&#8217;t mean that versions and dependencies will play nicely together.
To ensure that everything works, we recommend the versions selected by docToolchain contributors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading_and_resources_12">30.2. Further Reading and Resources</h3>
<div class="paragraph">
<p>Read the <a href="https://rdmueller.github.io/dependency-update/">Handle Dependency Updates the Easy Way</a> blog post.</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_development">30.3. Development</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>1 minute to read</pre>
</div>
</div>
<div class="paragraph">
<p>INFO: this chapter is still work in progress</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_a_dev_environment">30.4. Setting Up a Dev Environment</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/8a8d424110b84c60a6e502b582d78216?d=identicon" alt="rmi2hi" width="32" height="32" title="rmi2hi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>4 minutes to read</pre>
</div>
</div>
<div class="sect3">
<h4 id="_before_you_begin_3">30.4.1. Before You Begin</h4>
<div class="paragraph">
<p>When you install docToolchain, all the code is hidden. The information on this page explains how to get access to the code, so you can customise the setup in your dev environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_do_a_local_install_for_docker_and_sdkman">30.4.2. Do a Local Install for Docker and SDKMAN!</h4>
<div class="paragraph">
<p>You need a local installation of docToolchain for development. Docker and SDKMAN! are derived from it. Docker simply contains a local install, and SDKMAN! installs docToolchain locally, but the location is controlled by SDKMAN! not docToolchain.</p>
</div>
<div class="paragraph">
<p>The docToolchain-Wrapper installs docToolchain locally to <code>$HOME/.doctoolchain/docToolchain-$v2.6.7/</code>. All task invocations through the docToolchain-Wrapper <code>dtcw</code> are redirected to <code>$HOME/.doctoolchain/docToolchain-$v2.6.7/bin/doctoolchain</code>. This shell script calls the Gradle-Wrapper for most tasks.</p>
</div>
<div class="paragraph">
<p>What you need to do is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a local install which is connected to your GitHub fork of docToolchain.</p>
</li>
<li>
<p>Create a folder called <code>$HOME/.doctoolchain/docToolchain-2.0.0-dev/</code>.</p>
</li>
<li>
<p>Check out the ng-branch of your fork to this folder.</p>
</li>
<li>
<p>To use this version in your test project, edit the version at the start of your <code>dtcw</code> script to <code>2.0.0-dev</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You now have the full repo locally cloned. To save memory, some parts of the repo are zipped. If you have problems, check out the <a href="https://github.com/docToolchain/docToolchain/blob/master/build.gradle#L79">prepareDist-Task</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_gradle_independent_tasks">30.4.3. Create Gradle-Independent Tasks</h4>
<div class="paragraph">
<p>All tasks currently use Gradle to run. You can bypass Gradle for tasks where it doesn’t add any value (and make docToolchain run faster as a result!). To do this, use the <code>bin/doctoolchain</code> scripts and create a switch.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_or_change_a_theme">30.4.4. Create or Change a Theme</h4>
<div class="paragraph">
<p>It’s not just the docToolchain code that is hidden. The themes for the static site generator jBake are also hidden. Follow these procedures to customise themes.</p>
</div>
<div class="sect4">
<h5 id="_how_to_overwrite_a_project_theme">How to Overwrite a Project Theme</h5>
<div class="paragraph">
<p>When docToolchain builds a static website, it first copies an internal theme to a temp folder, then copies an external theme (if defined) over it. Finally, it copies the project theme over the top. This gives you the opportunity to overwrite some parts of the theme on a per-project basis. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the <code>copyThemes</code> task to copy the internal and external themes to the <code>microsite.siteFolder</code>.</p>
</li>
<li>
<p>Check the files (take a look at <a href="https://jbake.org/">jbake.org</a> to get a better understanding).</p>
</li>
<li>
<p>Modify the relevant files and delete all the other files.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_how_to_modify_an_existing_theme_or_create_a_theme_from_scratch">How to Modify an Existing Theme or Create a Theme from Scratch</h5>
<div class="paragraph">
<p>As we have already mentioned, an external theme is simply a zipped copy of the 'microsite.siteFolder'. All themes are downloaded when referenced from a <code>dtcw</code> configuration, and are stored in <code>$HOME/.doctoolchain/themes/[hash of url]</code>.</p>
</div>
<div class="paragraph">
<p>To modify an existing theme, go to its folder and check out the theme’s project instead of the downloaded copy. This will create a connection back to the GitHub repo so that you can modify the theme directly in <code>$HOME/.doctoolchain/themes/[hash of url]</code>.</p>
</div>
<div class="paragraph">
<p>To create a new theme from scratch, use a simple md5 hash. For example, if you configure your new theme as <code>"myTheme"</code> then <code>"myTheme".md5()</code> will be the hash.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_special_functionality_for_themes_config_fragments">30.4.5. Special Functionality for Themes (Config Fragments)</h4>
<div class="paragraph">
<p>It’s likely that you will need a new config item for your self-generated theme. And you can also prompt users to set a value for this new config item when they install the theme for the first time. To do this, create a file called <code>configFragment.groovy</code> in the <code>site</code> folder of your theme. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">// the title of the microsite, displayed in the upper-left corner
// Example: my new site
title = '##site-title##'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The first line is the message that will be shown to the user (can be over several lines).</p>
</li>
<li>
<p>The second line (starting with <code>Example</code>:) is the default value for the prompt.</p>
</li>
<li>
<p>The third line is the config item itself. If the value is surrounded by <code>##</code>, the user will be prompted for this value and it will be replaced with the user’s input. Otherwise, the config item will be added without a prompt to the user’s current <code>docToochainConfig.groovy</code>.
:jbake-status: published
:jbake-order: 20
:jbake-type: page_toc
:jbake-menu: development
:jbake-title: Running Tests</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_tests">30.5. Running Tests</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="paragraph">
<p>docToolchain uses Spock as Test-Framework. See <a href="http://spockframework.org/" class="bare">http://spockframework.org/</a> for details.</p>
</div>
<div class="sect3">
<h4 id="_execute_tests">30.5.1. Execute Tests</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">rm -r build &amp;&amp; ./gradlew test --info</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rm</code> command ensures that you have a clean test running. This is vital because if artifacts of an older test run still exist, Gradle will skip steps (‘Up-to-date’) and you might get false positives.</p>
</div>
</div>
<div class="sect3">
<h4 id="_execute_a_specific_test">30.5.2. Execute a specific test</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="bash">rm -r build &amp;&amp; ./gradlew test --info --tests=ExportStructurizrSpec</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_workaround_to_ensure_correct_proxy_settings_for_tests">30.5.3. Workaround to Ensure Correct Proxy Settings for Tests</h4>
<div class="paragraph">
<p>The docToolchain setup is based on the <a href="https://docs.gradle.org/current/userguide/test_kit.html">Gradle-Test-Kit</a> and makes use of the <a href="https://code.google.com/archive/p/spock/">Spock test execution framework</a>.</p>
</div>
<div class="paragraph">
<p>The Gradle test runner is started in its own test environment and its own JVM instance. As a result, the global proxy settings are ignored. To execute the test with the correct proxy settings, you must use a workaround. Copy the proxy settings from the gradle.properties file located in the user directory to the gradle.properties file located in the docToolchain folder itself.</p>
</div>
<div class="paragraph">
<p>Note: The files downloaded by the Gradle test runner are placed in a different folder than the default Gradle cache. You will find them in the Tmp folder C:\Users\YOUR_USER_NAME\AppData\Local\Temp\.gradle-test-kit-YOUR_USER_NAME\caches.
:jbake-status: published
:jbake-order: 30
:jbake-type: page_toc
:jbake-menu: development
:jbake-title: Creating a New Release</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_new_release">30.6. Creating a New Release</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/01d61a369ff83fb5a364c448b421d103?d=identicon" alt="Tulio Camminati" width="32" height="32" title="Tulio Camminati"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect3">
<h4 id="_before_you_begin_4">30.6.1. Before You Begin</h4>
<div class="ulist">
<ul>
<li>
<p>We use <a href="https://semver.org/">semantic versioning</a> and we also keep a <a href="https://keepachangelog.com/">changelog</a>. All of this is done on a best-efforts basis.</p>
</li>
<li>
<p>A release consists of five parts, each explained below.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_github">30.6.2. GitHub</h4>
<div class="ulist">
<ul>
<li>
<p>run<br>
<code>docker run -it -e BATS_LIB_PATH=/usr/lib/bats -v "${PWD}/dtcw:/code/dtcw"  -v "${PWD}/test:/code/test" maxh/bats:latest test</code><br>
to test dtcw</p>
</li>
<li>
<p>Update the version in <code>gradle.properties</code>.</p>
</li>
<li>
<p>Update the version in <code>dtcw</code> and <code>dtcw.ps1</code>. <code>dtcw.bat</code> will be generated</p>
</li>
<li>
<p>Update the changelog.</p>
<div class="ulist">
<ul>
<li>
<p>Create a section for the version.</p>
</li>
<li>
<p>Copy to the new section all unreleased features which will be in the release.</p>
</li>
<li>
<p>Commit and push the new version.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/docToolchain/docToolchain/releases/new">Draft a new release</a>.</p>
</li>
<li>
<p>Copy the contents of the changelog for this version to the description then submit.</p>
</li>
<li>
<p>Set the version as <strong>v</strong>X.Y.Z.</p>
</li>
<li>
<p>Run <code>./gradlew createDist</code> to zip the source in build (the distribution file).</p>
</li>
<li>
<p>Add the zipped file and submit the new release.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_docker_hub">30.6.3. Docker Hub</h4>
<div class="sect4">
<h5 id="_standard_image">Standard Image</h5>
<div class="ulist">
<ul>
<li>
<p>Update the <a href="https://github.com/docToolchain/docker-image/tree/ng-beta/.github/workflows">GitHub workflows</a> to reflect the new version.</p>
</li>
<li>
<p>run <a href="https://github.com/docToolchain/docker-image/actions/workflows/standard-build.yml">github action</a> to build and deploy the image</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>do the same for the other images</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blog_post">30.6.4. Blog Post</h4>
<div class="paragraph">
<p>Create a blog post to announce the new release. The SDKMAN! announcement will reference it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_doctoolchain_wrapper_dtcw">30.6.5. docToolchain-Wrapper (dtcw)</h4>
<div class="paragraph">
<p>Everything went well? Great! Now let’s update the wrapper.</p>
</div>
<div class="paragraph">
<p>Navigate to <a href="https://github.com/docToolchain/doctoolchain.github.io/actions/workflows/update-dtcw.yml" class="bare">https://github.com/docToolchain/doctoolchain.github.io/actions/workflows/update-dtcw.yml</a> and trigger the action.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sdkman">30.6.6. SDKMAN!</h4>
<div class="paragraph">
<p>A GitHub action <a href="https://github.com/docToolchain/docToolchain/actions?query=workflow%3A%22sdkman+deploy%22">sdkman deploy</a> has been created to deploy to SDKMAN!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the version to the same as for the other releases, but without the prepended v: X.Y.Z.</p>
</li>
<li>
<p>Use as a download link the link to the <code>docToolchain-dist.zip</code> from the GitHub release. Tip: the link looks like <a href="https://github.com/docToolchain/docToolchain/releases/download/v1.3.1/docToolchain-dist.zip">https://github.com/docToolchain/docToolchain/releases/download/v1.3.1/docToolchain-dist.zip</a>.
:jbake-status: published
:jbake-order: 40
:jbake-type: page_toc
:jbake-menu: development
:jbake-title: Debugging</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_debugging">30.7. Debugging</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b75bf2d43c618f7eb22b0c76ee8514?d=identicon" alt="Gerd Aschemann" width="32" height="32" title="Gerd Aschemann"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2fb11e699999e0d7f6913d50228d7bd8?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="paragraph">
<p>Things not working as you expected? Here are some tips that might help you.</p>
</div>
<div class="sect3">
<h4 id="_environment">30.7.1. Environment</h4>
<div class="paragraph">
<p>To get the best out of docToolchain, we recommend that you set up a development environment.
This way you get to see the inner workings and you also get to add extra debug output to the tasks that you want to inspect.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gradle">30.7.2. Gradle</h4>
<div class="paragraph">
<p>You get more hints about what is going on with Gradle when you add the <code>--info</code> flag to your <code>./dtcw generateSite</code> command:</p>
</div>
<div class="paragraph">
<p><code>./dtcw generateSite --info</code></p>
</div>
<div class="paragraph">
<p>This outputs all config settings as seen by docToolchain along with many other internal settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jbake_templates">30.7.3. jBake Templates</h4>
<div class="paragraph">
<p>If something goes wrong with a template, you typically don’t receive much information about the problem. Take a look at <code>menu.gsp</code> to see how you can use <code>try/catch</code> blocks to get an error message. But to find out where the problem is occurring, you’ll need to use the poor man’s debugger and add some <code>System.out.println</code> statements. Make sure that you use the full <code>System.out.println</code> statement and not only <code>println</code> otherwise you won’t see any output.</p>
</div>
</div>
<div class="sect3">
<h4 id="_theming_menu_and_images">30.7.4. Theming, Menu and Images</h4>
<div class="paragraph">
<p>How the system creates the menu entries might seem like magic, but sometimes you cannot work out why an image is not shown. Remember, there is a way that you can check the generated files.</p>
</div>
<div class="paragraph">
<p>Check the <code>build/microsite/tmp</code> folder to see the folder that is fed into jBake. In this folder, all files will have additional <code>jbake</code> attributes which are used to build the menu. They are generated from the original attributes of the file and folder/filename information. Now check the <code>build/microsite/output</code> folder to see the generated result. This often helps you find out where an image actually is located.</p>
</div>
</div>
<div class="sect3">
<h4 id="_script_execution_debugging">30.7.5. Script Execution Debugging</h4>
<div class="paragraph">
<p>The execution of the <a href="../../../bin/doctoolchain" class="bare">../../../bin/doctoolchain</a> bash script may be traced by setting the environment variable <code>DTC_BASH_OPTS</code> to, e.g., <code>-vx</code>.</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_solutions_to_common_problems">30.8. Solutions to Common Problems</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/7c4c4a3d249b712651df3a1d1c28ab97?d=identicon" alt="Jérémie Bresson" width="32" height="32" title="Jérémie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/1936641b4122f826bbcfdb9b55b71a56?d=identicon" alt="faltfe" width="32" height="32" title="faltfe"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/9e7160732f1b0b86fba51a814d5b32b7?d=identicon" alt="Aaron Collier" width="32" height="32" title="Aaron Collier"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0af2ddd81694aba35cd520f469ab0c42?d=identicon" alt="Bennykillua" width="32" height="32" title="Bennykillua"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/fdbd46a8418be834d8ab743ca4b52455?d=identicon" alt="funkr" width="32" height="32" title="funkr"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2e3af23bd872d2b971788a4519e3bf46?d=identicon" alt="jakubjab" width="32" height="32" title="jakubjab"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>9 minutes to read</pre>
</div>
</div>
<div class="paragraph">
<p>This section tries to answer the most common and frequently asked questions about how to work with docToolchain.
It will also contain questions relevant to the tools used to build docToolchain, but the main focus is docToolchain itself.</p>
</div>
<div class="paragraph">
<p>If you are stuck, make sure that you also check other sources like <a href="https://stackoverflow.com/questions/tagged/asciidoctor">Stack Overflow</a>.</p>
</div>
<div class="paragraph">
<p>There is also a great FAQ for all your arc42 questions: <a href="https://faq.arc42.org/home/" class="bare">https://faq.arc42.org/home/</a></p>
</div>
<div class="paragraph">
<p>If you have a question or problem for which you can&#8217;t find a solution, you can</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for this repo, add your question and create a pull request</p>
</li>
<li>
<p>raise the issue through the <a href="https://github.com/docToolchain/docToolchain/issues">GitHub issue tracker</a></p>
</li>
<li>
<p>ask your question on <a href="https://stackoverflow.com/questions/tagged/doctoolchain?sort=active&amp;pageSize=50">Stack Overflow</a></p>
</li>
<li>
<p>discuss the problem on <a href="https://t.co/lnqrUc1YMM">Slack</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_references">30.8.1. References</h4>
<div class="sect4">
<h5 id="_q_how_can_i_reference_source_code_from_my_documentation">Q: How can I reference source code from my documentation?</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>As long, as you stay within your documents folder (default <code>src/docs</code>), you can simply reference other files with a relative <code>include::filename.adoc[]</code>-statement.<br>
If you need to reference files outside of the documents folder, you need to reference them with an absolute path.</p>
</div>
<div class="paragraph">
<p><code>include::/home/runner/work/docToolchain/docToolchainfilename.adoc[]</code><br></p>
</div>
<div class="paragraph">
<p>The <code>/home/runner/work/docToolchain/docToolchain</code> will point to the folder where your <code>dtcw</code> file resides.
In order make this also work in your editor preview, specify a line like the following in your documents:</p>
</div>
<div class="paragraph">
<p><code>ifndef::projectRootDir[:projectRootDir: ../../../]</code></p>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="_images">30.8.2. Images</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://asciidoctor.org/docs/user-manual/#images">Asciidoctor User Manual on images</a></p>
</li>
<li>
<p><a href="https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#images">Asciidoctor Quick Reference on images</a></p>
</li>
<li>
<p><a href="https://asciidoctor.org/docs/asciidoc-writers-guide/#images">AsciiDoctor Writer Guide on images</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_q_why_are_images_not_shown_in_the_preview_of_my_editor">Q: Why are images not shown in the preview of my editor?</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>This is most likely because your editor doesn&#8217;t know where they are stored.
If you follow the default settings, you probably store your images in a subfolder <code>images</code>.
The build script knows about it, because the attribute <code>imagesdir</code> has been set to <code>./images</code>, but your editor doesn&#8217;t care about the build script - it only checks the currently opened AsciiDoc file.</p>
</div>
<div class="paragraph">
<p>The solution is to add a line to each file which checks if the <code>imagesdir</code> is set and if not, sets it to a valid value:</p>
</div>
<div class="paragraph">
<p><code>ifndef::imagesdir[:imagesdir: ../images]</code></p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_which_image_format_should_i_use">Q: Which image format should I use?</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>AsciiDoc and AsciiDoctor support several formats like GIF, PNG, JPG and SVG.
However, if you want to use most features, some formats are better to use than others:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GIF</dt>
<dd>
<p>is not supported by the PDF renderer.
Use JPG or PNG instead.</p>
</dd>
<dt class="hdlist1">JPG</dt>
<dd>
<p>is great for photos but not for diagrams (you might get compression artifacts).
So, if you want to use photos from your flipcharts - JPG might work for you.</p>
</dd>
<dt class="hdlist1">SVG</dt>
<dd>
<p>great for high resolution diagrams, but not good supported by DOCX as output format.
OpenOffice Writer might display the image a bit stretched, MS Word didn&#8217;t display it at all in some experiments.
PDF output might display a warning that newer SVG versions are not supported (happens especially with diagrams.net images).</p>
</dd>
<dt class="hdlist1">PNG</dt>
<dd>
<p>this is the preferred format for images used with docToolchain.
All output formats support it and if diagrams are rendered with a resolution high enough to display all details, it will also be scaled well with all output formats.</p>
</dd>
</dl>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_why_are_my_images_rotated_in_the_output">Q: Why are my images rotated in the output?</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>This most likely happens when you&#8217;ve taken photos with a mobile device and include them in you docs.
A mobile device does not rotate the image itself, it only stores the orientation of the device in the metadata of the photo.
Your operating system will show you the image as expected, but the rendered AsciiDoc will not.
This can be „fixed“ with Imagemagick, by using <code>convert -auto-orient</code> or <code>mogrify -auto-orient</code> (thanx to <a href="https://twitter.com/RalfDMueller/status/920888868345384960">@rotnroll666</a> for this tip).
You can also try to just open the image in your favourite editor and re-save it.</p>
</div>
<div class="paragraph">
<p>=== exportVisio</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_an_error_message_saying_that_a_library_is_not_registered_when_i_try_to_run_the_exportvisio_task">Q: I get an error message saying that a library is not registered when I try to run the <code>exportVisio</code>-task.</h5>
<div class="listingblock">
<div class="content">
<pre>Ausnahme beim Festlegen von "Visible": "Das COM-Objekt des Typs "Microsoft.Office.Interop.Visio.ApplicationClass" kann nicht in den Schnittstellentyp
"Microsoft.Office.Interop.Visio.IVApplication" umgewandelt werden. Dieser Vorgang konnte nicht durchgeführt werden, da der QueryInterface-Aufruf an die
COM-Komponente für die Schnittstelle mit der IID "{000D0700-0000-0000-C000-000000000046}" aufgrund des folgenden Fehlers nicht durchgeführt werden konnte:
Bibliothek nicht registriert. (Ausnahme von HRESULT: 0x8002801D (TYPE_E_LIBNOTREGISTERED))."
In ...\scripts\VisioPageToPngConverter.ps1:48 Zeichen:1
+ $VisioApp.Visible = $false
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], SetValueInvocationException
    + FullyQualifiedErrorId : ExceptionWhenSetting</pre>
</div>
</div>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>When Visio is installed, it registers itself as a com library.
It seems that this registration can break.
You can fix this by visiting the windows system settings &#8594; install or uninstall a program, select <code>visio</code>, select <code>change</code> and then <code>repair</code>.</p>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="_sparx_enterprise_architect">30.8.3. Sparx Enterprise Architect</h4>
<div class="sect4">
<h5 id="_q_sparx_enterprise_architect_is_a_windows_tool_isnt_it">Q: Sparx Enterprise Architect is a Windows tool, isn&#8217;t it?</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>Yes, it is, but it is written to support CrossOver in order to run on Linux based systems.
Wine, the open source branch of CrossOver, seems to work as well.</p>
</div>
<div class="paragraph">
<p>Take a look at this page to see how to install it on a linux based system: <a href="https://www.sparxsystems.com/support/faq/ea_on_linux.html" class="bare">https://www.sparxsystems.com/support/faq/ea_on_linux.html</a></p>
</div>
<div class="paragraph">
<p>I (Ralf) once gave it a try and even managed to get remote control over EA via VBS and COM up and running (which is the pre-requisite for docToolchain).</p>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="_known_error_messages">30.8.4. Known error Messages</h4>
<div class="sect4">
<h5 id="_q_i_get_the_error_for_generatedeck_saying_no_such_file_or_directory_when_cloning_reveal_js">Q: I get the error for ':generateDeck' saying 'No such file or directory' when cloning reveal.js.</h5>
<div class="listingblock">
<div class="content">
<pre>./dtcw generateDeck
dtcw - docToolchain wrapper V0.38
docToolchain Vlatest
docToolchain as CLI available
docker available
home folder exists
cloning reveal.js
./dtcw: line 133: cd: $HOME/.doctoolchain/docToolchain-latest/resources: No such file or directory</pre>
</div>
</div>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>You&#8217;re using dtcw v0.38 or an older version. This is because with the release of docToolchain 3.x, the ':generateDeck' tasks no longer rely on helper scripts. To resolve this issue, simply upgrade dtcw to the latest version. The good news is that dtcw is backwards compatible with docToolchain, meaning you can use the latest version of dtcw while still referring to older versions of docToolchain. To switch to other version of docToolchain refer to <a href="https://doctoolchain.org/docToolchain/v2.0.x/010_manual/20_install.html#_let_the_wrapper_use_a_new_doctoolchain_release">the installation docs</a>.</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_the_error_saying_failed_to_create_md5_hash_for_file_content">Q: I get the error saying 'Failed to create MD5 hash for file content'.</h5>
<div class="listingblock">
<div class="content">
<pre>* What went wrong:
Failed to capture snapshot of input files for task ':generateHTML' property 'sourceDir' during up-to-date check.
&gt; Failed to create MD5 hash for file content.`</pre>
</div>
</div>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>There are two known reasons for this error.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>One of the .adoc files is opened in an editor, so that windows can&#8217;t get the lock for that file.
&#8594; Close all .adoc files.</p>
</li>
<li>
<p>You use the Bash script <code>doctoolchain</code> on a windows system.
&#8594; Use <code>doctoolchain.bat</code> instead.
It works even in a Bash Shell.</p>
</li>
</ol>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_the_error_saying_unsupported_major_minor_version_52_0">Q: I get the error saying 'Unsupported major.minor version 52.0'</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>This is a sign that you use an outdated version of Java.
Please upgrade to Java 8 at least and 14 max.
The docToolchain-wrapper (dtcw) in v2.0 will check the java version for you so that you will not see this error message in the future.</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_an_error_message_saying_error_occurred_during_initialization_of_vm">Q: I get an error message saying 'Error occurred during initialization of VM'</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details

FAILURE: Build failed with an exception.

* What went wrong:
Unable to start the daemon process.
…
Error occurred during initialization of VM
Could not reserve enough space for 2097152KB object heap</code></pre>
</div>
</div>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>Somehow docToolchain can&#8217;t allocate the memory which is configured out of the box.
Try to free up some memory or comment out the line <code>org.gradle.jvmargs=-Xmx2048m</code> in <code>gradle.properties</code></p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="wsl">Q: I get the error saying <code>Could not initialize class java.awt.GraphicsEnvironment$LocaleGE</code></h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>This seems to be a problem with WSL on Windows.
Some sources mention to run Java in headless mode, but in this case, it doesn&#8217;t solve the problem.
The root cause seems to be plantUML trying to get some font information.</p>
</div>
<div class="paragraph">
<p>Only real solution seems to be to shutdown WSL from a powershell window with <code>wsl --shutdown</code> and retry.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
this will kill all your WSL terminals without warning.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another solution seems to be to install a fresh version of your java runtime (I thought it is immutable, but it really helps).</p>
</div>
<div class="paragraph">
<p>Best Solution is to switch to powershell.</p>
</div>
<div class="paragraph">
<p>Another solution is to avoid PlantUML and generate Diagrams through a <a href="https://kroki.io">kroki.io</a> server.</p>
</div>
<div class="paragraph">
<p>Another variant of this is <code>Can&#8217;t connect to X11 window server using '192.168.189.153:0' as the value of the DISPLAY variable.</code>.
In this case, it might help to install an X-Server (x410 for example) and configure the <code>DISPLAY</code> variable correctly.
An easy way to test your configuration is to run <code>xeyes</code> in WSL.</p>
</div>
<div class="paragraph">
<p>Make sure that your WSL is up-to-date by running <code>wsl --update</code>. This is not part of your regular Windows update!</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_a_failed_to_create_parent_directory_project_gradle_error">Q: I get a <code>Failed to create parent directory /project/.gradle</code> error</h5>
<div class="listingblock">
<div class="content">
<pre>&gt; Gradle could not start your build.
&gt; Could not create service of type CrossBuildFileHashCache using BuildSessionServices.createCrossBuildFileHashCache().
   &gt; Failed to create parent directory '/project/.gradle' when creating directory '/project/.gradle/6.7.1/fileHashes'</pre>
</div>
</div>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>This issue can occur in CI environments (such as Bamboo) that have restricted permissions in the working folder where files or directories created outside the container might not be accessible inside the container. Before starting the container, give the working directory maximum permissions for allowing access to the user inside the Docker container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>chmod -R o+rwx ${bamboo.working.directory}
./dtcw generateSite</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another solution could be that you work on the same project with WSL and Powershell.
In such an environment, the WSL environment creates temporary files which can not be modified via powershell.</p>
</div>
<div class="paragraph">
<p>In such a case, just delete the <code>.gradle</code> folder.</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_q_i_get_an_error_stating_that_gradle_dependencies_cannot_be_downloaded_because_a_proxy_is_restricting_internet_access">Q: I get an error stating that Gradle dependencies cannot be downloaded because a proxy is restricting internet access</h5>
<details>
<summary class="title">Answer</summary>
<div class="content">
<div class="paragraph">
<p>Remember that dtcw is a wrapper around Gradle. So instead of calling this:</p>
</div>
<div class="paragraph">
<p><code>./dtcw generateSite</code></p>
</div>
<div class="paragraph">
<p>You could call this instead (remember to replace the values used in our example):</p>
</div>
<div class="paragraph">
<p><code>./dtcw generateSite -Dhttp.proxyHost=127.0.0.1 -Dhttp.proxyPort=3128 "-http.nonProxyHosts=*.nonproxyrepos.com|localhost"</code></p>
</div>
<div class="paragraph">
<p>(IP, port, etc. just an example)</p>
</div>
<div class="paragraph">
<p>For more information about Gradle proxy configuration, read <a href="https://stackoverflow.com/questions/5991194/gradle-proxy-configuration">this article</a>.</p>
</div>
</div>
</details>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_useful_resources">30.9. Useful Resources</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/9e7160732f1b0b86fba51a814d5b32b7?d=identicon" alt="Aaron Collier" width="32" height="32" title="Aaron Collier"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/0af2ddd81694aba35cd520f469ab0c42?d=identicon" alt="Bennykillua" width="32" height="32" title="Bennykillua"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Stefan Pfeiffer" width="32" height="32" title="Stefan Pfeiffer"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="sect3">
<h4 id="_introduction_2">30.9.1. Introduction</h4>
<div class="paragraph">
<p>Everything you need to know about docToolchain, from the underlying technology to useful resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="_underlying_technologies">30.9.2. Underlying Technologies</h4>
<div class="paragraph">
<p>Learn more about the technologies that support docToolchain, as well as some useful resources.</p>
</div>
<div class="sect4">
<h5 id="_markup">Markup</h5>
<details>
<summary class="title">AsciiDoc</summary>
<div class="content">
<div class="paragraph">
<p>This is our preferred markup language for technical docs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://asciidoctor.org/docs/user-manual/">Asciidoctor User-Manual</a></p>
</li>
<li>
<p><a href="https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">AsciiDoc Syntax Quick Reference</a></p>
</li>
<li>
<p><a href="https://www.ahus1.de/post/asciidoctor-intro-and-deep-dive">"Asciidoctor Deep Dive Video"</a> by Alexander Schwartz</p>
</li>
</ul>
</div>
</div>
</details>
<details>
<summary class="title">Markdown</summary>
<div class="content">
<div class="paragraph">
<p>Since we use JBake as a static site generator, you can write your docs in Markdown too.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/vsch/flexmark-java">flexmark-java</a> is the Markdown parser and flavor jBake uses.</p>
</li>
<li>
<p><a href="https://github.com/bodiam/markdown-to-asciidoc">markdown-to-asciidoc</a> library can be used if you prefer to use the <a href="#"><code>exportMarkdown</code></a>-Task.</p>
</li>
</ul>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_templates">Templates</h5>
<details>
<summary class="title">arc42</summary>
<div class="content">
<div class="paragraph">
<p>The perfect template for your software solution architecture documentation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://arc42.org/">arc42</a></p>
</li>
<li>
<p><a href="https://docs.arc42.org/home/">arc42 Tips &amp; Tricks</a></p>
</li>
<li>
<p><a href="https://faq.arc42.org/home/">arc42 FAQ</a></p>
</li>
</ul>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_docs_as_code_2">Docs as Code</h5>
<details>
<summary class="title">Docs as Code</summary>
<div class="content">
<div class="paragraph">
<p>Treat your docs as if they were code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs-as-co.de/">Docs-as-Code</a></p>
</li>
<li>
<p><a href="https://www.writethedocs.org/guide/docs-as-code/">write the docs: docs-as-code</a></p>
</li>
</ul>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_static_site_generator">Static Site Generator</h5>
<details>
<summary class="title">Static Site Generator</summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The underlying static site generator for the <a href="#"><code>generateSite</code></a>-Task is <a href="https://jbake.org">jBake</a></p>
</li>
<li>
<p>Our standard theme is <a href="https://www.docsy.dev/">docsy</a></p>
</li>
<li>
<p>Our CSS framework is <a href="https://getbootstrap.com/docs/4.6/getting-started/introduction/">Twitter Bootstrap</a></p>
</li>
</ul>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="_books">30.9.3. Books</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These are Amazon affiliate links.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Title</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Language</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.amazon.com/dp/1387081322">Docs Like Code</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anne Gentle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amzn.to/2sn0kyx">Modern Technical Writing: An Introduction to Software Documentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Andrew Etter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://leanpub.com/arc42byexample">arc42 by Example</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gernot Starke, Stefan Zörner, Michael Simons, Ralf D. Müller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://leanpub.com/arc42inpractice">Communicating Software Architectures with arc42</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gernot Starke und Peter Hruschka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://leanpub.com/visualising-software-architecture">Software Architecture for Developers, Volume 2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simon Brown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">English</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amzn.to/2smM5Kp">arc42 in Aktion:
Praktische Tipps zur Architekturdokumentation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">von Gernot Starke and Peter Hruschka40:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">German</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://amzn.to/2ru9Yvr">Softwarearchitekturen dokumentieren und kommunizieren:
Entwürfe, Entscheidungen und Lösungen nachvollziehbar und wirkungsvoll festhalten</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">von Stefan Zörner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">German</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_6">30.10. Configuration</h3>
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="stehlih" width="32" height="32" title="stehlih"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/34ef1437fd31ff96c31dff58125e93fe?d=identicon" alt="Dr. Stefan Pfeiffer" width="32" height="32" title="Dr. Stefan Pfeiffer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>2 minutes to read</pre>
</div>
</div>
<div class="paragraph">
<p>This appendix covers all configuration introduced by docToolchain.
AsciiDoc, AsciiDoctor, Gradle and other tools and libraries used know of more configuration settings and you can read about those in the corresponding documentation.</p>
</div>
<div class="sect3">
<h4 id="_mainconfigfile_and_docdir">30.10.1. <code>mainConfigFile</code> and <code>docDir</code></h4>
<div class="paragraph">
<p>docToolchain should be easy to use.
That&#8217;s why the goal is to have one config file with all settings for each project.
But first of all, docToolchain has to know where your documentation project is located.</p>
</div>
<div class="paragraph">
<p>If <code>docDir</code> is defined, the default for <code>mainConfigFile</code> is <code>Config.groovy</code> in the root folder of your <code>docDir</code>.</p>
</div>
<div class="paragraph">
<p>You have several options to specify the location of your documentation project (<code>docDir</code>) and the location of your config file (<code>mainConfigFile</code>).</p>
</div>
<div class="sect4">
<h5 id="_commandline">Commandline</h5>
<div class="paragraph">
<p>Specify the property on the commandline</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./dtcw generateHTML -PmainConfigFile=Config.groovy</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can verify the location of your <code>Config.groovy</code> by executing docToolchain with the <code>--info</code> parameter which sets the loglevel to <code>info</code>.
It will print the location on the command line (among other settings)
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_configuration_properties">dynamic configuration properties</h5>
<div class="paragraph">
<p>Sometimes you need a more dynamic configuration.
Since the configuration file is an executable <code>.groovy</code> file, you can not only configure static values but also fetch dynamic once.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>   example = System.properties.myProperty</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then specify the property with the <code>-D</code> parameter like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>./dtcw docker generateHTML -DmyProperty=myValue</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same way, you can use environment variables</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>   example = System.getenv("myEnvVariable")</code></pre>
</div>
</div>
<div class="paragraph">
<p>But in this case, you have to ensure that the environment variable can be accessed.
It will not work for docker based execution of <code>dtcw</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_content_of_the_mainconfigfile">Content of the <code>mainConfigFile</code></h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">Unresolved directive in 30_config.adoc - include::../../../Config.groovy[tags=**]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asciidoc_config">30.10.2. AsciiDoc config</h4>

</div>
<div class="sect3">
<h4 id="_command_line_parameters">30.10.3. Command Line Parameters</h4>

</div>
</div>
</div>
</div>
        </p>

        <style>
.feedback--answer {
    display: inline-block;
}

.feedback--answer-no {
    margin-left: 1em;
}

.feedback--response {
    display: none;
    margin-top: 1em;
}

.feedback--response__visible {
    display: block;
}
</style>

<div class="d-print-none">
    <h2 class="feedback--title">Feedback</h2>
    <p class="feedback--question">Was this page helpful?</p>
    <button class="feedback--answer feedback--answer-yes">Yes</button>
    <button class="feedback--answer feedback--answer-no">No</button>
    <p class="feedback--response feedback--response-yes">
        Glad to hear it! Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27%20%F0%9F%91%8D&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc">tell us
    how we can improve</a>.
    </p>
    <p class="feedback--response feedback--response-no">
        Sorry to hear that. Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27docToolchain+Manual%27%20%F0%9F%91%8E&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:010_manual/single-page.adoc">tell
    us how we can improve</a>.
    </p>
</div>
<script>
    const yesButton = document.querySelector('.feedback--answer-yes');
    const noButton = document.querySelector('.feedback--answer-no');
    const yesResponse = document.querySelector('.feedback--response-yes');
    const noResponse = document.querySelector('.feedback--response-no');
    const disableButtons = () => {
        yesButton.disabled = true;
        noButton.disabled = true;
    };
    const sendFeedback = (value) => {
        if (typeof ga !== 'function') return;
        const args = {
            command: 'send',
            hitType: 'event',
            category: 'Helpful',
            action: 'click',
            label: window.location.pathname,
            value: value
        };
        ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
    };
    yesButton.addEventListener('click', () => {
        yesResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(1);
    });
    noButton.addEventListener('click', () => {
        noResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(0);
    });
</script>


        <br>

        <!--div class="text-muted mt-5 pt-3 border-top">Last modified July 3, 2019: <a
                href="https://github.com/google/docsy-example/commit/d6aa89c8b24089d7e6741030864eff209465e896">Added
            links to user guide repo (d6aa89c)</a>
        </div-->
    </div>


			</main>

		</div>
	</div>


	
    <!--footer class="footer mt-auto py-3 bg-light">
        <div class="container">
            <span class="text-muted">&copy; 2020 | based on <a href="https://arc42.org">arc42 7.0</a> | mixed with <a href="http://getbootstrap.com/">Bootstrap v5.0.0-beta</a> | Baked with <a href="http://jbake.org">JBake v2.6.7</a></span>
        </div>
    </footer-->

    <footer class="bg-dark py-5 row d-print-none">
        <div class="container-fluid mx-sm-5">
            <div class="row">
                <div class="col-6 col-sm-4 text-xs-center order-sm-2">


                    <ul class="list-inline mb-0">
                        
                        <li aria-label="User mailing list" class="list-inline-item mx-2 h3" data-original-title="User mailing list" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="mailto:info@docs-as-co.de" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fa fa-envelope"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Twitter" class="list-inline-item mx-2 h3" data-original-title="Twitter" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://twitter.com/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Stack Overflow" class="list-inline-item mx-2 h3" data-original-title="Stack Overflow" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://stackoverflow.com/questions/tagged/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-stack-overflow"></i>
                            </a>
                        </li>
                        
                    </ul>


                </div>
                <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">


                    <ul class="list-inline mb-0">

                        
                        <li aria-label="GitHub" class="list-inline-item mx-2 h3" data-original-title="GitHub" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://github.com/doctoolchain/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-github"></i>
                            </a>
                        </li>
                        

                        


                    </ul>


                </div>
                <div class="col-12 col-sm-4 text-center py-2 order-sm-2">

                        <small class="text-white">built with <a href="https://doctoolchain.org">docToolchain</a> and <a href="https://jbake.org">jBake</a> <br /> theme: <a href="https://www.docsy.dev/">docsy</a></small>

                </div>
            </div>
        </div>
    </footer>

    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>


    <script src="../js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js"></script>
    <script src="../js/blocks.js" ></script>
    <script src="../js/prettify.js"></script>
    <script src="../js/copy-n-paste.js"></script>
    <script src="../js/submenucollapse.js"></script>


</body>
</html>
