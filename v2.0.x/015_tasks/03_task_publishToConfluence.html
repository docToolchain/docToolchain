<!doctype html>
<html lang="de">
<head>
    
    <!-- sourceuri: 015_tasks/03_task_publishToConfluence.html -->
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="jbake" name="generator">
    <meta content="INDEX, FOLLOW" name="ROBOTS">

    <title>publishToConfluence</title>
    <meta content="docToolchain" property="og:title">
    <meta content="build your dev docs the easy way..." property="og:description">
    <meta content="website" property="og:type">
    <meta content="docToolchain" property="og:site_name">
    <meta content="docToolchain" itemprop="name">
    <meta content="build your dev docs the easy way..." itemprop="description">
    <meta content="summary" name="twitter:card">
    <meta content="docToolchain" name="twitter:title">
    <meta content="build your dev docs the easy way..." name="twitter:description">

    <link as="style"
        href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css"
        rel="preload">
    <link href="../css/main.min.881fe5f7b53609f55ebfb496c7097c3b30b2e8ceb20a54bc6a48350ded67224f.css"
        integrity=""
        rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- favicon generated with https://www.favicon-generator.org/ -->
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <script src="../js/jquery-3.5.1.min.js"></script>
    <style>
    div.bg-light {
        background-color: rgba(127, 180, 224, 0.3) !important;
    }

    /* for blog posts */
    span.blogtag {
        border-radius: 10px;
        background-color: #30638E;
        color: white;
        padding: 5px 10px;
    }

    span.blogblogtag a {
        color: white;
        padding: 0
    }

    span.blogtag span {
        margin-left: 10px;
        border-radius: 10px;
        background-color: white;
        color: #30638E;
    }

    div.td-toc {
        height: calc(100vh - 5rem) !important;
    }

    div#toctitle {
        display: none
    }

    #td-section-nav {
        max-height: calc(100vh - 4rem);
        font-size: smaller;
        line-height: 1.1;
    }

    .td-page-meta {
        font-size: smaller;
        line-height: 1.1;
    }

    #td-section-nav ul.td-sidebar-nav__section {
        padding-left: 0;
    }

    span.navbar-logo {
        padding-right: 1.5em;
    }

    .match {
        font-size: smaller;
    }

    .admonitionblock td.icon .fa:before {
        font-size: xxx-large;
    }
    </style>

    <style>
    div.openblock.primary div.content, div.openblock.secondary div.content {
        border: 1px solid #7a2518;
        padding: 5px;
    }

    div.openblock.primary div.content div.content, div.openblock.secondary div.content div.content {
        border: 0 solid #7a2518;
        padding: 0;
    }

    .hidden {
        display: none;
    }

    .switch {
        border-width: 1px 1px 0 1px;
        border-style: solid;
        border-color: #7a2518;
        display: inline-block;
    }

    .switch--item {
        padding: 2px 10px;
        background-color: #ffffff;
        color: #7a2518;
        display: inline-block;
        cursor: pointer;
    }

    .switch--item:not(:first-child) {
        border-width: 0 0 0 1px;
        border-style: solid;
        border-color: #7a2518;
    }

    .switch--item.selected {
        background-color: #7a2519;
        color: #ffffff;
    }
    </style>

    <!-- copy-n-paste.js -->
    <style>
        div.listingblock {
            position: relative;
        }
        div.listingblock > span.icon {
            position: absolute;
            top: 2px;
            right: 6px;
            visibility: hidden;
            z-index: 2;
            cursor: pointer;
        }
        div.listingblock:hover > span.icon {
            visibility: visible;
        }
        div.listingblock div.content pre {
            margin: 0;
        }
    </style>
    <style>
        .td-sidebar-nav__section {
            padding-left: 9px;
        }
        details {
            margin-left: 10px;
        }
        summary {
            cursor: pointer;
            padding-left: 10px; /* Erhöhter linker Padding für den Pfeil */
            list-style: none;
            position: relative; /* Für absolute Positionierung des Pfeils */
        }
        summary::before {
            content: '>';
            position: absolute;
            left: 10px; /* Position des Pfeils */
            top: 50%;
            transform: translateY(-50%) translateX(-120%);
            transition: transform 0.3s;
        }
        details[open] > summary::before {
            transform: translateY(-50%) translateX(-120%) rotate(90deg);
        }
    </style>
</head>

<body onload="prettyPrint()" class="td-section">
<header>
	
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <a class="navbar-brand" href="../index.html">
        <span class="navbar-logo"><img src="../images/doctoolchain-logo-blue.png" alt="docToolchain" width="32px" /></span><span
            class="font-weight-bold">docToolchain</span>
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
        <ul class="navbar-nav mt-2 mt-lg-0">
    <li class="nav-item mr-4 mb-2 mb-lg-0"><!--img src="../images/status.png" alt="status" width="16" height="16" onerror="this.style.display='none'"--></li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../10_about/10_about-the-project.html"><span>About</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../010_manual/20_install.html"><span>User Docs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link active" href="../015_tasks/03_tasks.html"><span>Tasks</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../020_tutorial/010_Install.html"><span>Tutorial</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../025_development/005_contributing_to_docs.html"><span>For Devs</span></a>
            </li>

            <li class="nav-item mr-4 mb-2 mb-lg-0">
                <a class="nav-link " href="../030_news/index.html"><span>News</span></a>
            </li>

        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block" >
        <form action="../search.html">
        <input aria-label="Search this site…" autocomplete="off" class="form-control td-search-input"
               placeholder=" Search this site…" type="search" name="q">
        </form>
    </div>
</nav>

</header>
<div class="container-fluid td-outer">
	<div class="td-main">
		<div class="row flex-xl-nowrap">
			<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
				<div class="td-sidebar__inner" id="td-sidebar-menu" >
					

        <form class="td-sidebar__search d-flex align-items-center d-lg-none" action="../search.html">

            <input aria-label="Search this site…" name="q" autocomplete="off" class="form-control td-search-input"
                   placeholder=" Search this site…" type="search">


            <button aria-controls="td-docs-nav" aria-expanded="false"
                    aria-label="Toggle section navigation" class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" data-target="#td-section-nav"
                    data-toggle="collapse" type="button">
            </button>
        </form>

        <nav aria-label="Submenu" class="collapse td-sidebar-nav" id="td-section-nav" >

            <ul class="td-sidebar-nav__section">
                <li class="td-sidebar-nav__section-title">
                    <span class="align-left pl-0 pr-2 pt-2 active td-sidebar-link td-sidebar-link__section">Tasks</span>
                </li>
                <li>
                  <ul>
                      <li class="collapse show" id="docs">
                          
                        <ul class="td-sidebar-nav__section ul-0">
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_tasks.html" title="What Is a Task?">What Is a Task?</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_autobuildSite.html" title="autobuildSite">autobuildSite</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_collectIncludes.html" title="collectIncludes">collectIncludes</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_convertToDocx.html" title="convertToDocx">convertToDocx</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_convertToEpub.html" title="convertToEpub">convertToEpub</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_copy_themes.html" title="copyThemes">copyThemes</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_createReferenceDoc.html" title="createReferenceDoc">createReferenceDoc</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_dependencyUpdates.html" title="dependencyUpdates">dependencyUpdates</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_downloadTemplate.html" title="downloadTemplate">downloadTemplate</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportChangeLog.html" title="exportChangeLog">exportChangeLog</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportConfluence.html" title="exportConfluence">exportConfluence</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportContributors.html" title="exportContributors">exportContributors</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportDrawIo.html" title="exportDrawIo">exportDrawIo</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportEA.html" title="exportEA">exportEA</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportExcel.html" title="exportExcel">exportExcel</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportJiraIssues.html" title="exportJiraIssues">exportJiraIssues</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportJiraSprintChangelog.html" title="exportJiraSprintChangelogIssues">exportJiraSprintChangelogIssues</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportMarkdown.html" title="exportMarkdown">exportMarkdown</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportMetrics.html" title="exportMetrics">exportMetrics</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportOpenApi.html" title="exportOpenAPI">exportOpenAPI</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportPPT.html" title="exportPPT">exportPPT</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportStructurizr.html" title="exportStructurizr">exportStructurizr</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_exportVisio.html" title="exportVisio">exportVisio</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_fixencoding.html" title="fixEncoding">fixEncoding</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generateContent.html" title="generateContent">generateContent</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generateDeck.html" title="generateDeck">generateDeck</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generateDocBook.html" title="generateDocbook">generateDocbook</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generateHTML.html" title="generateHTML">generateHTML</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generatePDF.html" title="generatePDF">generatePDF</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_generateSite.html" title="generateSite">generateSite</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_htmlSanityCheck.html" title="htmlSanityCheck">htmlSanityCheck</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_prependFilename.html" title="prependFilename">prependFilename</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_previewSite.html" title="previewSite">previewSite</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section active"
                                   href="../015_tasks/03_task_publishToConfluence.html" title="publishToConfluence">publishToConfluence</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/03_task_wipeConfluenceSpace.html" title="wipeConfluenceSpace">wipeConfluenceSpace</a>
                                
                            </li>
                            <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child">
                                <a class="align-left pl-0 pr-2 pt-2 td-sidebar-link td-sidebar-link__section "
                                   href="../015_tasks/150_task_createTask.html" title="createTask">createTask</a>
                                
                            </li>
                        </ul>
                      </li>
                  </ul>
                <li>
        </nav>

				</div>
			</div>
			<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
				<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
					

        <a href="https://github.com/doctoolchain/doctoolchain/edit/ng/src/docs/015_tasks/03_task_publishToConfluence.adoc"
           target="_blank"><i class="fa fa-edit fa-fw"></i> Improve this doc</a>


        <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27publishToConfluence%27&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:%20https://github.com/doctoolchain/doctoolchain/edit/ng/src/docs/015_tasks/03_task_publishToConfluence.adoc%0A%23branch:%20ng" target="_blank"><i
                class="fab fa-github fa-fw"></i> Create an issue</a>

        
        
        <hr />
<script>
const issuesBaseUrl = "https://api.github.com/repos/doctoolchain/doctoolchain/issues";
const searchTerm = "015_tasks/03_task_publishToConfluence.adoc";
</script>

<script src="../js/issues.js"></script>

<style>
        #issues-container {
            background-color: white;
            padding: 0px;
            margin: 0;
        }
        .issue {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .issue:last-child {
            border-bottom: none;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: -10px;
        }
        .issue-content {
            flex-grow: 1;
            background-color: rgba(255,255,255,0.6);
        }
        .issue-title {
            font-weight: bold;
            color: #0366d6;
        }
        .issue-date {
            font-size: 0.9em;
            color: #586069;
        }

</style>

<div id="issues-container">
searching issues...
</div>

        <hr />

        <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_publishtoconfluence">publishToConfluence</a>
<ul class="sectlevel2">
<li><a href="#_about_this_task">About This Task</a></li>
<li><a href="#_special_features">Special Features</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_attributes">Attributes</a></li>
<li><a href="#_css_styling">CSS Styling</a></li>
<li><a href="#_source">Source</a></li>
</ul>
</li>
</ul>
</div>




				</div>
			</div>
			<main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
				    <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
        <ol class="breadcrumb spb-1">
            <!--li aria-current="page" class="breadcrumb-item active">
                <a href="https://example.docsy.dev/docs/">Documentation</a>
            </li-->

        </ol>
    </nav>


    <div class="td-content">
        <p>
            
<style>
.gravatar img {
    margin-left: 3px;
    border-radius: 4px;
}
</style>
<div class="sect1">
<h2 id="_publishtoconfluence">publishToConfluence</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image gravatar"><img src="https://www.gravatar.com/avatar/9934d8546416204bc9454812316d4113?d=identicon" alt="Pascal Euhus" width="32" height="32" title="Pascal Euhus"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2d7d4905cb126f17594f25175a5ef086?d=identicon" alt="Timo Abele" width="32" height="32" title="Timo Abele"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a1a5917e47cadf234366c3e3beef39b6?d=identicon" alt="Johannes Thorn" width="32" height="32" title="Johannes Thorn"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/8ef7eec3e8d0d4f6cf243e8009c1cee8?d=identicon" alt="Bence Hornák" width="32" height="32" title="Bence Hornák"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5a5f4f4cb007274a31a00ca53975ad5c?d=identicon" alt="apparatchick" width="32" height="32" title="apparatchick"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/ad30b590d12622a076b6fe3767266c47?d=identicon" alt="Adelrich König (koa)" width="32" height="32" title="Adelrich König (koa)"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/ddc89ccc2b60ccbd48c6cfa1516573b6?d=identicon" alt="Andreas Klemp (EXT)" width="32" height="32" title="Andreas Klemp (EXT)"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/70d15b356579ae85bc72b68af52946c2?d=identicon" alt="Rosi" width="32" height="32" title="Rosi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/1a867bc36c58b6d45b3dde4d87f9410a?d=identicon" alt="Martin" width="32" height="32" title="Martin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/cc5f3bf8b3cb91c985ed4fd046aa451d?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/fc4dffda746759e7e98470ed9cfcc074?d=identicon" alt="Jan-Niklas Vierheller" width="32" height="32" title="Jan-Niklas Vierheller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c3a42a44fe24014c947ff435ca206081?d=identicon" alt="Jody Winter" width="32" height="32" title="Jody Winter"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/26543494012e9d554d707ae10121bcf3?d=identicon" alt="Denny Israel" width="32" height="32" title="Denny Israel"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/c9b0a22075cd70224fd219e3257a8ce0?d=identicon" alt="Jeremie Bresson" width="32" height="32" title="Jeremie Bresson"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/518a75fcbe5adea38aa4bec267d7572b?d=identicon" alt="Nikolay Orozov" width="32" height="32" title="Nikolay Orozov"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/eedf6f2d4b31cc4e49a7aa4fc55f51d3?d=identicon" alt="Ralf D. Müller" width="32" height="32" title="Ralf D. Müller"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/b55e260be513eedfb745afb36248b8ec?d=identicon" alt="Vladi" width="32" height="32" title="Vladi"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6dd2fe167fd7d2a84322787e3428d14e?d=identicon" alt="Joseph Staub" width="32" height="32" title="Joseph Staub"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/a8ff23c0e396f621ed233027f21c27ea?d=identicon" alt="Peter Stange" width="32" height="32" title="Peter Stange"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/7107bc30257a84fd371a188bda07309f?d=identicon" alt="oliver drewes" width="32" height="32" title="oliver drewes"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/415bf2233be007b088ca81b749f02071?d=identicon" alt="Nils Mahlstaedt" width="32" height="32" title="Nils Mahlstaedt"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/be47969496f94a5a89159d70cd82bda0?d=identicon" alt="sabatmonk" width="32" height="32" title="sabatmonk"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/05107bc93f3e4d103ca06f4e68a64b38?d=identicon" alt="Heiko Stehli" width="32" height="32" title="Heiko Stehli"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/4280fc350b2b3cb323d151be608be3f8?d=identicon" alt="Alexander Herrmann" width="32" height="32" title="Alexander Herrmann"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/3c015f3ee9960d842c195993cbb91cff?d=identicon" alt="Tim Riemer" width="32" height="32" title="Tim Riemer"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/aacd09e76c0affa36f76f8ef337a1536?d=identicon" alt="Luis Muniz" width="32" height="32" title="Luis Muniz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c5a117679f7101b5de26dd25a2a8e98?d=identicon" alt="Dierk Höppner" width="32" height="32" title="Dierk Höppner"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/e7d9e6618a36e94b35d43cbd2925aee0?d=identicon" alt="bit-jkraushaar" width="32" height="32" title="bit-jkraushaar"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/5f528a3f6814d28b583f31842e3e8d9e?d=identicon" alt="Alexander Schwartz" width="32" height="32" title="Alexander Schwartz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/d2017e2cab333d23e2c7285cb62fdc43?d=identicon" alt="Constantin" width="32" height="32" title="Constantin"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/6c384e5d2b684c60fc8f062d75dae3f7?d=identicon" alt="Alfon" width="32" height="32" title="Alfon"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/2dc2929d0609d6338d2794446156f312?d=identicon" alt="Thomas Grabietz" width="32" height="32" title="Thomas Grabietz"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/69124393772349d32fb9fe975545757d?d=identicon" alt="Lars Francke" width="32" height="32" title="Lars Francke"></span> <span class="image gravatar"><img src="https://www.gravatar.com/avatar/73252f762a6ec69bb59a23c8ff861c4a?d=identicon" alt="David M. Carr" width="32" height="32" title="David M. Carr"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>10 minutes to read</pre>
</div>
</div>
<div class="sect2">
<h3 id="_about_this_task">About This Task</h3>
<div class="paragraph">
<p>This task takes a generated HTML file, splits it by headline, and pushes it to your instance of <a href="https://www.atlassian.com/software/confluence">Confluence</a>.
This lets you use the <a href="https://www.writethedocs.org/guide/docs-as-code/">docs-as-code approach</a> even if your organisation insists on using Confluence as its main document repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>From the 01.01.2024 on, Atlassian turns off API V1 for Confluence Cloud, if there is a V2 equivalent. docToolchain versions from 3.1 on support API V2. If you are using an older version of docToolchain, you&#8217;ll need to upgrade to a newer version.
To <strong>enable API V2</strong>, set <code>useV1Api</code> to <code>false</code> in the Confluence section of the docToolchain configuration file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, docToolchain only has full support for the old Confluence editor. The new editor is not fully supported yet. You can use the new editor, but you may experience some unexpected layout issues/ changes. To make use of the new editor you need to set <code>enforceNewEditor</code> to <code>true</code> in the Confluence section of the docToolchain configuration file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_special_features">Special Features</h3>
<div class="sect3">
<h4 id="_easy_code_block_conversion">Easy Code Block Conversion</h4>
<div class="paragraph">
<p><code>[source]</code>-blocks are converted to code-macro blocks in Confluence.</p>
</div>
<div class="paragraph">
<p>Confluence supports a very limited list of languages supported for code block syntax highlighting.
When specifying an unknown language, it would even display an error.
Therefore, some transformation is applied.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If no language is given in the source block, it is explicitly set to plain text (because the default would be Java that might not always apply).</p>
</li>
<li>
<p>Some known and common AsciiDoc source languages are mapped to Confluence code block languages.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">source</th>
<th class="tableblock halign-left valign-top">target</th>
<th class="tableblock halign-left valign-top">note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">produces an acceptable highlighting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only a specific shell is supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yaml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">different name of language</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>If the language of the source block is not supported by Confluence, it is set to plain text as fallback to avoid the error.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Get a list of valid languages (and learn how to add others) <a href="https://confluence.atlassian.com/doc/code-block-macro-139390.html">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_minimal_impact_on_non_techie_confluence_users">Minimal Impact on Non-Techie Confluence Users</h4>
<div class="paragraph">
<p>Only pages and images that changed between task runs are published, and only those changes are notified to page watchers, cutting down on 'spam'.</p>
</div>
</div>
<div class="sect3">
<h4 id="_keywords_automatically_attached_as_labels">Keywords Automatically Attached as Labels</h4>
<div class="paragraph">
<p><code>:keywords:</code> are attached as labels to every Confluence page generated using the <code>publishToConfluence</code> task.
See <a href="https://confluence.atlassian.com/doc/add-remove-and-search-for-labels-136419.html">Atlassian&#8217;s own guidelines on labels</a>.
Several keywords are allowed, and they must be separated by commas. For example: <code>:keywords: label_1, label-2, label3, &#8230;&#8203;</code>.
Labels (keywords) must not contain a space character. Use either '_' or '-'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>You configure the publishToConfluence task in the file docToolchainConfig.groovy. It is located in the root of your project folder. We try to make the configuration self-explanatory, but below is some more information about each config option.</p>
</div>
<div class="paragraph">
<p><strong>input</strong></p>
</div>
<div class="paragraph">
<p>is an array of files to upload to Confluence with the ability
to configure a different parent page for each file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attributes">Attributes</h3>
<div class="ulist">
<ul>
<li>
<p><code>file</code>: absolute or relative path to the asciidoc generated html file to be exported</p>
</li>
<li>
<p><code>url</code>: absolute URL to an asciidoc generated html file to be exported</p>
</li>
<li>
<p><code>ancestorName</code> (optional): the name of the parent page in Confluence as string;
this attribute has priority over ancestorId, but if page with given name doesn&#8217;t exist,
ancestorId will be used as a fallback</p>
</li>
<li>
<p><code>ancestorId</code> (optional): the id of the parent page in Confluence as string; leave this empty
if a new parent shall be created in the space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following four keys can also be used in the global section below</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spaceKey</code>: page specific variable for the key of the confluence space to write to
case sensitive! If the case is not correct, it can be that new page will be
created but can&#8217;t be updated in the next run.</p>
</li>
<li>
<p><code>subpagesForSections</code> (optional): The number of nested sub-pages to create. Default is '1'.
'0' means creating all on one page.
The following migration for removed configuration can be used.</p>
<div class="ulist">
<ul>
<li>
<p><code>allInOnePage = true</code> is the same as <code>subpagesForSections = 0</code></p>
</li>
<li>
<p><code>allInOnePage = false &amp;&amp; createSubpages = false</code> is the same as <code>subpagesForSections = 1</code></p>
</li>
<li>
<p><code>allInOnePage = false &amp;&amp; createSubpages = true</code> is the same as <code>subpagesForSections = 2</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>pagePrefix</code> (optional): page specific variable, the pagePrefix will be a prefix for the page title and it&#8217;s sub-pages
use this if you only have access to one confluence space but need to store several
pages with the same title - a different pagePrefix will make them unique</p>
</li>
<li>
<p><code>pageSuffix</code> (optional): same usage as prefix but appended to the title and it&#8217;s subpages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>only 'file' or 'url' is allowed. If both are given, 'url' is ignored</p>
</div>
<div class="paragraph">
<p><strong>ancestorId</strong></p>
</div>
<div class="paragraph">
<p>The page ID of the parent page where you want your docs to be published.
Go to this page, click <strong>Edit</strong> and the required ID will show up in the URL.
Specify the ID as a string within the config file.</p>
</div>
<div class="paragraph">
<p><strong>api</strong></p>
</div>
<div class="paragraph">
<p>Endpoint of the confluenceAPI (REST) to be used and looks like <code>https://[yourServer]/[context]</code>, while <code>[context]</code> is optional.
If you use Confluence Cloud, you can omit the context.
If you use Confluence Server, you may need to set a context, depending on your Confluence configuration.</p>
</div>
<div class="paragraph">
<p><strong>rateLimit</strong> (since 3.2.0), The rate limit for Confluence requests. Default is 10 requests per second.</p>
</div>
<div class="paragraph">
<p><strong>useV1Api</strong></p>
</div>
<div class="paragraph">
<p><strong><em>This feature is available for docToolchain &gt;= 3.1 only</em></strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you set this to <code>false</code>, ensure the <code>api</code> config is set to <code>https://[yourCloudDomain]</code>. (Mind no <em>context</em> given here)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Confluence Cloud, you can set this to <code>false</code> to use the new API V2. If you are using Confluence Server, you can set this to <code>true</code> to use the old API V1. If you are using Confluence Cloud and set this to <code>false</code>, you will get an error message, once Atlassian turns off API V1 (starting 01.01.2024).</p>
</div>
<div class="paragraph">
<p><strong>enforceNewEditor</strong></p>
</div>
<div class="paragraph">
<p>Atlassian is currently rolling out a new editor for Confluence. If you want to use the new editor, you can set this to <code>true</code>. If you are using the old editor, you can set this to <code>false</code>. If you are using the new editor, you may experience some unexpected layout issues/ changes, since the new editor has yet no feature parity and therefore may be incompatible.</p>
</div>
<div class="paragraph">
<p><strong>disableToC</strong></p>
</div>
<div class="paragraph">
<p>This boolean configuration determines whether the table of contents (ToC) is disabled on the page once uploaded to Confluence. <code>false</code> by default, so the ToC is active.</p>
</div>
<div class="paragraph">
<p><strong>pagePrefix/pageSuffix</strong></p>
</div>
<div class="paragraph">
<p>Confluence can&#8217;t handle two pages with the same name - even with different casing (lowercase, UPPERCASE, a mix).
This script matches pages regardless of case and refuses to replace a page whose name differs from an existing page only by casing.
Ideally, you should create a new Confluence space for each piece of larger documentation.
If you are restricted and can&#8217;t create new spaces, you can use <code>pagePrefix</code>/<code>pageSuffix</code> to define a prefix/suffix for the doc so that it doesn&#8217;t conflict with other page names.</p>
</div>
<div class="paragraph">
<p><strong>pageVersionComment</strong></p>
</div>
<div class="paragraph">
<p>Set an optional comment for the new page version in Confluence.</p>
</div>
<div class="paragraph">
<p><strong>credentials</strong></p>
</div>
<div class="paragraph">
<p>For security reasons it is highly recommended to store your credentials in a separate file outside the Git repository, such as in your Home folder.</p>
</div>
<div class="paragraph">
<p>To authenticate with username and API token, use:
    credentials = "user:${new File("/users/me/apitoken").text}" or
    credentials = "user:${new File("/users/me/apitoken").text}"`.bytes.encodeBase64().toString()` to &#8230;&#8203;&#8230;&#8203;..
You can create an API-token in <a href="https://confluence.atlassian.com/cloud/api-tokens-938839638.html">your profile</a>.</p>
</div>
<div class="paragraph">
<p>To authenticate with username and password, use:
    credentials = &#8230;&#8203;&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>You can also set your username, password of apitoken as an environment variable. You then do the following:
1. Open the file that contains the environment variables:
    a. On a Mac, go to your Home folder and open the file .zpfrofile.
2. &#8230;&#8203;.</p>
</div>
<div class="paragraph">
<p>If you wish to simplify the injection of credentials from external sources, do the following:
1. In docToolchainConfig.groovy, do not enter the credentials. Make sure the credentials are escaped.
2. Create a <code>gradle.properties</code> file in the project or home directory. See <a href="https://docs.gradle.org/current/userguide/build_environment.html">the gradle user guide</a>.
3. Open the file, and put the variables in it:
    - confluenceUser=myusername, and on a new line
    - confluencePass=myuserpassword</p>
</div>
<div class="paragraph">
<p><strong>apikey</strong></p>
</div>
<div class="paragraph">
<p>In situations where you have to use full user authorisation because of internal Confluence permission handling, you&#8217;ll need to add the API-token in addition to the credentials.
The API-token cannot be added to the credentials because it&#8217;s used for user and password exchange.
Therefore, the API-token can be added as parameter <code>apikey</code>, which makes the addition of the token a separate header field with key: <code>keyId</code> and value of <code>apikey</code>.
An example (including storing of the real value outside this configuration) is: <code>apikey = "${new File("/home/me/apitoken").text}"</code>.</p>
</div>
<div class="paragraph">
<p><strong>bearerToken</strong></p>
</div>
<div class="paragraph">
<p>You can pass a <a href="https://confluence.atlassian.com/enterprise/using-personal-access-tokens-1026032365.html">Confluence
Personal Access Token</a> as the <code>bearerToken</code>. It is an alternative to
<code>credentials</code>. Do not confuse it with <code>apiKey</code>.</p>
</div>
<div class="paragraph">
<p><strong>extraPageContent</strong></p>
</div>
<div class="paragraph">
<p>If you need to prefix your pages with a warning stating that 'this is generated content', this is where you do it.</p>
</div>
<div class="paragraph">
<p><strong>enableAttachments</strong></p>
</div>
<div class="paragraph">
<p>If value is set to <code>true</code>, any links to local file references will be uploaded as attachments. The current implementation only supports a single folder, the name of which will be used as a prefix to validate whether your file should be uploaded.
If you enable this feature, and use a folder which starts with 'attachment', an adaption of this prefix is required.</p>
</div>
<div class="paragraph">
<p><strong>pageLimit</strong></p>
</div>
<div class="paragraph">
<p>Limits the number of pages retrieved from the server to check if a page with this name already exists.</p>
</div>
<div class="paragraph">
<p><strong>jiraServerId</strong>
Only required if you are using Jira on-premise. If you are using Jira cloud you do not need to set this value.
Stores the Jira server ID that your Confluence instance is connected to. If a value is set, all anchors pointing to a Jira ticket will be replaced by the Confluence Jira macro. How-To find your Jira server ID <a href="https://confluence.atlassian.com/adminjiraserver/finding-your-server-id-938847652.html">please check the Atlassian documentation</a>.</p>
</div>
<div class="paragraph">
<p>All files to attach will need to be linked inside the document:
<code>link:attachment/myfolder/myfile.json[My API definition]</code></p>
</div>
<div class="paragraph">
<p><strong>attachmentPrefix</strong></p>
</div>
<div class="paragraph">
<p>Stores the expected foldername of your output directory. Default is <code>attachment</code>.</p>
</div>
<div class="paragraph">
<p><strong>proxy</strong></p>
</div>
<div class="paragraph">
<p>If you need to provide proxy to access Confluence, you can set a map with the keys <code>host</code> (e.g. <code>'my.proxy.com'</code>), <code>port</code> (e.g. <code>'1234'</code>) and <code>schema</code> (e.g. <code>'http'</code>) of your proxy.</p>
</div>
<div class="paragraph">
<p><strong>useOpenapiMacro</strong></p>
</div>
<div class="paragraph">
<p>If this option is present and equal to <code>confluence-open-api</code> or <code>swagger-open-api</code> then any source block marked with <code>class openapi</code> will be wrapped in the Elitesoft Swagger Editor macro (see <a href="https://marketplace.atlassian.com/apps/1218914/open-api-swagger-editor-for-confluence">Elitesoft Swagger Editor</a>). The key depends on the version of the macro.</p>
</div>
<div class="paragraph">
<p>For backward compatibility, if this option is present and equal to <code>true</code>, then again the Elitesoft Swagger Editor macro will be used.</p>
</div>
<div class="paragraph">
<p>If this option is present and equal to "open-api" then any source block marked with class openapi will be wrapped in Open API Documentation for Confluence macro:  (see <a href="https://marketplace.atlassian.com/apps/1215176/open-api-documentation-for-confluence">Open API Documentation for Confluence</a>). A download source (yaml) button is shown by default.<br>
Using the plugin can be handled on different ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>copy/paste the content of the YAML file to the plugin without linking to the origin source by using the url to the YAML file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml]
    ----
    \include::https://my-domain.com/path-to-yaml[]
    ----</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>copy/paste the content of the YAML file to the plugin without linking to the origin source by using a YAML file in your project structure:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml]
    ----
    \include::my-yaml-file.yaml[]
    ----</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>create a link between the plugin and the YAML file without copying the content into the plugin. The advantage following this way is that even in case the API specification is changed without re-generating the documentation, the new version of the configuration is used in Confluence.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="asciidoc">    [source.openapi,yaml,role="url:https://my-domain.com/path-to-yaml"]
    ----
    \include::https://my-domain.com/path-to-yaml[]
    ----</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">//Configureation for publishToConfluence

confluence = [:]

// 'input' is an array of files to upload to Confluence with the ability
//          to configure a different parent page for each file.
//
// Attributes
// - 'file': absolute or relative path to the asciidoc generated html file to be exported
// - 'url': absolute URL to an asciidoc generated html file to be exported
// - 'ancestorName' (optional): the name of the parent page in Confluence as string;
//                             this attribute has priority over ancestorId, but if page with given name doesn't exist,
//                             ancestorId will be used as a fallback
// - 'ancestorId' (optional): the id of the parent page in Confluence as string; leave this empty
//                            if a new parent shall be created in the space
//                            Set it for every file so the page scanning is done only for the given ancestor page trees.
//
// The following four keys can also be used in the global section below
// - 'spaceKey' (optional): page specific variable for the key of the confluence space to write to
// - 'subpagesForSections' (optional): The number of nested sub-pages to create. Default is '1'.
//                                     '0' means creating all on one page.
//                                     The following migration for removed configuration can be used.
//                                     'allInOnePage = true' is the same as 'subpagesForSections = 0'
//                                     'allInOnePage = false &amp;&amp; createSubpages = false' is the same as 'subpagesForSections = 1'
//                                     'allInOnePage = false &amp;&amp; createSubpages = true' is the same as 'subpagesForSections = 2'
// - 'pagePrefix' (optional): page specific variable, the pagePrefix will be a prefix for the page title and it's sub-pages
//                            use this if you only have access to one confluence space but need to store several
//                            pages with the same title - a different pagePrefix will make them unique
// - 'pageSuffix' (optional): same usage as prefix but appended to the title and it's subpages
// only 'file' or 'url' is allowed. If both are given, 'url' is ignored
confluence.with {
    input = [
            [ file: "build/docs/html5/arc42-template-de.html" ],
    ]

    // endpoint of the confluenceAPI (REST) to be used
    // https://[yourServer]
    api = 'https://[yourServer]'

    // requests per second for confluence API calls
    rateLimit = 10

//    Additionally, spaceKey, subpagesForSections, pagePrefix and pageSuffix can be globally defined here. The assignment in the input array has precedence

    // the key of the confluence space to write to
    spaceKey = 'asciidoc'

    // if true, all pages will be created using the new editor v2
    // enforceNewEditor = false

    // variable to determine how many layers of sub pages should be created
    subpagesForSections = 1

    // the pagePrefix will be a prefix for each page title
    // use this if you only have access to one confluence space but need to store several
    // pages with the same title - a different pagePrefix will make them unique
    pagePrefix = ''

    pageSuffix = ''

    /*
    WARNING: It is strongly recommended to store credentials securely instead of commiting plain text values to your git repository!!!

    Tool expects credentials that belong to an account which has the right permissions to to create and edit confluence pages in the given space.
    Credentials can be used in a form of:
     - passed parameters when calling script (-PconfluenceUser=myUsername -PconfluencePass=myPassword) which can be fetched as a secrets on CI/CD or
     - gradle variables set through gradle properties (uses the 'confluenceUser' and 'confluencePass' keys)
    Often, same credentials are used for Jira &amp; Confluence, in which case it is recommended to pass CLI parameters for both entities as
    -Pusername=myUser -Ppassword=myPassword
    */

    //optional API-token to be added in case the credentials are needed for user and password exchange.
    //apikey = "[API-token]"

    // HTML Content that will be included with every page published
    // directly after the TOC. If left empty no additional content will be
    // added
    // extraPageContent = '&lt;ac:structured-macro ac:name="warning"&gt;&lt;ac:parameter ac:name="title" /&gt;&lt;ac:rich-text-body&gt;This is a generated page, do not edit!&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;
    extraPageContent = ''

    // enable or disable attachment uploads for local file references
    enableAttachments = false

    // default attachmentPrefix = attachment - All files to attach will require to be linked inside the document.
    // attachmentPrefix = "attachment"


    // Optional proxy configuration, only used to access Confluence
    // schema supports http and https
    // proxy = [host: 'my.proxy.com', port: 1234, schema: 'http']

    // Optional: specify which Confluence OpenAPI Macro should be used to render OpenAPI definitions
    // possible values: ["confluence-open-api", "open-api", "swagger-open-api", true]. true is the same as "confluence-open-api" for backward compatibility
    // useOpenapiMacro = "confluence-open-api"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_css_styling">CSS Styling</h3>
<div class="paragraph">
<p>Some AsciiDoctor features depend on specific CSS style definitions.
Unless these styles are defined, some formatting that is present in the HTML version will not be represented when published to Confluence.
To configure Confluence to include additional style definitions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to Confluence as a space admin.</p>
</li>
<li>
<p>Go to the desired space.</p>
</li>
<li>
<p>Select <strong>Space tools &gt; Look and Feel &gt; Stylesheet</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> then enter the desired style definitions.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The default style definitions can be found in the AsciiDoc project as <a href="https://raw.githubusercontent.com/asciidoctor/asciidoctor/master/data/stylesheets/asciidoctor-default.css">asciidoctor-default.css</a>.
You will most likely <strong>NOT</strong> want to include the entire thing, as some of the definitions are likely to disrupt Confluence&#8217;s layout.</p>
</div>
<div class="paragraph">
<p>The following style definitions are Confluence-compatible, and will enable the use of the built-in roles (<code>big</code>/<code>small</code>, <code>underline</code>/<code>overline</code>/<code>line-through</code>, <code><em>COLOR</em></code>/<code><em>COLOR</em>-background</code> for the <a href="https://en.wikipedia.org/wiki/Web_colors#HTML_color_names">sixteen HTML color names</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code data-lang="css">.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source">Source</h3>
<details>
<summary class="title">Show source code of <code>scripts/publishToConfluence.gradle</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/scripts/publishToConfluence.gradle" target="_blank" rel="noopener">GitHub · docToolchain/scripts/publishToConfluence.gradle</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">scripts/publishToConfluence.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">task publishToConfluence(
        description: 'publishes the HTML rendered output to confluence',
        group: 'docToolchain'
) {
    doLast {
        logger.info("docToolchain&gt; docDir: "+docDir)
        config.confluence.api = findProperty("confluence.api")?:config.confluence.api
        //TODO default should be false, if the V1 has been removed in cloud
        config.confluence.useV1Api = findProperty("confluence.useV1Api") != null ?
            findProperty("confluence.useV1Api") : config.confluence.useV1Api != [:] ?
            config.confluence.useV1Api :true
        Asciidoc2ConfluenceTask.From(config, docDir).execute()
    }
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">Show source code of <code>core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</code> or go directly to <a href="https://github.com/docToolchain/docToolchain/blob/ng/core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy" target="_blank" rel="noopener">GitHub · docToolchain/core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</a>.</summary>
<div class="content">
<div class="listingblock">
<div class="title">core/src/main/groovy/org/docToolchain/scripts/asciidoc2confluence.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code data-lang="groovy">package org.docToolchain.scripts

/**
 * THIS SCRIPT HAS BEEN DEPRECATED. IT IS NOT USED ANYMORE. PLEASE REFER TO THE NEW Asciidoc2ConfluenceTask
 * IMPLEMENTATION INSTEAD. REFERENCE ONLY.
 */

import org.docToolchain.atlassian.transformer.HtmlTransformer

/**
 * Created by Ralf D. Mueller and Alexander Heusingfeld
 * https://github.com/rdmueller/asciidoc2confluence
 *
 * this script expects an HTML document created with AsciiDoctor
 * in the following style (default AsciiDoctor output)
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     &lt;div class="sectionbody"&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *         &lt;div class="sect2"&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *     &lt;/div&gt;
 * &lt;/div&gt;
 * &lt;div class="sect1"&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     ...
 * &lt;/div&gt;
 *
 */

/*
    Additions for issue #342 marked as #342-dierk42
    ;-)
*/

// some dependencies

import org.jsoup.nodes.Document
import org.jsoup.nodes.Element
import org.jsoup.nodes.Entities
import org.jsoup.nodes.TextNode
import org.jsoup.select.Elements

import groovy.transform.Field

import java.nio.charset.Charset
import java.nio.file.Path
import java.security.MessageDigest
import static groovy.io.FileType.FILES

import org.docToolchain.atlassian.confluence.clients.ConfluenceClientV1
import org.docToolchain.atlassian.confluence.clients.ConfluenceClientV2
import org.docToolchain.configuration.ConfigService
import org.docToolchain.atlassian.confluence.ConfluenceService

@Field
ConfigService configService = new ConfigService(config)

@Field
ConfluenceService confluenceService = new ConfluenceService(configService)

@Field
def confluenceClient = configService.getConfigProperty("confluence.useV1Api") ?
        new ConfluenceClientV1(configService) :
        new ConfluenceClientV2(configService)

@Field
def CDATA_PLACEHOLDER_START = '&lt;cdata-placeholder&gt;'

@Field
def CDATA_PLACEHOLDER_END = '&lt;/cdata-placeholder&gt;'

@Field
def baseUrl
def allPages
// #938-mksiva: global variable to hold input spaceKey passed in the Config.groovy
def spaceKeyInput
// configuration

def confluenceSpaceKey
def confluenceSubpagesForSections
@Field
def confluencePagePrefix
@Field
def confluencePageSuffix
//def baseApiPath = new URI(config.confluence.api).path
// helper functions

def MD5(String s) {
    MessageDigest.getInstance("MD5").digest(s.bytes).encodeHex().toString()
}

def parseAdmonitionBlock(block, String type) {
    content = block.select(".content").first()
    titleElement = content.select(".title")
    titleText = ''
    if(titleElement != null) {
        titleText = "&lt;ac:parameter ac:name=\"title\"&gt;${titleElement.text()}&lt;/ac:parameter&gt;"
        titleElement.remove()
    }
    block.after("&lt;ac:structured-macro ac:name=\"${type}\"&gt;${titleText}&lt;ac:rich-text-body&gt;${content}&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;")
    block.remove()
}

/*  #342-dierk42

    add labels to a Confluence page. Labels are taken from :keywords: which
    are converted as meta tags in HTML. Building the array: see below

    Confluence allows adding labels only after creation of a page.
    Therefore we need extra API calls.

    Currently the labels are added one by one. Suggestion for improvement:
    Build a label structure of all labels an place them with one call.

    Replaces exisiting labels. No harm
    Does not check for deleted labels when keywords are deleted from source
    document!
*/
def addLabels = { def pageId, def labelsArray -&gt;
    // Attach each label in a API call of its own. The only prefix possible
    // in our own Confluence is 'global'
    labelsArray.each { label -&gt;
        label_data = [
            prefix : 'global',
            name : label
        ]
        confluenceClient.addLabel(pageId, label_data)
        println "added label " + label + " to page ID " + pageId
    }
}


def uploadAttachment = { def pageId, String url, String fileName, String note -&gt;
    def is
    def localHash
    if (url.startsWith('http')) {
        is = new URL(url).openStream()
        //build a hash of the attachment
        localHash = MD5(new URL(url).openStream().text)
    } else {
        is = new File(url).newDataInputStream()
        //build a hash of the attachment
        localHash = MD5(new File(url).newDataInputStream().text)
    }

    def attachment = confluenceClient.getAttachment(pageId, fileName)
    if (attachment?.results) {
        // attachment exists. need an update?
        if (confluenceClient.attachmentHasChanged(attachment, localHash)) {
            //hash is different -&gt; attachment needs to be updated
            confluenceClient.updateAttachment(pageId, attachment.results[0].id, is, fileName, note, localHash)
            println "    updated attachment"
        }
    } else {
        confluenceClient.createAttachment(pageId, is, fileName, note, localHash)
    }
}

def realTitle(pageTitle){
    confluencePagePrefix + pageTitle + confluencePageSuffix
}

def rewriteMarks (body) {
    // Confluence strips out mark elements.  Replace them with default formatting.
    body.select('mark').wrap('&lt;span style="background:#ff0;color:#000"&gt;&lt;/style&gt;').unwrap()
}

// #352-LuisMuniz: Helper methods
// Fetch all pages of the defined config ancestorsIds. Only keep relevant info in the pages Map
// The map is indexed by lower-case title
def retrieveAllPages = { String spaceKey -&gt;
    // #938-mksiva: added a condition spaceKeyInput is null, if it is null, it means that, space key is different, so re fetch all pages.
    if (allPages != null &amp;&amp; spaceKeyInput == null) {
        println "allPages already retrieved"
        allPages
    } else {
        def pageIds = []
        def checkSpace = false
        int pageLimit = config.confluence.pageLimit ? config.confluence.pageLimit : 100
        config.confluence.input.each { input -&gt;
            if (!input.ancestorId) {
                // if one ancestorId is missing we should scan the whole space
                checkSpace = true;
                return
            }
            pageIds.add(input.ancestorId)
        }
        println (".")

        if(checkSpace) {
            allPages = confluenceClient.fetchPagesBySpaceKey(spaceKey, pageLimit)
        } else {
            allPages = confluenceClient.fetchPagesByAncestorId(pageIds, pageLimit)
        }
        allPages
    }
}


// Retrieve a page by id with contents and version
def retrieveFullPage = { String id -&gt;
    println("retrieving page with id " + id)
    confluenceClient.retrieveFullPageById(id)
}

//if a parent has been specified, check whether a page has the same parent.
boolean hasRequestedParent(Map existingPage, String requestedParentId) {
    if (requestedParentId) {
        existingPage.parentId == requestedParentId
    } else {
        true
    }
}

def rewriteDescriptionLists(body) {
    def TAGS = [ dt: 'th', dd: 'td' ]
    body.select('dl').each { dl -&gt;
        // WHATWG allows wrapping dt/dd in divs, simply unwrap them
        dl.select('div').each { it.unwrap() }

        // group dts and dds that belong together, usually it will be a 1:1 relation
        // but HTML allows for different constellations
        def rows = []
        def current = [dt: [], dd: []]
        rows &lt;&lt; current
        dl.select('dt, dd').each { child -&gt;
            def tagName = child.tagName()
            if (tagName == 'dt' &amp;&amp; current.dd.size() &gt; 0) {
                // dt follows dd, start a new group
                current = [dt: [], dd: []]
                rows &lt;&lt; current
            }
            current[tagName] &lt;&lt; child.tagName(TAGS[tagName])
            child.remove()
        }

        rows.each { row -&gt;
            def sizes = [dt: row.dt.size(), dd: row.dd.size()]
            def rowspanIdx = [dt: -1, dd: sizes.dd - 1]
            def rowspan = Math.abs(sizes.dt - sizes.dd) + 1
            def max = sizes.dt
            if (sizes.dt &lt; sizes.dd) {
                max = sizes.dd
                rowspanIdx = [dt: sizes.dt - 1, dd: -1]
            }
            (0..&lt;max).each { idx -&gt;
                def tr = dl.appendElement('tr')
                ['dt', 'dd'].each { type -&gt;
                    if (sizes[type] &gt; idx) {
                        tr.appendChild(row[type][idx])
                        if (idx == rowspanIdx[type] &amp;&amp; rowspan &gt; 1) {
                            row[type][idx].attr('rowspan', "${rowspan}")
                        }
                    } else if (idx == 0) {
                        tr.appendElement(TAGS[type]).attr('rowspan', "${rowspan}")
                    }
                }
            }
        }

        dl.wrap('&lt;table&gt;&lt;/table&gt;')
            .unwrap()
    }
}

def rewriteInternalLinks (body, anchors, pageAnchors) {
    // find internal cross-references and replace them with link macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith('#')) {
            def anchor = href.substring(1)
            def pageTitle = anchors[anchor] ?: pageAnchors[anchor]
            if (pageTitle &amp;&amp; a.text()) {
                // as Confluence insists on link texts to be contained
                // inside CDATA, we have to strip all HTML and
                // potentially loose styling that way.
                a.html(a.text())
                a.wrap("&lt;ac:link${anchors.containsKey(anchor) ? ' ac:anchor="' + anchor + '"' : ''}&gt;&lt;/ac:link&gt;")
                   .before("&lt;ri:page ri:content-title=\"${realTitle pageTitle}\"/&gt;")
                   .wrap("&lt;ac:plain-text-link-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-link-body&gt;")
                   .unwrap()
            }
        }
    }
}

def rewriteJiraLinks = { body -&gt;
    // find links to jira tickets and replace them with jira macros
    body.select('a[href]').each { a -&gt;
        def href = a.attr('href')
        if (href.startsWith(config.jira.api + "/browse/")) {
                def ticketId = a.text()
                a.before("""&lt;ac:structured-macro ac:name=\"jira\" ac:schema-version=\"1\"&gt;
                     &lt;ac:parameter ac:name=\"key\"&gt;${ticketId}&lt;/ac:parameter&gt;
                     &lt;ac:parameter ac:name=\"serverId\"&gt;${config.confluence.jiraServerId}&lt;/ac:parameter&gt;
                     &lt;/ac:structured-macro&gt;""")
                a.remove()
        }
    }
}

def rewriteOpenAPI (org.jsoup.nodes.Element body) {
    if (config.confluence.useOpenapiMacro == true || config.confluence.useOpenapiMacro == 'confluence-open-api') {
        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()
            code.parent()
                    .wrap('&lt;ac:structured-macro ac:name="confluence-open-api" ac:schema-version="1" ac:macro-id="1dfde21b-6111-4535-928a-470fa8ae3e7d"&gt;&lt;/ac:structured-macro&gt;')
                    .unwrap()
            code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
        }
    } else if (config.confluence.useOpenapiMacro == 'swagger-open-api') {
        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()
            code.parent()
                    .wrap('&lt;ac:structured-macro ac:name="swagger-open-api" ac:schema-version="1" ac:macro-id="f9deda8a-1375-4488-8ca5-3e10e2e4ee70"&gt;&lt;/ac:structured-macro&gt;')
                    .unwrap()
            code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
        }
    } else if (config.confluence.useOpenapiMacro == 'open-api') {
        def includeURL=null

        for (Element e : body.select('div .listingblock.openapi')) {
            for (String s : e.className().split(" ")) {
                if (s.startsWith("url")) {
                    //include the link to the URL for the macro
                    includeURL = s.replace('url:', '')
                }
            }
        }

        body.select('div.openapi  pre &gt; code').each { code -&gt;
            def parent=code.parent()
            def rawYaml=code.wholeText()

            code.parent()
                .wrap('&lt;ac:structured-macro ac:name="open-api" ac:schema-version="1" data-layout="default" ac:macro-id="4302c9d8-fca4-4f14-99a9-9885128870fa"&gt;&lt;/ac:structured-macro&gt;')
                .unwrap()

            if (includeURL!=null)
            {
                code.before('&lt;ac:parameter ac:name="url"&gt;'+includeURL+'&lt;/ac:parameter&gt;')
            }
            else {
                //default: show download button
                code.before('&lt;ac:parameter ac:name="showDownloadButton"&gt;true&lt;/ac:parameter&gt;')
                code.wrap("&lt;ac:plain-text-body&gt;${CDATA_PLACEHOLDER_START}${CDATA_PLACEHOLDER_END}&lt;/ac:plain-text-body&gt;")
                    .replaceWith(new TextNode(rawYaml))
            }
        }
    }
}

def getEmbeddedImageData(src){
    def imageData = src.split("[;:,]")
    def fileExtension = imageData[1].split("/")[1]
    // treat svg+xml as svg to be able to create a file from the embedded image
    // more MIME types: https://www.iana.org/assignments/media-types/media-types.xhtml#image
    if(fileExtension == "svg+xml"){
        fileExtension = "svg"
    }
    return Map.of(
        "fileExtension", fileExtension,
        "encoding", imageData[2],
        "encodedContent", imageData[3]
    )
}

def handleEmbeddedImage(basePath, fileName, fileExtension, encodedContent) {
    def imageDir = "images/"
    if(config.imageDirs.size() &gt; 0){
        def dir = config.imageDirs.find { it -&gt;
            def configureImagesDir = it.replace('./', '/')
            Path.of(basePath, configureImagesDir, fileName).toFile().exists()
        }
        if(dir != null){
            imageDir = dir.replace('./', '/')
        }
    }

    if(!Path.of(basePath, imageDir, fileName).toFile().exists()){
        println "Could not find embedded image at a known location"
        def embeddedImagesLocation = "/confluence/images/"
        new File(basePath + embeddedImagesLocation).mkdirs()
        def imageHash = MD5(encodedContent)
        println "Embedded Image Hash " + imageHash
        def image = new File(basePath + embeddedImagesLocation + imageHash + ".${fileExtension}")
        if(!image.exists()){
            println "Creating image at " + basePath + embeddedImagesLocation
            image.withOutputStream {output -&gt;
                output.write(encodedContent.decodeBase64())}
        }
        fileName = imageHash + ".${fileExtension}"
        return Map.of(
            "filePath", image.canonicalPath,
            "fileName", fileName
        )
    } else {
        return Map.of(
            "filePath", basePath + imageDir + fileName,
            "fileName", fileName
        )
    }
}

//modify local page in order to match the internal confluence storage representation a bit better
//definition lists are not displayed by confluence, so turn them into tables
//body can be of type Element or Elements

def parseBody(body, anchors, pageAnchors) {
    def uploads = []
    rewriteOpenAPI body

    body.select('div.paragraph').unwrap()
    body.select('div.ulist').unwrap()
    //body.select('div.sect3').unwrap()
    [   'note':'info',
        'warning':'warning',
        'important':'warning',
        'caution':'note',
        'tip':'tip'            ].each { adType, cType -&gt;
        body.select('.admonitionblock.'+adType).each { block -&gt;
            parseAdmonitionBlock(block, cType)
        }
    }
    //special for the arc42-template
    body.select('div.arc42help').select('.content')
            .wrap('&lt;ac:structured-macro ac:name="expand"&gt;&lt;/ac:structured-macro&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;/ac:rich-text-body&gt;')
            .wrap('&lt;ac:structured-macro ac:name="info"&gt;&lt;/ac:structured-macro&gt;')
            .before('&lt;ac:parameter ac:name="title"&gt;arc42&lt;/ac:parameter&gt;')
            .wrap('&lt;ac:rich-text-body&gt;&lt;p&gt;&lt;/p&gt;&lt;/ac:rich-text-body&gt;')
    body.select('div.arc42help').unwrap()
    body.select('div.title').wrap("&lt;strong&gt;&lt;/strong&gt;").before("&lt;br /&gt;").wrap("&lt;div&gt;&lt;/div&gt;")
    body.select('div.listingblock').wrap("&lt;p&gt;&lt;/p&gt;").unwrap()
    // see if we can find referenced images and fetch them
    new File("tmp/images/.").mkdirs()
    // find images, extract their URLs for later uploading (after we know the pageId) and replace them with this macro:
    // &lt;ac:image ac:align="center" ac:width="500"&gt;
    // &lt;ri:attachment ri:filename="deployment-context.png"/&gt;
    // &lt;/ac:image&gt;

    body.select('img').each { img -&gt;
        def src = img.attr('src')
        def imgWidth = img.attr('width')?:500
        def imgAlign = img.attr('align')?:"center"

        //it is not an online image, so upload it to confluence and use the ri:attachment tag
        if(!src.startsWith("http")) {
            def sanitizedBaseUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')
            def newUrl
            def fileName
            //it is an embedded image
            if(src.startsWith("data:image")){
                def imageData = getEmbeddedImageData(src)
                def fileExtension = imageData.get("fileExtension")
                def encodedContent = imageData.get("encodedContent")
                fileName = img.attr('alt').replaceAll(/\s+/,"_").concat(".${fileExtension}")
                def embeddedImage = handleEmbeddedImage(sanitizedBaseUrl, fileName, fileExtension, encodedContent)
                newUrl = embeddedImage.get("filePath")
                fileName = embeddedImage.get("fileName")
            }else {
                newUrl = sanitizedBaseUrl + src
                fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
            }
            newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")
            println "    image: "+newUrl
            uploads &lt;&lt;  [0,newUrl,fileName,"automatically uploaded"]
            img.after("&lt;ac:image ac:align=\"${imgAlign}\" ac:width=\"${imgWidth}\"&gt;&lt;ri:attachment ri:filename=\"${fileName}\"/&gt;&lt;/ac:image&gt;")
        }
        // it is an online image, so we have to use the ri:url tag
        else {
            img.after("&lt;ac:image ac:align=\"imgAlign\" ac:width=\"${imgWidth}\"&gt;&lt;ri:url ri:value=\"${src}\"/&gt;&lt;/ac:image&gt;")
        }
        img.remove()
    }


    if(config.confluence.enableAttachments){
        attachmentPrefix = config.confluence.attachmentPrefix ? config.confluence.attachmentPrefix : 'attachment'
        body.select('a').each { link -&gt;

            def src = link.attr('href')
            println "    attachment src: "+src

            //upload it to confluence and use the ri:attachment tag
            if(src.startsWith(attachmentPrefix)) {
                def newUrl = baseUrl.toString().replaceAll('\\\\','/').replaceAll('/[^/]*$','/')+src
                def fileName = java.net.URLDecoder.decode((src.tokenize('/')[-1]),"UTF-8")
                newUrl = java.net.URLDecoder.decode(newUrl,"UTF-8")

                uploads &lt;&lt;  [0,newUrl,fileName,"automatically uploaded non-image attachment by docToolchain"]
                def uriArray=fileName.split("/")
                def pureFilename = uriArray[uriArray.length-1]
                def innerhtml = link.html()
                link.after("&lt;ac:structured-macro ac:name=\"view-file\" ac:schema-version=\"1\"&gt;&lt;ac:parameter ac:name=\"name\"&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
                link.after("&lt;ac:link&gt;&lt;ri:attachment ri:filename=\"${pureFilename}\"/&gt;&lt;ac:plain-text-link-body&gt; &lt;![CDATA[\"${innerhtml}\"]]&gt;&lt;/ac:plain-text-link-body&gt;&lt;/ac:link&gt;")
                link.remove()

            }
        }
    }

    if(config.confluence.jiraServerId){
        rewriteJiraLinks body
    }

    rewriteMarks body
    rewriteDescriptionLists body
    rewriteInternalLinks body, anchors, pageAnchors
    //not really sure if must check here the type
    String bodyString = body
    if(body instanceof Element){
        bodyString = body.html()
    }
    Element saneHtml = new Document("")
        .outputSettings(new Document.OutputSettings().syntax(Document.OutputSettings.Syntax.xml).prettyPrint(false))
        .html(bodyString)
    def pageString = new HtmlTransformer().transformToConfluenceFormat(saneHtml)

    return Map.of(
        "page", pageString,
        "uploads", uploads
    )
}

def generateAndAttachToC(localPage) {
    def content
    if(config.confluence.disableToC){
        def prefix = (config.confluence.extraPageContent?:'')
        content  = prefix+localPage
    }else{
        def default_toc = '&lt;p&gt;&lt;ac:structured-macro ac:name="toc"/&gt;&lt;/p&gt;'
        def prefix = (config.confluence.tableOfContents?:default_toc)+(config.confluence.extraPageContent?:'')
        content  = prefix+localPage
        def default_children = '&lt;p&gt;&lt;ac:structured-macro ac:name="children"&gt;&lt;ac:parameter ac:name="sort"&gt;creation&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;&lt;/p&gt;'
        content += (config.confluence.tableOfChildren?:default_children)
    }
    def localHash = MD5(localPage)
    content += '&lt;ac:placeholder&gt;hash: #'+localHash+'#&lt;/ac:placeholder&gt;'
    return content
}



// the create-or-update functionality for confluence pages
// #342-dierk42: added parameter 'keywords'
def pushToConfluence = { pageTitle, pageBody, parentId, anchors, pageAnchors, keywords -&gt;
    parentId = parentId?.toString()

    def deferredUpload = []
    String realTitleLC = realTitle(pageTitle).toLowerCase()
    String realTitle = realTitle(pageTitle)

    //try to get an existing page
    def parsedBody = parseBody(pageBody, anchors, pageAnchors)
    localPage = parsedBody.get("page")
    deferredUpload.addAll(parsedBody.get("uploads"))
    def localHash = MD5(localPage)
    localPage = generateAndAttachToC(localPage)

    // #938-mksiva: Changed the 3rd parameter from 'config.confluence.spaceKey' to 'confluenceSpaceKey' as it was always taking the default spaceKey
    // instead of the one passed in the input for each row.
    def pages = retrieveAllPages(confluenceSpaceKey)
    println("pages retrieved")
    // println "Suche nach vorhandener Seite: " + pageTitle
    Map existingPage = pages[realTitleLC]
    def page

    if (existingPage) {
        if (hasRequestedParent(existingPage, parentId)) {
            page = retrieveFullPage(existingPage.id as String)
        } else {
            page = null
        }
    } else {
        page = null
    }
    // println "Gefunden: " + page.id + " Titel: " + page.title

    if (page) {
        println "found existing page: " + page.id +" version "+page.version.number

        //extract hash from remote page to see if it is different from local one
        def remotePage = page.body.storage.value.toString().trim()

        def remoteHash = remotePage =~ /(?ms)hash: #([^#]+)#/
        remoteHash = remoteHash.size()==0?"":remoteHash[0][1]

        // println "remoteHash: " + remoteHash
        // println "localHash:  " + localHash

        if (remoteHash == localHash) {
            println "page hasn't changed!"
            deferredUpload.each {
                uploadAttachment(page?.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        } else {
            def newPageVersion = (page.version.number as Integer) + 1

            confluenceClient.updatePage(
                    page.id,
                    realTitle,
                    confluenceSpaceKey,
                    localPage,
                    newPageVersion,
                    config.confluence.pageVersionComment ?: '',
                    parentId
            )
            println "&gt; updated page "+page.id
            deferredUpload.each {
                uploadAttachment(page.id, it[1], it[2], it[3])
            }
            deferredUpload = []
            // #324-dierk42: Add keywords as labels to page.
            if (keywords) {
                addLabels(page.id, keywords)
            }
            return page.id
        }
    } else {
        //#352-LuisMuniz if the existing page's parent does not match the requested parentId, fail
        if (existingPage &amp;&amp; !hasRequestedParent(existingPage, parentId)) {
            throw new IllegalArgumentException("Cannot create page, page with the same "
                    + "title=${existingPage.title} "
                    + "with id=${existingPage.id} already exists in the space. "
                    + "A Confluence page title must be unique within a space, consider specifying a 'confluencePagePrefix' in ConfluenceConfig.groovy")
        }
        //create a page
        page = confluenceClient.createPage(
                realTitle,
                confluenceSpaceKey,
                localPage,
                config.confluence.pageVersionComment ?: '',
                parentId
        )
        println "&gt; created page "+page?.id
        deferredUpload.each {
            uploadAttachment(page?.id, it[1], it[2], it[3])
        }
        deferredUpload = []
        // #324-dierk42: Add keywords as labels to page.
        if (keywords) {
            addLabels(page?.id, keywords)
        }
        return page?.id
    }
}

def parseAnchors(page) {
    def anchors = [:]
    page.body.select('[id]').each { anchor -&gt;
        def name = anchor.attr('id')
        anchors[name] = page.title
        anchor.before("&lt;ac:structured-macro ac:name=\"anchor\"&gt;&lt;ac:parameter ac:name=\"\"&gt;${name}&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;")
    }
    anchors
}

def pushPages
pushPages = { pages, anchors, pageAnchors, labels -&gt;
    pages.each { page -&gt;
        page.title = page.title.trim()
        println page.title
        def id = pushToConfluence page.title, page.body, page.parent, anchors, pageAnchors, labels
        page.children*.parent = id
        // println "Push children von id " + id
        pushPages page.children, anchors, pageAnchors, labels
        // println "Ende Push children von id " + id
    }
}

def recordPageAnchor(head) {
    def a = [:]
    if (head.attr('id')) {
        a[head.attr('id')] = head.text()
    }
    a
}

def promoteHeaders(tree, start, offset) {
    (start..7).each { i -&gt;
        tree.select("h${i}").tagName("h${i-offset}").before('&lt;br /&gt;')
    }
}

def retrievePageIdByName = { String name -&gt;
    def data = confluenceClient.retrievePageIdByName(name, confluenceSpaceKey)
    return data?.results?.get(0)?.id
}

def getPagesRecursive(Element element, String parentId, Map anchors, Map pageAnchors, int level, int maxLevel) {
    def pages = []
    element.select("div.sect${level}").each { sect -&gt;
        def title = sect.select("h${level + 1}").text()
        pageAnchors.putAll(recordPageAnchor(sect.select("h${level + 1}")))
        Elements pageBody
        if (level == 1) {
            pageBody = sect.select('div.sectionbody')
        } else {
            pageBody = new Elements(sect)
            pageBody.select("h${level + 1}").remove()
        }
        def currentPage = [
            title: title,
            body: pageBody,
            children: [],
            parent: parentId
        ]

        if (maxLevel &gt; level) {
            currentPage.children.addAll(getPagesRecursive(sect, null, anchors, pageAnchors, level + 1, maxLevel))
            pageBody.select("div.sect${level + 1}").remove()
        } else {
            pageBody.select("div.sect${level + 1}").unwrap()
        }
        promoteHeaders sect, level + 2, level + 1
        pages &lt;&lt; currentPage
        anchors.putAll(parseAnchors(currentPage))
    }
    return pages
}

def getPages(Document dom, String parentId, int maxLevel) {
    def anchors = [:]
    def pageAnchors = [:]
    def sections = pages = []
    def title = dom.select('h1').text()
    if (maxLevel &lt;= 0) {
        dom.select('div#content').each { pageBody -&gt;
            pageBody.select('div.sect2').unwrap()
            promoteHeaders pageBody, 2, 1
            def page = [title   : title,
                        body    : pageBody,
                        children: [],
                        parent  : parentId]
            pages &lt;&lt; page
            sections = page.children
            parentId = null
            anchors.putAll(parseAnchors(page))
        }
    } else {
        // let's try to select the "first page" and push it to confluence
        dom.select('div#preamble div.sectionbody').each { pageBody -&gt;
            pageBody.select('div.sect2').unwrap()
            def preamble = [
                title: title,
                body: pageBody,
                children: [],
                parent: parentId
            ]
            pages &lt;&lt; preamble
            sections = preamble.children
            parentId = null
            anchors.putAll(parseAnchors(preamble))
        }
        sections.addAll(getPagesRecursive(dom, parentId, anchors, pageAnchors, 1, maxLevel))
    }
    return [pages, anchors, pageAnchors]
}

if(config.confluence.inputHtmlFolder) {
    htmlFolder = "${docDir}/${config.confluence.inputHtmlFolder}"
    println "Starting processing files in folder: " + config.confluence.inputHtmlFolder
    def dir = new File(htmlFolder)

    dir.eachFileRecurse (FILES) { fileName -&gt;
        if (fileName.isFile()){
            def map = [file: config.confluence.inputHtmlFolder+fileName.getName()]
            config.confluence.input.add(map)
        }
    }
}

config.confluence.input.each { input -&gt;
    // TODO check why this is necessary
    if(input.file) {
        input.file = confluenceService.checkAndBuildCanonicalFileName(input.file)
        //  assignend, but never used in pushToConfluence(...) (fixed here)
        // #938-mksiva: assign spaceKey passed for each file in the input
        spaceKeyInput = input.spaceKey
        confluenceSpaceKey = input.spaceKey ?: config.confluence.spaceKey
        confluenceCreateSubpages = (input.createSubpages != null) ? input.createSubpages : config.confluence.createSubpages
        confluenceAllInOnePage = (input.allInOnePage != null) ? input.allInOnePage : config.confluence.allInOnePage
        if (!(confluenceCreateSubpages instanceof ConfigObject &amp;&amp; confluenceAllInOnePage instanceof ConfigObject)) {
            println "ERROR:"
            println "Deprecated configuration, migrate as follows:"
            println "allInOnePage = true -&gt; subpagesForSections = 0"
            println "allInOnePage = false &amp;&amp; createSubpages = false -&gt; subpagesForSections = 1"
            println "allInOnePage = false &amp;&amp; createSubpages = true -&gt; subpagesForSections = 2"
            throw new RuntimeException("config problem")
        }
        confluenceSubpagesForSections = (input.subpagesForSections != null) ? input.subpagesForSections : config.confluence.subpagesForSections
        if (confluenceSubpagesForSections instanceof ConfigObject) {
            confluenceSubpagesForSections = 1
        }
    //  hard to read in case of using :sectnums: -&gt; so we add a suffix
        confluencePagePrefix = input.pagePrefix ?: config.confluence.pagePrefix
    //  added
        confluencePageSuffix = input.pageSuffix ?: config.confluence.pageSuffix
        confluencePreambleTitle = input.preambleTitle ?: config.confluence.preambleTitle
        if (!(confluencePreambleTitle instanceof ConfigObject)) {
            println "ERROR:"
            println "Deprecated configuration, use first level heading in document instead of preambleTitle configuration"
            throw new RuntimeException("config problem")
        }
        File htmlFile = new File(input.file)
        baseUrl = htmlFile
        Document dom = confluenceService.parseFile(htmlFile)

        // if ancestorName is defined try to find machingAncestorId in confluence
        def retrievedAncestorId
        if (input.ancestorName) {
            // Retrieve a page id by name
            retrievedAncestorId = retrievePageIdByName(input.ancestorName)
            println("Retrieved pageId for given ancestorName '${input.ancestorName}' is ${retrievedAncestorId}")
        }
        // if input does not contain an ancestorName, check if there is ancestorId, otherwise check if there is a global one
        def parentId = retrievedAncestorId ?: input.ancestorId ?: config.confluence.ancestorId

        // if parentId is still not set, create a new parent page (parentId = null)
        parentId = parentId ?: null
        //println("ancestorName: '${input.ancestorName}', ancestorId: ${input.ancestorId} ---&gt; final parentId: ${parentId}")

        // #342-dierk42: get the keywords from the meta tags
        def keywords = confluenceService.getKeywords(dom)

        def (pages, anchors, pageAnchors) = getPages(dom, parentId, confluenceSubpagesForSections)
        pushPages pages, anchors, pageAnchors, keywords
        if (parentId) {
            println "published to ${config.confluence.api - "rest/api/"}/spaces/${confluenceSpaceKey}/pages/${parentId}"
        } else {
            println "published to ${config.confluence.api - "rest/api/"}/spaces/${confluenceSpaceKey}"
        }
    }
}
""</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
        </p>

        <style>
.feedback--answer {
    display: inline-block;
}

.feedback--answer-no {
    margin-left: 1em;
}

.feedback--response {
    display: none;
    margin-top: 1em;
}

.feedback--response__visible {
    display: block;
}
</style>

<div class="d-print-none">
    <h2 class="feedback--title">Feedback</h2>
    <p class="feedback--question">Was this page helpful?</p>
    <button class="feedback--answer feedback--answer-yes">Yes</button>
    <button class="feedback--answer feedback--answer-no">No</button>
    <p class="feedback--response feedback--response-yes">
        Glad to hear it! Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27publishToConfluence%27%20%F0%9F%91%8D&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:015_tasks/03_task_publishToConfluence.adoc">tell us
    how we can improve</a>.
    </p>
    <p class="feedback--response feedback--response-no">
        Sorry to hear that. Please <a href="https://github.com/docToolchain/docToolchain/issues/new?title=Docs%3A+Feedback+for+%27publishToConfluence%27%20%F0%9F%91%8E&body=%0A%0A%5BEnter%20feedback%20here%5D%0A%0A%0A---%0A%23page:015_tasks/03_task_publishToConfluence.adoc">tell
    us how we can improve</a>.
    </p>
</div>
<script>
    const yesButton = document.querySelector('.feedback--answer-yes');
    const noButton = document.querySelector('.feedback--answer-no');
    const yesResponse = document.querySelector('.feedback--response-yes');
    const noResponse = document.querySelector('.feedback--response-no');
    const disableButtons = () => {
        yesButton.disabled = true;
        noButton.disabled = true;
    };
    const sendFeedback = (value) => {
        if (typeof ga !== 'function') return;
        const args = {
            command: 'send',
            hitType: 'event',
            category: 'Helpful',
            action: 'click',
            label: window.location.pathname,
            value: value
        };
        ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
    };
    yesButton.addEventListener('click', () => {
        yesResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(1);
    });
    noButton.addEventListener('click', () => {
        noResponse.classList.add('feedback--response__visible');
        disableButtons();
        sendFeedback(0);
    });
</script>


        <br>

        <!--div class="text-muted mt-5 pt-3 border-top">Last modified July 3, 2019: <a
                href="https://github.com/google/docsy-example/commit/d6aa89c8b24089d7e6741030864eff209465e896">Added
            links to user guide repo (d6aa89c)</a>
        </div-->
    </div>


			</main>

		</div>
	</div>


	
    <!--footer class="footer mt-auto py-3 bg-light">
        <div class="container">
            <span class="text-muted">&copy; 2020 | based on <a href="https://arc42.org">arc42 7.0</a> | mixed with <a href="http://getbootstrap.com/">Bootstrap v5.0.0-beta</a> | Baked with <a href="http://jbake.org">JBake v2.6.7</a></span>
        </div>
    </footer-->

    <footer class="bg-dark py-5 row d-print-none">
        <div class="container-fluid mx-sm-5">
            <div class="row">
                <div class="col-6 col-sm-4 text-xs-center order-sm-2">


                    <ul class="list-inline mb-0">
                        
                        <li aria-label="User mailing list" class="list-inline-item mx-2 h3" data-original-title="User mailing list" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="mailto:info@docs-as-co.de" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fa fa-envelope"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Twitter" class="list-inline-item mx-2 h3" data-original-title="Twitter" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://twitter.com/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </li>
                        
                        
                        <li aria-label="Stack Overflow" class="list-inline-item mx-2 h3" data-original-title="Stack Overflow" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://stackoverflow.com/questions/tagged/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-stack-overflow"></i>
                            </a>
                        </li>
                        
                    </ul>


                </div>
                <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">


                    <ul class="list-inline mb-0">

                        
                        <li aria-label="GitHub" class="list-inline-item mx-2 h3" data-original-title="GitHub" data-placement="top"
                            data-toggle="tooltip" title="">
                            <a class="text-white" href="https://github.com/doctoolchain/doctoolchain" rel="noopener noreferrer"
                               target="_blank">
                                <i class="fab fa-github"></i>
                            </a>
                        </li>
                        

                        


                    </ul>


                </div>
                <div class="col-12 col-sm-4 text-center py-2 order-sm-2">

                        <small class="text-white">built with <a href="https://doctoolchain.org">docToolchain</a> and <a href="https://jbake.org">jBake</a> <br /> theme: <a href="https://www.docsy.dev/">docsy</a></small>

                </div>
            </div>
        </div>
    </footer>

    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>


    <script src="../js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js"></script>
    <script src="../js/blocks.js" ></script>
    <script src="../js/prettify.js"></script>
    <script src="../js/copy-n-paste.js"></script>
    <script src="../js/submenucollapse.js"></script>


</body>
</html>
