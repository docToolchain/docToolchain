<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>docToolchain Manual</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>docToolchain Manual</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_and_goals">1. Introduction and Goals</a>
<ul class="sectlevel2">
<li><a href="#_create_awesome_docs">1.1. create awesome docs!</a></li>
<li><a href="#_benefits_of_the_docs_as_code_approach">1.2. Benefits of the docs-as-code Approach</a></li>
</ul>
</li>
<li><a href="#_how_to_install_doctoolchain">2. How to install docToolchain</a>
<ul class="sectlevel2">
<li><a href="#_default_configuration">2.1. Default configuration</a></li>
<li><a href="#_custom_configuration">2.2. Custom configuration</a></li>
</ul>
</li>
<li><a href="#_overview_of_available_tasks">3. Overview of available Tasks</a>
<ul class="sectlevel2">
<li><a href="#_conventions">3.1. Conventions</a></li>
<li><a href="#_generatehtml">3.2. generateHTML</a></li>
<li><a href="#_generatepdf">3.3. generatePDF</a></li>
<li><a href="#_generatedocbook">3.4. generateDocbook</a></li>
<li><a href="#_generatedeck">3.5. generateDeck</a></li>
<li><a href="#_publishtoconfluence">3.6. publishToConfluence</a></li>
<li><a href="#_converttodocx">3.7. convertToDocx</a></li>
<li><a href="#_converttoepub">3.8. convertToEpub</a></li>
<li><a href="#_exportea">3.9. exportEA</a></li>
<li><a href="#_exportchangelog">3.10. exportChangeLog</a></li>
<li><a href="#_exportjiraissues">3.11. exportJiraIssues</a></li>
<li><a href="#_exportppt">3.12. exportPPT</a></li>
<li><a href="#_exportexcel">3.13. exportExcel</a></li>
<li><a href="#_htmlsanitycheck">3.14. htmlSanityCheck</a></li>
<li><a href="#_dependencyupdates">3.15. dependencyUpdates</a></li>
</ul>
</li>
<li><a href="#_further_reading">4. Further Reading</a>
<ul class="sectlevel2">
<li><a href="#_links">4.1. Links</a></li>
<li><a href="#_books">4.2. Books</a></li>
<li><a href="#_past_and_upcoming_talks">4.3. Past and upcoming Talks</a></li>
</ul>
</li>
<li><a href="#_acknowledgements_and_contributors">5. Acknowledgements and Contributors</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_and_goals">1. Introduction and Goals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_awesome_docs">1.1. create awesome docs!</h3>
<div class="paragraph">
<p><em>docToolchain</em> is an implementation of the <a href="http://www.writethedocs.org/guide/docs-as-code/"><em>docs-as-code</em></a> approach for software architecture plus some additional automation.
The basis of docToolchain is the philosophy that software documentation should be treated in the same way as code together with the <a href="http://arc42.org"><em>arc42</em></a> template for software architecture.</p>
</div>
<div class="paragraph">
<p>How it all began&#8230;&#8203;</p>
</div>
<div class="sect3">
<h4 id="_docs_as_code">1.1.1. docs-as-code</h4>
<div class="paragraph">
<p>Before this project started, I wasn&#8217;t aware of the term <em>docs-as-code</em>.
I just grew tired of keeping all my architecture diagrams up to date by copiing them from my UML tool over to my word processor.</p>
</div>
<div class="paragraph">
<p>As a lazy developer, I told myself 'there has to be a better way of doing this'.
And I started to automate the diagram export and switch from a full fledged word processor over to a markup renderer.
This enable me to reference the diagrams from within my text and update them just before I render the document.</p>
</div>
</div>
<div class="sect3">
<h4 id="_arc42">1.1.2. arc42</h4>
<div class="paragraph">
<p>Since my goal was to document software architectures, I was already using arc42 - a template for software architecture.
At this time, it used the MS Word template.</p>
</div>
<div class="paragraph">
<p>But what is arc42?</p>
</div>
<div class="paragraph">
<p>Dr. Gernot Starke and Peter Hruschka created this template in a joint effort to create a standard for software architecture documents.
The dumped all their experience about software architectures into not only a structure but also explaining texts.
These explanations are part of every chapter of the template and give you guidance on how to write each chapter of the document.</p>
</div>
<div class="paragraph">
<p>arc42 is available in many formats like MS Word, textile and Confluence and all these formats are automatically generated from one <em>golden master</em> which is formatted in <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/"><em>asciidoc</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_doctoolchain">1.1.3. docToolchain</h4>
<div class="paragraph">
<p>In order to follow the <em>docs-as-code</em> approach, you need a build script which automates steps like exporting diagrams and rendering the used markdown (<em>asciidoc</em> in case of <em>docToolchain</em>) to the target format.</p>
</div>
<div class="paragraph">
<p>Unfortunately, such a build script is not easy to create in the first place ('how do I create .docx?', 'why does lib x not work with lib y?') and it is also not too easy to maintain.</p>
</div>
<div class="paragraph">
<p><em>docToolchain</em> is the result of my journey through the <em>docs-as-code</em> land.
The goal is to have an easy to use build script which only has to be configured and not modified and which is maintained by a community as open source software.</p>
</div>
<div class="paragraph">
<p>The technical steps of my journey are written down in my blog: <a href="https://rdmueller.github.io" class="bare">https://rdmueller.github.io</a>.</p>
</div>
<hr>
<div class="paragraph">
<p>Let&#8217;s start with what you&#8217;ll get when you use <em>docToolchain</em>&#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_benefits_of_the_docs_as_code_approach">1.2. Benefits of the docs-as-code Approach</h3>
<div class="paragraph">
<p>You want to write technical docs for your software project.
So it is very likely that you already have the tools and proccesses to work with source code in place.
Why not also use it for your docs?</p>
</div>
<div class="sect3">
<h4 id="_document_management_system">1.2.1. Document Management System</h4>
<div class="paragraph">
<p>By using a version control system like <a href="https://git-scm.com/">Git</a>, you get a perfect document management system for free.
It let&#8217;s you version your docs, branch them and gives you an audit trail.
You are even able to check who wrote which part of the docs.
Isn&#8217;t that great?</p>
</div>
<div class="paragraph">
<p>Since your docs are now just plain text, it is also easy to do a diff and see exactly what has changed.</p>
</div>
<div class="paragraph">
<p>And when you store your docs in the same repository as your code, you always have both in sync!</p>
</div>
</div>
<div class="sect3">
<h4 id="_collaboration_and_review_process">1.2.2. Collaboration and Review Process</h4>
<div class="paragraph">
<p>Git as a distributed version control system let&#8217;s you even collaborate on your docs.
People can fork the docs and send you pull requests for the changes they made.
By reviewing the pull request, you have a perfect review process out of the box - by accepting the pull request, you show that you&#8217;ve reviewed and accepted the changes.
Most git frontends like <a href="https://www.bitbucket.org">Bitbucket</a>, <a href="https://gitlab.com">Gitlab</a> and of course <a href="https://github.com">Github</a> also allow you to reject pull requests with comments.</p>
</div>
</div>
<div class="sect3">
<h4 id="_image_references_and_code_snippets">1.2.3. Image References and Code Snippets</h4>
<div class="paragraph">
<p>Instead of pasting images to a binary document format, you now can reference images.
This will ensure that those images are always up to date every time you rebuild your documents.</p>
</div>
<div class="paragraph">
<p>In addition, you can reference code snippets directly from your source code.
This way, these snippets are also always up to date!</p>
</div>
</div>
<div class="sect3">
<h4 id="_compound_and_stakeholder_tailored_docs">1.2.4. Compound and Stakeholder-Tailored Docs</h4>
<div class="paragraph">
<p>Since you can not only reference images and code snippets but also sub-documents, you can split your docs into several sub-documents and a master which brings all those docs together.
But you are not restricted to one master - you can create master docs for several different stakeholder which only contain the chapters needed for them.</p>
</div>
</div>
<div class="sect3">
<h4 id="_many_more_features">1.2.5. many more Features&#8230;&#8203;</h4>
<div class="paragraph">
<p>If you can dream it, you can script it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Want to include a list of open issues from Jira? <strong>✓</strong> Check.</p>
</li>
<li>
<p>Want to include a changelog from Git? <strong>✓</strong> Check.</p>
</li>
<li>
<p>Want to use inline, text based diagrams? <strong>✓</strong> Check.</p>
</li>
<li>
<p>and many more&#8230;&#8203;</p>
</li>
</ul>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_install_doctoolchain">2. How to install docToolchain</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_default_configuration">2.1. Default configuration</h3>
<div class="paragraph">
<p>Let&#8217;s get started&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Assuming that you first create your solution architecture and then the code, you simply start by getting a copy of the current docToolchain repository.
The easiest way is to clone the repository without history and remove the <code>.git</code> folder:</p>
</div>
<div class="listingblock">
<div class="title">linux with git clone</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone --recursive https://github.com/docToolchain/docToolchain.git &lt;your project name&gt;
rm -rf .git
rm -rf resources/asciidoctor-reveal.js/.git
rm -rf resources/reveal.js/.git</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>--recursive</code> option is required because the repository contains 2 submodules - <code>resources/asciidoctor-reveal.js</code> and <code>resources/reveal.js</code>.</p>
</div>
<div class="paragraph">
<p>Another way is to download the zipped git repository and rename it:</p>
</div>
<div class="listingblock">
<div class="title">linux with download as zip</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wget https://github.com/docToolchain/docToolchain/archive/master.zip
unzip master.zip

# fetching dependencies

cd docToolchain-master/resources

rm -d reveal.js
wget https://github.com/hakimel/reveal.js/archive/tags/3.3.0.zip -O reveal.js.zip
unzip reveal.js.zip
mv reveal.js-tags-3.3.0 reveal.js

rm -d asciidoctor-reveal.js
wget https://github.com/asciidoctor/asciidoctor-reveal.js/archive/9667f5c.zip -O asciidoctor-reveal.js.zip
unzip asciidoctor-reveal.js.zip
mv asciidoctor-reveal.js-9667f5c5d926b3be48361d6d6413d3896954894c asciidoctor-reveal.js

mv docToolchain-master &lt;your project name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you work (like me) on a windows environment, just download and unzip the <a href="https://github.com/docToolchain/docToolchain/archive/master.zip">repository</a> as well as its dependencies:
<a href="https://github.com/hakimel/reveal.js/archive/tags/3.3.0.zip">reveal.js</a> and
<a href="https://github.com/asciidoctor/asciidoctor-reveal.js/archive/9667f5c.zip">asciidoctor-reveal.js</a>.</p>
</div>
<div class="paragraph">
<p>After unzipping, put the dependencies in <code>resources</code> folder, so that the structure is the same as on <a href="https://github.com/docToolchain/docToolchain/tree/master/resources">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>This should already be enough to start a first build:</p>
</div>
<div class="listingblock">
<div class="title">linux with gradle wrapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">linux with maven wrapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">windows with gradle wrapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">windows with maven wrapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw.bat</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result, you will see the progress of your build together with some warnings which you can just ignore for the moment.</p>
</div>
<div class="paragraph">
<p>The first build generated some file within the <code>&lt;project&gt;/build</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;project&gt;:
    build:
        docs:
            html5:
                images:
                arc42-template-de.html
                arc42-template-end.html
            pdf:
                arc42-template-de.pdf</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Congratulations!</strong> if you see the same folder structure, you just managed to render the standard arc42 template as html and pdf!</p>
</div>
<div class="paragraph">
<p>If you didn&#8217;t get the right output, please raise an issue on <a href="https://github.com/docToolchain/docToolchain/issues">github</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_configuration">2.2. Custom configuration</h3>
<div class="paragraph">
<p>You can install docToolchain in a directory separate from your project. Then docToolchain is a standalone tool that can be
upgraded independently from your code or used for multiple projects.
If you want to install docToolchain separately, you need to create a copy of Config.groovy and
ConfluenceConfig.groovy for each project. Inside each configuration file you need to specify the input and output
folders and files.</p>
</div>
<div class="paragraph">
<p>The paths to those configuration files can be provided by giving -P option to gradlew, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew -PconfluenceConfigFile=$HOME/projectA/ConfluenceConfig.groovy -PmainConfigFile=$HOME/projectA/Config.groovy
./gradlew -PconfluenceConfigFile=$HOME/projectB/ConfluenceConfig.groovy -PmainConfigFile=$HOME/projectB/Config.groovy</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_available_tasks">3. Overview of available Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains all docToolchain specific tasks.</p>
</div>
<div class="paragraph">
<p>The following picture gives an overview of the whole build system:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/Overview2.png" alt="Overview2">
</div>
<div class="title">Figure 1. docToolchain</div>
</div>
<div class="sect2">
<h3 id="_conventions">3.1. Conventions</h3>
<div class="paragraph">
<p>There are some simple naming conventions of the tasks.
They might be confusing first and that&#8217;s why they are explained here.</p>
</div>
<div class="sect3">
<h4 id="_generatex">3.1.1. generateX</h4>
<div class="paragraph">
<p><em>render</em> would have been another good prefix, since these tasks use the plain asciidoctor functionality to render the source to a given format.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exportx">3.1.2. exportX</h4>
<div class="paragraph">
<p>These tasks export images and AsciiDoc snippets from other systems or file formats.
The resulting artefacts can then be included from your main sources.</p>
</div>
<div class="paragraph">
<p>What&#8217;s different to the <em>generateX</em> tasks is that you don&#8217;t need to export with each build.</p>
</div>
<div class="paragraph">
<p>It is also likely that you have to put the resulting artefacts under version control because the tools needed for the export (like Sparx Enterprise Architect or MS PowerPoint) are likely to be not available on a build server or on another contributors machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_converttox">3.1.3. convertToX</h4>
<div class="paragraph">
<p>These tasks take the output from asciidoctor and convert it (through other tools) to the target format.
This results in a dependency on a <em>generateX</em> task and another external tool (currently <a href="http://pandoc.org">pandoc</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_publishtox">3.1.4. publishToX</h4>
<div class="paragraph">
<p>These tasks not only convert your documents but also deploy/publish/move them to a remote system&#8201;&#8212;&#8201;currently confluence.
This means that the result is likely to be visible immediately to others.</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_generatehtml">3.2. generateHTML</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateHTML.png" alt="generateHTML">
</div>
</div>
<div class="paragraph">
<p>This is the standard asciidoctor generator which is supported out of the box.</p>
</div>
<div class="paragraph">
<p>The result is written to <code>build/docs/html5</code>.
The HTML files need the images folder in the same directory to be displayed the right way.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you would like to have a single-file HTML as result, you can configure asciidoctor to store the images inline as <code>data-uri</code>.<br>
Just set <code>:data-uri:</code> in the config of your AsciiDoc file.<br>
But be warned - such a file can be easily very big and some browsers might get into trouble rendering them.<br>
<a href="https://rdmueller.github.io/single-file-html/" class="bare">https://rdmueller.github.io/single-file-html/</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_text_based_diagrams">3.2.1. Text based Diagrams</h4>
<div class="paragraph">
<p>For docToolchain, it is configured to use the <a href="http://asciidoctor.org/docs/asciidoctor-diagram/">asciidoctor-diagram</a> plugin which is used to create plantUML diagrams.</p>
</div>
<div class="paragraph">
<p>The plugin also supports a bunch of other text based diagrams, but <a href="http://plantuml.com/">plantUML</a> is the most used.</p>
</div>
<div class="paragraph">
<p>To use it, just specify your plantUML code like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.example diagram
[plantuml, "{plantUMLDir}demoPlantUML", png] <i class="conum" data-value="1"></i><b>(1)</b>
----
class BlockProcessor
class DiagramBlock
class DitaaBlock
class PlantUmlBlock

BlockProcessor &lt;|-- DiagramBlock
DiagramBlock &lt;|-- DitaaBlock
DiagramBlock &lt;|-- PlantUmlBlock
----</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The element of this list specifies the diagram tool <code>plantuml</code> to be used.<br>
The second element the name of the image to be created and the third the image type.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the {plantUMLDir} ensures that plantUML also works for the <a href="#_generatepdf">generatePDF</a> task.
Without it, <a href="#_generatehtml">generateHTML</a> works fine, but the PDF will not find the generated images.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
make sure to specify a unique image name for each diagram.
Otherwise it will be overwritten and you&#8217;ll get all the same diagrams.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example renders as</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demoPlantUML.png" alt="example diagram" width="233" height="238">
</div>
<div class="title">Figure 2. example diagram</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
plantUML needs graphviz dot installed to work.
If you can&#8217;t install it, you can use java based version of the dot library.
Just add <code>!pragma graphviz_dot jdot</code> as first line of your diagram definition.
It is still an experimental feature, but already works quite well!<br>
<a href="https://rdmueller.github.io/plantuml-without-graphviz/" class="bare">https://rdmueller.github.io/plantuml-without-graphviz/</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_source">3.2.2. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task generateHTML (
        <span class="key">type</span>: AsciidoctorTask,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">use html5 as asciidoc backend</span><span class="delimiter">'</span></span>) {

    attributes \
        <span class="string"><span class="delimiter">'</span><span class="content">plantUMLDir</span><span class="delimiter">'</span></span>         : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>

    sources {
        sourceFiles.findAll {
            <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats
        }.each {
            include <span class="local-variable">it</span>.file
        }
    }

    backends = [<span class="string"><span class="delimiter">'</span><span class="content">html5</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_generatepdf">3.3. generatePDF</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generatePDF.png" alt="generatePDF">
</div>
</div>
<div class="paragraph">
<p>This task makes use of the <a href="http://asciidoctor.org/docs/convert-asciidoc-to-pdf/">asciidoctor-pdf</a> plugin to render your documents as good looking PDF.</p>
</div>
<div class="paragraph">
<p>The file will be written to <code>src/docs/pdf</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the used plugin is still in alpha status, but the results are already quite good.
If you want to use another way to create a PDF, use for instance <a href="http://phantomjs.org/">phantomJS</a> and script it!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The PDF is generated directly from your AsciiDoc sources without the need of an intermediate format or other tools.
The result looks more like a nicely rendered book than a print-to-pdf HTML page.</p>
</div>
<div class="paragraph">
<p>It is very likely that you need to "theme" you PDF - change colors, fonts, page header and footer.
This can be done by changing the <code>src/docs/custom-theme.yml</code> file.
Documentation on how to modify it can be found in the <a href="https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc">asciidoctor-pdf theming guide</a>.</p>
</div>
<div class="sect3">
<h4 id="_source_2">3.3.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task generatePDF (
        <span class="key">type</span>: AsciidoctorTask,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">use pdf as asciidoc backend</span><span class="delimiter">'</span></span>) {

    attributes \
        <span class="string"><span class="delimiter">'</span><span class="content">plantUMLDir</span><span class="delimiter">'</span></span>         : file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>docDir<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>config.outputPath<span class="inline-delimiter">}</span></span><span class="content">/images/plantUML/</span><span class="delimiter">&quot;</span></span>).path

    sources {
        sourceFiles.findAll {
            <span class="string"><span class="delimiter">'</span><span class="content">pdf</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats
        }.each {
            include <span class="local-variable">it</span>.file
        }
    }

    backends = [<span class="string"><span class="delimiter">'</span><span class="content">pdf</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_generatedocbook">3.4. generateDocbook</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateDocBook.png" alt="generateDocBook">
</div>
</div>
<div class="paragraph">
<p>This is only a helper task - it generates the intermediate format for <a href="#_converttodocx">convertToDocx</a> and <a href="#_converttoepub">convertToEpub</a>.</p>
</div>
<div class="sect3">
<h4 id="_source_3">3.4.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task generateDocbook (
        <span class="key">type</span>: AsciidoctorTask,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">use docbook as asciidoc backend</span><span class="delimiter">'</span></span>) {

    sources {
        sourceFiles.findAll {
            <span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats
        }.each {
            include <span class="local-variable">it</span>.file
        }
    }

    backends = [<span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_generatedeck">3.5. generateDeck</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/generateDeck.png" alt="generateDeck">
</div>
</div>
<div class="paragraph">
<p>This task makes use of the <a href="https://github.com/asciidoctor/asciidoctor-reveal.js/">asciidoctor-reveal.js</a> backend to render your documents HTML based presentation.</p>
</div>
<div class="paragraph">
<p>This task is best used together with the <a href="#_exportppt">exportPPT</a> task.
Create a PowerPoint presentation and enrich it with reveal.js slide definitions in AsciiDoc within the speaker notes.</p>
</div>
<div class="sect3">
<h4 id="_source_4">3.5.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task generateDeck (
        <span class="key">type</span>: AsciidoctorTask,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">use revealJs as asciidoc backend to create a presentation</span><span class="delimiter">'</span></span>) {

    attributes \
        <span class="string"><span class="delimiter">'</span><span class="content">plantUMLDir</span><span class="delimiter">'</span></span>         : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">idprefix</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">slide-</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">idseparator</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">docinfo1</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_theme</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">black</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_progress</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_touch</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_hideAddressBar</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_transition</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">linear</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_history</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">revealjs_slideNumber</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>

    options template_dirs : [<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">resources/asciidoctor-reveal.js</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">templates/slim</span><span class="delimiter">'</span></span>).absolutePath ]

    sources {
        sourceFiles.findAll {
            <span class="string"><span class="delimiter">'</span><span class="content">revealjs</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats
        }.each {
            include <span class="local-variable">it</span>.file
        }

    }

    outputDir = file(targetDir+<span class="string"><span class="delimiter">'</span><span class="content">/decks/</span><span class="delimiter">'</span></span>)

    resources {
        from(<span class="string"><span class="delimiter">'</span><span class="content">resources</span><span class="delimiter">'</span></span>) {
            include <span class="string"><span class="delimiter">'</span><span class="content">reveal.js/**</span><span class="delimiter">'</span></span>
        }
        from(sourceDir) {
            include <span class="string"><span class="delimiter">'</span><span class="content">images/**</span><span class="delimiter">'</span></span>
        }
        into(<span class="string"><span class="delimiter">&quot;</span><span class="content">ppt</span><span class="delimiter">&quot;</span></span>)
        logger.error <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>docDir<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>config.outputPath<span class="inline-delimiter">}</span></span><span class="content">/ppt/images</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_publishtoconfluence">3.6. publishToConfluence</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/publishToConfluence.png" alt="publishToConfluence">
</div>
</div>
<div class="sect3">
<h4 id="_source_5">3.6.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task publishToConfluence(
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">publishes the HTML rendered output to confluence</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) {
    doLast {
        binding.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">docDir</span><span class="delimiter">'</span></span>, docDir)
        binding.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">confluenceConfigFile</span><span class="delimiter">'</span></span>, confluenceConfigFile)
        evaluate(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">scripts/asciidoc2confluence.groovy</span><span class="delimiter">'</span></span>))
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">scripts/asciidoc2confluence.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * Created by Ralf D. Mueller and Alexander Heusingfeld
 * https://github.com/rdmueller/asciidoc2confluence
 *
 * this script expects an HTML document created with AsciiDoctor
 * in the following style (default AsciiDoctor output)
 * &lt;div class=&quot;sect1&quot;&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     &lt;div class=&quot;sectionbody&quot;&gt;
 *         &lt;div class=&quot;sect2&quot;&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *         &lt;div class=&quot;sect2&quot;&gt;
 *            &lt;h3&gt;Sub-Page Title&lt;/h3&gt;
 *         &lt;/div&gt;
 *     &lt;/div&gt;
 * &lt;/div&gt;
 * &lt;div class=&quot;sect1&quot;&gt;
 *     &lt;h2&gt;Page Title&lt;/h2&gt;
 *     ...
 * &lt;/div&gt;
 *
 */</span>

<span class="comment">// some dependencies</span>
<span class="comment">/**
@Grapes(
        [@Grab('org.jsoup:jsoup:1.8.2'),
         @Grab('org.codehaus.groovy.modules.http-builder:http-builder:0.6' ),
         @Grab('org.apache.httpcomponents:httpmime:4.5.1')]
)
**/</span>
<span class="keyword">import</span> <span class="include">org.jsoup.Jsoup</span>
<span class="keyword">import</span> <span class="include">org.jsoup.parser.Parser</span>
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Entities.EscapeMode</span>
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document</span>
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Document.OutputSettings</span>
<span class="keyword">import</span> <span class="include">org.jsoup.nodes.Element</span>
<span class="keyword">import</span> <span class="include">org.jsoup.select.Elements</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.RESTClient</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.HttpResponseException</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.HTTPBuilder</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.EncoderRegistry</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.ContentType</span>
<span class="keyword">import</span> <span class="include">java.security.MessageDigest</span>
<span class="comment">//to upload attachments:</span>
<span class="keyword">import</span> <span class="include">org.apache.http.entity.mime.MultipartEntity</span>
<span class="keyword">import</span> <span class="include">org.apache.http.entity.mime.content.StringBody</span>
<span class="keyword">import</span> <span class="include">org.apache.http.entity.mime.content.InputStreamBody</span>
<span class="keyword">import</span> <span class="include">org.apache.http.entity.mime.HttpMultipartMode</span>
<span class="keyword">import</span> <span class="include">groovyx.net.http.Method</span>

<span class="keyword">def</span> CDATA_PLACEHOLDER_START = <span class="string"><span class="delimiter">'</span><span class="content">&lt;cdata-placeholder&gt;</span><span class="delimiter">'</span></span>
<span class="keyword">def</span> CDATA_PLACEHOLDER_END = <span class="string"><span class="delimiter">'</span><span class="content">&lt;/cdata-placeholder&gt;</span><span class="delimiter">'</span></span>

<span class="keyword">def</span> baseUrl

<span class="comment">// configuration</span>
<span class="keyword">def</span> config
println <span class="string"><span class="delimiter">&quot;</span><span class="content">docDir: </span><span class="inline"><span class="inline-delimiter">${</span>docDir<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
println <span class="string"><span class="delimiter">&quot;</span><span class="content">confluenceConfigFile: </span><span class="inline"><span class="inline-delimiter">${</span>confluenceConfigFile<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
config = <span class="keyword">new</span> ConfigSlurper().parse(<span class="keyword">new</span> <span class="predefined-type">File</span>(docDir, confluenceConfigFile).text)

<span class="keyword">def</span> confluenceSpaceKey
<span class="keyword">def</span> confluenceCreateSubpages
<span class="keyword">def</span> confluencePagePrefix

<span class="comment">// helper functions</span>

<span class="keyword">def</span> <span class="function">MD5</span>(<span class="predefined-type">String</span> s) {
    <span class="predefined-type">MessageDigest</span>.getInstance(<span class="string"><span class="delimiter">&quot;</span><span class="content">MD5</span><span class="delimiter">&quot;</span></span>).digest(s.bytes).encodeHex().toString()
}

<span class="comment">// for getting better error message from the REST-API</span>
<span class="type">void</span> trythis (Closure action) {
    <span class="keyword">try</span> {
        action.run()
    } <span class="keyword">catch</span> (HttpResponseException error) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">something went wrong - got an http response code </span><span class="delimiter">&quot;</span></span>+error.response.status+<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span>
        println error.response.data
        <span class="keyword">throw</span> error
    }
}


<span class="keyword">def</span> <span class="function">parseAdmonitionBlock</span>(block, <span class="predefined-type">String</span> type) {
    content = block.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">.content</span><span class="delimiter">&quot;</span></span>).first()
    titleElement = content.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">.title</span><span class="delimiter">&quot;</span></span>)
    titleText = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
    <span class="keyword">if</span>(titleElement != <span class="predefined-constant">null</span>) {
        titleText = <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:parameter ac:name=</span><span class="char">\&quot;</span><span class="content">title</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="inline"><span class="inline-delimiter">${</span>titleElement.text()<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:parameter&gt;</span><span class="delimiter">&quot;</span></span>
        titleElement.remove()
    }
    block.after(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:structured-macro ac:name=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>type<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="inline"><span class="inline-delimiter">${</span>titleText<span class="inline-delimiter">}</span></span><span class="content">&lt;ac:rich-text-body&gt;</span><span class="inline"><span class="inline-delimiter">${</span>content<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:rich-text-body&gt;&lt;/ac:structured-macro&gt;</span><span class="delimiter">&quot;</span></span>)
    block.remove()
}

<span class="keyword">def</span> uploadAttachment = { <span class="keyword">def</span> pageId, <span class="predefined-type">String</span> url, <span class="predefined-type">String</span> fileName, <span class="predefined-type">String</span> note -&gt;
    <span class="keyword">def</span> is
    <span class="keyword">def</span> localHash
    <span class="keyword">if</span> (url.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">http</span><span class="delimiter">'</span></span>)) {
        is = <span class="keyword">new</span> <span class="predefined-type">URL</span>(url).openStream()
        <span class="comment">//build a hash of the attachment</span>
        localHash = MD5(<span class="keyword">new</span> <span class="predefined-type">URL</span>(url).openStream().text)
    } <span class="keyword">else</span> {
        is = <span class="keyword">new</span> <span class="predefined-type">File</span>(url).newDataInputStream()
        <span class="comment">//build a hash of the attachment</span>
        localHash = MD5(<span class="keyword">new</span> <span class="predefined-type">File</span>(url).newDataInputStream().text)
    }

    <span class="comment">//https://docs.atlassian.com/confluence/REST/latest/</span>
    <span class="keyword">def</span> api = <span class="keyword">new</span> RESTClient(config.confluenceAPI)
    <span class="comment">//this fixes the encoding</span>
    api.encoderRegistry = <span class="keyword">new</span> EncoderRegistry( <span class="key">charset</span>: <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span> )

    <span class="keyword">def</span> headers = [
            <span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Basic </span><span class="delimiter">'</span></span> + config.confluenceCredentials,
            <span class="string"><span class="delimiter">'</span><span class="content">X-Atlassian-Token</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">no-check</span><span class="delimiter">'</span></span>
    ]
    <span class="comment">//check if attachment already exists</span>
    <span class="keyword">def</span> result = <span class="string"><span class="delimiter">&quot;</span><span class="content">nothing</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> attachment = api.get(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">content/</span><span class="delimiter">'</span></span> + pageId + <span class="string"><span class="delimiter">'</span><span class="content">/child/attachment</span><span class="delimiter">'</span></span>,
            <span class="key">query</span>: [
                    <span class="string"><span class="delimiter">'</span><span class="content">filename</span><span class="delimiter">'</span></span>: fileName,
            ], <span class="key">headers</span>: headers).data
    <span class="keyword">def</span> http
    <span class="keyword">if</span> (attachment.size==<span class="integer">1</span>) {
        <span class="comment">// attachment exists. need an update?</span>
        <span class="keyword">def</span> remoteHash = attachment.results[<span class="integer">0</span>].extensions.comment.replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">(?sm).*#([^#]+)#.*</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">$1</span><span class="delimiter">'</span></span>)
        <span class="keyword">if</span> (remoteHash!=localHash) {
            <span class="comment">//hash is different -&gt; attachment needs to be updated</span>
            http = <span class="keyword">new</span> HTTPBuilder(config.confluenceAPI + <span class="string"><span class="delimiter">'</span><span class="content">content/</span><span class="delimiter">'</span></span> + pageId + <span class="string"><span class="delimiter">'</span><span class="content">/child/attachment/</span><span class="delimiter">'</span></span> + attachment.results[<span class="integer">0</span>].id + <span class="string"><span class="delimiter">'</span><span class="content">/data</span><span class="delimiter">'</span></span>)
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">    updated attachment</span><span class="delimiter">&quot;</span></span>
        }
    } <span class="keyword">else</span> {
        http = <span class="keyword">new</span> HTTPBuilder(config.confluenceAPI + <span class="string"><span class="delimiter">'</span><span class="content">content/</span><span class="delimiter">'</span></span> + pageId + <span class="string"><span class="delimiter">'</span><span class="content">/child/attachment</span><span class="delimiter">'</span></span>)
    }
    <span class="keyword">if</span> (http) {
        http.request(<span class="predefined-type">Method</span>.POST) { req -&gt;
            <span class="key">requestContentType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">multipart/form-data</span><span class="delimiter">&quot;</span></span>
            MultipartEntity multiPartContent = <span class="keyword">new</span> MultipartEntity(HttpMultipartMode.BROWSER_COMPATIBLE)
            <span class="comment">// Adding Multi-part file parameter &quot;file&quot;</span>
            multiPartContent.addPart(<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> InputStreamBody(is, fileName))
            <span class="comment">// Adding another string parameter &quot;comment&quot;</span>
            multiPartContent.addPart(<span class="string"><span class="delimiter">&quot;</span><span class="content">comment</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> StringBody(note + <span class="string"><span class="delimiter">&quot;</span><span class="char">\r</span><span class="char">\n</span><span class="content">#</span><span class="delimiter">&quot;</span></span> + localHash + <span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span>))
            req.setEntity(multiPartContent)
            headers.each { key, value -&gt;
                req.addHeader(key, value)
            }
        }
    }
}


<span class="keyword">def</span> realTitle = { pageTitle -&gt;
    confluencePagePrefix + pageTitle
}

<span class="keyword">def</span> rewriteDescriptionLists = { body -&gt;
    <span class="keyword">def</span> TAGS = [ <span class="key">dt</span>: <span class="string"><span class="delimiter">'</span><span class="content">th</span><span class="delimiter">'</span></span>, <span class="key">dd</span>: <span class="string"><span class="delimiter">'</span><span class="content">td</span><span class="delimiter">'</span></span> ]
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">dl</span><span class="delimiter">'</span></span>).each { dl -&gt;
        <span class="comment">// WHATWG allows wrapping dt/dd in divs, simply unwrap them</span>
        dl.select(<span class="string"><span class="delimiter">'</span><span class="content">div</span><span class="delimiter">'</span></span>).each { <span class="local-variable">it</span>.unwrap() }

        <span class="comment">// group dts and dds that belong together, usually it will be a 1:1 relation</span>
        <span class="comment">// but HTML allows for different constellations</span>
        <span class="keyword">def</span> rows = <span class="type">[]</span>
        <span class="keyword">def</span> current = [<span class="key">dt</span>: <span class="type">[]</span>, <span class="key">dd</span>: <span class="type">[]</span>]
        rows &lt;&lt; current
        dl.select(<span class="string"><span class="delimiter">'</span><span class="content">dt, dd</span><span class="delimiter">'</span></span>).each { child -&gt;
            <span class="keyword">def</span> tagName = child.tagName()
            <span class="keyword">if</span> (tagName == <span class="string"><span class="delimiter">'</span><span class="content">dt</span><span class="delimiter">'</span></span> &amp;&amp; current.dd.size() &gt; <span class="integer">0</span>) {
                <span class="comment">// dt follows dd, start a new group</span>
                current = [<span class="key">dt</span>: <span class="type">[]</span>, <span class="key">dd</span>: <span class="type">[]</span>]
                rows &lt;&lt; current
            }
            current[tagName] &lt;&lt; child.tagName(TAGS[tagName])
            child.remove()
        }

        rows.each { row -&gt;
            <span class="keyword">def</span> sizes = [<span class="key">dt</span>: row.dt.size(), <span class="key">dd</span>: row.dd.size()]
            <span class="keyword">def</span> rowspanIdx = [<span class="key">dt</span>: -<span class="integer">1</span>, <span class="key">dd</span>: sizes.dd - <span class="integer">1</span>]
            <span class="keyword">def</span> rowspan = <span class="predefined-type">Math</span>.abs(sizes.dt - sizes.dd) + <span class="integer">1</span>
            <span class="keyword">def</span> max = sizes.dt
            <span class="keyword">if</span> (sizes.dt &lt; sizes.dd) {
                max = sizes.dd
                rowspanIdx = [<span class="key">dt</span>: sizes.dt - <span class="integer">1</span>, <span class="key">dd</span>: -<span class="integer">1</span>]
            }
            (<span class="integer">0</span>..&lt;max).each { idx -&gt;
                <span class="keyword">def</span> tr = dl.appendElement(<span class="string"><span class="delimiter">'</span><span class="content">tr</span><span class="delimiter">'</span></span>)
                [<span class="string"><span class="delimiter">'</span><span class="content">dt</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">dd</span><span class="delimiter">'</span></span>].each { type -&gt;
                    <span class="keyword">if</span> (sizes[type] &gt; idx) {
                        tr.appendChild(row[type][idx])
                        <span class="keyword">if</span> (idx == rowspanIdx[type] &amp;&amp; rowspan &gt; <span class="integer">1</span>) {
                            row[type][idx].attr(<span class="string"><span class="delimiter">'</span><span class="content">rowspan</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rowspan<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                        }
                    } <span class="keyword">else</span> <span class="keyword">if</span> (idx == <span class="integer">0</span>) {
                        tr.appendElement(TAGS[type]).attr(<span class="string"><span class="delimiter">'</span><span class="content">rowspan</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rowspan<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                    }
                }
            }
        }

        dl.wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;table&gt;&lt;/table&gt;</span><span class="delimiter">'</span></span>)
            .unwrap()
    }
}

<span class="keyword">def</span> rewriteInternalLinks = { body, anchors, pageAnchors -&gt;
    <span class="comment">// find internal cross-references and replace them with link macros</span>
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">a[href]</span><span class="delimiter">'</span></span>).each { a -&gt;
        <span class="keyword">def</span> href = a.attr(<span class="string"><span class="delimiter">'</span><span class="content">href</span><span class="delimiter">'</span></span>)
        <span class="keyword">if</span> (href.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span>)) {
            <span class="keyword">def</span> anchor = href.substring(<span class="integer">1</span>)
            <span class="keyword">def</span> pageTitle = anchors[anchor] ?: pageAnchors[anchor]
            <span class="keyword">if</span> (pageTitle) {
                <span class="comment">// as Confluence insists on link texts to be contained</span>
                <span class="comment">// inside CDATA, we have to strip all HTML and</span>
                <span class="comment">// potentially loose styling that way.</span>
                a.html(a.text())
                a.wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:link</span><span class="inline"><span class="inline-delimiter">${</span>anchors.containsKey(anchor) ? <span class="string"><span class="delimiter">'</span><span class="content"> ac:anchor=&quot;</span><span class="delimiter">'</span></span> + anchor + <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span> : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span><span class="inline-delimiter">}</span></span><span class="content">&gt;&lt;/ac:link&gt;</span><span class="delimiter">&quot;</span></span>)
                   .before(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ri:page ri:content-title=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>realTitle pageTitle<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span>)
                   .wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:plain-text-link-body&gt;</span><span class="inline"><span class="inline-delimiter">${</span>CDATA_PLACEHOLDER_START<span class="inline-delimiter">}</span></span><span class="inline"><span class="inline-delimiter">${</span>CDATA_PLACEHOLDER_END<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:plain-text-link-body&gt;</span><span class="delimiter">&quot;</span></span>)
                   .unwrap()
            }
        }
    }
}

<span class="keyword">def</span> rewriteCodeblocks = { body -&gt;
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">pre &gt; code</span><span class="delimiter">'</span></span>).each { code -&gt;
        <span class="keyword">if</span> (code.attr(<span class="string"><span class="delimiter">'</span><span class="content">data-lang</span><span class="delimiter">'</span></span>)) {
            code.select(<span class="string"><span class="delimiter">'</span><span class="content">span[class]</span><span class="delimiter">'</span></span>).each { span -&gt;
                span.unwrap()
            }
            code.before(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:parameter ac:name=</span><span class="char">\&quot;</span><span class="content">language</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="inline"><span class="inline-delimiter">${</span>code.attr(<span class="string"><span class="delimiter">'</span><span class="content">data-lang</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:parameter&gt;</span><span class="delimiter">&quot;</span></span>)
        }
        code.parent() <span class="comment">// pre now</span>
            .wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:structured-macro ac:name=&quot;code&quot;&gt;&lt;/ac:structured-macro&gt;</span><span class="delimiter">'</span></span>)
            .unwrap()
        code.wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:plain-text-body&gt;</span><span class="inline"><span class="inline-delimiter">${</span>CDATA_PLACEHOLDER_START<span class="inline-delimiter">}</span></span><span class="inline"><span class="inline-delimiter">${</span>CDATA_PLACEHOLDER_END<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:plain-text-body&gt;</span><span class="delimiter">&quot;</span></span>)
            .unwrap()
    }
}

<span class="keyword">def</span> unescapeCDATASections = { html -&gt;
    <span class="keyword">def</span> start = html.indexOf(CDATA_PLACEHOLDER_START)
    <span class="keyword">while</span> (start &gt; -<span class="integer">1</span>) {
        <span class="keyword">def</span> end = html.indexOf(CDATA_PLACEHOLDER_END, start)
        <span class="keyword">if</span> (end &gt; -<span class="integer">1</span>) {
            <span class="keyword">def</span> prefix = html.substring(<span class="integer">0</span>, start) + CDATA_PLACEHOLDER_START
            <span class="keyword">def</span> suffix = html.substring(end)
            <span class="keyword">def</span> unescaped = html.substring(start + CDATA_PLACEHOLDER_START.length(), end)
                    .replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&amp;lt;</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&lt;</span><span class="delimiter">'</span></span>).replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&amp;gt;</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&gt;</span><span class="delimiter">'</span></span>)
            html = prefix + unescaped + suffix
        }
        start = html.indexOf(CDATA_PLACEHOLDER_START, start + <span class="integer">1</span>)
    }
    html
}

<span class="comment">//modify local page in order to match the internal confluence storage representation a bit better</span>
<span class="comment">//definition lists are not displayed by confluence, so turn them into tables</span>
<span class="comment">//body can be of type Element or Elements</span>
<span class="keyword">def</span> deferredUpload = <span class="type">[]</span>
<span class="keyword">def</span> parseBody =  { body, anchors, pageAnchors -&gt;
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.paragraph</span><span class="delimiter">'</span></span>).unwrap()
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.ulist</span><span class="delimiter">'</span></span>).unwrap()
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect3</span><span class="delimiter">'</span></span>).unwrap()
    [   <span class="string"><span class="delimiter">'</span><span class="content">note</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">info</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">warning</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">warning</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">important</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">warning</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">caution</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">note</span><span class="delimiter">'</span></span>,
        <span class="string"><span class="delimiter">'</span><span class="content">tip</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">tip</span><span class="delimiter">'</span></span>            ].each { adType, cType -&gt;
        body.select(<span class="string"><span class="delimiter">'</span><span class="content">.admonitionblock.</span><span class="delimiter">'</span></span>+adType).each { block -&gt;
            parseAdmonitionBlock(block, cType)
        }
    }
    <span class="comment">//special for the arc42-template</span>
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.arc42help</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">.content</span><span class="delimiter">'</span></span>)
            .wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:structured-macro ac:name=&quot;expand&quot;&gt;&lt;/ac:structured-macro&gt;</span><span class="delimiter">'</span></span>)
            .wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:rich-text-body&gt;&lt;/ac:rich-text-body&gt;</span><span class="delimiter">'</span></span>)
            .wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:structured-macro ac:name=&quot;info&quot;&gt;&lt;/ac:structured-macro&gt;</span><span class="delimiter">'</span></span>)
            .before(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:parameter ac:name=&quot;title&quot;&gt;arc42&lt;/ac:parameter&gt;</span><span class="delimiter">'</span></span>)
            .wrap(<span class="string"><span class="delimiter">'</span><span class="content">&lt;ac:rich-text-body&gt;&lt;p&gt;&lt;/p&gt;&lt;/ac:rich-text-body&gt;</span><span class="delimiter">'</span></span>)
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.arc42help</span><span class="delimiter">'</span></span>).unwrap()
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.title</span><span class="delimiter">'</span></span>).wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;strong&gt;&lt;/strong&gt;</span><span class="delimiter">&quot;</span></span>).before(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br /&gt;</span><span class="delimiter">&quot;</span></span>).wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;div&gt;&lt;/div&gt;</span><span class="delimiter">&quot;</span></span>)
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">div.listingblock</span><span class="delimiter">'</span></span>).wrap(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;&lt;/p&gt;</span><span class="delimiter">&quot;</span></span>).unwrap()
    <span class="comment">// see if we can find referenced images and fetch them</span>
    <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tmp/images/.</span><span class="delimiter">&quot;</span></span>).mkdirs()
    <span class="comment">// find images, extract their URLs for later uploading (after we know the pageId) and replace them with this macro:</span>
    <span class="comment">// &lt;ac:image ac:align=&quot;center&quot; ac:width=&quot;500&quot;&gt;</span>
    <span class="comment">// &lt;ri:attachment ri:filename=&quot;deployment-context.png&quot;/&gt;</span>
    <span class="comment">// &lt;/ac:image&gt;</span>
    body.select(<span class="string"><span class="delimiter">'</span><span class="content">img</span><span class="delimiter">'</span></span>).each { img -&gt;
        img.attributes().each { attribute -&gt;
            <span class="comment">//println attribute.dump()</span>
        }
        <span class="keyword">def</span> src = img.attr(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>)
        <span class="keyword">def</span> imgWidth = img.attr(<span class="string"><span class="delimiter">'</span><span class="content">width</span><span class="delimiter">'</span></span>)?:<span class="integer">500</span>
        <span class="keyword">def</span> imgAlign = img.attr(<span class="string"><span class="delimiter">'</span><span class="content">align</span><span class="delimiter">'</span></span>)?:<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">    image: </span><span class="delimiter">&quot;</span></span>+src

        <span class="comment">//it is not an online image, so upload it to confluence and use the ri:attachment tag</span>
        <span class="keyword">if</span>(!src.startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span>)) {
          <span class="keyword">def</span> newUrl = baseUrl.toString().replaceAll(<span class="string"><span class="delimiter">'</span><span class="char">\\</span><span class="char">\\</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>).replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">/[^/]*$</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)+src
          <span class="keyword">def</span> fileName = (src.tokenize(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)[-<span class="integer">1</span>])

          trythis {
              deferredUpload &lt;&lt;  [<span class="integer">0</span>,newUrl,fileName,<span class="string"><span class="delimiter">&quot;</span><span class="content">automatically uploaded</span><span class="delimiter">&quot;</span></span>]
          }
          img.after(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:image ac:align=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>imgAlign<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content"> ac:width=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>imgWidth<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">&gt;&lt;ri:attachment ri:filename=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>fileName<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/ac:image&gt;</span><span class="delimiter">&quot;</span></span>)
        }
        <span class="comment">// it is an online image, so we have to use the ri:url tag</span>
        <span class="keyword">else</span> {
          img.after(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:image ac:align=</span><span class="char">\&quot;</span><span class="content">imgAlign</span><span class="char">\&quot;</span><span class="content"> ac:width=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>imgWidth<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">&gt;&lt;ri:url ri:value=</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span>src<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/ac:image&gt;</span><span class="delimiter">&quot;</span></span>)
        }
        img.remove()
    }
    rewriteDescriptionLists body
    rewriteInternalLinks body, anchors, pageAnchors
    <span class="comment">//sanitize code inside code tags</span>
    rewriteCodeblocks body
    <span class="keyword">def</span> pageString = unescapeCDATASections body.html().trim()

    <span class="comment">//change some html elements through simple substitutions</span>
    pageString = pageString
            .replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&lt;br&gt;</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">&lt;br /&gt;</span><span class="delimiter">'</span></span>)
            .replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&lt;/br&gt;</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">&lt;br /&gt;</span><span class="delimiter">'</span></span>)
            .replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&lt;a([^&gt;]*)&gt;&lt;/a&gt;</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
            .replaceAll(CDATA_PLACEHOLDER_START,<span class="string"><span class="delimiter">'</span><span class="content">&lt;![CDATA[</span><span class="delimiter">'</span></span>)
            .replaceAll(CDATA_PLACEHOLDER_END,<span class="string"><span class="delimiter">'</span><span class="content">]]&gt;</span><span class="delimiter">'</span></span>)

    <span class="keyword">return</span> pageString
}

<span class="comment">// the create-or-update functionality for confluence pages</span>
<span class="keyword">def</span> pushToConfluence = { pageTitle, pageBody, parentId, anchors, pageAnchors -&gt;
    <span class="keyword">def</span> api = <span class="keyword">new</span> RESTClient(config.confluenceAPI)
    <span class="keyword">def</span> headers = [
            <span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Basic </span><span class="delimiter">'</span></span> + config.confluenceCredentials,
            <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">application/json; charset=utf-8</span><span class="delimiter">'</span></span>
    ]
    <span class="comment">//this fixes the encoding</span>
    api.encoderRegistry = <span class="keyword">new</span> EncoderRegistry( <span class="key">charset</span>: <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span> )
    <span class="comment">//try to get an existing page</span>
    <span class="keyword">def</span> page
    localPage = parseBody(pageBody, anchors, pageAnchors)

    <span class="keyword">def</span> localHash = MD5(localPage)
    <span class="keyword">def</span> prefix = <span class="string"><span class="delimiter">'</span><span class="content">&lt;p&gt;&lt;ac:structured-macro ac:name=&quot;toc&quot;/&gt;&lt;/p&gt;</span><span class="delimiter">'</span></span>+(config.extraPageContent?:<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
    localPage  = prefix+localPage
    localPage += <span class="string"><span class="delimiter">'</span><span class="content">&lt;p&gt;&lt;ac:structured-macro ac:name=&quot;children&quot;&gt;&lt;ac:parameter ac:name=&quot;sort&quot;&gt;creation&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;&lt;/p&gt;</span><span class="delimiter">'</span></span>
    localPage += <span class="string"><span class="delimiter">'</span><span class="content">&lt;p style=&quot;display:none&quot;&gt;hash: #</span><span class="delimiter">'</span></span>+localHash+<span class="string"><span class="delimiter">'</span><span class="content">#&lt;/p&gt;</span><span class="delimiter">'</span></span>

    <span class="keyword">def</span> request = [
            type : <span class="string"><span class="delimiter">'</span><span class="content">page</span><span class="delimiter">'</span></span>,
            <span class="key">title</span>: realTitle(pageTitle),
            <span class="key">space</span>: [
                    <span class="key">key</span>: confluenceSpaceKey
            ],
            body : [
                    <span class="key">storage</span>: [
                            value         : localPage,
                            <span class="key">representation</span>: <span class="string"><span class="delimiter">'</span><span class="content">storage</span><span class="delimiter">'</span></span>
                    ]
            ]
    ]
    <span class="keyword">if</span> (parentId) {
        request.ancestors = [
                [ <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">page</span><span class="delimiter">'</span></span>, <span class="key">id</span>: parentId]
        ]
    }
    trythis {
        page = api.get(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>,
                <span class="key">query</span>: [
                        <span class="string"><span class="delimiter">'</span><span class="content">spaceKey</span><span class="delimiter">'</span></span>: confluenceSpaceKey,
                        <span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>   : realTitle(pageTitle),
                        <span class="string"><span class="delimiter">'</span><span class="content">expand</span><span class="delimiter">'</span></span>  : <span class="string"><span class="delimiter">'</span><span class="content">body.storage,version</span><span class="delimiter">'</span></span>
                ], <span class="key">headers</span>: headers).data.results[<span class="integer">0</span>]
    }
    <span class="keyword">if</span> (page) {
        <span class="comment">//println &quot;found existing page: &quot; + page.id +&quot; version &quot;+page.version.number</span>

        <span class="comment">//extract hash from remote page to see if it is different from local one</span>

        <span class="keyword">def</span> remotePage = page.body.storage.value.toString().trim()

        <span class="keyword">def</span> remoteHash = remotePage =~ <span class="regexp"><span class="delimiter">/</span><span class="content">(?ms)hash: #([^#]+)#</span><span class="delimiter">/</span></span>
        remoteHash = remoteHash.size()==<span class="integer">0</span>?<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>:remoteHash[<span class="integer">0</span>][<span class="integer">1</span>]

        <span class="keyword">if</span> (remoteHash == localHash) {
            <span class="comment">//println &quot;page hasn't changed!&quot;</span>
            deferredUpload.each {
                uploadAttachment(page?.id, <span class="local-variable">it</span>[<span class="integer">1</span>], <span class="local-variable">it</span>[<span class="integer">2</span>], <span class="local-variable">it</span>[<span class="integer">3</span>])
            }
            deferredUpload = <span class="type">[]</span>
            <span class="keyword">return</span> page.id
        } <span class="keyword">else</span> {
            trythis {
                <span class="comment">// update page</span>
                <span class="comment">// https://developer.atlassian.com/display/CONFDEV/Confluence+REST+API+Examples#ConfluenceRESTAPIExamples-Updatingapage</span>
                request.id      = page.id
                request.version = [<span class="key">number</span>: (page.version.number <span class="keyword">as</span> <span class="predefined-type">Integer</span>) + <span class="integer">1</span>]
                <span class="keyword">def</span> res = api.put(<span class="key">contentType</span>: ContentType.JSON,
                        requestContentType : ContentType.JSON,
                        <span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">content/</span><span class="delimiter">'</span></span> + page.id, <span class="key">body</span>: request, <span class="key">headers</span>: headers)
            }
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt; updated page</span><span class="delimiter">&quot;</span></span>+page.id
            deferredUpload.each {
                uploadAttachment(page.id, <span class="local-variable">it</span>[<span class="integer">1</span>], <span class="local-variable">it</span>[<span class="integer">2</span>], <span class="local-variable">it</span>[<span class="integer">3</span>])
            }
            deferredUpload = <span class="type">[]</span>
            <span class="keyword">return</span> page.id
        }
    } <span class="keyword">else</span> {
        <span class="comment">//create a page</span>
        trythis {
            page = api.post(<span class="key">contentType</span>: ContentType.JSON,
                    <span class="key">requestContentType</span>: ContentType.JSON,
                    <span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">content</span><span class="delimiter">'</span></span>, <span class="key">body</span>: request, <span class="key">headers</span>: headers)
        }
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt; created page </span><span class="delimiter">&quot;</span></span>+page?.data?.id
        deferredUpload.each {
            uploadAttachment(page?.data?.id, <span class="local-variable">it</span>[<span class="integer">1</span>], <span class="local-variable">it</span>[<span class="integer">2</span>], <span class="local-variable">it</span>[<span class="integer">3</span>])
        }
        deferredUpload = <span class="type">[]</span>
        <span class="keyword">return</span> page?.data?.id
    }
}

<span class="keyword">def</span> parseAnchors = { page -&gt;
    <span class="keyword">def</span> anchors = [:]
    page.body.select(<span class="string"><span class="delimiter">'</span><span class="content">[id]</span><span class="delimiter">'</span></span>).each { anchor -&gt;
        <span class="keyword">def</span> name = anchor.attr(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>)
        anchors[name] = page.title
        anchor.before(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;ac:structured-macro ac:name=</span><span class="char">\&quot;</span><span class="content">anchor</span><span class="char">\&quot;</span><span class="content">&gt;&lt;ac:parameter ac:name=</span><span class="char">\&quot;</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content">&lt;/ac:parameter&gt;&lt;/ac:structured-macro&gt;</span><span class="delimiter">&quot;</span></span>)
    }
    anchors
}

<span class="keyword">def</span> pushPages
pushPages = { pages, anchors, pageAnchors -&gt;
    pages.each { page -&gt;
        println page.title
        <span class="keyword">def</span> id = pushToConfluence page.title, page.body, page.parent, anchors, pageAnchors
        page.children*.parent = id
        pushPages page.children, anchors, pageAnchors
    }
}

<span class="keyword">def</span> recordPageAnchor = { head -&gt;
    <span class="keyword">def</span> a = [:]
    <span class="keyword">if</span> (head.attr(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>)) {
        a[head.attr(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>)] = head.text()
    }
    a
}

<span class="keyword">def</span> promoteHeaders = { tree, start, offset -&gt;
    (start..<span class="integer">7</span>).each { i -&gt;
        tree.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="inline"><span class="inline-delimiter">${</span>i<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>).tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">h</span><span class="inline"><span class="inline-delimiter">${</span>i-offset<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>).before(<span class="string"><span class="delimiter">'</span><span class="content">&lt;br /&gt;</span><span class="delimiter">'</span></span>)
    }
}

config.input.each { input -&gt;

    input.file = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>docDir<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>input.file<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

    <span class="keyword">if</span> (input.file ==~ <span class="regexp"><span class="delimiter">/</span><span class="content">.*[.](ad|adoc|asciidoc)</span><span class="content">$</span><span class="delimiter">/</span></span>) {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">convert </span><span class="inline"><span class="inline-delimiter">${</span>input.file<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy asciidoc2html.groovy </span><span class="inline"><span class="inline-delimiter">${</span>input.file<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>.execute()
        input.file = input.file.replaceAll(<span class="regexp"><span class="delimiter">/</span><span class="content">[.](ad|adoc|asciidoc)</span><span class="content">$</span><span class="delimiter">/</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">.html</span><span class="delimiter">'</span></span>)
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">to </span><span class="inline"><span class="inline-delimiter">${</span>input.file<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
    confluenceSpaceKey = input.spaceKey?:config.confluenceSpaceKey
    confluenceCreateSubpages = (input.createSubpages!= <span class="predefined-constant">null</span>)?input.createSubpages:config.confluenceCreateSubpages
    confluencePagePrefix = input.pagePrefix?:config.confluencePagePrefix

    <span class="keyword">def</span> html =input.file?<span class="keyword">new</span> <span class="predefined-type">File</span>(input.file).getText(<span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>):<span class="keyword">new</span> <span class="predefined-type">URL</span>(input.url).getText()
    baseUrl  =input.file?<span class="keyword">new</span> <span class="predefined-type">File</span>(input.file):<span class="keyword">new</span> <span class="predefined-type">URL</span>(input.url)
    <span class="predefined-type">Document</span> dom = Jsoup.parse(html, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>, <span class="predefined-type">Parser</span>.xmlParser())
    dom.outputSettings().prettyPrint(<span class="predefined-constant">false</span>);<span class="comment">//makes html() preserve linebreaks and spacing</span>
    dom.outputSettings().escapeMode(org.jsoup.nodes.Entities.EscapeMode.xhtml); <span class="comment">//This will ensure xhtml validity regarding entities</span>
    dom.outputSettings().charset(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>); <span class="comment">//does no harm :-)</span>
    <span class="keyword">def</span> masterid = input.ancestorId

    <span class="comment">// if confluenceAncestorId is not set, create a new parent page</span>
    <span class="keyword">def</span> parentId = !input.ancestorId ? <span class="predefined-constant">null</span> : input.ancestorId
    <span class="keyword">def</span> anchors = [:]
    <span class="keyword">def</span> pageAnchors = [:]
    <span class="keyword">def</span> sections = pages = <span class="type">[]</span>

    <span class="comment">// let's try to select the &quot;first page&quot; and push it to confluence</span>
    dom.select(<span class="string"><span class="delimiter">'</span><span class="content">div#preamble div.sectionbody</span><span class="delimiter">'</span></span>).each { pageBody -&gt;
        pageBody.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect2</span><span class="delimiter">'</span></span>).unwrap()
        <span class="keyword">def</span> preamble = [
            <span class="key">title</span>: input.preambleTitle ?: <span class="string"><span class="delimiter">&quot;</span><span class="content">arc42</span><span class="delimiter">&quot;</span></span>,
            <span class="key">body</span>: pageBody,
            <span class="key">children</span>: <span class="type">[]</span>,
            <span class="key">parent</span>: parentId
        ]
        pages &lt;&lt; preamble
        sections = preamble.children
        parentId = <span class="predefined-constant">null</span>
        anchors.putAll(parseAnchors(preamble))
    }
    <span class="comment">// &lt;div class=&quot;sect1&quot;&gt; are the main headings</span>
    <span class="comment">// let's extract these</span>
    dom.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect1</span><span class="delimiter">'</span></span>).each { sect1 -&gt;
        Elements pageBody = sect1.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sectionbody</span><span class="delimiter">'</span></span>)
        <span class="keyword">def</span> currentPage = [
            <span class="key">title</span>: sect1.select(<span class="string"><span class="delimiter">'</span><span class="content">h2</span><span class="delimiter">'</span></span>).text(),
            <span class="key">body</span>: pageBody,
            <span class="key">children</span>: <span class="type">[]</span>,
            <span class="key">parent</span>: parentId
        ]
        pageAnchors.putAll(recordPageAnchor(sect1.select(<span class="string"><span class="delimiter">'</span><span class="content">h2</span><span class="delimiter">'</span></span>)))

        <span class="keyword">if</span> (confluenceCreateSubpages) {
            pageBody.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect2</span><span class="delimiter">'</span></span>).each { sect2 -&gt;
                <span class="keyword">def</span> title = sect2.select(<span class="string"><span class="delimiter">'</span><span class="content">h3</span><span class="delimiter">'</span></span>).text()
                pageAnchors.putAll(recordPageAnchor(sect2.select(<span class="string"><span class="delimiter">'</span><span class="content">h3</span><span class="delimiter">'</span></span>)))
                sect2.select(<span class="string"><span class="delimiter">'</span><span class="content">h3</span><span class="delimiter">'</span></span>).remove()
                <span class="keyword">def</span> body = sect2
                <span class="keyword">def</span> subPage = [
                    <span class="key">title</span>: title,
                    <span class="key">body</span>: body
                ]
                currentPage.children &lt;&lt; subPage
                promoteHeaders sect2, <span class="integer">4</span>, <span class="integer">3</span>
                anchors.putAll(parseAnchors(subPage))
            }
            pageBody.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect2</span><span class="delimiter">'</span></span>).remove()
        } <span class="keyword">else</span> {
            pageBody.select(<span class="string"><span class="delimiter">'</span><span class="content">div.sect2</span><span class="delimiter">'</span></span>).unwrap()
            promoteHeaders sect1, <span class="integer">3</span>, <span class="integer">2</span>
        }
        sections &lt;&lt; currentPage
        anchors.putAll(parseAnchors(currentPage))
    }

    pushPages pages, anchors, pageAnchors
}
<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_converttodocx">3.7. convertToDocx</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/convertToDocx.png" alt="convertToDocx">
</div>
</div>
<div class="sect3">
<h4 id="_source_6">3.7.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task convertToDocx (
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">type</span>: Exec
) {
    <span class="comment">// For now it's only taking the first input file that has docbook format specified</span>
    <span class="keyword">def</span> sourceFile = sourceFiles.find { <span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats }.file.replace(<span class="string"><span class="delimiter">'</span><span class="content">.adoc</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">.xml</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> targetFile = sourceFile.replace(<span class="string"><span class="delimiter">'</span><span class="content">.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">.docx</span><span class="delimiter">'</span></span>)

    workingDir <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>targetDir</span><span class="content">/docbook</span><span class="delimiter">&quot;</span></span>
    executable = <span class="string"><span class="delimiter">&quot;</span><span class="content">pandoc</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>targetDir</span><span class="content">/docx/</span><span class="delimiter">&quot;</span></span>).mkdirs()
    args = [<span class="string"><span class="delimiter">'</span><span class="content">-r</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">-t</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">docx</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">-o</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">../docx/</span><span class="inline"><span class="inline-delimiter">$</span>targetFile</span><span class="delimiter">&quot;</span></span>,
            sourceFile]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_converttoepub">3.8. convertToEpub</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/convertToEpub.png" alt="convertToEpub">
</div>
</div>
<div class="paragraph">
<p>Dependency: <a href="#generateDocBook">[generateDocBook]</a></p>
</div>
<div class="paragraph">
<p>This task uses <a href="http://pandoc.org">pandoc</a> to convert the DocBook output from AsciiDoctor to ePub.
This way, you can read your documentation in a convenient way on an eBook-reader.</p>
</div>
<div class="paragraph">
<p>Result can be found in <code>build/docs/epub</code></p>
</div>
<div class="sect3">
<h4 id="_source_7">3.8.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task convertToEpub (
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>,
        <span class="key">type</span>: Exec
) {
    <span class="comment">// For now it's only taking the first input file that has docbook format specified</span>
    <span class="keyword">def</span> sourceFile = sourceFiles.find { <span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span> <span class="keyword">in</span> <span class="local-variable">it</span>.formats }.file.replace(<span class="string"><span class="delimiter">'</span><span class="content">.adoc</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">.xml</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> targetFile = sourceFile.replace(<span class="string"><span class="delimiter">'</span><span class="content">.xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">.epub</span><span class="delimiter">'</span></span>)

    workingDir <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>targetDir</span><span class="content">/docbook</span><span class="delimiter">&quot;</span></span>
    executable = <span class="string"><span class="delimiter">&quot;</span><span class="content">pandoc</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>targetDir</span><span class="content">/epub/</span><span class="delimiter">&quot;</span></span>).mkdirs()
    args = [<span class="string"><span class="delimiter">'</span><span class="content">-r</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">docbook</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">-t</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">epub</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">'</span><span class="content">-o</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">../epub/</span><span class="inline"><span class="inline-delimiter">$</span>targetFile</span><span class="delimiter">&quot;</span></span>,
            sourceFile]
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_exportea">3.9. exportEA</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportEA.png" alt="exportEA">
</div>
</div>
<div class="sect3">
<h4 id="_source_8">3.9.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task exportEA(
        <span class="key">dependsOn</span>: [streamingExecute],
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">exports all diagrams and some texts from EA files</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) {
    doLast {
        <span class="comment">//make sure path for notes exists</span>
        <span class="comment">//and remove old notes</span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ea</span><span class="delimiter">'</span></span>).deleteDir()
        <span class="comment">//also remove old diagrams</span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ea</span><span class="delimiter">'</span></span>).deleteDir()
        <span class="comment">//create a readme to clarify things</span>
        <span class="keyword">def</span> readme = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">This folder contains exported diagrams or notes from Enterprise Architect.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder        will be overwritten with each re-export!**

use `gradle exportEA` to re-export files
</span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ea/.</span><span class="delimiter">'</span></span>).mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ea/readme.ad</span><span class="delimiter">'</span></span>).write(readme)
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ea/.</span><span class="delimiter">'</span></span>).mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ea/readme.ad</span><span class="delimiter">'</span></span>).write(readme)
        <span class="comment">//execute through cscript in order to make sure that we get WScript.echo right</span>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">%SystemRoot%</span><span class="char">\\</span><span class="content">System32</span><span class="char">\\</span><span class="content">cscript.exe //nologo scripts/exportEAP.vbs</span><span class="delimiter">&quot;</span></span>.executeCmd()
        <span class="comment">//the VB Script is only capable of writing iso-8859-1-Files.</span>
        <span class="comment">//we now have to convert them to UTF-8</span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ea/.</span><span class="delimiter">'</span></span>).eachFileRecurse { file -&gt;
            <span class="keyword">if</span> (file.isFile()) {
                println <span class="string"><span class="delimiter">&quot;</span><span class="content">exported notes </span><span class="delimiter">&quot;</span></span> + file.canonicalPath
                file.write(file.getText(<span class="string"><span class="delimiter">'</span><span class="content">iso-8859-1</span><span class="delimiter">'</span></span>), <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">scripts/exportEAP.vbs</div>
<div class="content">
<pre class="CodeRay highlight"><code>    ' based on the "Project Interface Example" which comes with EA
    ' http://stackoverflow.com/questions/1441479/automated-method-to-export-enterprise-architect-diagrams

    Dim EAapp 'As EA.App
    Dim Repository 'As EA.Repository
    Dim FS 'As Scripting.FileSystemObject

    Dim projectInterface 'As EA.Project

    Const   ForAppending = 8

    ' Helper
    ' http://windowsitpro.com/windows/jsi-tip-10441-how-can-vbscript-create-multiple-folders-path-mkdir-command
    Function MakeDir (strPath)
      Dim strParentPath, objFSO
      Set objFSO = CreateObject("Scripting.FileSystemObject")
      On Error Resume Next
      strParentPath = objFSO.GetParentFolderName(strPath)

      If Not objFSO.FolderExists(strParentPath) Then MakeDir strParentPath
      If Not objFSO.FolderExists(strPath) Then objFSO.CreateFolder strPath
      On Error Goto 0
      MakeDir = objFSO.FolderExists(strPath)

    End Function

    Sub WriteNote(currentModel, currentElement, notes, prefix)
        If (Left(notes, 6) = "{adoc:") Then
            strFileName = Mid(notes,7,InStr(notes,"}")-7)
            strNotes = Right(notes,Len(notes)-InStr(notes,"}"))
            set objFSO = CreateObject("Scripting.FileSystemObject")
            If (currentModel.Name="Model") Then
              ' When we work with the default model, we don't need a sub directory
              path = "./src/docs/ea/"
            Else
              path = "./src/docs/ea/"&amp;currentModel.Name&amp;"/"
            End If
            MakeDir(path)
            ' WScript.echo path&amp;strFileName
            post = ""
            If (prefix&lt;&gt;"") Then
                post = "_"
            End If
            set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;post&amp;strFileName&amp;".ad",ForAppending, True)
            name = currentElement.Name
            name = Replace(name,vbCr,"")
            name = Replace(name,vbLf,"")
            ' WScript.echo "-"&amp;Left(strNotes, 6)&amp;"-"
            if (Left(strNotes, 3) = vbCRLF&amp;"|") Then
                ' content should be rendered as table - so don't interfere with it
                objFile.WriteLine(vbCRLF)
            else
                'let's add the name of the object
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name)
            End If
            objFile.WriteLine(vbCRLF&amp;strNotes)
            objFile.Close
            if (prefix&lt;&gt;"") Then
                ' write the same to a second file
                set objFile = objFSO.OpenTextFile(path&amp;prefix&amp;".ad",ForAppending, True)
                objFile.WriteLine(vbCRLF&amp;vbCRLF&amp;"."&amp;name&amp;vbCRLF&amp;strNotes)
                objFile.Close
            End If
        End If
    End Sub

    Sub SyncJira(currentModel, currentDiagram)
        notes = currentDiagram.notes
        set currentPackage = Repository.GetPackageByID(currentDiagram.PackageID)
        updated = 0
        created = 0
        If (Left(notes, 6) = "{jira:") Then
            WScript.echo " &gt;&gt;&gt;&gt; Diagram jira tag found"
            strSearch = Mid(notes,7,InStr(notes,"}")-7)
            Set objShell = CreateObject("WScript.Shell")
            'objShell.CurrentDirectory = fso.GetFolder("./scripts")
            Set objExecObject = objShell.Exec ("cmd /K  groovy ./scripts/exportJira.groovy """ &amp; strSearch &amp;""" &amp; exit")
            strReturn = ""
            x = 0
            y = 0
            Do While Not objExecObject.StdOut.AtEndOfStream
                output = objExecObject.StdOut.ReadLine()
                ' WScript.echo output
                jiraElement = Split(output,"|")
                name = jiraElement(0)&amp;":"&amp;vbCR&amp;vbLF&amp;jiraElement(4)
                On Error Resume Next
                Set requirement = currentPackage.Elements.GetByName(name)
                On Error Goto 0
                if (IsObject(requirement)) then
                    ' element already exists
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    updated = updated + 1
                else
                    Set requirement = currentPackage.Elements.AddNew(name,"Requirement")
                    requirement.notes = ""
                    requirement.notes = requirement.notes&amp;"&lt;a href='"&amp;jiraElement(5)&amp;"'&gt;"&amp;jiraElement(0)&amp;"&lt;/a&gt;"&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Priority: "&amp;jiraElement(1)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Created: "&amp;jiraElement(2)&amp;vbCR&amp;vbLF
                    requirement.notes = requirement.notes&amp;"Assignee: "&amp;jiraElement(3)&amp;vbCR&amp;vbLF
                    requirement.Update()
                    currentPackage.Elements.Refresh()
                    Set dia_obj = currentDiagram.DiagramObjects.AddNew("l="&amp;(10+x*200)&amp;";t="&amp;(10+y*50)&amp;";b="&amp;(10+y*50+44)&amp;";r="&amp;(10+x*200+180),"")
                    x = x + 1
                    if (x&gt;3) then
                      x = 0
                      y = y + 1
                    end if
                    dia_obj.ElementID = requirement.ElementID
                    dia_obj.Update()
                    created = created + 1
                end if
            Loop
            Set objShell = Nothing
            WScript.echo "created "&amp;created&amp;" requirements"
            WScript.echo "updated "&amp;updated&amp;" requirements"
        End If
    End Sub

    Sub SaveDiagram(currentModel, currentDiagram)
                ' Open the diagram
            Repository.OpenDiagram(currentDiagram.DiagramID)

            ' Save and close the diagram
            If (currentModel.Name="Model") Then
                ' When we work with the default model, we don't need a sub directory
                path = "/src/docs/images/ea/"
            Else
                path = "/src/docs/images/ea/" &amp; currentModel.Name &amp; "/"
            End If
            diagramName = Replace(currentDiagram.Name," ","_")
            diagramName = Replace(diagramName,vbCr,"")
            diagramName = Replace(diagramName,vbLf,"")
            filename = path &amp; diagramName &amp; ".png"
            MakeDir("." &amp; path)
            projectInterface.SaveDiagramImageToFile(fso.GetAbsolutePathName(".")&amp;filename)
            ' projectInterface.putDiagramImageToFile currentDiagram.DiagramID,fso.GetAbsolutePathName(".")&amp;filename,1
            WScript.echo " extracted image to ." &amp; filename
            Repository.CloseDiagram(currentDiagram.DiagramID)
            For Each diagramElement In currentDiagram.DiagramObjects
                Set currentElement = Repository.GetElementByID(diagramElement.ElementID)
                WriteNote currentModel, currentElement, currentElement.Notes, diagramName&amp;"_notes"
            Next
            For Each diagramLink In currentDiagram.DiagramLinks
                set currentConnector = Repository.GetConnectorByID(diagramLink.ConnectorID)
                WriteNote currentModel, currentConnector, currentConnector.Notes, diagramName&amp;"_links"
            Next
    End Sub
    '
    ' Recursively saves all diagrams under the provided package and its children
    '
    Sub DumpDiagrams(thePackage,currentModel)

        Set currentPackage = thePackage

        ' export element notes
        For Each currentElement In currentPackage.Elements
            WriteNote currentModel, currentElement, currentElement.Notes, ""
            ' export connector notes
            For Each currentConnector In currentElement.Connectors
                ' WScript.echo currentConnector.ConnectorGUID
                if (currentConnector.ClientID=currentElement.ElementID) Then
                    WriteNote currentModel, currentConnector, currentConnector.Notes, ""
                End If
            Next
            if (Not currentElement.CompositeDiagram Is Nothing) Then
                SyncJira currentModel, currentElement.CompositeDiagram
                SaveDiagram currentModel, currentElement.CompositeDiagram
            End If
            if (Not currentElement.Elements Is Nothing) Then
                DumpDiagrams currentElement,currentModel
            End If
        Next


        ' Iterate through all diagrams in the current package
        For Each currentDiagram In currentPackage.Diagrams
            SyncJira currentModel, currentDiagram
            SaveDiagram currentModel, currentDiagram
        Next

        ' Process child packages
        Dim childPackage 'as EA.Package
        ' otPackage = 5
        if (currentPackage.ObjectType = 5) Then
            For Each childPackage In currentPackage.Packages
                call DumpDiagrams(childPackage, currentModel)
            Next
        End If
    End Sub

		Function SearchEAProjects(path)

		  For Each folder In path.SubFolders
		    SearchEAProjects folder
		  Next

		  For Each file In path.Files
				If fso.GetExtensionName (file.Path) = "eap" Then
					WScript.echo "found "&amp;file.path
					OpenProject(file.Path)
				End If
		  Next

    End Function

    Sub OpenProject(file)
      ' open Enterprise Architect
      Set EAapp = CreateObject("EA.App")
      WScript.echo "opening Enterprise Architect. This might take a moment..."
      ' load project
      EAapp.Repository.OpenFile(file)
      ' make Enterprise Architect to not appear on screen
      EAapp.Visible = False

      ' get repository object
      Set Repository = EAapp.Repository
      ' Show the script output window
      ' Repository.EnsureOutputVisible("Script")

      Set projectInterface = Repository.GetProjectInterface()

      ' Iterate through all model nodes
      Dim currentModel 'As EA.Package
      For Each currentModel In Repository.Models
        ' Iterate through all child packages and save out their diagrams
        Dim childPackage 'As EA.Package
        For Each childPackage In currentModel.Packages
          call DumpDiagrams(childPackage,currentModel)
        Next
      Next
      EAapp.Repository.CloseFile()
    End Sub

  set fso = CreateObject("Scripting.fileSystemObject")
  WScript.echo "Image extractor"
  WScript.echo "looking for .eap files in " &amp; fso.GetAbsolutePathName(".") &amp; "/src"
  'Dim f As Scripting.Files
  SearchEAProjects fso.GetFolder("./src")
  WScript.echo "finished exporting images"</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_exportchangelog">3.10. exportChangeLog</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportChangeLog.png" alt="exportChangeLog">
</div>
</div>
<div class="paragraph">
<p>As the name says, this task exports the changelog to be referenced from within your documentation - if needed.</p>
</div>
<div class="paragraph">
<p>The source is the git changelog for the path <code>src/docs</code> - it only contains the commit messages for changes on the documentation.
All changes on the build or other sources from the repository will not show up.</p>
</div>
<div class="paragraph">
<p>The changelog is written to <code>build/docs/changelog.adoc</code> and contains the changes with <em>date</em>, <em>author</em> and <em>commit message</em> already formatted as AsciiDoc table content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>| 09.04.2017
| Ralf D. Mueller
| fix #24 template updated to V7.0

| 08.04.2017
| Ralf D. Mueller
| fixed typo</pre>
</div>
</div>
<div class="paragraph">
<p>You simply include it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.Changes
[options="header",cols="1,2,6"]
|====
| Date
| Author
| Comment

include::../../build/docs/changelog.adoc[]

|====</pre>
</div>
</div>
<div class="paragraph">
<p>By excluding the table definition, you can easily translate the table headings through different text snippets.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
it might make sense to only include certain commit messages from the change log or exclude others (starting with <code>#</code> or <code>//</code>?).
But this isn&#8217;t implemented yet.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_source_9">3.10.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task exportChangeLog(
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">exports the change log from a git subpath</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) doLast {
    <span class="comment">// https://git-scm.com/docs/pretty-formats</span>
    <span class="keyword">def</span> changes = <span class="string"><span class="delimiter">&quot;</span><span class="content">git log --pretty=format:%x7c%x20%ad%x20%n%x7c%x20%an%x20%n%x7c%x20%s%x20%n --date=short ./src/docs/arc42</span><span class="delimiter">&quot;</span></span>.execute().text
    <span class="keyword">new</span> <span class="predefined-type">File</span>(targetDir).mkdirs()
    <span class="keyword">def</span> changelog = <span class="keyword">new</span> <span class="predefined-type">File</span>(targetDir, <span class="string"><span class="delimiter">'</span><span class="content">changelog.adoc</span><span class="delimiter">'</span></span>)
    logger.info <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt; changelog exported</span><span class="delimiter">&quot;</span></span>
    changelog.write(changes)
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_exportjiraissues">3.11. exportJiraIssues</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportJiraIssues.png" alt="exportJiraIssues">
</div>
</div>
<div class="sect3">
<h4 id="_source_10">3.11.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task exportJiraIssues(
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">exports all jira issues from a given search</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) {
    doLast {
        <span class="keyword">def</span> user = jiraUser
        <span class="keyword">def</span> pass = jiraPass
        <span class="keyword">if</span> (!pass) {
            pass = <span class="predefined-type">System</span>.console().readPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">Jira password for user '</span><span class="inline"><span class="inline-delimiter">$</span>user</span><span class="content">': </span><span class="delimiter">&quot;</span></span>)
        }

        <span class="keyword">def</span> stats = [:]
        <span class="keyword">def</span> jira = <span class="keyword">new</span> groovyx.net.http.RESTClient(jiraRoot + <span class="string"><span class="delimiter">'</span><span class="content">/rest/api/2/</span><span class="delimiter">'</span></span>)
        jira.encoderRegistry = <span class="keyword">new</span> groovyx.net.http.EncoderRegistry(<span class="key">charset</span>: <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
        <span class="keyword">def</span> headers = [
                <span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic </span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>user<span class="inline-delimiter">}</span></span><span class="content">:</span><span class="inline"><span class="inline-delimiter">${</span>pass<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>.bytes.encodeBase64().toString(),
                <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span> : <span class="string"><span class="delimiter">'</span><span class="content">application/json; charset=utf-8</span><span class="delimiter">'</span></span>
        ]
        <span class="keyword">def</span> openIssues = <span class="keyword">new</span> <span class="predefined-type">File</span>(targetDir, <span class="string"><span class="delimiter">'</span><span class="content">openissues.adoc</span><span class="delimiter">'</span></span>)
        openIssues.write(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
        println jiraJql.replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">%jiraProject%</span><span class="delimiter">'</span></span>, jiraProject).replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">%jiraLabel%</span><span class="delimiter">'</span></span>, jiraLabel)
        jira.get(<span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">search</span><span class="delimiter">'</span></span>,
                <span class="key">query</span>: [<span class="string"><span class="delimiter">'</span><span class="content">jql</span><span class="delimiter">'</span></span>       : jiraJql.replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">%jiraProject%</span><span class="delimiter">'</span></span>, jiraProject).replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">%jiraLabel%</span><span class="delimiter">'</span></span>, jiraLabel),
                        <span class="string"><span class="delimiter">'</span><span class="content">maxResults</span><span class="delimiter">'</span></span>: <span class="integer">1000</span>,
                        <span class="string"><span class="delimiter">'</span><span class="content">fields</span><span class="delimiter">'</span></span>    : <span class="string"><span class="delimiter">'</span><span class="content">created,resolutiondate,priority,summary,timeoriginalestimate, assignee</span><span class="delimiter">'</span></span>
                ],
                <span class="key">headers</span>: headers
        ).data.issues.each { issue -&gt;
            openIssues.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">| &lt;&lt;</span><span class="inline"><span class="inline-delimiter">${</span>issue.key<span class="inline-delimiter">}</span></span><span class="content">&gt;&gt; </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
            openIssues.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">| </span><span class="inline"><span class="inline-delimiter">${</span>issue.fields.priority.name<span class="inline-delimiter">}</span></span><span class="content"> </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
            openIssues.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">| </span><span class="inline"><span class="inline-delimiter">${</span><span class="predefined-type">Date</span>.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd'T'H:m:s.000z</span><span class="delimiter">&quot;</span></span>, issue.fields.created).format(<span class="string"><span class="delimiter">'</span><span class="content">dd.MM.yy</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="content"> </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
            openIssues.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">| </span><span class="inline"><span class="inline-delimiter">${</span>issue.fields.assignee ? issue.fields.assignee.displayName : <span class="string"><span class="delimiter">'</span><span class="content">not assigned</span><span class="delimiter">'</span></span><span class="inline-delimiter">}</span></span><span class="content"> </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
            openIssues.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">| </span><span class="inline"><span class="inline-delimiter">${</span>jiraRoot<span class="inline-delimiter">}</span></span><span class="content">/browse/</span><span class="inline"><span class="inline-delimiter">${</span>issue.key<span class="inline-delimiter">}</span></span><span class="content">[</span><span class="inline"><span class="inline-delimiter">${</span>issue.fields.summary<span class="inline-delimiter">}</span></span><span class="content">]</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">utf-8</span><span class="delimiter">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_exportppt">3.12. exportPPT</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportPPT.png" alt="exportPPT">
</div>
</div>
<div class="sect3">
<h4 id="_source_11">3.12.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task exportPPT(
        <span class="key">dependsOn</span>: [streamingExecute],
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">exports all slides and some texts from PPT files</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) {
    doLast {
        <span class="comment">//make sure path for notes exists</span>
        <span class="comment">//and remove old notes</span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ppt</span><span class="delimiter">'</span></span>).deleteDir()
        <span class="comment">//also remove old diagrams</span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ppt</span><span class="delimiter">'</span></span>).deleteDir()
        <span class="comment">//create a readme to clarify things</span>
        <span class="keyword">def</span> readme = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">This folder contains exported slides or notes from .ppt presentations.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder        will be overwritten with each re-export!**

use `gradle exportPPT` to re-export files
</span><span class="delimiter">&quot;&quot;&quot;</span></span>
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ppt/.</span><span class="delimiter">'</span></span>).mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/images/ppt/readme.ad</span><span class="delimiter">'</span></span>).write(readme)
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ppt/.</span><span class="delimiter">'</span></span>).mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/ppt/readme.ad</span><span class="delimiter">'</span></span>).write(readme)
        <span class="comment">//execute through cscript in order to make sure that we get WScript.echo right</span>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">%SystemRoot%</span><span class="char">\\</span><span class="content">System32</span><span class="char">\\</span><span class="content">cscript.exe //nologo scripts/exportPPT.vbs</span><span class="delimiter">&quot;</span></span>.executeCmd()
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_exportexcel">3.13. exportExcel</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/exportExcel.png" alt="exportExcel">
</div>
</div>
<div class="paragraph">
<p>Sometimes you have tabular data to be included in your documentation.
Then it is likely that the data is available as excel sheet or you would like to use MS Excel to create and edit it.</p>
</div>
<div class="paragraph">
<p>Either way, this task lets you export your excel sheet and include it directly in your docs.</p>
</div>
<div class="paragraph">
<p>The task searches for <code>.xlsx</code> files and exports each contained worksheet as <code>.csv</code> and as <code>.adoc</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Formulars containes in your Workbook are evaluated and exported statically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated files are written to <code>src/excel/[filename]/[worksheet].(adoc|cvs)</code> .
The <code>src</code> and not <code>build</code> folder is chosen mainly to get a better history for all changes on the worksheets.</p>
</div>
<div class="paragraph">
<p>The files can be included either as AsciiDoc</p>
</div>
<div class="listingblock">
<div class="content">
<pre>include::excel/Sample.xlsx/Numerisch.adoc[]</pre>
</div>
</div>
<div class="paragraph">
<p>or as CSV file</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[options="header",format="csv"]
|===
include::excel/Sample.xlsx/Numerisch.csv[]
|===</pre>
</div>
</div>
<div class="paragraph">
<p>The AsciiDoc version gives you a bit more control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>horizontal and vertical alignment is preserved</p>
</li>
<li>
<p>line breaks are preserved</p>
</li>
<li>
<p>column width&#8201;&#8212;&#8201;relative to other columns is preserved</p>
</li>
<li>
<p>background colors are preserved.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_source_12">3.13.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">task exportExcel(
        <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">exports all excelsheets to csv and AsciiDoc</span><span class="delimiter">'</span></span>,
        <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">docToolchain</span><span class="delimiter">'</span></span>
) {
    doLast {
        <span class="predefined-type">File</span> sourceDir = file(srcDir)

        <span class="keyword">def</span> tree = fileTree(srcDir).include(<span class="string"><span class="delimiter">'</span><span class="content">**/*.xlsx</span><span class="delimiter">'</span></span>).exclude(<span class="string"><span class="delimiter">'</span><span class="content">**/~*</span><span class="delimiter">'</span></span>)

        <span class="keyword">def</span> exportFileDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(sourceDir, <span class="string"><span class="delimiter">'</span><span class="content">excel</span><span class="delimiter">'</span></span>)

        <span class="comment">//make sure path for notes exists</span>
        exportFileDir.deleteDir()
        <span class="comment">//create a readme to clarify things</span>
        <span class="keyword">def</span> readme = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">This folder contains exported workbooks from Excel.

Please note that these are generated files but reside in the `src`-folder in order to be versioned.

This is to make sure that they can be used from environments other than windows.

# Warning!

**The contents of this folder will be overwritten with each re-export!**

use `gradle exportExcel` to re-export files
</span><span class="delimiter">&quot;&quot;&quot;</span></span>
        exportFileDir.mkdirs()
        <span class="keyword">new</span> <span class="predefined-type">File</span>(exportFileDir, <span class="string"><span class="delimiter">'</span><span class="content">/readme.ad</span><span class="delimiter">'</span></span>).write(readme)

        <span class="keyword">def</span> nl = <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">line.separator</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">def</span> <span class="keyword">export</span> = { sheet, evaluator, targetFileName -&gt;
            <span class="keyword">def</span> targetFileCSV = <span class="keyword">new</span> <span class="predefined-type">File</span>(targetFileName + <span class="string"><span class="delimiter">'</span><span class="content">.csv</span><span class="delimiter">'</span></span>)
            <span class="keyword">def</span> targetFileAD = <span class="keyword">new</span> <span class="predefined-type">File</span>(targetFileName + <span class="string"><span class="delimiter">'</span><span class="content">.adoc</span><span class="delimiter">'</span></span>)
            <span class="keyword">def</span> df = <span class="keyword">new</span> org.apache.poi.ss.usermodel.DataFormatter();
            <span class="keyword">def</span> regions = <span class="type">[]</span>
            sheet.numMergedRegions.times {
                regions &lt;&lt; sheet.getMergedRegion(<span class="local-variable">it</span>)
            }
            logger.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">sheet contains </span><span class="inline"><span class="inline-delimiter">${</span>regions.size()<span class="inline-delimiter">}</span></span><span class="content"> regions</span><span class="delimiter">&quot;</span></span>
            <span class="keyword">def</span> color = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
            <span class="keyword">def</span> resetColor = <span class="predefined-constant">false</span>
            <span class="keyword">def</span> numCols = <span class="integer">0</span>
            <span class="keyword">def</span> headerCreated = <span class="predefined-constant">false</span>
            <span class="keyword">def</span> emptyRows = <span class="integer">0</span>
            <span class="keyword">for</span> (<span class="type">int</span> rowNum=<span class="integer">0</span>; rowNum&lt;=sheet.lastRowNum; rowNum++) {
                <span class="keyword">def</span> row = sheet.getRow(rowNum)
                <span class="keyword">if</span> (row &amp;&amp; !headerCreated) {
                    headerCreated = <span class="predefined-constant">true</span>
                    <span class="comment">// create AsciiDoc table header</span>
                    <span class="keyword">def</span> width = <span class="type">[]</span>
                    numCols = row.lastCellNum
                    numCols.times { columnIndex -&gt;
                        width &lt;&lt; sheet.getColumnWidth((<span class="type">int</span>) columnIndex)
                    }
                    <span class="comment">//lets make those numbers nicer:</span>
                    width = width.collect { <span class="predefined-type">Math</span>.round(<span class="integer">100</span> * <span class="local-variable">it</span> / width.sum()) }
                    targetFileAD.append(<span class="string"><span class="delimiter">'</span><span class="content">[options=&quot;header&quot;,cols=&quot;</span><span class="delimiter">'</span></span> + width.join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content">&quot;]</span><span class="delimiter">'</span></span> + nl)
                    targetFileAD.append(<span class="string"><span class="delimiter">'</span><span class="content">|===</span><span class="delimiter">'</span></span> + nl)
                }
                <span class="keyword">def</span> data = <span class="type">[]</span>
                <span class="keyword">def</span> style = <span class="type">[]</span>
                <span class="keyword">def</span> colors = <span class="type">[]</span>
                <span class="comment">// For each row, iterate through each columns</span>
                <span class="keyword">if</span> (row &amp;&amp; (row?.lastCellNum!=-<span class="integer">1</span>)) {
                    numCols.times { columnIndex -&gt;
                        <span class="keyword">def</span> cell = row.getCell(columnIndex)
                        <span class="keyword">if</span> (cell) {
                            <span class="keyword">def</span> cellValue = df.formatCellValue(cell, evaluator)
                            <span class="keyword">if</span> (cellValue.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>) &amp;&amp; cellValue.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">\u20AC</span><span class="delimiter">'</span></span>)) {
                                <span class="comment">// Remove special characters at currency</span>
                                cellValue = cellValue.substring(<span class="integer">1</span>).trim();
                            }
                            <span class="keyword">def</span> cellStyle = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
                            <span class="keyword">def</span> region = regions.find { <span class="local-variable">it</span>.isInRange(cell.rowIndex, cell.columnIndex) }
                            <span class="keyword">def</span> skipCell = <span class="predefined-constant">false</span>
                            <span class="keyword">if</span> (region) {
                                <span class="comment">//check if we are in the upper left corner of the region</span>
                                <span class="keyword">if</span> (region.firstRow == cell.rowIndex &amp;&amp; region.firstColumn == cell.columnIndex) {
                                    <span class="keyword">def</span> colspan = <span class="integer">1</span> + region.lastRow - region.firstRow
                                    <span class="keyword">def</span> rowspan = <span class="integer">1</span> + region.lastColumn - region.firstColumn
                                    <span class="keyword">if</span> (rowspan &gt; <span class="integer">1</span>) {
                                        cellStyle += <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rowspan<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
                                    }
                                    <span class="keyword">if</span> (colspan &gt; <span class="integer">1</span>) {
                                        cellStyle += <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="inline"><span class="inline-delimiter">${</span>colspan<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
                                    }
                                    cellStyle += <span class="string"><span class="delimiter">&quot;</span><span class="content">+</span><span class="delimiter">&quot;</span></span>
                                } <span class="keyword">else</span> {
                                    skipCell = <span class="predefined-constant">true</span>
                                }
                            }
                            <span class="keyword">if</span> (!skipCell) {
                                <span class="keyword">switch</span> (cell.cellStyle.alignmentEnum.toString()) {
                                    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">RIGHT</span><span class="delimiter">'</span></span>:
                                        cellStyle += <span class="string"><span class="delimiter">'</span><span class="content">&gt;</span><span class="delimiter">'</span></span>
                                        <span class="keyword">break</span>
                                    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">CENTER</span><span class="delimiter">'</span></span>:
                                        cellStyle += <span class="string"><span class="delimiter">'</span><span class="content">^</span><span class="delimiter">'</span></span>
                                        <span class="keyword">break</span>
                                }
                                <span class="keyword">switch</span> (cell.cellStyle.verticalAlignmentEnum.toString()) {
                                    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">BOTTOM</span><span class="delimiter">'</span></span>:
                                        cellStyle += <span class="string"><span class="delimiter">'</span><span class="content">.&gt;</span><span class="delimiter">'</span></span>
                                        <span class="keyword">break</span>
                                    <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">CENTER</span><span class="delimiter">'</span></span>:
                                        cellStyle += <span class="string"><span class="delimiter">'</span><span class="content">.^</span><span class="delimiter">'</span></span>
                                        <span class="keyword">break</span>
                                }
                                color = cell.cellStyle.fillForegroundXSSFColor?.rgb?.encodeHex()
                                color = color != <span class="predefined-constant">null</span> ? nl + <span class="string"><span class="delimiter">&quot;</span><span class="content">{set:cellbgcolor:#</span><span class="inline"><span class="inline-delimiter">${</span>color<span class="inline-delimiter">}</span></span><span class="content">}</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
                                data &lt;&lt; cellValue
                                <span class="keyword">if</span> (color == <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span> &amp;&amp; resetColor) {
                                    colors &lt;&lt; nl + <span class="string"><span class="delimiter">&quot;</span><span class="content">{set:cellbgcolor!}</span><span class="delimiter">&quot;</span></span>
                                    resetColor = <span class="predefined-constant">false</span>
                                } <span class="keyword">else</span> {
                                    colors &lt;&lt; color
                                }
                                <span class="keyword">if</span> (color != <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>) {
                                    resetColor = <span class="predefined-constant">true</span>
                                }
                                style &lt;&lt; cellStyle
                            } <span class="keyword">else</span> {
                                data &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                                colors &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                                style &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span>
                            }
                        } <span class="keyword">else</span> {
                            data &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                            colors &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                            style &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                        }

                    }
                    emptyRows = <span class="integer">0</span>
                } <span class="keyword">else</span> {
                    <span class="keyword">if</span> (emptyRows&lt;<span class="integer">3</span>) {
                        <span class="comment">//insert empty row</span>
                        numCols.times {
                            data &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                            colors &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                            style &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                        }
                        emptyRows++
                    } <span class="keyword">else</span> {
                        <span class="keyword">break</span>
                    }
                }

                targetFileCSV.append(data
                        .collect {
                    <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span>.replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&quot;&quot;</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>
                }
                .join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>) + nl, <span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>)
                targetFileAD.append(data
                        .withIndex()
                        .collect { value, index -&gt;
                    <span class="keyword">if</span> (style[index] == <span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span>) {
                        <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
                    } <span class="keyword">else</span> {
                        style[index] + <span class="string"><span class="delimiter">&quot;</span><span class="content">| </span><span class="inline"><span class="inline-delimiter">${</span>value.replaceAll(<span class="string"><span class="delimiter">'</span><span class="content">[|]</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">{vbar}</span><span class="delimiter">'</span></span>).replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content"> +$0</span><span class="delimiter">'</span></span>) + colors[index]<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
                    }
                }
                .join(nl) + nl * <span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>)
            }
            targetFileAD.append(<span class="string"><span class="delimiter">'</span><span class="content">|===</span><span class="delimiter">'</span></span> + nl)
        }


        tree.each { <span class="predefined-type">File</span> excel -&gt;
            println excel
            <span class="keyword">def</span> excelDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(exportFileDir, excel.getName())
            excelDir.mkdirs()
            <span class="predefined-type">InputStream</span> inp
            inp = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(excel)
            <span class="keyword">def</span> wb = org.apache.poi.ss.usermodel.WorkbookFactory.create(inp);
            <span class="keyword">def</span> evaluator = wb.getCreationHelper().createFormulaEvaluator();
            <span class="keyword">for</span> (<span class="type">int</span> wbi = <span class="integer">0</span>; wbi &lt; wb.getNumberOfSheets(); wbi++) {
                <span class="keyword">def</span> sheetName = wb.getSheetAt(wbi).getSheetName()
                println sheetName
                <span class="keyword">def</span> targetFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(excelDir, sheetName)
                <span class="keyword">export</span>(wb.getSheetAt(wbi), evaluator, targetFile.getAbsolutePath())
            }
            inp.close();
        }
    }
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_htmlsanitycheck">3.14. htmlSanityCheck</h3>
<div class="imageblock">
<div class="content">
<img src="images/ea/Manual/htmlSanityCheck.png" alt="htmlSanityCheck">
</div>
</div>
<div class="paragraph">
<p>This task invokes the <a href="https://github.com/aim42/htmlSanityCheck">htmlSanityCheck</a> gradle plugin.
It is a Standalone (batch- and command-line) html sanity checker - detects missing images, dead links, duplicate bookmarks.</p>
</div>
<div class="paragraph">
<p>In docToolchain, this task is used to ensure that the generated HTML contains no missing links or other problems.</p>
</div>
<div class="paragraph">
<p>This task is the last default task and creates a report in <code>build/report/htmlchecks/index.html</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/manual/htmlSanityCheck.png" alt="htmlSanityCheck">
</div>
<div class="title">Figure 3. sample report</div>
</div>
<div class="paragraph">
<p>Further information can be found on github: <a href="https://github.com/aim42/htmlSanityCheck" class="bare">https://github.com/aim42/htmlSanityCheck</a></p>
</div>
<div class="sect3">
<h4 id="_source_13">3.14.1. Source</h4>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">htmlSanityCheck {
    sourceDir = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>targetDir</span><span class="content">/html5</span><span class="delimiter">&quot;</span></span>)

    <span class="comment">// files to check - in Set-notation</span>
    <span class="comment">//sourceDocuments = [ &quot;one-file.html&quot;, &quot;another-file.html&quot;, &quot;index.html&quot;]</span>

    <span class="comment">// where to put results of sanityChecks...</span>
    checkingResultsDir = <span class="keyword">new</span> <span class="predefined-type">File</span>( checkingResultsPath )
    checkExternalLinks = <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_dependencyupdates">3.15. dependencyUpdates</h3>
<div class="paragraph">
<p>This task uses the <a href="https://github.com/ben-manes/gradle-versions-plugin">Gradle versions plugin</a> created by Ben Manes to check for outdated build dependencies.
Quite helpful to keep all dependencies up-to-date.</p>
</div>
<hr>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_reading">4. Further Reading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter lists some additional references to interesting resources.</p>
</div>
<div class="sect2">
<h3 id="_links">4.1. Links</h3>
<div class="ulist">
<ul>
<li>
<p><strong>AsciiDoc</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="http://asciidoctor.org/docs/user-manual/">Asciidoctor User-Manual</a></p>
</li>
<li>
<p><a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">AsciiDoc Syntax Quick Reference</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>arc42</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="http://arc42.org/">arc42</a></p>
</li>
<li>
<p><a href="http://docs.arc42.org/home/">arc42 Tips &amp; Tricks</a></p>
</li>
<li>
<p><a href="http://faq.arc42.org/home/">rc42 FAQ</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://rdmueller.github.io/">the docToolchain Blog</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_books">4.2. Books</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
links to amazon are affiliate links
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_english_books">4.2.1. English Books</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://amzn.to/2smRhxE">DOCS-LIKE-CODE</a> by Anne Gentle</p>
</li>
<li>
<p><a href="http://amzn.to/2sn0kyx">Modern technical writing: An Introduction to Software Documentation</a> by Andrew Etter</p>
</li>
<li>
<p><a href="https://leanpub.com/arc42byexample">arc42 by Example</a> by Gernot Starke, Stefan Zörner, Michael Simons</p>
</li>
<li>
<p><a href="https://leanpub.com/arc42inpractice">Communicating Software Architectures with arc42</a> by Gernot Starke und Peter Hruschka</p>
</li>
<li>
<p><a href="https://leanpub.com/visualising-software-architecture">Visualise, document and explore your software architecture</a> by Simon Brown</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_german_books">4.2.2. German Books</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://amzn.to/2smM5Kp">arc42 in Aktion: Praktische Tipps zur Architekturdokumentation</a> von Gernot Starke und Peter Hruschka</p>
</li>
<li>
<p><a href="http://amzn.to/2ru9Yvr">Softwarearchitekturen dokumentieren und kommunizieren: Entwürfe, Entscheidungen und Lösungen nachvollziehbar und wirkungsvoll festhalten</a> von Stefan Zörner</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_past_and_upcoming_talks">4.3. Past and upcoming Talks</h3>
<div class="sect3">
<h4 id="_dokumentation_am_riesen_beispiel_arc42_asciidoc_und_co_in_aktion">4.3.1. Dokumentation am (Riesen-)Beispiel – arc42, AsciiDoc und Co. in Aktion</h4>
<div class="paragraph">
<p><a href="https://twitter.com/gernotstarke">Gernot Starke</a> and <a href="https://twitter.com/ralfdmueller">Ralf D. Müller</a></p>
</div>
<div class="paragraph">
<p>Anhand eines großen Systems zeigen Gernot und Ralf, wie Sie mit ziemlich wenig Aufwand angemessene und vernünftige Dokumentation für unterschiedliche Stakeholder produzieren – sodass Entwicklungsteams dabei auch noch Spaß haben.</p>
</div>
<div class="paragraph">
<p>Unser Rezept: AsciiDoc mit arc42 mischen, Automatisierung mit Gradle und Maven hinzufügen und mit Diagramm- oder Modellierungstools Ihrer Wahl kombinieren.
Schon sind schicke HTML- und reviewfähige PDF-Dokumente fertig.
Auf Wunsch gibts DOCX und Confluence als Zugabe.</p>
</div>
<div class="paragraph">
<p>Wir zeigen, wie Sie Doku genau wie Quellcode verwalten können, stakeholderspezifische Dokumente erzeugen und Diagramme automatisiert integrieren können.
Einige Teile dieser Doku können Sie sogar automatisiert testen.</p>
</div>
<div class="paragraph">
<p>Zwischendurch bekommen Sie zahlreiche Tipps, wie und wo Sie systematisch den Aufwand für Dokumentation reduzieren können und trotzdem lesbare, verständliche und praxistaugliche Ergebnisse produzieren.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="https://speakerdeck.com/rdmueller/dokumentation-am-riesen-beispiel-arc42-asciidoc-und-co-in-aktion"><img src="images/manual/speakerdeck1.png" alt="speakerdeck1"></a>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gesunde_dokumentation_mit_asciidoctor">4.3.2. Gesunde Dokumentation mit Asciidoctor</h4>
<div class="paragraph">
<p><a href="https://twitter.com/ahus1de">Alexander Schwartz</a></p>
</div>
<div class="paragraph">
<p>Autoren möchten Inhalte effizient dokumentieren und vorhandene Inhalte wiederverwenden. Ein Leser möchte das Dokument in einem ansprechenden Layout präsentiert bekommen.</p>
</div>
<div class="paragraph">
<p>Das textbasierte Asciidoc-Format bietet für einen Entwickler oder technischen Redakteur alle notwendigen Auszeichungselemente, um auch anspruchsvolle Dokumente zu schreiben. So werden unter anderem Tabellen, Fußnoten und annotierte Quellcodes unterstützt. Gleichzeitig ist es ähnlich leichtgewichtig wie z.B. das Markdown Format. Für die Leser wird HTML, PDF oder EPUB generiert.</p>
</div>
<div class="paragraph">
<p>Da Asciidoc wie Programmcode eingecheckt wird und Merge-Operationen einfach möglich sind, können Programmcode und Dokumentation zusammen versioniert und auf einem einheitlichen Stand gehalten werden.</p>
</div>
<div class="paragraph">
<p>Der Vortrag gibt eine kurze Einführung in Asciidoc und die dazugehörigen Werkzeuge.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<a class="image" href="https://speakerdeck.com/ahus1/gesunde-dokumentation-mit-asciidoctor"><img src="images/manual/speakerdeck2.png" alt="speakerdeck2"></a>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements_and_contributors">5. Acknowledgements and Contributors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project is an open source project which is based on community efforts.</p>
</div>
<div class="paragraph">
<p>Many people are involved in the underlying technologies like AsciiDoc, Asciidoctor, Gradle, arc42 etc.
This project depends and build on them.</p>
</div>
<div class="paragraph">
<p>But it even more depends on the direct contributions made through giving feedback, creating issues, answering questions or sending pull requests.</p>
</div>
<div class="paragraph">
<p>Here is an incomplete and unordered list of contributors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/bodewig">Stefan Bodewig</a></p>
</li>
<li>
<p><a href="https://github.com/MoePad">MoePad</a></p>
</li>
<li>
<p><a href="https://github.com/opensource21">Niels</a></p>
</li>
<li>
<p><a href="https://github.com/wschaef">wschaef</a></p>
</li>
<li>
<p><a href="https://github.com/gernotstarke">Gernot Starke</a></p>
</li>
<li>
<p><a href="https://github.com/ahus1">Alexander Schwartz</a></p>
</li>
<li>
<p><a href="https://github.com/aheusingfeld">Alexander Heusingfeld</a></p>
</li>
<li>
<p><a href="https://github.com/mojavelinux">Dan Allen</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-09-25 21:54:12 CEST
</div>
</div>
</body>
</html>